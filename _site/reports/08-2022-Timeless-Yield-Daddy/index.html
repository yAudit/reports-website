

<!DOCTYPE html>

<html lang="en-US">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge">

  

  <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">


  <link rel="stylesheet" href="/assets/css/just-the-docs-default.css">

  

  
    <script type="text/javascript" src="/assets/js/vendor/lunr.min.js"></script>
  

  
    <script src="https://cdn.jsdelivr.net/npm/mermaid@9.1.6/dist/mermaid.min.js"></script>
  

  <script type="text/javascript" src="/assets/js/just-the-docs.js"></script>
  <script defer data-domain="reports.yAudit.dev" src="https://plausible.io/js/script.js"></script>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>08-2022-Timeless-Yield-Daddy | yAudit Reports</title>
<meta name="generator" content="Jekyll v3.9.2" />
<meta property="og:title" content="08-2022-Timeless-Yield-Daddy" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Timeless Yield Daddy yAcademy Report" />
<meta property="og:description" content="Timeless Yield Daddy yAcademy Report" />
<link rel="canonical" href="http://localhost:4000/reports/08-2022-Timeless-Yield-Daddy/" />
<meta property="og:url" content="http://localhost:4000/reports/08-2022-Timeless-Yield-Daddy/" />
<meta property="og:site_name" content="yAudit Reports" />
<meta property="og:image" content="http://localhost:4000/assets/images/logo.png" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary_large_image" />
<meta property="twitter:image" content="http://localhost:4000/assets/images/logo.png" />
<meta property="twitter:title" content="08-2022-Timeless-Yield-Daddy" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","description":"Timeless Yield Daddy yAcademy Report","headline":"08-2022-Timeless-Yield-Daddy","image":"http://localhost:4000/assets/images/logo.png","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"http://localhost:4000/assets/images/yaudit-logo.jpg"}},"url":"http://localhost:4000/reports/08-2022-Timeless-Yield-Daddy/"}</script>
<!-- End Jekyll SEO tag -->


  

</head>

<body>
  <a class="skip-to-main" href="#main-content">Skip to main content</a>
  <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
    <symbol id="svg-link" viewBox="0 0 24 24">
      <title>Link</title>
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link">
        <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
      </svg>
    </symbol>
    <symbol id="svg-search" viewBox="0 0 24 24">
      <title>Search</title>
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search">
        <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line>
      </svg>
    </symbol>
    <symbol id="svg-menu" viewBox="0 0 24 24">
      <title>Menu</title>
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu">
        <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line>
      </svg>
    </symbol>
    <symbol id="svg-arrow-right" viewBox="0 0 24 24">
      <title>Expand</title>
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right">
        <polyline points="9 18 15 12 9 6"></polyline>
      </svg>
    </symbol>
    <symbol id="svg-doc" viewBox="0 0 24 24">
      <title>Document</title>
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file">
        <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline>
      </svg>
    </symbol>
    <!-- Feather. MIT License: https://github.com/feathericons/feather/blob/master/LICENSE -->
<symbol id="svg-external-link" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-external-link">
  <title id="svg-external-link-title">(external link)</title>
  <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line>
</symbol>

  </svg>

  <div class="side-bar">
    <div class="site-header">
      <a href="/" class="site-title lh-tight">
  <div class="site-logo"></div>

</a>
      <a href="#" id="menu-button" class="site-button">
        <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg>
      </a>
    </div>
    <nav role="navigation" aria-label="Main" id="site-nav" class="site-nav">
      
      
        <ul class="nav-list"><li class="nav-list-item"><a href="/" class="nav-list-link">yAudit Reports</a></li><li class="nav-list-item"><a href="/reports/03-2022-Ohm/" class="nav-list-link">03-2022-Ohm</a></li><li class="nav-list-item"><a href="/reports/04-2022-Ohm-Bond/" class="nav-list-link">04-2022-Ohm-Bond</a></li><li class="nav-list-item"><a href="/reports/04-2022-veYFI/" class="nav-list-link">04-2022-veYFI</a></li><li class="nav-list-item"><a href="/reports/05-2022-OpenMEVRouter/" class="nav-list-link">05-2022-OpenMEV</a></li><li class="nav-list-item"><a href="/reports/08-2022-Bunni/" class="nav-list-link">08-2022-Bunni</a></li><li class="nav-list-item active"><a href="/reports/08-2022-Timeless-Yield-Daddy/" class="nav-list-link active">08-2022-Timeless-Yield-Daddy</a></li><li class="nav-list-item"><a href="/reports/09-2022-yFu-NFT/" class="nav-list-link">09-2022-yFu-NFT</a></li><li class="nav-list-item"><a href="/reports/10-2022-NounsDAO-Token-Buyer/" class="nav-list-link">10-2022-NounsDAO-Token-Buyer</a></li><li class="nav-list-item"><a href="/reports/12-2022-Gro-Protocol/" class="nav-list-link">12-2022-Gro-Protocol</a></li><li class="nav-list-item external">
      <a href="https://yaudit.dev/" class="nav-list-link external">
        yAudit Website
        <svg viewBox="0 0 24 24" aria-labelledby="svg-external-link-title"><use xlink:href="#svg-external-link"></use></svg>
      </a>
    </li></ul>
      
      
    </nav>

    
    
      <footer class="site-footer">
        <!-- This site uses <a href="https://github.com/just-the-docs/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. -->
      </footer>
    
  </div>
  <div class="main" id="top">
    <div id="main-header" class="main-header">
      

        

        <div class="search">
          <div class="search-input-wrap">
            <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search yAudit Reports" aria-label="Search yAudit Reports" autocomplete="off">
            <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label>
          </div>
          <div id="search-results" class="search-results"></div>
        </div>
      
      
      
    </div>
    <div id="main-content-wrap" class="main-content-wrap">
      
        
      
      <div id="main-content" class="main-content" role="main">
        
          <h1 class="no_toc" id="yacademy-timeless-yield-daddy-review">
        
        
          <a href="#yacademy-timeless-yield-daddy-review" class="anchor-heading" aria-labelledby="yacademy-timeless-yield-daddy-review"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> yAcademy Timeless Yield Daddy review
        
        
      </h1>
    

<p><strong>Review Resources:</strong>
None beyond the code repositories</p>

<p><strong>Residents:</strong></p>
<ul>
  <li>engn33r</li>
  <li>Benjamin Samuels</li>
</ul>
      <h2 class="no_toc" id="table-of-contents">
        
        
          <a href="#table-of-contents" class="anchor-heading" aria-labelledby="table-of-contents"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Table of Contents
        
        
      </h2>
    

<ol id="markdown-toc">
  <li><a href="#review-summary" id="markdown-toc-review-summary">Review Summary</a></li>
  <li><a href="#scope" id="markdown-toc-scope">Scope</a></li>
  <li><a href="#code-evaluation-matrix" id="markdown-toc-code-evaluation-matrix">Code Evaluation Matrix</a></li>
  <li><a href="#findings-explanation" id="markdown-toc-findings-explanation">Findings Explanation</a></li>
  <li><a href="#high-findings" id="markdown-toc-high-findings">High Findings</a>    <ol>
      <li><a href="#1-high---incorrect-order-of-operations-in-libcompoundsol-engn33r" id="markdown-toc-1-high---incorrect-order-of-operations-in-libcompoundsol-engn33r">1. High - Incorrect order of operations in LibCompound.sol (engn33r)</a>        <ol>
          <li><a href="#technical-details" id="markdown-toc-technical-details">Technical Details</a></li>
          <li><a href="#impact" id="markdown-toc-impact">Impact</a></li>
          <li><a href="#recommendation" id="markdown-toc-recommendation">Recommendation</a></li>
          <li><a href="#developer-response" id="markdown-toc-developer-response">Developer Response</a></li>
        </ol>
      </li>
      <li><a href="#2-high---user-can-set-arbitrary-approvemaxifneeded-target-engn33r" id="markdown-toc-2-high---user-can-set-arbitrary-approvemaxifneeded-target-engn33r">2. High - User can set arbitrary <code class="language-plaintext highlighter-rouge">approveMaxIfNeeded()</code> target (engn33r)</a>        <ol>
          <li><a href="#technical-details-1" id="markdown-toc-technical-details-1">Technical Details</a></li>
          <li><a href="#impact-1" id="markdown-toc-impact-1">Impact</a></li>
          <li><a href="#recommendation-1" id="markdown-toc-recommendation-1">Recommendation</a></li>
          <li><a href="#developer-response-1" id="markdown-toc-developer-response-1">Developer Response</a></li>
        </ol>
      </li>
      <li><a href="#3-high---lack-of-slippage-protection-in-curve-swaps-engn33r" id="markdown-toc-3-high---lack-of-slippage-protection-in-curve-swaps-engn33r">3. High - Lack of slippage protection in Curve swaps (engn33r)</a>        <ol>
          <li><a href="#technical-details-2" id="markdown-toc-technical-details-2">Technical Details</a></li>
          <li><a href="#impact-2" id="markdown-toc-impact-2">Impact</a></li>
          <li><a href="#recommendation-2" id="markdown-toc-recommendation-2">Recommendation</a></li>
          <li><a href="#developer-response-2" id="markdown-toc-developer-response-2">Developer Response</a></li>
        </ol>
      </li>
    </ol>
  </li>
  <li><a href="#medium-findings" id="markdown-toc-medium-findings">Medium Findings</a>    <ol>
      <li><a href="#1-medium---accrued-rewards-may-not-be-returned-to-depositors-engn33r" id="markdown-toc-1-medium---accrued-rewards-may-not-be-returned-to-depositors-engn33r">1. Medium - Accrued rewards may not be returned to depositors (engn33r)</a>        <ol>
          <li><a href="#technical-details-3" id="markdown-toc-technical-details-3">Technical Details</a></li>
          <li><a href="#impact-3" id="markdown-toc-impact-3">Impact</a></li>
          <li><a href="#recommendation-3" id="markdown-toc-recommendation-3">Recommendation</a></li>
          <li><a href="#developer-response-3" id="markdown-toc-developer-response-3">Developer Response</a></li>
        </ol>
      </li>
      <li><a href="#2-medium---bypass-to-add-cetheraddress-to-underlyingtoctoken-array-engn33r" id="markdown-toc-2-medium---bypass-to-add-cetheraddress-to-underlyingtoctoken-array-engn33r">2. Medium - Bypass to add <code class="language-plaintext highlighter-rouge">cEtherAddress</code> to <code class="language-plaintext highlighter-rouge">underlyingToCToken</code> array (engn33r)</a>        <ol>
          <li><a href="#technical-details-4" id="markdown-toc-technical-details-4">Technical Details</a></li>
          <li><a href="#impact-4" id="markdown-toc-impact-4">Impact</a></li>
          <li><a href="#recommendation-4" id="markdown-toc-recommendation-4">Recommendation</a></li>
          <li><a href="#developer-response-4" id="markdown-toc-developer-response-4">Developer Response</a></li>
        </ol>
      </li>
      <li><a href="#3-medium---improper-wrapethinput-call-can-cause-value-loss-engn33r" id="markdown-toc-3-medium---improper-wrapethinput-call-can-cause-value-loss-engn33r">3. Medium - Improper <code class="language-plaintext highlighter-rouge">wrapEthInput()</code> call can cause value loss (engn33r)</a>        <ol>
          <li><a href="#technical-details-5" id="markdown-toc-technical-details-5">Technical Details</a></li>
          <li><a href="#impact-5" id="markdown-toc-impact-5">Impact</a></li>
          <li><a href="#recommendation-5" id="markdown-toc-recommendation-5">Recommendation</a></li>
          <li><a href="#developer-response-5" id="markdown-toc-developer-response-5">Developer Response</a></li>
        </ol>
      </li>
      <li><a href="#4-medium---erc20-tokens-sitting-in-contracts-can-be-extracted-engn33r" id="markdown-toc-4-medium---erc20-tokens-sitting-in-contracts-can-be-extracted-engn33r">4. Medium - ERC20 tokens sitting in contracts can be extracted (engn33r)</a>        <ol>
          <li><a href="#technical-details-6" id="markdown-toc-technical-details-6">Technical Details</a></li>
          <li><a href="#impact-6" id="markdown-toc-impact-6">Impact</a></li>
          <li><a href="#recommendation-6" id="markdown-toc-recommendation-6">Recommendation</a></li>
          <li><a href="#developer-response-6" id="markdown-toc-developer-response-6">Developer Response</a></li>
        </ol>
      </li>
    </ol>
  </li>
  <li><a href="#low-findings" id="markdown-toc-low-findings">Low Findings</a>    <ol>
      <li><a href="#1-low---difficult-to-use-withdraw-with-full-deposit-engn33r" id="markdown-toc-1-low---difficult-to-use-withdraw-with-full-deposit-engn33r">1. Low - Difficult to use <code class="language-plaintext highlighter-rouge">withdraw()</code> with full deposit (engn33r)</a>        <ol>
          <li><a href="#technical-details-7" id="markdown-toc-technical-details-7">Technical Details</a></li>
          <li><a href="#impact-7" id="markdown-toc-impact-7">Impact</a></li>
          <li><a href="#recommendation-7" id="markdown-toc-recommendation-7">Recommendation</a></li>
          <li><a href="#developer-response-7" id="markdown-toc-developer-response-7">Developer Response</a></li>
        </ol>
      </li>
      <li><a href="#2-low---inaccurate-function-return-values-engn33r" id="markdown-toc-2-low---inaccurate-function-return-values-engn33r">2. Low - Inaccurate function return values (engn33r)</a>        <ol>
          <li><a href="#technical-details-8" id="markdown-toc-technical-details-8">Technical Details</a></li>
          <li><a href="#impact-8" id="markdown-toc-impact-8">Impact</a></li>
          <li><a href="#recommendation-8" id="markdown-toc-recommendation-8">Recommendation</a></li>
          <li><a href="#developer-response-8" id="markdown-toc-developer-response-8">Developer Response</a></li>
        </ol>
      </li>
      <li><a href="#3-low---no-fee-on-transfer-token-support-engn33r" id="markdown-toc-3-low---no-fee-on-transfer-token-support-engn33r">3. Low - No fee-on-transfer token support (engn33r)</a>        <ol>
          <li><a href="#technical-details-9" id="markdown-toc-technical-details-9">Technical Details</a></li>
          <li><a href="#impact-9" id="markdown-toc-impact-9">Impact</a></li>
          <li><a href="#recommendation-9" id="markdown-toc-recommendation-9">Recommendation</a></li>
          <li><a href="#developer-response-9" id="markdown-toc-developer-response-9">Developer Response</a></li>
        </ol>
      </li>
      <li><a href="#4-low---curves-price_oracle-may-provide-less-effective-sandwiching-protection-post-merge-benjamin-samuels" id="markdown-toc-4-low---curves-price_oracle-may-provide-less-effective-sandwiching-protection-post-merge-benjamin-samuels">4. Low - Curve’s <code class="language-plaintext highlighter-rouge">price_oracle()</code> may provide less effective sandwiching protection post-merge (Benjamin Samuels)</a>        <ol>
          <li><a href="#technical-details-10" id="markdown-toc-technical-details-10">Technical Details</a></li>
          <li><a href="#impact-10" id="markdown-toc-impact-10">Impact</a></li>
          <li><a href="#recommendation-10" id="markdown-toc-recommendation-10">Recommendation</a></li>
          <li><a href="#developer-response-10" id="markdown-toc-developer-response-10">Developer Response</a></li>
        </ol>
      </li>
      <li><a href="#5-low---insufficient-swapargs-input-validation-engn33r" id="markdown-toc-5-low---insufficient-swapargs-input-validation-engn33r">5. Low - Insufficient SwapArgs input validation (engn33r)</a>        <ol>
          <li><a href="#technical-details-11" id="markdown-toc-technical-details-11">Technical Details</a></li>
          <li><a href="#impact-11" id="markdown-toc-impact-11">Impact</a></li>
          <li><a href="#recommendation-11" id="markdown-toc-recommendation-11">Recommendation</a></li>
          <li><a href="#developer-response-11" id="markdown-toc-developer-response-11">Developer Response</a></li>
        </ol>
      </li>
      <li><a href="#6-low---curve-swap-design-may-generate-unexpected-nytpyt-dust-benjamin-samuels" id="markdown-toc-6-low---curve-swap-design-may-generate-unexpected-nytpyt-dust-benjamin-samuels">6. Low - Curve Swap design may generate unexpected NYT/PYT dust (Benjamin Samuels)</a>        <ol>
          <li><a href="#technical-details-12" id="markdown-toc-technical-details-12">Technical Details</a></li>
          <li><a href="#impact-12" id="markdown-toc-impact-12">Impact</a></li>
          <li><a href="#recommendation-12" id="markdown-toc-recommendation-12">Recommendation</a></li>
          <li><a href="#developer-response-12" id="markdown-toc-developer-response-12">Developer Response</a></li>
        </ol>
      </li>
      <li><a href="#7-low---xpyt-deployment-lacks-trust-mechanism-engn33r" id="markdown-toc-7-low---xpyt-deployment-lacks-trust-mechanism-engn33r">7. Low - xPYT deployment lacks trust mechanism (engn33r)</a>        <ol>
          <li><a href="#technical-details-13" id="markdown-toc-technical-details-13">Technical Details</a></li>
          <li><a href="#impact-13" id="markdown-toc-impact-13">Impact</a></li>
          <li><a href="#recommendation-13" id="markdown-toc-recommendation-13">Recommendation</a></li>
          <li><a href="#developer-response-13" id="markdown-toc-developer-response-13">Developer Response</a></li>
        </ol>
      </li>
      <li><a href="#8-low---missing-pytnyt-lookup-mechanism-engn33r" id="markdown-toc-8-low---missing-pytnyt-lookup-mechanism-engn33r">8. Low - Missing PYT/NYT lookup mechanism (engn33r)</a>        <ol>
          <li><a href="#technical-details-14" id="markdown-toc-technical-details-14">Technical Details</a></li>
          <li><a href="#impact-14" id="markdown-toc-impact-14">Impact</a></li>
          <li><a href="#recommendation-14" id="markdown-toc-recommendation-14">Recommendation</a></li>
          <li><a href="#developer-response-14" id="markdown-toc-developer-response-14">Developer Response</a></li>
        </ol>
      </li>
    </ol>
  </li>
  <li><a href="#gas-savings-findings" id="markdown-toc-gas-savings-findings">Gas Savings Findings</a>    <ol>
      <li><a href="#1-gas---replace-require-blocks-with-errors-engn33r" id="markdown-toc-1-gas---replace-require-blocks-with-errors-engn33r">1. Gas - Replace require blocks with errors (engn33r)</a>        <ol>
          <li><a href="#technical-details-15" id="markdown-toc-technical-details-15">Technical Details</a></li>
          <li><a href="#impact-15" id="markdown-toc-impact-15">Impact</a></li>
          <li><a href="#recommendation-15" id="markdown-toc-recommendation-15">Recommendation</a></li>
          <li><a href="#developer-response-15" id="markdown-toc-developer-response-15">Developer Response</a></li>
        </ol>
      </li>
      <li><a href="#2-gas---declare-variables-internal-immutable-or-constant-when-possible-engn33r" id="markdown-toc-2-gas---declare-variables-internal-immutable-or-constant-when-possible-engn33r">2. Gas - Declare variables internal, immutable, or constant when possible (engn33r)</a>        <ol>
          <li><a href="#technical-details-16" id="markdown-toc-technical-details-16">Technical Details</a></li>
          <li><a href="#impact-16" id="markdown-toc-impact-16">Impact</a></li>
          <li><a href="#recommendation-16" id="markdown-toc-recommendation-16">Recommendation</a></li>
          <li><a href="#developer-response-16" id="markdown-toc-developer-response-16">Developer Response</a></li>
        </ol>
      </li>
      <li><a href="#3-gas---remove-beforewithdraw-calls-engn33r" id="markdown-toc-3-gas---remove-beforewithdraw-calls-engn33r">3. Gas - Remove <code class="language-plaintext highlighter-rouge">beforeWithdraw()</code> calls (engn33r)</a>        <ol>
          <li><a href="#technical-details-17" id="markdown-toc-technical-details-17">Technical Details</a></li>
          <li><a href="#impact-17" id="markdown-toc-impact-17">Impact</a></li>
          <li><a href="#recommendation-17" id="markdown-toc-recommendation-17">Recommendation</a></li>
          <li><a href="#developer-response-17" id="markdown-toc-developer-response-17">Developer Response</a></li>
        </ol>
      </li>
      <li><a href="#4-gas---replace-duplicate-code-with-internal-function-engn33r" id="markdown-toc-4-gas---replace-duplicate-code-with-internal-function-engn33r">4. Gas - Replace duplicate code with internal function (engn33r)</a>        <ol>
          <li><a href="#technical-details-18" id="markdown-toc-technical-details-18">Technical Details</a></li>
          <li><a href="#impact-18" id="markdown-toc-impact-18">Impact</a></li>
          <li><a href="#recommendation-18" id="markdown-toc-recommendation-18">Recommendation</a></li>
          <li><a href="#developer-response-18" id="markdown-toc-developer-response-18">Developer Response</a></li>
        </ol>
      </li>
      <li><a href="#5-gas---declare-functions-external-for-gas-savings-engn33r" id="markdown-toc-5-gas---declare-functions-external-for-gas-savings-engn33r">5. Gas - Declare functions external for gas savings (engn33r)</a>        <ol>
          <li><a href="#technical-details-19" id="markdown-toc-technical-details-19">Technical Details</a></li>
          <li><a href="#impact-19" id="markdown-toc-impact-19">Impact</a></li>
          <li><a href="#recommendation-19" id="markdown-toc-recommendation-19">Recommendation</a></li>
          <li><a href="#developer-response-19" id="markdown-toc-developer-response-19">Developer Response</a></li>
        </ol>
      </li>
      <li><a href="#6-gas---use-claimcomp-with-borrowers--false-engn33r" id="markdown-toc-6-gas---use-claimcomp-with-borrowers--false-engn33r">6. Gas - Use <code class="language-plaintext highlighter-rouge">claimComp()</code> with borrowers = false (engn33r)</a>        <ol>
          <li><a href="#technical-details-20" id="markdown-toc-technical-details-20">Technical Details</a></li>
          <li><a href="#impact-20" id="markdown-toc-impact-20">Impact</a></li>
          <li><a href="#recommendation-20" id="markdown-toc-recommendation-20">Recommendation</a></li>
          <li><a href="#developer-response-20" id="markdown-toc-developer-response-20">Developer Response</a></li>
        </ol>
      </li>
      <li><a href="#7-gas---use-unchecked-if-no-underflow-risk-engn33r" id="markdown-toc-7-gas---use-unchecked-if-no-underflow-risk-engn33r">7. Gas - Use unchecked if no underflow risk (engn33r)</a>        <ol>
          <li><a href="#technical-details-21" id="markdown-toc-technical-details-21">Technical Details</a></li>
          <li><a href="#impact-21" id="markdown-toc-impact-21">Impact</a></li>
          <li><a href="#recommendation-21" id="markdown-toc-recommendation-21">Recommendation</a></li>
          <li><a href="#developer-response-21" id="markdown-toc-developer-response-21">Developer Response</a></li>
        </ol>
      </li>
      <li><a href="#8-gas---function-arg-should-be-calldata-not-memory-engn33r" id="markdown-toc-8-gas---function-arg-should-be-calldata-not-memory-engn33r">8. Gas - Function arg should be <code class="language-plaintext highlighter-rouge">calldata</code> not <code class="language-plaintext highlighter-rouge">memory</code> (engn33r)</a>        <ol>
          <li><a href="#technical-details-22" id="markdown-toc-technical-details-22">Technical Details</a></li>
          <li><a href="#impact-22" id="markdown-toc-impact-22">Impact</a></li>
          <li><a href="#recommendation-22" id="markdown-toc-recommendation-22">Recommendation</a></li>
          <li><a href="#developer-response-22" id="markdown-toc-developer-response-22">Developer Response</a></li>
        </ol>
      </li>
      <li><a href="#9-gas---move-revert-earlier-in-function-engn33r" id="markdown-toc-9-gas---move-revert-earlier-in-function-engn33r">9. Gas - Move revert earlier in function (engn33r)</a>        <ol>
          <li><a href="#technical-details-23" id="markdown-toc-technical-details-23">Technical Details</a></li>
          <li><a href="#impact-23" id="markdown-toc-impact-23">Impact</a></li>
          <li><a href="#recommendation-23" id="markdown-toc-recommendation-23">Recommendation</a></li>
          <li><a href="#developer-response-23" id="markdown-toc-developer-response-23">Developer Response</a></li>
        </ol>
      </li>
      <li><a href="#10-gas---internal-function-is-cheaper-than-modifier-engn33r" id="markdown-toc-10-gas---internal-function-is-cheaper-than-modifier-engn33r">10. Gas - Internal function is cheaper than modifier (engn33r)</a>        <ol>
          <li><a href="#technical-details-24" id="markdown-toc-technical-details-24">Technical Details</a></li>
          <li><a href="#impact-24" id="markdown-toc-impact-24">Impact</a></li>
          <li><a href="#recommendation-24" id="markdown-toc-recommendation-24">Recommendation</a></li>
          <li><a href="#developer-response-24" id="markdown-toc-developer-response-24">Developer Response</a></li>
        </ol>
      </li>
      <li><a href="#11-gas---zero-check-could-save-gas-engn33r" id="markdown-toc-11-gas---zero-check-could-save-gas-engn33r">11. Gas - Zero check could save gas (engn33r)</a>        <ol>
          <li><a href="#technical-details-25" id="markdown-toc-technical-details-25">Technical Details</a></li>
          <li><a href="#impact-25" id="markdown-toc-impact-25">Impact</a></li>
          <li><a href="#recommendation-25" id="markdown-toc-recommendation-25">Recommendation</a></li>
          <li><a href="#developer-response-25" id="markdown-toc-developer-response-25">Developer Response</a></li>
        </ol>
      </li>
      <li><a href="#12-gas---remove-unnecessary-approve-engn33r-benjamin-samuels" id="markdown-toc-12-gas---remove-unnecessary-approve-engn33r-benjamin-samuels">12. Gas - Remove unnecessary approve (engn33r, Benjamin Samuels)</a>        <ol>
          <li><a href="#technical-details-26" id="markdown-toc-technical-details-26">Technical Details</a></li>
          <li><a href="#impact-26" id="markdown-toc-impact-26">Impact</a></li>
          <li><a href="#recommendation-26" id="markdown-toc-recommendation-26">Recommendation</a></li>
          <li><a href="#developer-response-26" id="markdown-toc-developer-response-26">Developer Response</a></li>
        </ol>
      </li>
      <li><a href="#13-gas---unnecessary-logic-in-approvemaxifneeded-function-engn33r" id="markdown-toc-13-gas---unnecessary-logic-in-approvemaxifneeded-function-engn33r">13. Gas - Unnecessary logic in <code class="language-plaintext highlighter-rouge">approveMaxIfNeeded()</code> function (engn33r)</a>        <ol>
          <li><a href="#technical-details-27" id="markdown-toc-technical-details-27">Technical Details</a></li>
          <li><a href="#impact-27" id="markdown-toc-impact-27">Impact</a></li>
          <li><a href="#recommendation-27" id="markdown-toc-recommendation-27">Recommendation</a></li>
          <li><a href="#developer-response-27" id="markdown-toc-developer-response-27">Developer Response</a></li>
        </ol>
      </li>
    </ol>
  </li>
  <li><a href="#informational-findings" id="markdown-toc-informational-findings">Informational Findings</a>    <ol>
      <li><a href="#1-informational---direct-transfer-of-atokens-impacts-share-value-engn33r" id="markdown-toc-1-informational---direct-transfer-of-atokens-impacts-share-value-engn33r">1. Informational - Direct transfer of aTokens impacts share value (engn33r)</a>        <ol>
          <li><a href="#technical-details-28" id="markdown-toc-technical-details-28">Technical Details</a></li>
          <li><a href="#impact-28" id="markdown-toc-impact-28">Impact</a></li>
          <li><a href="#recommendation-28" id="markdown-toc-recommendation-28">Recommendation</a></li>
          <li><a href="#developer-response-28" id="markdown-toc-developer-response-28">Developer Response</a></li>
        </ol>
      </li>
      <li><a href="#2-informational---aampl-edge-cases-engn33r" id="markdown-toc-2-informational---aampl-edge-cases-engn33r">2. Informational - aAMPL edge cases (engn33r)</a>        <ol>
          <li><a href="#technical-details-29" id="markdown-toc-technical-details-29">Technical Details</a></li>
          <li><a href="#impact-29" id="markdown-toc-impact-29">Impact</a></li>
          <li><a href="#recommendation-29" id="markdown-toc-recommendation-29">Recommendation</a></li>
          <li><a href="#developer-response-29" id="markdown-toc-developer-response-29">Developer Response</a></li>
        </ol>
      </li>
      <li><a href="#3-informational---invert-constant-mask-variables-engn33r" id="markdown-toc-3-informational---invert-constant-mask-variables-engn33r">3. Informational - Invert constant mask variables (engn33r)</a>        <ol>
          <li><a href="#technical-details-30" id="markdown-toc-technical-details-30">Technical Details</a></li>
          <li><a href="#impact-30" id="markdown-toc-impact-30">Impact</a></li>
          <li><a href="#recommendation-30" id="markdown-toc-recommendation-30">Recommendation</a></li>
          <li><a href="#developer-response-30" id="markdown-toc-developer-response-30">Developer Response</a></li>
        </ol>
      </li>
      <li><a href="#4-informational---simplify-logic-in-maxdeposit-and-maxmint-engn33r" id="markdown-toc-4-informational---simplify-logic-in-maxdeposit-and-maxmint-engn33r">4. Informational - Simplify logic in <code class="language-plaintext highlighter-rouge">maxDeposit()</code> and <code class="language-plaintext highlighter-rouge">maxMint()</code> (engn33r)</a>        <ol>
          <li><a href="#technical-details-31" id="markdown-toc-technical-details-31">Technical Details</a></li>
          <li><a href="#impact-31" id="markdown-toc-impact-31">Impact</a></li>
          <li><a href="#recommendation-31" id="markdown-toc-recommendation-31">Recommendation</a></li>
          <li><a href="#developer-response-31" id="markdown-toc-developer-response-31">Developer Response</a></li>
        </ol>
      </li>
      <li><a href="#5-informational---add-parentheses-to-avoid-order-of-operations-ambiguity-engn33r" id="markdown-toc-5-informational---add-parentheses-to-avoid-order-of-operations-ambiguity-engn33r">5. Informational - Add parentheses to avoid order of operations ambiguity (engn33r)</a>        <ol>
          <li><a href="#technical-details-32" id="markdown-toc-technical-details-32">Technical Details</a></li>
          <li><a href="#impact-32" id="markdown-toc-impact-32">Impact</a></li>
          <li><a href="#recommendation-32" id="markdown-toc-recommendation-32">Recommendation</a></li>
          <li><a href="#developer-response-32" id="markdown-toc-developer-response-32">Developer Response</a></li>
        </ol>
      </li>
      <li><a href="#6-informational---inconsistent-erc4626-callback-usage-engn33r" id="markdown-toc-6-informational---inconsistent-erc4626-callback-usage-engn33r">6. Informational - Inconsistent ERC4626 callback usage (engn33r)</a>        <ol>
          <li><a href="#technical-details-33" id="markdown-toc-technical-details-33">Technical Details</a></li>
          <li><a href="#impact-33" id="markdown-toc-impact-33">Impact</a></li>
          <li><a href="#recommendation-33" id="markdown-toc-recommendation-33">Recommendation</a></li>
          <li><a href="#developer-response-33" id="markdown-toc-developer-response-33">Developer Response</a></li>
        </ol>
      </li>
      <li><a href="#7-informational---some-hard-coded-variables-might-be-better-adjustable-engn33r" id="markdown-toc-7-informational---some-hard-coded-variables-might-be-better-adjustable-engn33r">7. Informational - Some hard coded variables might be better adjustable (engn33r)</a>        <ol>
          <li><a href="#technical-details-34" id="markdown-toc-technical-details-34">Technical Details</a></li>
          <li><a href="#impact-34" id="markdown-toc-impact-34">Impact</a></li>
          <li><a href="#recommendation-34" id="markdown-toc-recommendation-34">Recommendation</a></li>
          <li><a href="#developer-response-34" id="markdown-toc-developer-response-34">Developer Response</a></li>
        </ol>
      </li>
      <li><a href="#8-informational---unclear-upgrade-mechanism-engn33r" id="markdown-toc-8-informational---unclear-upgrade-mechanism-engn33r">8. Informational - Unclear upgrade mechanism (engn33r)</a>        <ol>
          <li><a href="#technical-details-35" id="markdown-toc-technical-details-35">Technical Details</a></li>
          <li><a href="#impact-35" id="markdown-toc-impact-35">Impact</a></li>
          <li><a href="#recommendation-35" id="markdown-toc-recommendation-35">Recommendation</a></li>
          <li><a href="#developer-response-35" id="markdown-toc-developer-response-35">Developer Response</a></li>
        </ol>
      </li>
      <li><a href="#9-informational---general-lack-of-documentation-and-comments-engn33r" id="markdown-toc-9-informational---general-lack-of-documentation-and-comments-engn33r">9. Informational - General lack of documentation and comments (engn33r)</a>        <ol>
          <li><a href="#technical-details-36" id="markdown-toc-technical-details-36">Technical Details</a></li>
          <li><a href="#impact-36" id="markdown-toc-impact-36">Impact</a></li>
          <li><a href="#recommendation-36" id="markdown-toc-recommendation-36">Recommendation</a></li>
          <li><a href="#developer-response-36" id="markdown-toc-developer-response-36">Developer Response</a></li>
        </ol>
      </li>
      <li><a href="#10-informational---typos-engn33r" id="markdown-toc-10-informational---typos-engn33r">10. Informational - Typos (engn33r)</a>        <ol>
          <li><a href="#technical-details-37" id="markdown-toc-technical-details-37">Technical Details</a></li>
          <li><a href="#impact-37" id="markdown-toc-impact-37">Impact</a></li>
          <li><a href="#recommendation-37" id="markdown-toc-recommendation-37">Recommendation</a></li>
          <li><a href="#developer-response-37" id="markdown-toc-developer-response-37">Developer Response</a></li>
        </ol>
      </li>
      <li><a href="#11-informational---aave-lendingpool-getconfiguration-can-replace-getreservedata-engn33r" id="markdown-toc-11-informational---aave-lendingpool-getconfiguration-can-replace-getreservedata-engn33r">11. Informational - Aave LendingPool <code class="language-plaintext highlighter-rouge">getConfiguration()</code> can replace <code class="language-plaintext highlighter-rouge">getReserveData()</code> (engn33r)</a>        <ol>
          <li><a href="#technical-details-38" id="markdown-toc-technical-details-38">Technical Details</a></li>
          <li><a href="#impact-38" id="markdown-toc-impact-38">Impact</a></li>
          <li><a href="#recommendation-38" id="markdown-toc-recommendation-38">Recommendation</a></li>
          <li><a href="#developer-response-38" id="markdown-toc-developer-response-38">Developer Response</a></li>
        </ol>
      </li>
      <li><a href="#12-informational---redundant-dependency-imports-engn33r" id="markdown-toc-12-informational---redundant-dependency-imports-engn33r">12. Informational - Redundant dependency imports (engn33r)</a>        <ol>
          <li><a href="#technical-details-39" id="markdown-toc-technical-details-39">Technical Details</a></li>
          <li><a href="#impact-39" id="markdown-toc-impact-39">Impact</a></li>
          <li><a href="#recommendation-39" id="markdown-toc-recommendation-39">Recommendation</a></li>
          <li><a href="#developer-response-39" id="markdown-toc-developer-response-39">Developer Response</a></li>
        </ol>
      </li>
      <li><a href="#13-informational---interface-doesnt-match-mainnet-contract-engn33r" id="markdown-toc-13-informational---interface-doesnt-match-mainnet-contract-engn33r">13. Informational - Interface doesn’t match mainnet contract (engn33r)</a>        <ol>
          <li><a href="#technical-details-40" id="markdown-toc-technical-details-40">Technical Details</a></li>
          <li><a href="#impact-40" id="markdown-toc-impact-40">Impact</a></li>
          <li><a href="#recommendation-40" id="markdown-toc-recommendation-40">Recommendation</a></li>
          <li><a href="#developer-response-40" id="markdown-toc-developer-response-40">Developer Response</a></li>
        </ol>
      </li>
      <li><a href="#14-informational---consider-upgrade-to-latest-solidity-release-engn33r" id="markdown-toc-14-informational---consider-upgrade-to-latest-solidity-release-engn33r">14. Informational - Consider upgrade to latest solidity release (engn33r)</a>        <ol>
          <li><a href="#technical-details-41" id="markdown-toc-technical-details-41">Technical Details</a></li>
          <li><a href="#impact-41" id="markdown-toc-impact-41">Impact</a></li>
          <li><a href="#recommendation-41" id="markdown-toc-recommendation-41">Recommendation</a></li>
          <li><a href="#developer-response-41" id="markdown-toc-developer-response-41">Developer Response</a></li>
        </ol>
      </li>
      <li><a href="#15-informational---theoretical-overflow-of-converttoshares-and-converttoassets-engn33r" id="markdown-toc-15-informational---theoretical-overflow-of-converttoshares-and-converttoassets-engn33r">15. Informational - Theoretical overflow of <code class="language-plaintext highlighter-rouge">convertToShares()</code> and <code class="language-plaintext highlighter-rouge">convertToAssets()</code> (engn33r)</a>        <ol>
          <li><a href="#technical-details-42" id="markdown-toc-technical-details-42">Technical Details</a></li>
          <li><a href="#impact-42" id="markdown-toc-impact-42">Impact</a></li>
          <li><a href="#recommendation-42" id="markdown-toc-recommendation-42">Recommendation</a></li>
          <li><a href="#developer-response-42" id="markdown-toc-developer-response-42">Developer Response</a></li>
        </ol>
      </li>
      <li><a href="#16-informational---no-zero-address-checks-in-constructor-engn33r" id="markdown-toc-16-informational---no-zero-address-checks-in-constructor-engn33r">16. Informational - No zero address checks in constructor (engn33r)</a>        <ol>
          <li><a href="#technical-details-43" id="markdown-toc-technical-details-43">Technical Details</a></li>
          <li><a href="#impact-43" id="markdown-toc-impact-43">Impact</a></li>
          <li><a href="#recommendation-43" id="markdown-toc-recommendation-43">Recommendation</a></li>
          <li><a href="#developer-response-43" id="markdown-toc-developer-response-43">Developer Response</a></li>
        </ol>
      </li>
      <li><a href="#17-informational---modify-gatesol-claimyieldandenter-function-argument-engn33r" id="markdown-toc-17-informational---modify-gatesol-claimyieldandenter-function-argument-engn33r">17. Informational - Modify Gate.sol <code class="language-plaintext highlighter-rouge">claimYieldAndEnter()</code> function argument (engn33r)</a>        <ol>
          <li><a href="#technical-details-44" id="markdown-toc-technical-details-44">Technical Details</a></li>
          <li><a href="#impact-44" id="markdown-toc-impact-44">Impact</a></li>
          <li><a href="#recommendation-44" id="markdown-toc-recommendation-44">Recommendation</a></li>
          <li><a href="#developer-response-44" id="markdown-toc-developer-response-44">Developer Response</a></li>
        </ol>
      </li>
      <li><a href="#18-informational---curvev2xpyt-utilizes-a-non-twap-price-oracle-benjamin-samuels" id="markdown-toc-18-informational---curvev2xpyt-utilizes-a-non-twap-price-oracle-benjamin-samuels">18. Informational - CurveV2xPYT utilizes a non-TWAP price oracle (Benjamin Samuels)</a>        <ol>
          <li><a href="#technical-details-45" id="markdown-toc-technical-details-45">Technical Details</a></li>
          <li><a href="#impact-45" id="markdown-toc-impact-45">Impact</a></li>
          <li><a href="#recommendation-45" id="markdown-toc-recommendation-45">Recommendation</a></li>
          <li><a href="#developer-response-45" id="markdown-toc-developer-response-45">Developer Response</a></li>
        </ol>
      </li>
      <li><a href="#19-informational---replace-magic-numbers-with-constants-engn33r" id="markdown-toc-19-informational---replace-magic-numbers-with-constants-engn33r">19. Informational - Replace magic numbers with constants (engn33r)</a>        <ol>
          <li><a href="#technical-details-46" id="markdown-toc-technical-details-46">Technical Details</a></li>
          <li><a href="#impact-46" id="markdown-toc-impact-46">Impact</a></li>
          <li><a href="#recommendation-46" id="markdown-toc-recommendation-46">Recommendation</a></li>
          <li><a href="#developer-response-46" id="markdown-toc-developer-response-46">Developer Response</a></li>
        </ol>
      </li>
      <li><a href="#20-informational---no-timelock-or-other-protection-around-changing-fee-or-fee-recipient-engn33r" id="markdown-toc-20-informational---no-timelock-or-other-protection-around-changing-fee-or-fee-recipient-engn33r">20. Informational - No timelock or other protection around changing fee or fee recipient (engn33r)</a>        <ol>
          <li><a href="#technical-details-47" id="markdown-toc-technical-details-47">Technical Details</a></li>
          <li><a href="#impact-47" id="markdown-toc-impact-47">Impact</a></li>
          <li><a href="#recommendation-47" id="markdown-toc-recommendation-47">Recommendation</a></li>
          <li><a href="#developer-response-47" id="markdown-toc-developer-response-47">Developer Response</a></li>
        </ol>
      </li>
      <li><a href="#21-informational---safeapprove-is-deprecated-benjamin-samuels" id="markdown-toc-21-informational---safeapprove-is-deprecated-benjamin-samuels">21. Informational - safeApprove is deprecated (Benjamin Samuels)</a>        <ol>
          <li><a href="#technical-details-48" id="markdown-toc-technical-details-48">Technical Details</a></li>
          <li><a href="#impact-48" id="markdown-toc-impact-48">Impact</a></li>
          <li><a href="#recommendation-48" id="markdown-toc-recommendation-48">Recommendation</a></li>
          <li><a href="#developer-response-48" id="markdown-toc-developer-response-48">Developer Response</a></li>
        </ol>
      </li>
      <li><a href="#22-informational---swapper-repo-foundry-coverage-failing-engn33r" id="markdown-toc-22-informational---swapper-repo-foundry-coverage-failing-engn33r">22. Informational - Swapper repo foundry coverage failing (engn33r)</a>        <ol>
          <li><a href="#technical-details-49" id="markdown-toc-technical-details-49">Technical Details</a></li>
          <li><a href="#impact-49" id="markdown-toc-impact-49">Impact</a></li>
          <li><a href="#recommendation-49" id="markdown-toc-recommendation-49">Recommendation</a></li>
          <li><a href="#developer-response-49" id="markdown-toc-developer-response-49">Developer Response</a></li>
        </ol>
      </li>
      <li><a href="#23-informational---stetherc4626tsol-test-failing-benjamin-samuels" id="markdown-toc-23-informational---stetherc4626tsol-test-failing-benjamin-samuels">23. Informational - StETHERC4626.t.sol test failing (Benjamin Samuels)</a>        <ol>
          <li><a href="#technical-details-50" id="markdown-toc-technical-details-50">Technical Details</a></li>
          <li><a href="#impact-50" id="markdown-toc-impact-50">Impact</a></li>
          <li><a href="#recommendation-50" id="markdown-toc-recommendation-50">Recommendation</a></li>
          <li><a href="#developer-response-50" id="markdown-toc-developer-response-50">Developer Response</a></li>
        </ol>
      </li>
    </ol>
  </li>
  <li><a href="#final-remarks" id="markdown-toc-final-remarks">Final remarks</a>    <ol>
      <li><a href="#engn33r" id="markdown-toc-engn33r">engn33r</a></li>
      <li><a href="#benjamin-samuels" id="markdown-toc-benjamin-samuels">Benjamin Samuels</a></li>
    </ol>
  </li>
  <li><a href="#about-yacademy" id="markdown-toc-about-yacademy">About yAcademy</a></li>
</ol>
      <h2 id="review-summary">
        
        
          <a href="#review-summary" class="anchor-heading" aria-labelledby="review-summary"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Review Summary
        
        
      </h2>
    

<p><strong>Yield Daddy</strong></p>

<p>Yield Daddy provides ERC4626 wrappers for common tokens from yield-generating protocols. This includes tokens received from Aave, Compound, Curve, and other lending protocols that provide users with tokens that increase in value over time.</p>

<p>The contracts of the <a href="https://github.com/timeless-fi/yield-daddy">Yield Daddy repo</a>, <a href="https://github.com/timeless-fi/xPYT">xPYT repo</a>, and <a href="https://github.com/timeless-fi/swapper">swapper repo</a> were reviewed over 16 days, 2 of which were used to create an initial overview of the contract. The code review was performed between August 31 and September 16, 2022. The code was reviewed by 2 residents for a total of 60 review hours (engn33r 32 hours, Benjamin Samuels 28 hours). The repository was under active development during the review, but the review was limited to the latest commit at the start of the review. This was commit 2c8f62681ab90325ede093ac9c9f94dbcc5f7e49 for the Yield Daddy repo, commit fabe9d7cb9700334b10a48ee5d081234eb98def9 for the xPYT repo, and commit 35db08558aa01e8473ada13c092e24857d01461b for the Swapper repo.</p>
      <h2 id="scope">
        
        
          <a href="#scope" class="anchor-heading" aria-labelledby="scope"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Scope
        
        
      </h2>
    

<p>The scope of the review consisted of the following contracts at the specific commit:</p>

<ul>
  <li><a href="https://github.com/timeless-fi/yield-daddy/tree/2c8f62681ab90325ede093ac9c9f94dbcc5f7e49">Yield Daddy Code Repo @ 2c8f62681ab90325ede093ac9c9f94dbcc5f7e49</a>
    <ul>
      <li>AaveV2ERC4626.sol</li>
      <li>AaveV2ERC4626Factory.sol</li>
      <li>AaveV3ERC4626.sol</li>
      <li>AaveV3ERC4626Factory.sol</li>
      <li>CompoundERC4626.sol</li>
      <li>CompoundERC4626Factory.sol</li>
      <li>EulerERC4626.sol</li>
      <li>EulerERC4626Factory.sol</li>
      <li>StETHERC4626.sol</li>
    </ul>
  </li>
  <li><a href="https://github.com/timeless-fi/xPYT/commit/fabe9d7cb9700334b10a48ee5d081234eb98def9">xPYT Code Repo @ fabe9d7cb9700334b10a48ee5d081234eb98def9</a>
    <ul>
      <li>CurveV2xPYT.sol</li>
      <li>CurveV2xPYTFactory.sol</li>
    </ul>
  </li>
  <li><a href="https://github.com/timeless-fi/swapper/commit/35db08558aa01e8473ada13c092e24857d01461b">Swapper Code Repo @ 35db08558aa01e8473ada13c092e24857d01461b</a>
    <ul>
      <li>CurveV2Swapper.sol</li>
      <li>CurveV2Juggler.sol</li>
    </ul>
  </li>
</ul>

<p>No other protocol ERC4626 wrappers are to be reviewed in Yield Daddy, such as the Uniswap wrappers present in the repositories at the time of review. Contracts from <a href="https://github.com/timeless-fi/timeless">the main Timeless repo</a> that are integrated with the xPYT and swapper repositories, including <a href="https://github.com/timeless-fi/timeless/blob/47c79493120c562ac69eff786f0445e8b8c9470a/src/Gate.sol">Gate.sol</a>, were out of scope and not fully reviewed, although some interactions with in-scope contracts were examined. After the findings were presented to the Yield Daddy team, fixes were made and included in several PRs.</p>

<p>This review is a code review to identify potential vulnerabilities in the code. The reviewers did not investigate security practices or operational security and assumed that privileged accounts could be trusted. The reviewers did not evaluate the security of the code relative to a standard or specification. The review may not have identified all potential attack vectors or areas of vulnerability.</p>

<p>yAcademy and the residents make no warranties regarding the security of the code and do not warrant that the code is free from defects. yAcademy and the residents do not represent nor imply to third parties that the code has been audited nor that the code is free from defects. By deploying or using the code, Yield Daddy and users of the contracts agree to use the code at their own risk.</p>
      <h2 id="code-evaluation-matrix">
        
        
          <a href="#code-evaluation-matrix" class="anchor-heading" aria-labelledby="code-evaluation-matrix"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Code Evaluation Matrix
        
        
      </h2>
    

<div class="table-wrapper"><table>
  <thead>
    <tr>
      <th>Category</th>
      <th>Mark</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Access Control</td>
      <td>Good</td>
      <td>No access control modifiers are present besides the use of the <code class="language-plaintext highlighter-rouge">onlyOwner</code> modifier in one location. Governance has no special privileges, which limits centralization risks and attack vectors targeting privileged addresses.</td>
    </tr>
    <tr>
      <td>Mathematics</td>
      <td>Good</td>
      <td>The only math involved in the custom code of the protocol involves adding and subtracting account balances. There is no reliance on complex math.</td>
    </tr>
    <tr>
      <td>Complexity</td>
      <td>Low</td>
      <td>The scope of the review is roughly 1200 lines of code. The ERC4626 wrappers are very concise. However, the xPYT and Swapper repositories are relatively complex and are very tightly coupled with several other contracts that were out of scope of the audit.</td>
    </tr>
    <tr>
      <td>Libraries</td>
      <td>Average</td>
      <td>An average number of solmate libraries are imported into the project, as well as the <code class="language-plaintext highlighter-rouge">BoringOwnable.sol</code> library. This is common practice, but relying on external dependencies always increases the risk of vulnerabilities in these dependencies.</td>
    </tr>
    <tr>
      <td>Decentralization</td>
      <td>Good</td>
      <td>Only <code class="language-plaintext highlighter-rouge">ownerSetProtocolFee()</code> in Swapper.sol provides extra functionality based on an access modifier. The rest of the code is permissionless and does not rely on governance, whitelisting, or other special admin requirements.</td>
    </tr>
    <tr>
      <td>Code stability</td>
      <td>Good</td>
      <td>No changes were made to the code in the review scope after the review started and the code did not have TODO comments indicating unfinished code.</td>
    </tr>
    <tr>
      <td>Documentation</td>
      <td>Low</td>
      <td>There are no developer docs for the project and many functions are missing NatSpec comments. Custom logic, like the value comparisons in <code class="language-plaintext highlighter-rouge">maxWithdraw()</code> and <code class="language-plaintext highlighter-rouge">maxRedeem()</code> in Yield Daddy, are missing comments explaining why the values are being compared (in these specific functions, the reason for the comparison is an edge case of undercollateralized Aave aTokens). Developer docs should be created, explaining a typical user’s interaction with the protocol. NatSpec comments should be added to all functions, even functions that are part of the ERC4626 specification.</td>
    </tr>
    <tr>
      <td>Monitoring</td>
      <td>Average</td>
      <td>Events exist in all functions involving state changes except the Swapper swap-related functions.</td>
    </tr>
    <tr>
      <td>Testing and verification</td>
      <td>Average</td>
      <td>Tests are implemented in foundry but could use improved coverage. Specifically, the Compound ERC4626 wrapper and factory is at 0% code coverage, CurveV2xPYTFactory.sol in xPYT is also at 0% coverage, and the swapper repository returns a <code class="language-plaintext highlighter-rouge">CompilerError: Stack too deep when compiling inline assembly</code> error when <code class="language-plaintext highlighter-rouge">forge coverage</code> is run. Some contracts such as <code class="language-plaintext highlighter-rouge">CurveV2Juggler</code> are only tested indirectly through other contract’s testing. There are also few integration tests for testing the system against a live network.</td>
    </tr>
  </tbody>
</table></div>
      <h2 id="findings-explanation">
        
        
          <a href="#findings-explanation" class="anchor-heading" aria-labelledby="findings-explanation"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Findings Explanation
        
        
      </h2>
    

<p>Findings are broken down into sections by their respective impact:</p>
<ul>
  <li>Critical, High, Medium, Low impact
    <ul>
      <li>These are findings that range from attacks that may cause loss of funds, impact control/ownership of the contracts, or cause any unintended consequences/actions that are outside the scope of the requirements</li>
    </ul>
  </li>
  <li>Gas savings
    <ul>
      <li>Findings that can improve the gas efficiency of the contracts</li>
    </ul>
  </li>
  <li>Informational
    <ul>
      <li>Findings including recommendations and best practices</li>
    </ul>
  </li>
</ul><hr />
      <h2 id="high-findings">
        
        
          <a href="#high-findings" class="anchor-heading" aria-labelledby="high-findings"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> High Findings
        
        
      </h2>
    
      <h3 id="1-high---incorrect-order-of-operations-in-libcompoundsol-engn33r">
        
        
          <a href="#1-high---incorrect-order-of-operations-in-libcompoundsol-engn33r" class="anchor-heading" aria-labelledby="1-high---incorrect-order-of-operations-in-libcompoundsol-engn33r"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 1. High - Incorrect order of operations in LibCompound.sol (engn33r)
        
        
      </h3>
    

<p>Changes made to the LibCompound.sol dependency modify the order of operations. The original version of this file on github does not have the same order of operations. This changes the result of the math, causing incorrect calculations.</p>
      <h4 id="technical-details">
        
        
          <a href="#technical-details" class="anchor-heading" aria-labelledby="technical-details"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Technical Details
        
        
      </h4>
    

<p>The problematic computations are for the variables <a href="https://github.com/timeless-fi/yield-daddy/blob/2c8f62681ab90325ede093ac9c9f94dbcc5f7e49/src/compound/lib/LibCompound.sol#L32-L33"><code class="language-plaintext highlighter-rouge">interestAccumulated</code></a> and <a href="https://github.com/timeless-fi/yield-daddy/blob/2c8f62681ab90325ede093ac9c9f94dbcc5f7e49/src/compound/lib/LibCompound.sol#L41-L43">the return value</a>.</p>

<p><code class="language-plaintext highlighter-rouge">interestAccumulated</code> calculation <a href="https://github.com/transmissions11/libcompound/blob/20ab8e325440749d56cde122bd21bd55f5f6e9d8/src/LibCompound.sol#L30-L32">from transmissions11/libcompound repo</a>:</p>
<div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">uint256</span> <span class="n">interestAccumulated</span> <span class="o">=</span> <span class="p">(</span><span class="n">borrowRateMantissa</span> <span class="o">*</span> <span class="p">(</span><span class="n">block</span><span class="p">.</span><span class="n">number</span> <span class="o">-</span> <span class="n">accrualBlockNumberPrior</span><span class="p">)).</span><span class="n">mulWadDown</span><span class="p">(</span>
	<span class="n">borrowsPrior</span>
<span class="p">);</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">interestAccumulated</code> calculation <a href="https://github.com/timeless-fi/yield-daddy/blob/2c8f62681ab90325ede093ac9c9f94dbcc5f7e49/src/compound/lib/LibCompound.sol#L32-L33">from local LibCompound.sol contract</a>:</p>
<div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">uint256</span> <span class="n">interestAccumulated</span> <span class="o">=</span>
	<span class="n">borrowRateMantissa</span> <span class="o">*</span> <span class="n">block</span><span class="p">.</span><span class="n">number</span> <span class="o">-</span> <span class="n">accrualBlockNumberPrior</span><span class="p">.</span><span class="n">mulWadDown</span><span class="p">(</span><span class="n">borrowsPrior</span><span class="p">);</span>
</code></pre></div></div>

<p>Made up example values:</p>
<ul>
  <li>borrowRateMantissa = 1000000000</li>
  <li>block.number = 15460000</li>
  <li>accrualBlockNumberPrior = 15459990</li>
  <li>borrowsPrior = 500000000000000000000000
<code class="language-plaintext highlighter-rouge">interestAccumulated</code> result from transmissions11/libcompound: 5000000000000000
<code class="language-plaintext highlighter-rouge">interestAccumulated</code> result from local LibCompound.sol: 15452270005000000</li>
</ul>

<p>Return value calculation <a href="https://github.com/transmissions11/libcompound/blob/20ab8e325440749d56cde122bd21bd55f5f6e9d8/src/LibCompound.sol#L41">from transmissions11/libcompound repo</a>:</p>
<div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="n">totalCash</span> <span class="o">+</span> <span class="n">totalBorrows</span> <span class="o">-</span> <span class="n">totalReserves</span><span class="p">).</span><span class="n">divWadDown</span><span class="p">(</span><span class="n">totalSupply</span><span class="p">);</span>
</code></pre></div></div>

<p>Return value calculation <a href="https://github.com/timeless-fi/yield-daddy/blob/2c8f62681ab90325ede093ac9c9f94dbcc5f7e49/src/compound/lib/LibCompound.sol#L42">from local LibCompound.sol contract</a>:</p>
<div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">totalCash</span> <span class="o">+</span> <span class="n">totalBorrows</span> <span class="o">-</span> <span class="n">totalReserves</span><span class="p">.</span><span class="n">divWadDown</span><span class="p">(</span><span class="n">totalSupply</span><span class="p">);</span>
</code></pre></div></div>

<p>Example values loosely taken from cDAI:</p>
<ul>
  <li>totalCash = 400000000000000000000000000</li>
  <li>totalBorrows = 300000000000000000000000000</li>
  <li>totalReserves = 20000000000000000000000000</li>
  <li>totalSupply = 3100000000000000000
Return value result from transmissions11/libcompound: 219354838709677419354838709
Return value result from local LibCompound.sol: 693548387096774193548387097</li>
</ul>
      <h4 id="impact">
        
        
          <a href="#impact" class="anchor-heading" aria-labelledby="impact"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Impact
        
        
      </h4>
    

<p>High. Incorrect order of operations leads to different calculation results for <code class="language-plaintext highlighter-rouge">totalAssets()</code>, which impacts key value management functions including <code class="language-plaintext highlighter-rouge">convertToShares()</code> and <code class="language-plaintext highlighter-rouge">convertToAssets()</code>.</p>
      <h4 id="recommendation">
        
        
          <a href="#recommendation" class="anchor-heading" aria-labelledby="recommendation"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Recommendation
        
        
      </h4>
    

<p>Use the latest version of <a href="https://github.com/transmissions11/libcompound/blob/main/src/LibCompound.sol">the transmissions11/libcompound repo</a> after confirming its math is correct.</p>
      <h4 id="developer-response">
        
        
          <a href="#developer-response" class="anchor-heading" aria-labelledby="developer-response"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Developer Response
        
        
      </h4>
    

<p>Fixed in commit <a href="https://github.com/timeless-fi/yield-daddy/commit/0ea9347d360dc6d226fa134c9c73d025d2fc6aa5">0ea9347d360dc6d226fa134c9c73d025d2fc6aa5</a>.</p>
      <h3 id="2-high---user-can-set-arbitrary-approvemaxifneeded-target-engn33r">
        
        
          <a href="#2-high---user-can-set-arbitrary-approvemaxifneeded-target-engn33r" class="anchor-heading" aria-labelledby="2-high---user-can-set-arbitrary-approvemaxifneeded-target-engn33r"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 2. High - User can set arbitrary <code class="language-plaintext highlighter-rouge">approveMaxIfNeeded()</code> target (engn33r)
        
        
      </h3>
    

<p>The Swapper.sol contract is written in a way that a malicious contract could be written that:</p>
<ol>
  <li>is approved for <code class="language-plaintext highlighter-rouge">type(uint256).max</code> of the token types that pass through Swapper.sol</li>
  <li>calls <code class="language-plaintext highlighter-rouge">safeTransferFrom()</code> on these ERC20 tokens it has been approved for</li>
</ol>

<p>To be clear, this in itself would not steal value from Swapper.sol. But the <code class="language-plaintext highlighter-rouge">nonReentrant</code> modifiers in CurveV2Swapper.sol indicate there is in theory a non-zero chance that an external contract may execute malicious code to call back into a CurveV2Swapper.sol function partway through a function’s execution. If such an action were possible, the <code class="language-plaintext highlighter-rouge">nonReentrant</code> modifier would not protect against a malicious contract calling <code class="language-plaintext highlighter-rouge">safeTransferFrom()</code>.</p>
      <h4 id="technical-details-1">
        
        
          <a href="#technical-details-1" class="anchor-heading" aria-labelledby="technical-details-1"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Technical Details
        
        
      </h4>
    

<p>This finding is not a complete attack chain, but the missing link of the chain depends on a hypothetical weakness in an external contract, which is out of scope of this review. In order for value to be stolen from Swapper.sol, a malicious actor would:</p>
<ol>
  <li>Create a malicious contract that is approved by Swapper.sol for ERC20 tokens that pass through Swapper.sol, which enables it to <code class="language-plaintext highlighter-rouge">transferFrom()</code> those tokens</li>
  <li>Use an external call from Swapper.sol to call the malicious contract while Swapper.sol holds value to take that value before it can be sent to the user calling the contract</li>
</ol>

<p>The first step is possible because the input argument to <code class="language-plaintext highlighter-rouge">approveMaxIfNeeded()</code> in Swapper.sol code is a user-specified argument. Not only that, but in a function such as <code class="language-plaintext highlighter-rouge">_swapXpytToUnderlying()</code>, the <code class="language-plaintext highlighter-rouge">args.gate</code> parameter approved for <code class="language-plaintext highlighter-rouge">args.xPYT</code> here is only used for one function call, <code class="language-plaintext highlighter-rouge">exitToUnderlying()</code>. This function could be implemented in a malicious contract as an empty function and the rest of the <code class="language-plaintext highlighter-rouge">_swapXpytToUnderlying()</code> function would still succeed, allowing the <code class="language-plaintext highlighter-rouge">args.gate</code> user-specific argument to be set to an address under the malicious user’s control. Even worse, this <code class="language-plaintext highlighter-rouge">exitToUnderlying()</code> could be where the <code class="language-plaintext highlighter-rouge">transferFrom()</code> call happens, so if an innocent user specifies this value for the <code class="language-plaintext highlighter-rouge">args.gate</code> value (either due to a mistake, a Timeless frontend hack, or any other means), the value would be transferred to the malicious gate contract and the innocent user would lose the value that was going to be sent to them.</p>

<p>It is not even necessary for the user to provide a malicious value for <code class="language-plaintext highlighter-rouge">args.gate</code> for this to become a problem. Multiple external calls exist within the functions of Swapper.sol, and if any of these are insecure or have an external call to an insecure contract, loss of value can occur even if the user’s transaction has the proper function argument values set.</p>
      <h4 id="impact-1">
        
        
          <a href="#impact-1" class="anchor-heading" aria-labelledby="impact-1"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Impact
        
        
      </h4>
    

<p>High. The complete attack chain is not defined in the scope of this review. However, there is a non-zero risk of removal of value from Swapper.sol despite the <code class="language-plaintext highlighter-rouge">nonReentrant</code> modifiers on the external functions due to approval of arbitrary addresses.</p>
      <h4 id="recommendation-1">
        
        
          <a href="#recommendation-1" class="anchor-heading" aria-labelledby="recommendation-1"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Recommendation
        
        
      </h4>
    

<p>As described in finding Low #5, there is insufficient input validation on the SwapArgs <code class="language-plaintext highlighter-rouge">args</code> function argument. For this specific issue, it would be best to:</p>
<ol>
  <li>Confirm that <code class="language-plaintext highlighter-rouge">args.gate</code> is a legitimate gate contract (and not a malicious contract that resembles the gate contract) by querying the factory contract or another contract that maintains a whitelist of legitimate gate contracts. If there is no such whitelist, it should be created. For example, Uniswap maintains <a href="https://github.com/Uniswap/v2-core/blob/ee547b17853e71ed4e0101ccfd52e70d5acded58/contracts/UniswapV2Factory.sol#L10">a mapping of legitimate token pairs</a>.</li>
  <li>Confirm that the other values related to the <code class="language-plaintext highlighter-rouge">approveMaxIfNeeded()</code> calls, namely <code class="language-plaintext highlighter-rouge">args.xPYT</code>, <code class="language-plaintext highlighter-rouge">args.pyt</code>, and <code class="language-plaintext highlighter-rouge">args.nyt</code>, are legitimate Timeless tokens (and not malicious contracts) with the same solution of querying the relevant factory contract that is described above for the <code class="language-plaintext highlighter-rouge">args.gate</code> argument. Also perform a check the <code class="language-plaintext highlighter-rouge">args.underlying</code> corresponds to the Timeless tokens and is not an unrelated token.</li>
  <li>If added protection against a malicious contract calling <code class="language-plaintext highlighter-rouge">transferFrom</code> in an external call is needed, consider checking that the token balance held by the contract before the external call and after the external call is unchanged, reverting if this is not the case.</li>
</ol>
      <h4 id="developer-response-1">
        
        
          <a href="#developer-response-1" class="anchor-heading" aria-labelledby="developer-response-1"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Developer Response
        
        
      </h4>
    

<p>This is fine. We assume that input validation is done on the frontend/by the caller, so user foot-gunning by giving invalid/malicious parameters is not in scope. The permissionlessness of the contract is more important to us.</p>
      <h3 id="3-high---lack-of-slippage-protection-in-curve-swaps-engn33r">
        
        
          <a href="#3-high---lack-of-slippage-protection-in-curve-swaps-engn33r" class="anchor-heading" aria-labelledby="3-high---lack-of-slippage-protection-in-curve-swaps-engn33r"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 3. High - Lack of slippage protection in Curve swaps (engn33r)
        
        
      </h3>
    

<p>The Curve <code class="language-plaintext highlighter-rouge">exchange()</code> function has a <code class="language-plaintext highlighter-rouge">min_dy</code> parameter to specify the minimum amount of the output token to receive. This value is set to zero, meaning there is no slippage requirement for the swap. Lack of slippage protection can result in loss of value from frontrunning and backrunning.</p>
      <h4 id="technical-details-2">
        
        
          <a href="#technical-details-2" class="anchor-heading" aria-labelledby="technical-details-2"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Technical Details
        
        
      </h4>
    

<p>The <a href="https://github.com/timeless-fi/xPYT/blob/fabe9d7cb9700334b10a48ee5d081234eb98def9/src/curve-v2/CurveV2xPYT.sol#L94"><code class="language-plaintext highlighter-rouge">exchange()</code> call in <code class="language-plaintext highlighter-rouge">_swap()</code> in CurveV2xPYT.sol</a> sets a minimum output token quantity of zero. This means the swap will happen regardless of how imbalanced the pool is. The only check that is applied to the quantity of tokens received is <a href="https://github.com/timeless-fi/xPYT/blob/fabe9d7cb9700334b10a48ee5d081234eb98def9/src/xPYT.sol#L160-L163">validating the amount is greater than <code class="language-plaintext highlighter-rouge">minXpytAmountOut</code></a>. The value of <code class="language-plaintext highlighter-rouge">minXpytAmountOut</code> does not help with slippage and is not user customizable, it only helps avoid a case where a very small (near zero) amount of of xPYT is returned.</p>

<p>This is in contrast to where <code class="language-plaintext highlighter-rouge">pool.exchange()</code> is used in <code class="language-plaintext highlighter-rouge">_swapFromUnderlying()</code> in the swapper repository. There is a check of <code class="language-plaintext highlighter-rouge">tokenAmountOut &lt; args.minAmountOut</code> in Swapper.sol to check the return value of <code class="language-plaintext highlighter-rouge">pool.exchange()</code>. Whether the <code class="language-plaintext highlighter-rouge">args.minAmountOut</code> value will be calculated properly in the user interface is outside the scope of this review, but at least users have the option to specify a slippage tolerance. Similarly, the output of the <code class="language-plaintext highlighter-rouge">swapAmountOut</code> return value from <code class="language-plaintext highlighter-rouge">_swapFromYieldToken()</code> <a href="https://github.com/timeless-fi/swapper/blob/b898896579b60697a8113da21cefb3b00bcfaa0d/src/Swapper.sol#L529">is compared against <code class="language-plaintext highlighter-rouge">args.minAmountOut</code> in Swapper.sol</a>.</p>
      <h4 id="impact-2">
        
        
          <a href="#impact-2" class="anchor-heading" aria-labelledby="impact-2"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Impact
        
        
      </h4>
    

<p>High. Lack of slippage protection is likely to result in loss of value from MEV on larger swaps, especially because the <code class="language-plaintext highlighter-rouge">pound()</code> function can be called by anyone. The existing assumption is that MEV will cause this function to be called frequently so the extracted value amount is small. But this function may not be called frequently by users, which could lead to a sizeable loss of value when the function is finally called and MEV bots extract value.</p>
      <h4 id="recommendation-2">
        
        
          <a href="#recommendation-2" class="anchor-heading" aria-labelledby="recommendation-2"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Recommendation
        
        
      </h4>
    

<p>Because this function is designed to be called relatively frequently, hard code a reasonable slippage tolerance for this external function depending on the pool that is traded. The cost/benefit of using keepers from the <a href="https://keep3r.network/">Keeper Network</a> or <a href="https://www.gelato.network/">Gelato</a> should be examined, because it may preserve more value for users (less MEV extracting value from the <code class="language-plaintext highlighter-rouge">pound()</code> process).</p>
      <h4 id="developer-response-2">
        
        
          <a href="#developer-response-2" class="anchor-heading" aria-labelledby="developer-response-2"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Developer Response
        
        
      </h4>
    

<p>This is by design.</p>

<p>The description</p>

<blockquote>
  <p>The value of minXpytAmountOut does not help with slippage and is not user customizable, it only helps avoid a case where a very small (near zero) amount of of xPYT is returned.</p>
</blockquote>

<p>is incorrect. minXpytAmountOut is computed using the EMA price oracle of the Curve pool to ensure the experienced slippage is not too high. It does not “only helps avoid a case where a very small (near zero) amount of of xPYT is returned”, it works as a generalized &amp; permissionless way to limit slippage &amp; sandwiching attacks. Because pound() is permissionless by design, allowing the caller to specify slippage parameters does not help.</p>
      <h2 id="medium-findings">
        
        
          <a href="#medium-findings" class="anchor-heading" aria-labelledby="medium-findings"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Medium Findings
        
        
      </h2>
    
      <h3 id="1-medium---accrued-rewards-may-not-be-returned-to-depositors-engn33r">
        
        
          <a href="#1-medium---accrued-rewards-may-not-be-returned-to-depositors-engn33r" class="anchor-heading" aria-labelledby="1-medium---accrued-rewards-may-not-be-returned-to-depositors-engn33r"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 1. Medium - Accrued rewards may not be returned to depositors (engn33r)
        
        
      </h3>
    

<p>The <code class="language-plaintext highlighter-rouge">claimRewards()</code> function sends all accrued rewards for the vault to <code class="language-plaintext highlighter-rouge">rewardRecipient</code>. These rewards are liquidity mining incentives that sometimes provided in addition to the base APY of the pool. The contracts in the scope of review did not show how (or if) rewards from <code class="language-plaintext highlighter-rouge">rewardRecipient</code> would be returned to depositors. This is a possible rug pull vector where the contract deployer could steal value from users.</p>
      <h4 id="technical-details-3">
        
        
          <a href="#technical-details-3" class="anchor-heading" aria-labelledby="technical-details-3"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Technical Details
        
        
      </h4>
    

<p>The <a href="https://github.com/timeless-fi/yield-daddy/blob/2c8f62681ab90325ede093ac9c9f94dbcc5f7e49/src/aave-v2/AaveV2ERC4626.sol#L79-L84"><code class="language-plaintext highlighter-rouge">claimRewards()</code> function</a> is an external function without access controls, so anyone can call it. When it is called, the liquidity mining incentive rewards accrued to the aTokens held by the ERC4626 vault are sent to the address <code class="language-plaintext highlighter-rouge">rewardRecipient</code>. The <code class="language-plaintext highlighter-rouge">rewardRecipient</code> address may be a previously audited contract that is out of scope of this review, but because it is not in the scope of this review, it is not clear whether users will receive rewards claimed from this function.</p>
      <h4 id="impact-3">
        
        
          <a href="#impact-3" class="anchor-heading" aria-labelledby="impact-3"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Impact
        
        
      </h4>
    

<p>Medium. Depositors could lose accrued rewards that they expected to receive.</p>
      <h4 id="recommendation-3">
        
        
          <a href="#recommendation-3" class="anchor-heading" aria-labelledby="recommendation-3"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Recommendation
        
        
      </h4>
    

<p>The protocol should make it clear how users receive rewards that are swept by the <code class="language-plaintext highlighter-rouge">claimRewards()</code> function. Rewards should be distributed to users fairly and the contract code should demonstrate how this fairness is calculated. If users that deposited in the ERC4626 vault earlier than other users should receive more rewards, the code should illustrate this.</p>
      <h4 id="developer-response-3">
        
        
          <a href="#developer-response-3" class="anchor-heading" aria-labelledby="developer-response-3"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Developer Response
        
        
      </h4>
    

<p>This is by design. We have considered building a reward distribution system inside the Yield Daddy wrapper contracts, but decided against it. The reason is that liquidity mining incentives are usually temporary, and it’s not worth it to add significant complexity to the contracts just for it to be useless after the incentives are over. The reward tokens will be handled by Timeless as it sees fit, for example using them to incentivize yield token liquidity.</p>
      <h3 id="2-medium---bypass-to-add-cetheraddress-to-underlyingtoctoken-array-engn33r">
        
        
          <a href="#2-medium---bypass-to-add-cetheraddress-to-underlyingtoctoken-array-engn33r" class="anchor-heading" aria-labelledby="2-medium---bypass-to-add-cetheraddress-to-underlyingtoctoken-array-engn33r"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 2. Medium - Bypass to add <code class="language-plaintext highlighter-rouge">cEtherAddress</code> to <code class="language-plaintext highlighter-rouge">underlyingToCToken</code> array (engn33r)
        
        
      </h3>
    

<p>The CompoundERC4626Factory.sol constructor has an if statement to prevent <code class="language-plaintext highlighter-rouge">cEtherAddress</code> from being added to the <code class="language-plaintext highlighter-rouge">underlyingToCToken</code> array. This if statement does not exist in <code class="language-plaintext highlighter-rouge">updateUnderlyingToCToken()</code>, a function with no access controls, so any user can added <code class="language-plaintext highlighter-rouge">cEtherAddress</code> to <code class="language-plaintext highlighter-rouge">underlyingToCToken</code>, which bypasses the check in the constructor.</p>
      <h4 id="technical-details-4">
        
        
          <a href="#technical-details-4" class="anchor-heading" aria-labelledby="technical-details-4"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Technical Details
        
        
      </h4>
    

<p>The CompoundERC4626Factory.sol constructor has an <a href="https://github.com/timeless-fi/yield-daddy/blob/2c8f62681ab90325ede093ac9c9f94dbcc5f7e49/src/compound/CompoundERC4626Factory.sol#L58-L60">if statement that prevents <code class="language-plaintext highlighter-rouge">cEtherAddress</code></a> from getting added to the <code class="language-plaintext highlighter-rouge">underlyingToCToken</code> array. The <a href="https://github.com/timeless-fi/yield-daddy/blob/2c8f62681ab90325ede093ac9c9f94dbcc5f7e49/src/compound/CompoundERC4626Factory.sol#L103-L116"><code class="language-plaintext highlighter-rouge">updateUnderlyingToCToken()</code> function</a> has a for loop very similar to the constructor, but the if statement check is missing. Because <code class="language-plaintext highlighter-rouge">updateUnderlyingToCToken()</code> has no access controls, anyone can use <code class="language-plaintext highlighter-rouge">updateUnderlyingToCToken()</code> to add the cEtherAddress to the array. This will cause problems because the CompoundERC4626.sol code assumes ERC20 tokens when using imported SafeTransferLib functions and does not use <code class="language-plaintext highlighter-rouge">safeTransferETH()</code> for the case where ETH is the underlying asset.</p>
      <h4 id="impact-4">
        
        
          <a href="#impact-4" class="anchor-heading" aria-labelledby="impact-4"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Impact
        
        
      </h4>
    

<p>Medium. The protocol is designed to support only ERC20 tokens and not ether. Adding cEther to the <code class="language-plaintext highlighter-rouge">underlyingToCToken</code> array could result in a denial of service problem when functions handling ether are called.</p>
      <h4 id="recommendation-4">
        
        
          <a href="#recommendation-4" class="anchor-heading" aria-labelledby="recommendation-4"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Recommendation
        
        
      </h4>
    

<p>Add the same <code class="language-plaintext highlighter-rouge">if (address(cToken) != cEtherAddress)</code> check from the constructor to the <code class="language-plaintext highlighter-rouge">updateUnderlyingToCToken()</code> function to prevent <code class="language-plaintext highlighter-rouge">cEtherAddress</code> from being added to the <code class="language-plaintext highlighter-rouge">underlyingToCToken</code> array.</p>
      <h4 id="developer-response-4">
        
        
          <a href="#developer-response-4" class="anchor-heading" aria-labelledby="developer-response-4"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Developer Response
        
        
      </h4>
    

<p>Fixed in commit <a href="https://github.com/timeless-fi/yield-daddy/commit/46e528a99773cf4060331cfe065cb1d781b2ff55">46e528a99773cf4060331cfe065cb1d781b2ff55</a>.</p>
      <h3 id="3-medium---improper-wrapethinput-call-can-cause-value-loss-engn33r">
        
        
          <a href="#3-medium---improper-wrapethinput-call-can-cause-value-loss-engn33r" class="anchor-heading" aria-labelledby="3-medium---improper-wrapethinput-call-can-cause-value-loss-engn33r"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 3. Medium - Improper <code class="language-plaintext highlighter-rouge">wrapEthInput()</code> call can cause value loss (engn33r)
        
        
      </h3>
    

<p><code class="language-plaintext highlighter-rouge">wrapEthInput()</code> in Swapper.sol must be used in a multicall when an external contract is depositing ETH. If this function is called on its own or in a separate transaction, this can cause loss of value for the user who called <code class="language-plaintext highlighter-rouge">wrapEthInput()</code> improperly. A footgun of this type should have the risks of improper use more clearly documented or add protections against improper use.</p>
      <h4 id="technical-details-5">
        
        
          <a href="#technical-details-5" class="anchor-heading" aria-labelledby="technical-details-5"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Technical Details
        
        
      </h4>
    

<p>If a user calls <code class="language-plaintext highlighter-rouge">wrapEthInput()</code> as a separate transaction, ether will be converted to WETH and deposited to the Swapper.sol address. Even if the user intends to call <code class="language-plaintext highlighter-rouge">swapUnderlyingToXpyt()</code> or <code class="language-plaintext highlighter-rouge">swapUnderlyingToNyt()</code> in their next transaction, the user can be frontrun. Whoever calls <code class="language-plaintext highlighter-rouge">swapUnderlyingToXpyt()</code> or <code class="language-plaintext highlighter-rouge">swapUnderlyingToNyt()</code> while Swapper.sol holds value can extract that value because those functions use <code class="language-plaintext highlighter-rouge">args.underlying.balanceOf(address(this))</code> for the value of <code class="language-plaintext highlighter-rouge">tokenAmountIn</code> (<a href="https://github.com/timeless-fi/swapper/blob/b898896579b60697a8113da21cefb3b00bcfaa0d/src/Swapper.sol#L322">here</a> and <a href="https://github.com/timeless-fi/swapper/blob/b898896579b60697a8113da21cefb3b00bcfaa0d/src/Swapper.sol#L401">here</a>).</p>
      <h4 id="impact-5">
        
        
          <a href="#impact-5" class="anchor-heading" aria-labelledby="impact-5"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Impact
        
        
      </h4>
    

<p>Medium. The risk only exists if a user improperly uses the protocol, but the protocol could add additional protections to avoid the improper usage scenario.</p>
      <h4 id="recommendation-5">
        
        
          <a href="#recommendation-5" class="anchor-heading" aria-labelledby="recommendation-5"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Recommendation
        
        
      </h4>
    

<p>Two options are possible depending if the developers want to remove the footgun entirely or leave the footgun with a better warning sign:</p>
<ol>
  <li>To remove the footgun from the code, create <code class="language-plaintext highlighter-rouge">_swapUnderlyingETHToXpyt()</code> and <code class="language-plaintext highlighter-rouge">_swapUnderlyingETHToNyt()</code> functions that are specifically designed to handle the case where ether is sent to Swapper.sol as the underlying asset. This is the approach taken by Uniswap, which has <a href="https://github.com/Uniswap/v2-periphery/blob/0335e8f7e1bd1e8d8329fd300aea2ef2f36dd19f/contracts/UniswapV2Router02.sol#L284"><code class="language-plaintext highlighter-rouge">swapExactTokensForETH()</code></a> and <a href="https://github.com/Uniswap/v2-periphery/blob/0335e8f7e1bd1e8d8329fd300aea2ef2f36dd19f/contracts/UniswapV2Router02.sol#L301"><code class="language-plaintext highlighter-rouge">swapETHForExactTokens()</code></a> functions.</li>
  <li>While not the recommended approach, the code can remain as is if the users are assumed to be trusted, but clearer warnings around <code class="language-plaintext highlighter-rouge">wrapEthInput()</code> should be added to indicate that this function can lead to loss of value if used improperly. If or when a website with developer documentation is created, add a colored “Warning” text box (similar to those in <a href="https://docs.soliditylang.org/en/latest/">the solidity documentation</a>) when documenting this function.</li>
</ol>
      <h4 id="developer-response-5">
        
        
          <a href="#developer-response-5" class="anchor-heading" aria-labelledby="developer-response-5"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Developer Response
        
        
      </h4>
    

<p>This is fine.</p>
      <h3 id="4-medium---erc20-tokens-sitting-in-contracts-can-be-extracted-engn33r">
        
        
          <a href="#4-medium---erc20-tokens-sitting-in-contracts-can-be-extracted-engn33r" class="anchor-heading" aria-labelledby="4-medium---erc20-tokens-sitting-in-contracts-can-be-extracted-engn33r"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 4. Medium - ERC20 tokens sitting in contracts can be extracted (engn33r)
        
        
      </h3>
    

<p>Any ERC20 tokens left in Swapper.sol can be extracted. Any unaccounted for <code class="language-plaintext highlighter-rouge">asset</code> tokens in xPYT.sol can be extracted with <code class="language-plaintext highlighter-rouge">sweep()</code>. This is similar to Uniswap’s V2 router, which is <a href="https://docs.uniswap.org/protocol/V2/reference/smart-contracts/router-02">not intended to “hold token balances” per Uniswap documentation</a>. This is unlikely a concern because tokens are not designed to be stored in the Swapper contract, but if the protocol is misused it can lead to loss of value for users.</p>
      <h4 id="technical-details-6">
        
        
          <a href="#technical-details-6" class="anchor-heading" aria-labelledby="technical-details-6"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Technical Details
        
        
      </h4>
    

<p>The Swapper.sol contract uses the code <code class="language-plaintext highlighter-rouge">args.TOKEN.balanceOf(address(this))</code> in several places. The value of <code class="language-plaintext highlighter-rouge">args.xPYT</code>, <code class="language-plaintext highlighter-rouge">args.pyt</code>, or <code class="language-plaintext highlighter-rouge">args.nyt</code> can be any address, which means any token balance stored by the contract can be queried, and soon after extracted, with this code. The contract is not designed to store value, but if it does store value (say if a user accidentally sends tokens directly to the contract), the value could be extracted in a backrun transaction. A similar scenario exists with Uniswap’s V2 router, which is <a href="https://docs.uniswap.org/protocol/V2/reference/smart-contracts/router-02">not designed to store any token balances</a> but it does have <a href="https://etherscan.io/address/0x7a250d5630b4cf539739df2c5dacb4c659f2488d">non-zero token balances as seen on etherscan</a>.</p>

<p>Separately, <code class="language-plaintext highlighter-rouge">sweep()</code> in xPYT.sol is described with <code class="language-plaintext highlighter-rouge">Uses the extra asset balance of the xPYT contract to mint shares</code>. This can remove any extra assets of token <code class="language-plaintext highlighter-rouge">asset</code> that sits in the xPYT.sol contract. While less generalize than the Sweeper.sol contract, a more specific case of the same issue exists.</p>
      <h4 id="impact-6">
        
        
          <a href="#impact-6" class="anchor-heading" aria-labelledby="impact-6"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Impact
        
        
      </h4>
    

<p>Medium. No edge case that forcibly traps tokens in the Swapper contract was found so it is unlikely a user will expect a different result.</p>
      <h4 id="recommendation-6">
        
        
          <a href="#recommendation-6" class="anchor-heading" aria-labelledby="recommendation-6"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Recommendation
        
        
      </h4>
    

<p>Clearly document that the Swapper contract should not store any token balances, ideally in developer documentation that is more reader friendly that reading NatSpec comments directly from the source code.</p>
      <h4 id="developer-response-6">
        
        
          <a href="#developer-response-6" class="anchor-heading" aria-labelledby="developer-response-6"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Developer Response
        
        
      </h4>
    

<p>This is fine.</p>
      <h2 id="low-findings">
        
        
          <a href="#low-findings" class="anchor-heading" aria-labelledby="low-findings"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Low Findings
        
        
      </h2>
    
      <h3 id="1-low---difficult-to-use-withdraw-with-full-deposit-engn33r">
        
        
          <a href="#1-low---difficult-to-use-withdraw-with-full-deposit-engn33r" class="anchor-heading" aria-labelledby="1-low---difficult-to-use-withdraw-with-full-deposit-engn33r"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 1. Low - Difficult to use <code class="language-plaintext highlighter-rouge">withdraw()</code> with full deposit (engn33r)
        
        
      </h3>
    

<p>The <code class="language-plaintext highlighter-rouge">withdraw()</code> function allows users to specify the amount of assets they wish to withdraw. If a user wants to withdraw all the assets they have deposited in Yield Daddy without leaving dust, it can be hard to accurately specify their full assets value because of the constantly rebasing nature of Aave aTokens.</p>
      <h4 id="technical-details-7">
        
        
          <a href="#technical-details-7" class="anchor-heading" aria-labelledby="technical-details-7"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Technical Details
        
        
      </h4>
    

<p>Aave allows <a href="https://github.com/aave/protocol-v2/blob/30a2a19f6d28b6fb8d26fc07568ca0f2918f4070/contracts/protocol/lendingpool/LendingPool.sol#L156-L158">users to submit the value <code class="language-plaintext highlighter-rouge">type(uint256).max</code> to withdraw</a> the user’s full balance. No similar feature is present in the Yield Daddy ERC4626 vault. This makes it hard to use <code class="language-plaintext highlighter-rouge">withdraw()</code> while specifying the correct value of assets to remove all aTokens from the vault because the aTokens are rebasing and increasing over time. In contrast, the <code class="language-plaintext highlighter-rouge">redeem()</code> function allows a user a specify the number of shares they want to withdraw. Shares are not always rebasing and are easier for a user to specify an accurate number for a complete withdrawal.</p>
      <h4 id="impact-7">
        
        
          <a href="#impact-7" class="anchor-heading" aria-labelledby="impact-7"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Impact
        
        
      </h4>
    

<p>Low.</p>
      <h4 id="recommendation-7">
        
        
          <a href="#recommendation-7" class="anchor-heading" aria-labelledby="recommendation-7"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Recommendation
        
        
      </h4>
    

<p>If the users are intended to call <code class="language-plaintext highlighter-rouge">redeem()</code> instead of <code class="language-plaintext highlighter-rouge">withdraw()</code> when withdrawing their entire vault deposit, this should at minimum be made clear in the documentation. If it should be possible to allow users to call <code class="language-plaintext highlighter-rouge">withdraw()</code> to receive their entire deposit, consider replacing <a href="https://github.com/timeless-fi/yield-daddy/blob/2c8f62681ab90325ede093ac9c9f94dbcc5f7e49/src/aave-v2/AaveV2ERC4626.sol#L96">this line in <code class="language-plaintext highlighter-rouge">withdraw()</code></a> with the following code:</p>

<div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">shares</span> <span class="o">=</span> <span class="n">assets</span> <span class="o">==</span> <span class="k">type</span><span class="p">(</span><span class="kt">uint256</span><span class="p">).</span><span class="n">max</span> <span class="o">?</span> <span class="n">balanceOf</span><span class="p">[</span><span class="n">owner</span><span class="p">]</span> <span class="o">:</span> <span class="n">previewWithdraw</span><span class="p">(</span><span class="n">assets</span><span class="p">);</span> <span class="c1">// No need to check for rounding error, previewWithdraw rounds up.
</span></code></pre></div></div>

<p>A similar feature to redeem all shares may be useful for <code class="language-plaintext highlighter-rouge">redeem()</code>. Although it may not be worth the gas cost because a user’s shares do not rebase in the same way that the underlying aTokens do, so <code class="language-plaintext highlighter-rouge">redeem()</code> can already allow a relatively simple way of withdrawing the entire deposit for a user.</p>
      <h4 id="developer-response-7">
        
        
          <a href="#developer-response-7" class="anchor-heading" aria-labelledby="developer-response-7"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Developer Response
        
        
      </h4>
    

<p>This is fine. The recommendation would make the wrappers not conform to the ERC-4626 specs.</p>
      <h3 id="2-low---inaccurate-function-return-values-engn33r">
        
        
          <a href="#2-low---inaccurate-function-return-values-engn33r" class="anchor-heading" aria-labelledby="2-low---inaccurate-function-return-values-engn33r"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 2. Low - Inaccurate function return values (engn33r)
        
        
      </h3>
    

<p><code class="language-plaintext highlighter-rouge">maxDeposit()</code> and <code class="language-plaintext highlighter-rouge">maxMint()</code> return <code class="language-plaintext highlighter-rouge">type(uint256).max</code> even though that value may not be possible to deposit or mint without a revert. Most likely these functions were copied from a default ERC4626 implementation and not customized for the underlying tokens.</p>
      <h4 id="technical-details-8">
        
        
          <a href="#technical-details-8" class="anchor-heading" aria-labelledby="technical-details-8"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Technical Details
        
        
      </h4>
    

<p>The <a href="https://github.com/timeless-fi/yield-daddy/blob/2c8f62681ab90325ede093ac9c9f94dbcc5f7e49/src/aave-v2/AaveV2ERC4626.sol#L155"><code class="language-plaintext highlighter-rouge">maxDeposit()</code></a> and <a href="https://github.com/timeless-fi/yield-daddy/blob/2c8f62681ab90325ede093ac9c9f94dbcc5f7e49/src/aave-v2/AaveV2ERC4626.sol#L170"><code class="language-plaintext highlighter-rouge">maxMint()</code></a> functions only return the value <code class="language-plaintext highlighter-rouge">type(uint256).max</code> when the underlying pool can accept a deposit or mint. The value <code class="language-plaintext highlighter-rouge">type(uint256).max</code> does not accurately represent the maximum value that can be deposited into the vault when some ERC4626 tokens have already been minted. This is because the vault normally can mint a maximum of <code class="language-plaintext highlighter-rouge">type(uint256).max</code>, otherwise the <code class="language-plaintext highlighter-rouge">totalSupply</code> state variable will overflow and cause a revert, so the existing token supply should be subtracted. The same is true for aTokens, which should have the existing supply excluded. <a href="https://eips.ethereum.org/EIPS/eip-4626#security-considerations#maxmint">EIP4626 defines this requirement</a> for <code class="language-plaintext highlighter-rouge">maxMint()</code>:</p>

<blockquote>
  <p>MUST return the maximum amount of shares mint would allow to be deposited to receiver and not cause a revert, which MUST NOT be higher than the actual maximum that would be accepted (it should underestimate if necessary).</p>
</blockquote>

<p>The output of <code class="language-plaintext highlighter-rouge">maxDeposit()</code> cannot be passed into <code class="language-plaintext highlighter-rouge">withdraw()</code> without a revert, which does not satisfy this ERC4626 requirement. A more accurate return value for <code class="language-plaintext highlighter-rouge">maxDeposit()</code> in <a href="https://github.com/timeless-fi/yield-daddy/blob/2c8f62681ab90325ede093ac9c9f94dbcc5f7e49/src/aave-v2/AaveV2ERC4626.sol#L167">Aave V2</a> and <a href="https://github.com/timeless-fi/yield-daddy/blob/2c8f62681ab90325ede093ac9c9f94dbcc5f7e49/src/aave-v3/AaveV3ERC4626.sol#L171">Aave V3</a>  is:</p>

<div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">return</span> <span class="k">type</span><span class="p">(</span><span class="kt">uint256</span><span class="p">).</span><span class="n">max</span> <span class="o">-</span> <span class="n">aToken</span><span class="p">.</span><span class="n">totalSupply</span><span class="p">();</span>
</code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">totalSupply</code> value limitation of the ERC4626 vault can be ignored because the <code class="language-plaintext highlighter-rouge">totalSupply</code> of the vault will always be less than or equal to <code class="language-plaintext highlighter-rouge">aToken.totalSupply()</code>, so the aToken totalSupply is the limiting factor.</p>

<p>The same issue is relevant for <code class="language-plaintext highlighter-rouge">maxMint()</code>, but the return value of <code class="language-plaintext highlighter-rouge">maxMint()</code> should be in units of shares instead of assets because the ERC4626 <code class="language-plaintext highlighter-rouge">mint()</code> function takes a shares value as input. The more accurate return value for <code class="language-plaintext highlighter-rouge">maxMint()</code> in <a href="https://github.com/timeless-fi/yield-daddy/blob/2c8f62681ab90325ede093ac9c9f94dbcc5f7e49/src/aave-v2/AaveV2ERC4626.sol#L182">Aave V2</a> and <a href="https://github.com/timeless-fi/yield-daddy/blob/2c8f62681ab90325ede093ac9c9f94dbcc5f7e49/src/aave-v3/AaveV3ERC4626.sol#L189">Aave V3</a> is therefore:</p>

<div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">return</span> <span class="n">convertToShares</span><span class="p">(</span><span class="k">type</span><span class="p">(</span><span class="kt">uint256</span><span class="p">).</span><span class="n">max</span> <span class="o">-</span> <span class="n">aToken</span><span class="p">.</span><span class="n">totalSupply</span><span class="p">());</span>
</code></pre></div></div>

<p>This issue is present in the Compound ERC4626 wrapper as well. A similar solution should be applied.</p>
      <h4 id="impact-8">
        
        
          <a href="#impact-8" class="anchor-heading" aria-labelledby="impact-8"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Impact
        
        
      </h4>
    

<p>Low. The <code class="language-plaintext highlighter-rouge">maxDeposit()</code> and <code class="language-plaintext highlighter-rouge">maxMint()</code> are view functions that do not directly impact any state variables, but the value returned from these functions does not match the intended purposes of these functions.</p>
      <h4 id="recommendation-8">
        
        
          <a href="#recommendation-8" class="anchor-heading" aria-labelledby="recommendation-8"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Recommendation
        
        
      </h4>
    

<p>Use the above code instead of returning the constant <code class="language-plaintext highlighter-rouge">type(uint256).max</code> in AaveV2ERC4626.sol and AaveV3ERC4626.sol. If a vault does not allow a max of <code class="language-plaintext highlighter-rouge">type(uint256).max</code> in deposits, use custom math for that vault, <a href="https://github.com/timeless-fi/yield-daddy/blob/2c8f62681ab90325ede093ac9c9f94dbcc5f7e49/src/aave-v3/AaveV3ERC4626.sol#L176">which is already done with the supplyCap in AaveV3ERC4626.sol</a> but not used for Aave V2. Fix the Compound wrapper with a similar approach.</p>
      <h4 id="developer-response-8">
        
        
          <a href="#developer-response-8" class="anchor-heading" aria-labelledby="developer-response-8"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Developer Response
        
        
      </h4>
    

<p>This is fine. While the ERC-4626 specs are not completely clear about what to do in this case, I’ve consulted transmissions11 and the return values of maxMint() and maxDeposit() are only supposed to differ from type(uint256).max when the ERC-4626 contract itself (or the contracts it interacts with) implements an explicit limit on deposits. Implicit limits, such as it being impossible to deposit a token with an amount greater than the token’s total supply, or it being impossible to deposit enough tokens to make the wrapper’s total supply exceed 256 bits, should not be reflected.</p>
      <h3 id="3-low---no-fee-on-transfer-token-support-engn33r">
        
        
          <a href="#3-low---no-fee-on-transfer-token-support-engn33r" class="anchor-heading" aria-labelledby="3-low---no-fee-on-transfer-token-support-engn33r"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 3. Low - No fee-on-transfer token support (engn33r)
        
        
      </h3>
    

<p>The <code class="language-plaintext highlighter-rouge">beforeWithdraw()</code> and <code class="language-plaintext highlighter-rouge">afterDeposit()</code> functions are not implemented with fee-on-transfer tokens in mind. If one of the supported lending platforms adds a fee-on-transfer token, or an existing supported tokens enables the fee-on-transfer feature, some ERC4626 wrapper functions in yield daddy will revert. The same lack of fee-on-transfer support exists in the swapper repo.</p>
      <h4 id="technical-details-9">
        
        
          <a href="#technical-details-9" class="anchor-heading" aria-labelledby="technical-details-9"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Technical Details
        
        
      </h4>
    

<p>Fee-on-transfer tokens have the property where the value that is sent is not the same as the value that is received. This <a href="https://github.com/d-xo/weird-erc20#fee-on-transfer">difference in logic compared to standard ERC20 tokens</a> requires special handling in solidity to avoid a revert or loss of value. No fee-on-transfer ERC20 appears to exist on the supported lending platforms at the time of the review, but if one is added in the future or if the fee is enabled on an existing token that supports fee-on-transfer, the ERC4626 wrappers for protocols that require two separate transfers for depositing and withdrawing (Euler, Compound, Aave only for depositing) would not function with fee-on-transfer tokens because the deposit or withdraw process would revert because the fee is not accounted for in between the two transfers.</p>

<p>The swapper repo also lacks fee-on-transfer support. This is because <a href="https://github.com/timeless-fi/swapper/blob/b898896579b60697a8113da21cefb3b00bcfaa0d/src/Swapper.sol#L409">the <code class="language-plaintext highlighter-rouge">tokenAmountIn</code> value used in the <code class="language-plaintext highlighter-rouge">safeTransferFrom()</code> call</a> is assumed to equal the value held by the Swapper.sol contract after the transfer takes place. This will revert when <code class="language-plaintext highlighter-rouge">args.gate.enterWithUnderlying()</code> is called because <a href="https://github.com/timeless-fi/timeless/blob/47c79493120c562ac69eff786f0445e8b8c9470a/src/Gate.sol#L229">the <code class="language-plaintext highlighter-rouge">underlying.safeTransferFrom()</code> call in Gate.sol’s <code class="language-plaintext highlighter-rouge">enterWithUnderlying()</code></a> will not have sufficient balance to transfer.</p>
      <h4 id="impact-9">
        
        
          <a href="#impact-9" class="anchor-heading" aria-labelledby="impact-9"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Impact
        
        
      </h4>
    

<p>Low. It is unlikely that fee-on-transfer tokens would be added to these lending protocols, but if this does occur, the ERC4626 wrapper as designed would not support these fee-on-transfer tokens.</p>
      <h4 id="recommendation-9">
        
        
          <a href="#recommendation-9" class="anchor-heading" aria-labelledby="recommendation-9"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Recommendation
        
        
      </h4>
    

<p>Add support for fee-on-transfer tokens if these wrappers are intended to remain in use without modifications for an extended period of time. A solution similar to <a href="https://github.com/Uniswap/v2-periphery/blob/0335e8f7e1bd1e8d8329fd300aea2ef2f36dd19f/contracts/UniswapV2Router02.sol#L339">Uniswap’s <code class="language-plaintext highlighter-rouge">swapExactTokensForTokensSupportingFeeOnTransferTokens()</code></a> could enable this support. Otherwise, be mindful that future changes to tokens supported by the lending protocols could cause compatibility issues with yield daddy.</p>
      <h4 id="developer-response-9">
        
        
          <a href="#developer-response-9" class="anchor-heading" aria-labelledby="developer-response-9"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Developer Response
        
        
      </h4>
    

<p>This is fine. We have zero intentions to support fee-on-transfer tokens.</p>
      <h3 id="4-low---curves-price_oracle-may-provide-less-effective-sandwiching-protection-post-merge-benjamin-samuels">
        
        
          <a href="#4-low---curves-price_oracle-may-provide-less-effective-sandwiching-protection-post-merge-benjamin-samuels" class="anchor-heading" aria-labelledby="4-low---curves-price_oracle-may-provide-less-effective-sandwiching-protection-post-merge-benjamin-samuels"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 4. Low - Curve’s <code class="language-plaintext highlighter-rouge">price_oracle()</code> may provide less effective sandwiching protection post-merge (Benjamin Samuels)
        
        
      </h3>
    

<p>CurveV2xPYT <a href="https://github.com/timeless-fi/xPYT/blob/fabe9d7cb9700334b10a48ee5d081234eb98def9/src/curve-v2/CurveV2xPYT.sol#L80">uses</a> Curve’s <code class="language-plaintext highlighter-rouge">price_oracle()</code> function to prevent swaps from being sandwiched.</p>

<p>Curve’s <code class="language-plaintext highlighter-rouge">price_oracle()</code> function is <a href="https://github.com/curvefi/curve-crypto-contract/blob/master/contracts/two/CurveCryptoSwap2ETH.vy#L598">implemented</a> using an Exponential Moving Average (EMA) filter. This filter prevents MEV extractors from manipulating the result of the price oracle, since doing so would require either a prohibitive amount of capital, or full control over multiple blocks in a row.</p>
      <h4 id="technical-details-10">
        
        
          <a href="#technical-details-10" class="anchor-heading" aria-labelledby="technical-details-10"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Technical Details
        
        
      </h4>
    

<p>In the upcoming Merge of the Ethereum mainnet, block proposers and validators are assigned randomly 2 epochs in advance. This enables an attacker with a sufficient amount of capital to fully manipulate the contents of two or more blocks in a row, undermining previous the security assumption that arbitrageurs could disrupt a multi-block oracle manipulation attack.</p>

<p>This risk is compounded by price oracles that put more weight on recent observations, such as Curve’s EMA oracle.</p>
      <h4 id="impact-10">
        
        
          <a href="#impact-10" class="anchor-heading" aria-labelledby="impact-10"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Impact
        
        
      </h4>
    

<p>Low. Given the undermining of several security assumptions in TWAP/EMA price oracles, it is possible that given the correct liquidity conditions and validator assignments, an attacker can sufficiently manipulate an oracle to enable an effective, multi-block sandwich attack.</p>

<p>While this attack has not been demonstrated in the wild yet, <a href="https://alrevuelta.github.io/posts/ethereum-mev-multiblock">research is ongoing</a> on its viability.</p>
      <h4 id="recommendation-10">
        
        
          <a href="#recommendation-10" class="anchor-heading" aria-labelledby="recommendation-10"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Recommendation
        
        
      </h4>
    

<p>An alternate mechanism for permissionless compounding is to use <a href="https://keep3r.network/">Keep3r Network</a>, which operates semi-permissionlessly and can be configured to require transactions be routed through Flashbots for sandwiching protection. Given the lack of demonstrated attacks, implementing a measure such as Keep3r may be better left off to later protocol versions.</p>
      <h4 id="developer-response-10">
        
        
          <a href="#developer-response-10" class="anchor-heading" aria-labelledby="developer-response-10"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Developer Response
        
        
      </h4>
    

<p>Acknowledged.</p>
      <h3 id="5-low---insufficient-swapargs-input-validation-engn33r">
        
        
          <a href="#5-low---insufficient-swapargs-input-validation-engn33r" class="anchor-heading" aria-labelledby="5-low---insufficient-swapargs-input-validation-engn33r"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 5. Low - Insufficient SwapArgs input validation (engn33r)
        
        
      </h3>
    

<p><code class="language-plaintext highlighter-rouge">swapUnderlyingToNyt()</code> and <code class="language-plaintext highlighter-rouge">swapUnderlyingToXpyt()</code> in CurveV2Swapper allows a user to input a SwapArgs struct that could be custom crafted. There is no validation of the data from this struct, which could lead to unexpected consequences.</p>
      <h4 id="technical-details-11">
        
        
          <a href="#technical-details-11" class="anchor-heading" aria-labelledby="technical-details-11"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Technical Details
        
        
      </h4>
    

<p>There is no validation in <code class="language-plaintext highlighter-rouge">_swapUnderlyingToNyt()</code> that confirms that the addresses of <code class="language-plaintext highlighter-rouge">args.underlying</code>, <code class="language-plaintext highlighter-rouge">args.nyt</code>, <code class="language-plaintext highlighter-rouge">args.pyt</code>, <code class="language-plaintext highlighter-rouge">args.xPYT</code>, and <code class="language-plaintext highlighter-rouge">args.vault</code> are all related to the same underlying asset. Similarly, the value <code class="language-plaintext highlighter-rouge">args.gate</code> may not hold the address of the actual Gate.sol contract in the timeless protocol, but instead may be the address of an attacker’s contract. An external call is made to <code class="language-plaintext highlighter-rouge">args.gate</code> in <code class="language-plaintext highlighter-rouge">_swapUnderlyingToNyt()</code> and <code class="language-plaintext highlighter-rouge">_swapUnderlyingToXpyt()</code>, and although the external functions <code class="language-plaintext highlighter-rouge">swapUnderlyingToNyt()</code> and <code class="language-plaintext highlighter-rouge">swapUnderlyingToXpyt()</code> have the nonReentrant modifier, there is no global reentrancy lock across the Timeless protocol(s), so the risk of a hack involving reentrancy is not zero.</p>
      <h4 id="impact-11">
        
        
          <a href="#impact-11" class="anchor-heading" aria-labelledby="impact-11"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Impact
        
        
      </h4>
    

<p>Low. No direct attack vectors were observed, but lack of user input validation is often a cause for concern.</p>
      <h4 id="recommendation-11">
        
        
          <a href="#recommendation-11" class="anchor-heading" aria-labelledby="recommendation-11"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Recommendation
        
        
      </h4>
    

<p>Add multiple validation checks to confirm the SwapArgs function argument complies with certain assumptions. When possible, do not trust the function argument fully, but instead derive the necessary values using external calls to look up the necessary values using <code class="language-plaintext highlighter-rouge">args.underlying</code> or similar values.</p>

<p>To reduce the number of inputs that need to be validated, at least three parameters in the <code class="language-plaintext highlighter-rouge">SwapArgs</code> struct can be removed and derived from existing parameters:</p>
<ol>
  <li><code class="language-plaintext highlighter-rouge">args.gate</code> is unnecessary because the proper gate can be derived using <code class="language-plaintext highlighter-rouge">args.xPYT.gate</code> or from <code class="language-plaintext highlighter-rouge">args.pyt.gate</code></li>
  <li><code class="language-plaintext highlighter-rouge">args.vault</code> can be derived from <code class="language-plaintext highlighter-rouge">args.xPYT.vault</code> or from <code class="language-plaintext highlighter-rouge">args.pyt.vault</code></li>
  <li><code class="language-plaintext highlighter-rouge">args.nyt</code> can be derived from <code class="language-plaintext highlighter-rouge">args.xPYT.nyt</code></li>
</ol>
      <h4 id="developer-response-11">
        
        
          <a href="#developer-response-11" class="anchor-heading" aria-labelledby="developer-response-11"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Developer Response
        
        
      </h4>
    

<p>This is by design, validation is not present to save on the gas costs of swapping.</p>
      <h3 id="6-low---curve-swap-design-may-generate-unexpected-nytpyt-dust-benjamin-samuels">
        
        
          <a href="#6-low---curve-swap-design-may-generate-unexpected-nytpyt-dust-benjamin-samuels" class="anchor-heading" aria-labelledby="6-low---curve-swap-design-may-generate-unexpected-nytpyt-dust-benjamin-samuels"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 6. Low - Curve Swap design may generate unexpected NYT/PYT dust (Benjamin Samuels)
        
        
      </h3>
    

<p><code class="language-plaintext highlighter-rouge">CurveV2Swapper</code> will leave behind unexpected dust due the use of the off-chain oracle implemented by <code class="language-plaintext highlighter-rouge">CurveV2Juggler</code>.</p>
      <h4 id="technical-details-12">
        
        
          <a href="#technical-details-12" class="anchor-heading" aria-labelledby="technical-details-12"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Technical Details
        
        
      </h4>
    

<p>According to the <a href="https://github.com/timeless-fi/swapper/blob/35db08558aa01e8473ada13c092e24857d01461b/src/curve-v2/CurveV2Juggler.sol#L46-L47">documentation</a>, CurveV2Swapper’s <code class="language-plaintext highlighter-rouge">swapNytToUnderlying()</code> and <code class="language-plaintext highlighter-rouge">swapXpytToUnderlying()</code> functions are intended to be used in conjunction with <code class="language-plaintext highlighter-rouge">CurveV2Juggler.juggleXpytInput()</code> and <code class="language-plaintext highlighter-rouge">CurveV2Juggler.juggleNytInput()</code> respectively. These two juggle function are intended to operate as off-chain oracles which are used to calculate the correct quantities of NYT/PYT tokens to be swapped. The goal of the swap is for the user to end up with a nominally equivalent number of NYT+PYT tokens for a vault, which are then redeemed in equal amounts for xPYT tokens, which is then redeemed for the underlying vault’s token.</p>

<p>The decoupling of the off-chain price oracle with the on-chain swap introduces a chance that the swap is executed at a different price that the price oracle expected. If a swap is executed at a different price than the oracle predicted, then the user will have differing quantities of NYT and PYT, and will have some amount of dust remaining after they redeem their NYT+PYT for xPYT.</p>
      <h4 id="impact-12">
        
        
          <a href="#impact-12" class="anchor-heading" aria-labelledby="impact-12"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Impact
        
        
      </h4>
    

<p>Low. As usage of the protocol increases, an increasingly large fraction of NYT/PYT redemption flows utilizing Curve swaps will generate NYT or PYT dust.</p>

<p>In scenarios where the Curve pool’s parameters are being modified (gamma, fees, amp parameter, etc.), <em>all</em> swap-based redemption flows will generate dust.</p>
      <h4 id="recommendation-12">
        
        
          <a href="#recommendation-12" class="anchor-heading" aria-labelledby="recommendation-12"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Recommendation
        
        
      </h4>
    

<p>CurveJuggler currently implements a numeric solution for calculating how much NYT/PYT should be swapped. This approach consumes a large amount of gas, which is why it can only be used as an off-chain oracle. If CurveJuggler implemented an analytic solution, gas consumption may be reduced enough that the oracle can be consulted from the on-chain swap transaction.</p>

<p>If an analytic solution is not possible, then an alternate AMM should be considered for NYT/PYT swaps.</p>
      <h4 id="developer-response-12">
        
        
          <a href="#developer-response-12" class="anchor-heading" aria-labelledby="developer-response-12"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Developer Response
        
        
      </h4>
    

<p>This is fine, since the extra dust is returned to the user. There is no analytical solution for Curve swaps, as even Curve itself uses Newton’s method to approximate the solution.</p>
      <h3 id="7-low---xpyt-deployment-lacks-trust-mechanism-engn33r">
        
        
          <a href="#7-low---xpyt-deployment-lacks-trust-mechanism-engn33r" class="anchor-heading" aria-labelledby="7-low---xpyt-deployment-lacks-trust-mechanism-engn33r"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 7. Low - xPYT deployment lacks trust mechanism (engn33r)
        
        
      </h3>
    

<p>xPYT.sol is designed to allow for many xPYTs to exist for a single underlying vault. <code class="language-plaintext highlighter-rouge">deployCurveV2xPYT()</code> in CurveV2xPYTFactory.sol does not use CREATE2 to deploy the xPYT contract, not does it store an array or mapping of deployed xPYT contracts. This means there is no way to determine whether an address is a legitimate xPYT contract deployed by CurveV2xPYTFactory.sol or a malicious contract deployed by a third party with the same function names and interfaces. Any contracts that take a xPYT address as a function argument, including third-party contracts that want to integrate with xPYT tokens, cannot validate that the address is legitimate and must treat the contract as potentially malicious. This also means that a xPYT contract call could add risk of reentrancy or other attack vectors.</p>
      <h4 id="technical-details-13">
        
        
          <a href="#technical-details-13" class="anchor-heading" aria-labelledby="technical-details-13"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Technical Details
        
        
      </h4>
    

<p>Often the CREATE2 opcode is used to deploy contracts that depend on underlying parameters, because the address of the contract can be derived from those underlying parameters. This is the approach used in <code class="language-plaintext highlighter-rouge">deployYieldTokenPair()</code> of Factory.sol to deploy new NYT/PYT pairs and by <a href="https://github.com/Uniswap/v2-core/blob/ee547b17853e71ed4e0101ccfd52e70d5acded58/contracts/UniswapV2Factory.sol#L31">Uniswap V2 to deploy new pairs</a>. But because multiple xPYT tokens can exist for a single underlying vault, perhaps CREATE2 cannot be used in this case. There is no state variable in CurveV2xPYTFactory.sol that stores the address of deployed xPYT contracts, which means that functions that accept a xPYT address as a function argument, including several functions in Swapper.sol that have a <code class="language-plaintext highlighter-rouge">SwapArgs.xPYT</code> function argument, cannot determine whether the xPYT address is a legitimate xPYT token or a malicious contract. This is unlikely to impact most users who use a web interface in their browser, but it may open up an attack vector of a malicious contract posing as a legitimate xPYT token.</p>
      <h4 id="impact-13">
        
        
          <a href="#impact-13" class="anchor-heading" aria-labelledby="impact-13"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Impact
        
        
      </h4>
    

<p>Low. No specific proof of concept attacks were found during the allocated review time, but the lack of trust for xPYT contracts is likely a concern that should be mitigated.</p>
      <h4 id="recommendation-13">
        
        
          <a href="#recommendation-13" class="anchor-heading" aria-labelledby="recommendation-13"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Recommendation
        
        
      </h4>
    

<p>Use CREATE2 to deploy new xPYT contracts if possible, otherwise add a mechanism to validate whether an address is a legitimate xPYT token. A mapping of xPYT addresses stored in <code class="language-plaintext highlighter-rouge">CurveV2xPYTFactory.sol</code> is a reasonable solution for this, as found <a href="https://github.com/Uniswap/v2-core/blob/ee547b17853e71ed4e0101ccfd52e70d5acded58/contracts/UniswapV2Factory.sol#L34-L35">in Uniswap V2</a>.</p>
      <h4 id="developer-response-13">
        
        
          <a href="#developer-response-13" class="anchor-heading" aria-labelledby="developer-response-13"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Developer Response
        
        
      </h4>
    

<p>Fixed in commit <a href="https://github.com/timeless-fi/xPYT/commit/5bcc2e5f053b7e7c31610b532f29720625429aa2">5bcc2e5f053b7e7c31610b532f29720625429aa2</a>.</p>
      <h3 id="8-low---missing-pytnyt-lookup-mechanism-engn33r">
        
        
          <a href="#8-low---missing-pytnyt-lookup-mechanism-engn33r" class="anchor-heading" aria-labelledby="8-low---missing-pytnyt-lookup-mechanism-engn33r"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 8. Low - Missing PYT/NYT lookup mechanism (engn33r)
        
        
      </h3>
    

<p>There is no good way to list all valid PYT/NYT token pairs. <a href="https://github.com/timeless-fi/timeless/blob/c04bd213b1a1f82b9f7c9790db3a6234eb0f7e8f/src/Factory.sol#L74"><code class="language-plaintext highlighter-rouge">deployYieldTokenPair()</code> has no access controls</a> so anyone can call the function with their own vault and a malicious gate-like contract. If a frontend or bot creates a list of existing PYT/NYT tokens by collecting all the <a href="https://github.com/timeless-fi/timeless/blob/c04bd213b1a1f82b9f7c9790db3a6234eb0f7e8f/src/Factory.sol#L85"><code class="language-plaintext highlighter-rouge">DeployYieldTokenPair</code> events</a> emitted from <code class="language-plaintext highlighter-rouge">deployYieldTokenPair()</code>, the list would then need to be filtered to contain only trusted <code class="language-plaintext highlighter-rouge">gate</code> addresses and validate the gate type corresponded to the vault type.</p>

<p>Note that this finding is outside the scope of this review, but was still highlighted.</p>
      <h4 id="technical-details-14">
        
        
          <a href="#technical-details-14" class="anchor-heading" aria-labelledby="technical-details-14"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Technical Details
        
        
      </h4>
    

<p>The PerpetualYieldToken.sol and NegativeYieldToken.sol contracts contain many external calls to the gate contract, notably the <code class="language-plaintext highlighter-rouge">gate.beforePerpetualYieldTokenTransfer()</code> call in PYT’s <a href="https://github.com/timeless-fi/timeless/blob/c04bd213b1a1f82b9f7c9790db3a6234eb0f7e8f/src/PerpetualYieldToken.sol#L39"><code class="language-plaintext highlighter-rouge">transfer()</code></a> and <a href="https://github.com/timeless-fi/timeless/blob/c04bd213b1a1f82b9f7c9790db3a6234eb0f7e8f/src/PerpetualYieldToken.sol#L75"><code class="language-plaintext highlighter-rouge">transferFrom()</code></a> functions and the gate-protected <a href="https://github.com/timeless-fi/timeless/blob/c04bd213b1a1f82b9f7c9790db3a6234eb0f7e8f/src/lib/BaseERC20.sol#L44"><code class="language-plaintext highlighter-rouge">gateMint()</code></a> and <a href="https://github.com/timeless-fi/timeless/blob/c04bd213b1a1f82b9f7c9790db3a6234eb0f7e8f/src/lib/BaseERC20.sol#L52"><code class="language-plaintext highlighter-rouge">gateBurn()</code></a> in BaseERC20.sol. If the gate is malicious, it could leverage these callbacks for a variety of attack vectors.</p>
      <h4 id="impact-14">
        
        
          <a href="#impact-14" class="anchor-heading" aria-labelledby="impact-14"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Impact
        
        
      </h4>
    

<p>Low. A malicious gate address can be specified which increases the risk of several attack vectors.</p>
      <h4 id="recommendation-14">
        
        
          <a href="#recommendation-14" class="anchor-heading" aria-labelledby="recommendation-14"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Recommendation
        
        
      </h4>
    

<p>A whitelist of valid gate addresses or a similar mechanism should be added to Factory.sol to prevent PYT/NYT token pair creation with arbitrary gate addresses. An additional check should exist to validate that the vault is matched with a proper gate, otherwise an ERC20Gate may be paired with a ERC4626 token. For reference, Uniswap V2’s <a href="https://github.com/Uniswap/v2-core/blob/ee547b17853e71ed4e0101ccfd52e70d5acded58/contracts/UniswapV2Factory.sol#L23"><code class="language-plaintext highlighter-rouge">createPair()</code> function only allows users to specify the two token addresses</a> and nothing else, so users only need to trust the underlying tokens. To interact with Timeless PYT/NYT tokens as it is designed now, the user must trust the vault AND the gate, PLUS verify the gate type and vault type match.</p>
      <h4 id="developer-response-14">
        
        
          <a href="#developer-response-14" class="anchor-heading" aria-labelledby="developer-response-14"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Developer Response
        
        
      </h4>
    

<p>This is fine. Gate contracts are immutable, so malicious gate contracts are easy to avoid. We do not intend to add whitelists for contracts in order to keep the protocol permissionless. There’s no good way that can ensure a vault matches the Gate type on the smart contract level, it is assumed that the validation is done in the frontend; furthermore, there’s no incentive for people to deploy yield tokens for a mismatched Gate and vault pair.</p>
      <h2 id="gas-savings-findings">
        
        
          <a href="#gas-savings-findings" class="anchor-heading" aria-labelledby="gas-savings-findings"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Gas Savings Findings
        
        
      </h2>
    
      <h3 id="1-gas---replace-require-blocks-with-errors-engn33r">
        
        
          <a href="#1-gas---replace-require-blocks-with-errors-engn33r" class="anchor-heading" aria-labelledby="1-gas---replace-require-blocks-with-errors-engn33r"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 1. Gas - Replace require blocks with errors (engn33r)
        
        
      </h3>
    

<p>One require block can be replaced with a custom error for gas savings. Errors were introduced in Solidity 0.8.4 and <a href="https://blog.soliditylang.org/2021/04/21/custom-errors/">offer a gas savings</a>. Custom errors are already used elsewhere in the project but are not applied everywhere.</p>
      <h4 id="technical-details-15">
        
        
          <a href="#technical-details-15" class="anchor-heading" aria-labelledby="technical-details-15"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Technical Details
        
        
      </h4>
    

<p>Instances of require that can be replace with custom errors are found in:</p>
<ul>
  <li><a href="https://github.com/timeless-fi/yield-daddy/blob/2c8f62681ab90325ede093ac9c9f94dbcc5f7e49/src/aave-v2/AaveV2ERC4626.sol#L126">AaveV2</a></li>
  <li><a href="https://github.com/timeless-fi/yield-daddy/blob/2c8f62681ab90325ede093ac9c9f94dbcc5f7e49/src/aave-v3/AaveV3ERC4626.sol#L132">AaveV3</a></li>
  <li><a href="https://github.com/timeless-fi/xPYT/blob/fabe9d7cb9700334b10a48ee5d081234eb98def9/src/xPYT.sol#L264">xPYT</a></li>
</ul>
      <h4 id="impact-15">
        
        
          <a href="#impact-15" class="anchor-heading" aria-labelledby="impact-15"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Impact
        
        
      </h4>
    

<p>Gas savings.</p>
      <h4 id="recommendation-15">
        
        
          <a href="#recommendation-15" class="anchor-heading" aria-labelledby="recommendation-15"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Recommendation
        
        
      </h4>
    

<p>Use solidity custom errors instead of require statements.</p>
      <h4 id="developer-response-15">
        
        
          <a href="#developer-response-15" class="anchor-heading" aria-labelledby="developer-response-15"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Developer Response
        
        
      </h4>
    

<p>This is fine.</p>
      <h3 id="2-gas---declare-variables-internal-immutable-or-constant-when-possible-engn33r">
        
        
          <a href="#2-gas---declare-variables-internal-immutable-or-constant-when-possible-engn33r" class="anchor-heading" aria-labelledby="2-gas---declare-variables-internal-immutable-or-constant-when-possible-engn33r"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 2. Gas - Declare variables internal, immutable, or constant when possible (engn33r)
        
        
      </h3>
    

<p>Declaring a constant with internal visibility enables a cheaper contract deployment than public constants because public variables automatically receive a getter function.</p>
      <h4 id="technical-details-16">
        
        
          <a href="#technical-details-16" class="anchor-heading" aria-labelledby="technical-details-16"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Technical Details
        
        
      </h4>
    

<p>Many public immutable variables exist in the Euler, Aave V2, Aave V3, and Compound wrappers. If possible, make these internal instead of public for gas savings.</p>

<p>There is <a href="https://github.com/timeless-fi/xPYT/blob/fabe9d7cb9700334b10a48ee5d081234eb98def9/src/xPYT.sol#L91">one variable in xPYT.sol, <code class="language-plaintext highlighter-rouge">assetBalance</code></a>, that can be made private because it already has a public getter function in the form of <code class="language-plaintext highlighter-rouge">totalAssets()</code>.</p>

<p>A variable in CurveV2xPYT.sol, <a href="https://github.com/timeless-fi/xPYT/blob/fabe9d7cb9700334b10a48ee5d081234eb98def9/src/curve-v2/CurveV2xPYT.sol#L34"><code class="language-plaintext highlighter-rouge">curvePool</code>, can be made immutable</a> because it is <a href="https://github.com/timeless-fi/xPYT/blob/fabe9d7cb9700334b10a48ee5d081234eb98def9/src/curve-v2/CurveV2xPYT.sol#L62">only changed once, in the initializer</a>.</p>
      <h4 id="impact-16">
        
        
          <a href="#impact-16" class="anchor-heading" aria-labelledby="impact-16"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Impact
        
        
      </h4>
    

<p>Gas savings.</p>
      <h4 id="recommendation-16">
        
        
          <a href="#recommendation-16" class="anchor-heading" aria-labelledby="recommendation-16"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Recommendation
        
        
      </h4>
    

<p>Make variables internal or private for gas savings on contract deployment.</p>
      <h4 id="developer-response-16">
        
        
          <a href="#developer-response-16" class="anchor-heading" aria-labelledby="developer-response-16"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Developer Response
        
        
      </h4>
    

<p>It’s not possible to make curvePool in CurveV2xPYT immutable, as it would create a circular dependency between the xPYT contract and the Curve pool. We’re ok with the other variables being public.</p>
      <h3 id="3-gas---remove-beforewithdraw-calls-engn33r">
        
        
          <a href="#3-gas---remove-beforewithdraw-calls-engn33r" class="anchor-heading" aria-labelledby="3-gas---remove-beforewithdraw-calls-engn33r"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 3. Gas - Remove <code class="language-plaintext highlighter-rouge">beforeWithdraw()</code> calls (engn33r)
        
        
      </h3>
    

<p>An unnecessary function call can be removed.</p>
      <h4 id="technical-details-17">
        
        
          <a href="#technical-details-17" class="anchor-heading" aria-labelledby="technical-details-17"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Technical Details
        
        
      </h4>
    

<p><code class="language-plaintext highlighter-rouge">withdraw()</code> and <code class="language-plaintext highlighter-rouge">redeem()</code> call <code class="language-plaintext highlighter-rouge">beforeWithdraw()</code>, but <code class="language-plaintext highlighter-rouge">beforeWithdraw()</code> is never implemented with code. <code class="language-plaintext highlighter-rouge">beforeWithdraw()</code> is declared in ERC4626.sol as an empty virtual function. The calls to <code class="language-plaintext highlighter-rouge">beforeWithdraw()</code> can be removed because it doesn’t run any code.</p>
      <h4 id="impact-17">
        
        
          <a href="#impact-17" class="anchor-heading" aria-labelledby="impact-17"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Impact
        
        
      </h4>
    

<p>Gas savings.</p>
      <h4 id="recommendation-17">
        
        
          <a href="#recommendation-17" class="anchor-heading" aria-labelledby="recommendation-17"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Recommendation
        
        
      </h4>
    

<p>Remove function calls to functions that are never implemented, specifically <a href="https://github.com/timeless-fi/yield-daddy/blob/2c8f62681ab90325ede093ac9c9f94dbcc5f7e49/src/aave-v2/AaveV2ERC4626.sol#L106">this line</a> and <a href="https://github.com/timeless-fi/yield-daddy/blob/2c8f62681ab90325ede093ac9c9f94dbcc5f7e49/src/aave-v2/AaveV2ERC4626.sol#L128">this line</a>.</p>
      <h4 id="developer-response-17">
        
        
          <a href="#developer-response-17" class="anchor-heading" aria-labelledby="developer-response-17"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Developer Response
        
        
      </h4>
    

<p>This is by design. It makes it easier for other contracts to inherit from it and still implement withdraw hooks.</p>
      <h3 id="4-gas---replace-duplicate-code-with-internal-function-engn33r">
        
        
          <a href="#4-gas---replace-duplicate-code-with-internal-function-engn33r" class="anchor-heading" aria-labelledby="4-gas---replace-duplicate-code-with-internal-function-engn33r"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 4. Gas - Replace duplicate code with internal function (engn33r)
        
        
      </h3>
    

<p>Certain code is duplicated. This code can be replaced with an internal function that could reduce gas costs on deployment.</p>
      <h4 id="technical-details-18">
        
        
          <a href="#technical-details-18" class="anchor-heading" aria-labelledby="technical-details-18"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Technical Details
        
        
      </h4>
    

<p>The code below is found in two places in AaveV2ERC4626.sol (<a href="https://github.com/timeless-fi/yield-daddy/blob/2c8f62681ab90325ede093ac9c9f94dbcc5f7e49/src/aave-v2/AaveV2ERC4626.sol#L186-L195">here</a> and <a href="https://github.com/timeless-fi/yield-daddy/blob/2c8f62681ab90325ede093ac9c9f94dbcc5f7e49/src/aave-v2/AaveV2ERC4626.sol#L203-L212">here</a>):</p>
<div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// check if pool is paused
</span><span class="k">if</span> <span class="p">(</span><span class="n">lendingPool</span><span class="p">.</span><span class="n">paused</span><span class="p">())</span> <span class="p">{</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// check if asset is paused
</span><span class="kt">uint256</span> <span class="n">configData</span> <span class="o">=</span> <span class="n">lendingPool</span><span class="p">.</span><span class="n">getReserveData</span><span class="p">(</span><span class="kt">address</span><span class="p">(</span><span class="n">asset</span><span class="p">)).</span><span class="n">configuration</span><span class="p">.</span><span class="n">data</span><span class="p">;</span>
<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">_getActive</span><span class="p">(</span><span class="n">configData</span><span class="p">))</span> <span class="p">{</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>This code could be moved into an internal view function to reduce contract deployment costs. The same could be done with the similar duplicate code block (<a href="https://github.com/timeless-fi/yield-daddy/blob/2c8f62681ab90325ede093ac9c9f94dbcc5f7e49/src/aave-v2/AaveV2ERC4626.sol#L156-L165">here</a> and <a href="https://github.com/timeless-fi/yield-daddy/blob/2c8f62681ab90325ede093ac9c9f94dbcc5f7e49/src/aave-v2/AaveV2ERC4626.sol#L171-L180">here</a>). The Aave V3 wrapper has duplicate code in the same functions of <code class="language-plaintext highlighter-rouge">maxDeposit()</code>, <code class="language-plaintext highlighter-rouge">maxMint()</code>, <code class="language-plaintext highlighter-rouge">maxWithdraw()</code>, and <code class="language-plaintext highlighter-rouge">maxRedeem()</code>.</p>
      <h4 id="impact-18">
        
        
          <a href="#impact-18" class="anchor-heading" aria-labelledby="impact-18"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Impact
        
        
      </h4>
    

<p>Gas savings.</p>
      <h4 id="recommendation-18">
        
        
          <a href="#recommendation-18" class="anchor-heading" aria-labelledby="recommendation-18"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Recommendation
        
        
      </h4>
    

<p>Replace duplicate code with internal functions to reduce contract deployment costs.</p>
      <h4 id="developer-response-18">
        
        
          <a href="#developer-response-18" class="anchor-heading" aria-labelledby="developer-response-18"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Developer Response
        
        
      </h4>
    

<p>This won’t save gas since it’s in a view function.</p>
      <h3 id="5-gas---declare-functions-external-for-gas-savings-engn33r">
        
        
          <a href="#5-gas---declare-functions-external-for-gas-savings-engn33r" class="anchor-heading" aria-labelledby="5-gas---declare-functions-external-for-gas-savings-engn33r"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 5. Gas - Declare functions external for gas savings (engn33r)
        
        
      </h3>
    

<p>The boostedBalanceOf function and deposit function of Gauge.sol should be declared external, not public, for gas savings.</p>
      <h4 id="technical-details-19">
        
        
          <a href="#technical-details-19" class="anchor-heading" aria-labelledby="technical-details-19"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Technical Details
        
        
      </h4>
    

<p>There is <a href="https://github.com/timeless-fi/yield-daddy/blob/2c8f62681ab90325ede093ac9c9f94dbcc5f7e49/src/compound/CompoundERC4626Factory.sol#L103">a public function <code class="language-plaintext highlighter-rouge">updateUnderlyingToCToken()</code></a> in CompoundERC4626Factory.sol that can be made external.</p>
      <h4 id="impact-19">
        
        
          <a href="#impact-19" class="anchor-heading" aria-labelledby="impact-19"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Impact
        
        
      </h4>
    

<p>Gas savings.</p>
      <h4 id="recommendation-19">
        
        
          <a href="#recommendation-19" class="anchor-heading" aria-labelledby="recommendation-19"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Recommendation
        
        
      </h4>
    

<p>Declare functions as an external functions for gas savings.</p>
      <h4 id="developer-response-19">
        
        
          <a href="#developer-response-19" class="anchor-heading" aria-labelledby="developer-response-19"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Developer Response
        
        
      </h4>
    

<p>Fixed in commit <a href="https://github.com/timeless-fi/yield-daddy/commit/6722541c7ae9a2c152bc90dcdb39f204af809312">6722541c7ae9a2c152bc90dcdb39f204af809312</a>.</p>
      <h3 id="6-gas---use-claimcomp-with-borrowers--false-engn33r">
        
        
          <a href="#6-gas---use-claimcomp-with-borrowers--false-engn33r" class="anchor-heading" aria-labelledby="6-gas---use-claimcomp-with-borrowers--false-engn33r"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 6. Gas - Use <code class="language-plaintext highlighter-rouge">claimComp()</code> with borrowers = false (engn33r)
        
        
      </h3>
    

<p>There are three <code class="language-plaintext highlighter-rouge">claimComp()</code> functions in the Compound Comptroller contract. The one called by CompoundERC4626.sol sets <code class="language-plaintext highlighter-rouge">borrowers = true</code> and <code class="language-plaintext highlighter-rouge">suppliers = true</code>. Because the vault does not borrow from Compound, the <code class="language-plaintext highlighter-rouge">borrowers</code> bool can be set to <code class="language-plaintext highlighter-rouge">false</code>, which will save gas by skipping logic in <a href="https://github.com/compound-finance/compound-protocol/blob/a3214f67b73310d547e00fc578e8355911c9d376/contracts/ComptrollerG7.sol#L1232">this <code class="language-plaintext highlighter-rouge">claimComp()</code> function</a>.</p>
      <h4 id="technical-details-20">
        
        
          <a href="#technical-details-20" class="anchor-heading" aria-labelledby="technical-details-20"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Technical Details
        
        
      </h4>
    

<p><code class="language-plaintext highlighter-rouge">claimComp()</code> is called <a href="https://github.com/timeless-fi/yield-daddy/blob/2c8f62681ab90325ede093ac9c9f94dbcc5f7e49/src/compound/CompoundERC4626.sol#L80">in <code class="language-plaintext highlighter-rouge">claimRewards()</code></a>. It can be replaced with a call to the other <code class="language-plaintext highlighter-rouge">claimComp()</code> function with <code class="language-plaintext highlighter-rouge">borrowers</code> set to <code class="language-plaintext highlighter-rouge">false</code>.</p>
      <h4 id="impact-20">
        
        
          <a href="#impact-20" class="anchor-heading" aria-labelledby="impact-20"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Impact
        
        
      </h4>
    

<p>Gas savings.</p>
      <h4 id="recommendation-20">
        
        
          <a href="#recommendation-20" class="anchor-heading" aria-labelledby="recommendation-20"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Recommendation
        
        
      </h4>
    

<p>Replace <a href="https://github.com/timeless-fi/yield-daddy/blob/2c8f62681ab90325ede093ac9c9f94dbcc5f7e49/src/compound/CompoundERC4626.sol#L80">this call to <code class="language-plaintext highlighter-rouge">claimComp()</code></a> with the following code:</p>

<div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">address</span><span class="p">[]</span> <span class="k">memory</span> <span class="n">holders</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">address</span><span class="p">[](</span><span class="mi">1</span><span class="p">);</span>
<span class="n">holders</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="kt">address</span><span class="p">(</span><span class="nb">this</span><span class="p">);</span>
<span class="n">comptroller</span><span class="p">.</span><span class="n">claimComp</span><span class="p">(</span><span class="n">holders</span><span class="p">,</span> <span class="n">cTokens</span><span class="p">,</span> <span class="nb">false</span><span class="p">,</span> <span class="nb">true</span><span class="p">);</span>
</code></pre></div></div>
      <h4 id="developer-response-20">
        
        
          <a href="#developer-response-20" class="anchor-heading" aria-labelledby="developer-response-20"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Developer Response
        
        
      </h4>
    

<p>Fixed in commit <a href="https://github.com/timeless-fi/yield-daddy/commit/a53c2333f40a7e3056a7dfeec3fa994e4da37993">a53c2333f40a7e3056a7dfeec3fa994e4da37993</a>.</p>
      <h3 id="7-gas---use-unchecked-if-no-underflow-risk-engn33r">
        
        
          <a href="#7-gas---use-unchecked-if-no-underflow-risk-engn33r" class="anchor-heading" aria-labelledby="7-gas---use-unchecked-if-no-underflow-risk-engn33r"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 7. Gas - Use unchecked if no underflow risk (engn33r)
        
        
      </h3>
    

<p>There is a subtraction that can be made unchecked for gas savings.</p>
      <h4 id="technical-details-21">
        
        
          <a href="#technical-details-21" class="anchor-heading" aria-labelledby="technical-details-21"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Technical Details
        
        
      </h4>
    

<p>There are two subtraction operations (<a href="https://github.com/timeless-fi/yield-daddy/blob/2c8f62681ab90325ede093ac9c9f94dbcc5f7e49/src/aave-v3/AaveV3ERC4626.sol#L176">here</a> and <a href="https://github.com/timeless-fi/yield-daddy/blob/2c8f62681ab90325ede093ac9c9f94dbcc5f7e49/src/aave-v3/AaveV3ERC4626.sol#L194">here</a>) that should not underflow because the <code class="language-plaintext highlighter-rouge">supplyCap</code> should be greater than the value of <code class="language-plaintext highlighter-rouge">totalSupply()</code>. The Aave V3 code should be checked to confirm that there is a valid comparison to <code class="language-plaintext highlighter-rouge">supplyCap</code> when the supply increases.</p>

<p>Another subtraction operation can be made unchecked in CurveV2Juggler.sol (and the out of scope UniswapV3Juggler.sol contract), found <a href="https://github.com/timeless-fi/swapper/blob/b898896579b60697a8113da21cefb3b00bcfaa0d/src/curve-v2/CurveV2Juggler.sol#L83">here</a> and <a href="https://github.com/timeless-fi/swapper/blob/b898896579b60697a8113da21cefb3b00bcfaa0d/src/curve-v2/CurveV2Juggler.sol#L132">here</a>. This operation can be unchecked because <code class="language-plaintext highlighter-rouge">tokenAmountIn &gt;= (tokenAmountIn &gt;&gt; 1)</code>, and because <code class="language-plaintext highlighter-rouge">swapAmountIn = (tokenAmountIn &gt;&gt; 1)</code>, then <code class="language-plaintext highlighter-rouge">tokenAmountIn &gt;= swapAmountIn</code> and <code class="language-plaintext highlighter-rouge">tokenAmountIn - swapAmountIn &gt;= 0</code>.</p>

<p>Swapper.sol has two operations repeated four times that can be unchecked to save gas. A similar operation that already is unchecked <a href="https://github.com/timeless-fi/xPYT/blob/fabe9d7cb9700334b10a48ee5d081234eb98def9/src/xPYT.sol#L170-L182">is found in xPYT.sol</a>.</p>
<ol>
  <li>Division <a href="https://github.com/timeless-fi/swapper/blob/b898896579b60697a8113da21cefb3b00bcfaa0d/src/Swapper.sol#L337">here</a>, <a href="https://github.com/timeless-fi/swapper/blob/b898896579b60697a8113da21cefb3b00bcfaa0d/src/Swapper.sol#L416">here</a>, <a href="https://github.com/timeless-fi/swapper/blob/b898896579b60697a8113da21cefb3b00bcfaa0d/src/Swapper.sol#L496">here</a>, and <a href="https://github.com/timeless-fi/swapper/blob/b898896579b60697a8113da21cefb3b00bcfaa0d/src/Swapper.sol#L613">here</a> can be unchecked because <code class="language-plaintext highlighter-rouge">(protocolFeeInfo_.fee / 10000) &lt; 1</code> so it cannot overflow.
    <div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">uint256</span> <span class="n">feeAmount</span> <span class="o">=</span> <span class="p">(</span><span class="n">tokenAmountIn</span> <span class="o">*</span> <span class="n">protocolFeeInfo_</span><span class="p">.</span><span class="n">fee</span><span class="p">)</span> <span class="o">/</span> <span class="mi">10000</span><span class="p">;</span>
</code></pre></div>    </div>
  </li>
  <li>Subtraction <a href="https://github.com/timeless-fi/swapper/blob/b898896579b60697a8113da21cefb3b00bcfaa0d/src/Swapper.sol#L341">here</a>, <a href="https://github.com/timeless-fi/swapper/blob/b898896579b60697a8113da21cefb3b00bcfaa0d/src/Swapper.sol#L420">here</a>, <a href="https://github.com/timeless-fi/swapper/blob/b898896579b60697a8113da21cefb3b00bcfaa0d/src/Swapper.sol#L499">here</a>, and <a href="https://github.com/timeless-fi/swapper/blob/b898896579b60697a8113da21cefb3b00bcfaa0d/src/Swapper.sol#L616">here</a> can be unchecked because <code class="language-plaintext highlighter-rouge">feeAmount &lt; tokenAmountIn</code> so it cannot underflow.
    <div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">tokenAmountIn</span> <span class="o">-=</span> <span class="n">feeAmount</span><span class="p">;</span>
</code></pre></div>    </div>
  </li>
</ol>
      <h4 id="impact-21">
        
        
          <a href="#impact-21" class="anchor-heading" aria-labelledby="impact-21"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Impact
        
        
      </h4>
    

<p>Gas savings.</p>
      <h4 id="recommendation-21">
        
        
          <a href="#recommendation-21" class="anchor-heading" aria-labelledby="recommendation-21"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Recommendation
        
        
      </h4>
    

<p>Use unchecked where there is no overflow or underflow risk.</p>
      <h4 id="developer-response-21">
        
        
          <a href="#developer-response-21" class="anchor-heading" aria-labelledby="developer-response-21"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Developer Response
        
        
      </h4>
    

<p>Many of the suggested operations that can be made unchecked are in view functions meant to be called off chain, so gas optimization is meaningless for them.</p>

<p>For the first point, the intermediate multiplication may overflow, so unchecked cannot be used here.</p>

<p>The second point has been fixed in commit <a href="https://github.com/timeless-fi/swapper/commit/9fbd20056c2bf6261524741d62ddeef2c6067d08">9fbd20056c2bf6261524741d62ddeef2c6067d08</a>.</p>
      <h3 id="8-gas---function-arg-should-be-calldata-not-memory-engn33r">
        
        
          <a href="#8-gas---function-arg-should-be-calldata-not-memory-engn33r" class="anchor-heading" aria-labelledby="8-gas---function-arg-should-be-calldata-not-memory-engn33r"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 8. Gas - Function arg should be <code class="language-plaintext highlighter-rouge">calldata</code> not <code class="language-plaintext highlighter-rouge">memory</code> (engn33r)
        
        
      </h3>
    

<p>Array function arguments that are <code class="language-plaintext highlighter-rouge">calldata</code> are cheaper to read than arguments that are <code class="language-plaintext highlighter-rouge">memory</code>.</p>
      <h4 id="technical-details-22">
        
        
          <a href="#technical-details-22" class="anchor-heading" aria-labelledby="technical-details-22"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Technical Details
        
        
      </h4>
    

<p>The Compound factory contract <a href="https://github.com/timeless-fi/yield-daddy/tree/main/src/compound/CompoundERC4626Factory.sol#L103">has a <code class="language-plaintext highlighter-rouge">memory</code> argument</a> that can be changed to <code class="language-plaintext highlighter-rouge">calldata</code> for gas savings.</p>

<p>The same change can be made <a href="https://github.com/timeless-fi/xPYT/blob/fabe9d7cb9700334b10a48ee5d081234eb98def9/src/curve-v2/CurveV2xPYTFactory.sol#L118">for <code class="language-plaintext highlighter-rouge">_deployCurvePool()</code> in CurveV2xPYTFactory.sol</a>.</p>
      <h4 id="impact-22">
        
        
          <a href="#impact-22" class="anchor-heading" aria-labelledby="impact-22"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Impact
        
        
      </h4>
    

<p>Gas savings.</p>
      <h4 id="recommendation-22">
        
        
          <a href="#recommendation-22" class="anchor-heading" aria-labelledby="recommendation-22"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Recommendation
        
        
      </h4>
    

<p>Replace <code class="language-plaintext highlighter-rouge">memory</code> with <code class="language-plaintext highlighter-rouge">calldata</code> for the Compound factory function.</p>
      <h4 id="developer-response-22">
        
        
          <a href="#developer-response-22" class="anchor-heading" aria-labelledby="developer-response-22"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Developer Response
        
        
      </h4>
    

<p>The point about the Compound factory is fixed in commit <a href="https://github.com/timeless-fi/yield-daddy/commit/6722541c7ae9a2c152bc90dcdb39f204af809312">6722541c7ae9a2c152bc90dcdb39f204af809312</a>.</p>

<p>It makes no sense to update _deployCurvePool(), since the coins array is indeed initialized in memory and not from calldata.</p>
      <h3 id="9-gas---move-revert-earlier-in-function-engn33r">
        
        
          <a href="#9-gas---move-revert-earlier-in-function-engn33r" class="anchor-heading" aria-labelledby="9-gas---move-revert-earlier-in-function-engn33r"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 9. Gas - Move revert earlier in function (engn33r)
        
        
      </h3>
    

<p>If a function reverts, the remaining gas is returned to the user. This means that the earlier a function reverts, the more gas that could be returned to the user. Revert checks should happen as early in the function as possible.</p>
      <h4 id="technical-details-23">
        
        
          <a href="#technical-details-23" class="anchor-heading" aria-labelledby="technical-details-23"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Technical Details
        
        
      </h4>
    

<p><a href="https://github.com/timeless-fi/xPYT/blob/fabe9d7cb9700334b10a48ee5d081234eb98def9/src/xPYT.sol#L109-L111">This revert check</a> in the xPYT constructor can take place earlier in the constructor because it only relies on a function argument and does not rely on any other calculations. Move this if statement to immediately follow the other if statement revert check.</p>
      <h4 id="impact-23">
        
        
          <a href="#impact-23" class="anchor-heading" aria-labelledby="impact-23"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Impact
        
        
      </h4>
    

<p>Gas savings.</p>
      <h4 id="recommendation-23">
        
        
          <a href="#recommendation-23" class="anchor-heading" aria-labelledby="recommendation-23"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Recommendation
        
        
      </h4>
    

<p>Move revert checks earlier in functions by combining the related checks into one:</p>
<div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="p">(</span><span class="n">minOutputMultiplier_</span> <span class="o">&gt;</span> <span class="n">ONE</span> <span class="o">||</span> <span class="n">pounderRewardMultiplier_</span> <span class="o">&gt;</span> <span class="n">ONE</span><span class="p">)</span> <span class="p">{</span>
	<span class="nb">revert</span> <span class="n">Error_InvalidMultiplierValue</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div></div>
      <h4 id="developer-response-23">
        
        
          <a href="#developer-response-23" class="anchor-heading" aria-labelledby="developer-response-23"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Developer Response
        
        
      </h4>
    

<p>This is fine.</p>
      <h3 id="10-gas---internal-function-is-cheaper-than-modifier-engn33r">
        
        
          <a href="#10-gas---internal-function-is-cheaper-than-modifier-engn33r" class="anchor-heading" aria-labelledby="10-gas---internal-function-is-cheaper-than-modifier-engn33r"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 10. Gas - Internal function is cheaper than modifier (engn33r)
        
        
      </h3>
    

<p>One access control modifier in Swapper.sol could be replaced with an internal function for gas savings.</p>
      <h4 id="technical-details-24">
        
        
          <a href="#technical-details-24" class="anchor-heading" aria-labelledby="technical-details-24"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Technical Details
        
        
      </h4>
    

<p><a href="https://github.com/timeless-fi/swapper/blob/35db08558aa01e8473ada13c092e24857d01461b/src/Swapper.sol#L264">This onlyOwner modifier</a> could be replaced with a require check in this function or an internal function. For example, add this line to <code class="language-plaintext highlighter-rouge">ownerSetProtocolFee()</code> to replace the modifier on the function.</p>

<div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">require</span><span class="p">(</span><span class="n">msg</span><span class="p">.</span><span class="n">sender</span> <span class="o">==</span> <span class="n">owner</span><span class="p">,</span> <span class="s">"UNAUTHORIZED"</span><span class="p">);</span>
</code></pre></div></div>
      <h4 id="impact-24">
        
        
          <a href="#impact-24" class="anchor-heading" aria-labelledby="impact-24"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Impact
        
        
      </h4>
    

<p>Gas savings.</p>
      <h4 id="recommendation-24">
        
        
          <a href="#recommendation-24" class="anchor-heading" aria-labelledby="recommendation-24"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Recommendation
        
        
      </h4>
    

<p>Replace modifiers with internal functions or require checks for gas savings.</p>
      <h4 id="developer-response-24">
        
        
          <a href="#developer-response-24" class="anchor-heading" aria-labelledby="developer-response-24"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Developer Response
        
        
      </h4>
    

<p>Acknowledged.</p>
      <h3 id="11-gas---zero-check-could-save-gas-engn33r">
        
        
          <a href="#11-gas---zero-check-could-save-gas-engn33r" class="anchor-heading" aria-labelledby="11-gas---zero-check-could-save-gas-engn33r"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 11. Gas - Zero check could save gas (engn33r)
        
        
      </h3>
    

<p>There are two places where the claimable yield is calculated, but in one place the code does not confirm that <code class="language-plaintext highlighter-rouge">yieldAmount != 0</code>. Applying this zero check in both places where yield is calculated can provide a gas savings when <code class="language-plaintext highlighter-rouge">yieldAmount</code> is zero. While this finding relies on code outside the scope of this review, the in-scope contacts use this function, so it was reviewed in excess of the requested scope.</p>
      <h4 id="technical-details-25">
        
        
          <a href="#technical-details-25" class="anchor-heading" aria-labelledby="technical-details-25"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Technical Details
        
        
      </h4>
    

<p><a href="https://github.com/timeless-fi/xPYT/blob/fabe9d7cb9700334b10a48ee5d081234eb98def9/src/xPYT.sol#L211"><code class="language-plaintext highlighter-rouge">getClaimableYieldAmount()</code> is called once in xPYT.sol</a>, but this function is missing a zero check for <code class="language-plaintext highlighter-rouge">yieldAmount</code>. The first function that calculates the claimable yield, <code class="language-plaintext highlighter-rouge">claimYieldAndEnter()</code>, <a href="https://github.com/timeless-fi/timeless/blob/8bcf872f34148cf9f4ce8b3ed2c8888672d328cf/src/Gate.sol#L621">confirms that <code class="language-plaintext highlighter-rouge">yieldAmount != 0</code></a>. The other locations where the claimable yield is calculated, <code class="language-plaintext highlighter-rouge">getClaimableYieldAmount</code>, does not confirm that <code class="language-plaintext highlighter-rouge">yieldAmount != 0</code>. This zero check could provide a gas savings in the case that <code class="language-plaintext highlighter-rouge">yieldAmount</code> is zero.</p>
      <h4 id="impact-25">
        
        
          <a href="#impact-25" class="anchor-heading" aria-labelledby="impact-25"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Impact
        
        
      </h4>
    

<p>Gas savings.</p>
      <h4 id="recommendation-25">
        
        
          <a href="#recommendation-25" class="anchor-heading" aria-labelledby="recommendation-25"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Recommendation
        
        
      </h4>
    

<p>Add the missing zero check. A longer term improvement would be to write the yield calculation logic only in one place inside a function and call this function as needed. This would avoid similar pieces of code with minor differences that could result in unexpected differences in behavior.</p>
      <h4 id="developer-response-25">
        
        
          <a href="#developer-response-25" class="anchor-heading" aria-labelledby="developer-response-25"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Developer Response
        
        
      </h4>
    

<p>Acknowledged.</p>
      <h3 id="12-gas---remove-unnecessary-approve-engn33r-benjamin-samuels">
        
        
          <a href="#12-gas---remove-unnecessary-approve-engn33r-benjamin-samuels" class="anchor-heading" aria-labelledby="12-gas---remove-unnecessary-approve-engn33r-benjamin-samuels"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 12. Gas - Remove unnecessary approve (engn33r, Benjamin Samuels)
        
        
      </h3>
    

<p>There is an unnecessary <code class="language-plaintext highlighter-rouge">approve()</code> call in CurveV2xPYT.sol which can be removed.</p>
      <h4 id="technical-details-26">
        
        
          <a href="#technical-details-26" class="anchor-heading" aria-labelledby="technical-details-26"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Technical Details
        
        
      </h4>
    

<p><a href="https://github.com/timeless-fi/xPYT/blob/fabe9d7cb9700334b10a48ee5d081234eb98def9/src/curve-v2/CurveV2xPYT.sol#L65">This <code class="language-plaintext highlighter-rouge">approve()</code> call</a> is designed to initialize the storage slot to a non-zero value in order to save gas on future changes of this slot. The problem is that the <a href="https://github.com/timeless-fi/xPYT/blob/fabe9d7cb9700334b10a48ee5d081234eb98def9/src/curve-v2/CurveV2xPYT.sol#L93"><code class="language-plaintext highlighter-rouge">approve()</code> call that happens before each swap</a> overwrites the initial allowance value, which is subsequently consumed by the Curve swap and re-set to zero.</p>
      <h4 id="impact-26">
        
        
          <a href="#impact-26" class="anchor-heading" aria-labelledby="impact-26"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Impact
        
        
      </h4>
    

<p>Gas savings.</p>
      <h4 id="recommendation-26">
        
        
          <a href="#recommendation-26" class="anchor-heading" aria-labelledby="recommendation-26"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Recommendation
        
        
      </h4>
    

<p>In order for the initially approved value of 1 to remain after the swap’s <code class="language-plaintext highlighter-rouge">transferFrom()</code> call, the <code class="language-plaintext highlighter-rouge">increaseAllowance()</code> function can be used <a href="https://github.com/OpenZeppelin/openzeppelin-contracts/blob/42fe56031f106e505d2edfc5163f0b5c95264b5a/contracts/token/ERC20/ERC20.sol#L181-L185">as implemented in OpenZeppelin’s ERC20 implementation</a>.</p>

<p>Alternatively, the approval at line 93 can be modified so it grants an approval on nytAmountIn + 1 wei;</p>

<p><code class="language-plaintext highlighter-rouge">nyt.approve(address(curvePool_), nytAmountIn + 1);</code></p>
      <h4 id="developer-response-26">
        
        
          <a href="#developer-response-26" class="anchor-heading" aria-labelledby="developer-response-26"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Developer Response
        
        
      </h4>
    

<p>Fixed in commit <a href="https://github.com/timeless-fi/xPYT/commit/59c3d152da5c4af50b24edbce68db053c6bbac05">59c3d152da5c4af50b24edbce68db053c6bbac05</a>.</p>
      <h3 id="13-gas---unnecessary-logic-in-approvemaxifneeded-function-engn33r">
        
        
          <a href="#13-gas---unnecessary-logic-in-approvemaxifneeded-function-engn33r" class="anchor-heading" aria-labelledby="13-gas---unnecessary-logic-in-approvemaxifneeded-function-engn33r"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 13. Gas - Unnecessary logic in <code class="language-plaintext highlighter-rouge">approveMaxIfNeeded()</code> function (engn33r)
        
        
      </h3>
    

<p>The <code class="language-plaintext highlighter-rouge">approveMaxIfNeeded()</code> differs from a simple <code class="language-plaintext highlighter-rouge">token.safeApprove(spender, type(uint256).max);</code> call by setting the allowance to zero first if the existing allowance is non-zero.  This is to handle the edge case of USDT, which requires this series of actions. Because there is no other approve in the contracts that use <code class="language-plaintext highlighter-rouge">approveMaxIfNeeded()</code>, these extra steps are not necessary because the only approve that can happen is approving <code class="language-plaintext highlighter-rouge">type(uint256).max</code>.</p>
      <h4 id="technical-details-27">
        
        
          <a href="#technical-details-27" class="anchor-heading" aria-labelledby="technical-details-27"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Technical Details
        
        
      </h4>
    

<p>The contracts that call <code class="language-plaintext highlighter-rouge">approveMaxIfNeeded()</code> include <a href="https://github.com/timeless-fi/swapper/blob/b898896579b60697a8113da21cefb3b00bcfaa0d/src/Swapper.sol#L16">Swapper.sol</a> and <a href="https://github.com/timeless-fi/swapper/blob/b898896579b60697a8113da21cefb3b00bcfaa0d/src/curve-v2/CurveV2Swapper.sol#L10">CurveV2Swapper.sol</a>. No other <code class="language-plaintext highlighter-rouge">approve()</code> or <code class="language-plaintext highlighter-rouge">safeApprove()</code> calls happen in these contracts, so the only allowance being set is an allowance of <code class="language-plaintext highlighter-rouge">type(uint256).max</code>. If the allowance is set to <code class="language-plaintext highlighter-rouge">type(int256).max</code>, <a href="https://github.com/tethercoin/USDT/blob/c3e3caa95c30e74a0f4f0d616e13ff97daa02191/TetherToken.sol#L181-L182">USDT will not decrease the allowance</a> when a transfer happens. So the process of checking the allowance and setting it to zero if the value is not <code class="language-plaintext highlighter-rouge">type(int256).max</code> is unnecessary and can be replaced with a simple <code class="language-plaintext highlighter-rouge">token.safeApprove(spender, type(uint256).max);</code> call. There might be an edge case other than USDT that the <code class="language-plaintext highlighter-rouge">approveMaxIfNeeded()</code> was designed for, but the function should not be necessary for USDT or standard ERC20 tokens.</p>
      <h4 id="impact-27">
        
        
          <a href="#impact-27" class="anchor-heading" aria-labelledby="impact-27"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Impact
        
        
      </h4>
    

<p>Gas savings.</p>
      <h4 id="recommendation-27">
        
        
          <a href="#recommendation-27" class="anchor-heading" aria-labelledby="recommendation-27"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Recommendation
        
        
      </h4>
    

<p>Remove unnecessary checks in <code class="language-plaintext highlighter-rouge">approveMaxIfNeeded()</code> or use a simpler <code class="language-plaintext highlighter-rouge">safeApprove()</code> if approval value is never set to a value other than <code class="language-plaintext highlighter-rouge">type(uint256).max</code>.</p>
      <h4 id="developer-response-27">
        
        
          <a href="#developer-response-27" class="anchor-heading" aria-labelledby="developer-response-27"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Developer Response
        
        
      </h4>
    

<p>Fixed in commit <a href="https://github.com/timeless-fi/swapper/commit/14c6928f9d0efb37c4d63d9bf6f5f3b4dcb53d99">14c6928f9d0efb37c4d63d9bf6f5f3b4dcb53d99</a>.</p>
      <h2 id="informational-findings">
        
        
          <a href="#informational-findings" class="anchor-heading" aria-labelledby="informational-findings"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Informational Findings
        
        
      </h2>
    
      <h3 id="1-informational---direct-transfer-of-atokens-impacts-share-value-engn33r">
        
        
          <a href="#1-informational---direct-transfer-of-atokens-impacts-share-value-engn33r" class="anchor-heading" aria-labelledby="1-informational---direct-transfer-of-atokens-impacts-share-value-engn33r"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 1. Informational - Direct transfer of aTokens impacts share value (engn33r)
        
        
      </h3>
    

<p>The <code class="language-plaintext highlighter-rouge">totalAssets()</code> function returns the balance of aTokens held by the ERC4626 vault. Any user can transfer aTokens to the vault directly, without depositing, and alter the output values of other functions. This would be equivalent to an instantaneous spike in the aToken yield. This scenario may cause unexpected consequences with other protocols integrating with the Yield Daddy ERC4626 vaults. There is a <a href="https://github.com/timeless-fi/yield-daddy/blob/2c8f62681ab90325ede093ac9c9f94dbcc5f7e49/src/aave-v2/AaveV2ERC4626.sol#L14-L18">comment for this edge case in the code</a>.</p>
      <h4 id="technical-details-28">
        
        
          <a href="#technical-details-28" class="anchor-heading" aria-labelledby="technical-details-28"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Technical Details
        
        
      </h4>
    

<div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">function</span> <span class="n">totalAssets</span><span class="p">()</span> <span class="k">public</span> <span class="k">view</span> <span class="k">virtual</span> <span class="k">override</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint256</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// aTokens use rebasing to accrue interest, so the total assets is just the aToken balance
</span>    <span class="k">return</span> <span class="n">aToken</span><span class="p">.</span><span class="n">balanceOf</span><span class="p">(</span><span class="kt">address</span><span class="p">(</span><span class="nb">this</span><span class="p">));</span>
<span class="p">}</span>
</code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">totalAssets()</code> function in AaveV2ERC4626.sol and AaveV3ERC4626.sol is an important function. It is called in the calculations of <code class="language-plaintext highlighter-rouge">convertToShares()</code>, <code class="language-plaintext highlighter-rouge">convertToAssets()</code>, <code class="language-plaintext highlighter-rouge">previewMint()</code>, and <code class="language-plaintext highlighter-rouge">previewWithdraw()</code>. It is possible for anyone to transfer Aave aTokens directly to the vault, which would change the value returned by <code class="language-plaintext highlighter-rouge">totalAssets()</code>. Although such an increase in value happens normally as deposits take place or yield is earned, an instantaneous change may impact how other protocols interface with Yield Daddy ERC4626 tokens depending on how the other protocols are implemented. This comment is absent from the Compound ERC4626 wrapper, but the same edge case of a user sending tokens directly to the vault can apply.</p>
      <h4 id="impact-28">
        
        
          <a href="#impact-28" class="anchor-heading" aria-labelledby="impact-28"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Impact
        
        
      </h4>
    

<p>Informational.</p>
      <h4 id="recommendation-28">
        
        
          <a href="#recommendation-28" class="anchor-heading" aria-labelledby="recommendation-28"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Recommendation
        
        
      </h4>
    

<p>If a contract modification is warranted, created an internal <code class="language-plaintext highlighter-rouge">aTokenBalance</code> variable that is increased in <code class="language-plaintext highlighter-rouge">afterDeposit()</code> and decreased in <code class="language-plaintext highlighter-rouge">withdraw()</code> and <code class="language-plaintext highlighter-rouge">redeem()</code>. Most importantly, documentation should clearly highlight that a change in <code class="language-plaintext highlighter-rouge">totalSupply()</code> is possible from a direct transfer so other protocols interfacing with Yield Daddy ERC4626 tokens can implement their protocols accordingly. If there is a significant risk from a direct transfer of aTokens, measures can be taken to deal with this, but there is no contract upgrade process implemented in the contracts.</p>
      <h4 id="developer-response-28">
        
        
          <a href="#developer-response-28" class="anchor-heading" aria-labelledby="developer-response-28"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Developer Response
        
        
      </h4>
    

<p>Acknowledged.</p>
      <h3 id="2-informational---aampl-edge-cases-engn33r">
        
        
          <a href="#2-informational---aampl-edge-cases-engn33r" class="anchor-heading" aria-labelledby="2-informational---aampl-edge-cases-engn33r"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 2. Informational - aAMPL edge cases (engn33r)
        
        
      </h3>
    

<p>AMPL is a rebasing token, and aAMPL is a rebasing token. The Yield Daddy vault will be exposed to two layers of rebasing, which could lead to unexpected edge cases. Aave even has a <a href="https://docs.aave.com/developers/v/2.0/guides/ampl-asset-listing">special docs page about AMPL caveats</a>, and a similar documentation page listing caveats for Yield Daddy may be useful.</p>
      <h4 id="technical-details-29">
        
        
          <a href="#technical-details-29" class="anchor-heading" aria-labelledby="technical-details-29"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Technical Details
        
        
      </h4>
    

<p>AMPL is a rebasing token, but unlike Aave aTokens, AMPL can increase or decrease the balance that user’s hold. <a href="https://www.coin-tools.com/ampl/ampl-rebase-history/">This website</a> shows some recent rebasing activity in both the positive and negative directions. The ability to rebalance in either direction means that a user depositing into the Yield Daddy aAMPL vault may receive less tokens when withdrawing than when they deposited. If there are very few depositors in the aAMPL vault, a user with a large fraction of vault ownership may be able to take advantage of the timing of the AMPL rebasing (which happens once per day) at the cost of the other vault shareholders.</p>
      <h4 id="impact-29">
        
        
          <a href="#impact-29" class="anchor-heading" aria-labelledby="impact-29"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Impact
        
        
      </h4>
    

<p>Informational.</p>
      <h4 id="recommendation-29">
        
        
          <a href="#recommendation-29" class="anchor-heading" aria-labelledby="recommendation-29"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Recommendation
        
        
      </h4>
    

<p>Although AMPL owners should be aware of the potential for positive and negative rebasing, Yield Daddy is exposed to two levels of rebasing. Proper testing of this 2nd order effect should take place and users should be warned of possible side effects, including withdrawing fewer tokens than were deposited.</p>
      <h4 id="developer-response-29">
        
        
          <a href="#developer-response-29" class="anchor-heading" aria-labelledby="developer-response-29"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Developer Response
        
        
      </h4>
    

<p>Acknowledged.</p>
      <h3 id="3-informational---invert-constant-mask-variables-engn33r">
        
        
          <a href="#3-informational---invert-constant-mask-variables-engn33r" class="anchor-heading" aria-labelledby="3-informational---invert-constant-mask-variables-engn33r"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 3. Informational - Invert constant mask variables (engn33r)
        
        
      </h3>
    

<p>There are five mask variables used only once, in the <code class="language-plaintext highlighter-rouge">_getDecimals()</code>, <code class="language-plaintext highlighter-rouge">_getActive()</code>, <code class="language-plaintext highlighter-rouge">_getFrozen()</code>, <code class="language-plaintext highlighter-rouge">_getPaused()</code>, and <code class="language-plaintext highlighter-rouge">_getSupplyCap()</code> functions. The mask values are constants but are only used in their inverted or negated form. Instead of negating the constants each time, the constant value should be the negated value of the current constant. This will improve readability.</p>
      <h4 id="technical-details-30">
        
        
          <a href="#technical-details-30" class="anchor-heading" aria-labelledby="technical-details-30"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Technical Details
        
        
      </h4>
    

<p>Modify <a href="https://github.com/timeless-fi/yield-daddy/blob/2c8f62681ab90325ede093ac9c9f94dbcc5f7e49/src/aave-v3/AaveV3ERC4626.sol#L36-L40">the constant masks in the Aave V3 wrapper</a> to the following:</p>

<div class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gd">-   uint256 internal constant DECIMALS_MASK = 0xFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF00FFFFFFFFFFFF;
</span><span class="gi">+ uint256 internal constant DECIMALS_MASK = 0xFF &lt;&lt; 48;
</span><span class="gd">-   uint256 internal constant ACTIVE_MASK = 0xFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFFFFFFFF;
</span><span class="gi">+ uint256 internal constant ACTIVE_MASK = 1 &lt;&lt; 56;
</span><span class="gd">-   uint256 internal constant FROZEN_MASK = 0xFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFDFFFFFFFFFFFFFF;
</span><span class="gi">+ uint256 internal constant FROZEN_MASK = 1 &lt;&lt; 57;
</span><span class="gd">-   uint256 internal constant PAUSED_MASK = 0xFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFFFFFFFFF;
</span><span class="gi">+ uint256 internal constant PAUSED_MASK = 1 &lt;&lt; 60;
</span><span class="gd">-   uint256 internal constant SUPPLY_CAP_MASK = 0xFFFFFFFFFFFFFFFFFFFFFFFFFF000000000FFFFFFFFFFFFFFFFFFFFFFFFFFFFF;
</span><span class="gi">+ uint256 internal constant PAUSED_MASK = 0xFFFFFFFFF &lt;&lt; 116;
</span></code></pre></div></div>

<p>Remember to remove the negation where the variables are used, so <code class="language-plaintext highlighter-rouge">~DECIMALS_MASK</code> will become <code class="language-plaintext highlighter-rouge">DECIMALS_MASK</code>.</p>
      <h4 id="impact-30">
        
        
          <a href="#impact-30" class="anchor-heading" aria-labelledby="impact-30"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Impact
        
        
      </h4>
    

<p>Informational.</p>
      <h4 id="recommendation-30">
        
        
          <a href="#recommendation-30" class="anchor-heading" aria-labelledby="recommendation-30"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Recommendation
        
        
      </h4>
    

<p>Change the constant variables to their inverse values.</p>
      <h4 id="developer-response-30">
        
        
          <a href="#developer-response-30" class="anchor-heading" aria-labelledby="developer-response-30"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Developer Response
        
        
      </h4>
    

<p>This is fine.</p>
      <h3 id="4-informational---simplify-logic-in-maxdeposit-and-maxmint-engn33r">
        
        
          <a href="#4-informational---simplify-logic-in-maxdeposit-and-maxmint-engn33r" class="anchor-heading" aria-labelledby="4-informational---simplify-logic-in-maxdeposit-and-maxmint-engn33r"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 4. Informational - Simplify logic in <code class="language-plaintext highlighter-rouge">maxDeposit()</code> and <code class="language-plaintext highlighter-rouge">maxMint()</code> (engn33r)
        
        
      </h3>
    

<p>The logic reused in several functions in AaveV3ERC4626.sol can be simplified.</p>
      <h4 id="technical-details-31">
        
        
          <a href="#technical-details-31" class="anchor-heading" aria-labelledby="technical-details-31"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Technical Details
        
        
      </h4>
    

<p><a href="https://github.com/timeless-fi/yield-daddy/blob/2c8f62681ab90325ede093ac9c9f94dbcc5f7e49/src/aave-v3/AaveV3ERC4626.sol#L164"><code class="language-plaintext highlighter-rouge">maxDeposit()</code></a> and <a href="https://github.com/timeless-fi/yield-daddy/blob/2c8f62681ab90325ede093ac9c9f94dbcc5f7e49/src/aave-v3/AaveV3ERC4626.sol#L182"><code class="language-plaintext highlighter-rouge">maxMint()</code></a> have logic which can be simplified:</p>

<div class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gd">- if (!(_getActive(configData) &amp;&amp; !_getFrozen(configData) &amp;&amp; !_getPaused(configData))) {
</span><span class="gi">+ if (!_getActive(configData) || _getFrozen(configData) || _getPaused(configData)) {
</span></code></pre></div></div>
      <h4 id="impact-31">
        
        
          <a href="#impact-31" class="anchor-heading" aria-labelledby="impact-31"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Impact
        
        
      </h4>
    

<p>Informational.</p>
      <h4 id="recommendation-31">
        
        
          <a href="#recommendation-31" class="anchor-heading" aria-labelledby="recommendation-31"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Recommendation
        
        
      </h4>
    

<p>Simplify boolean logic to make the code easier to read.</p>
      <h4 id="developer-response-31">
        
        
          <a href="#developer-response-31" class="anchor-heading" aria-labelledby="developer-response-31"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Developer Response
        
        
      </h4>
    

<p>This is fine.</p>
      <h3 id="5-informational---add-parentheses-to-avoid-order-of-operations-ambiguity-engn33r">
        
        
          <a href="#5-informational---add-parentheses-to-avoid-order-of-operations-ambiguity-engn33r" class="anchor-heading" aria-labelledby="5-informational---add-parentheses-to-avoid-order-of-operations-ambiguity-engn33r"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 5. Informational - Add parentheses to avoid order of operations ambiguity (engn33r)
        
        
      </h3>
    

<p><code class="language-plaintext highlighter-rouge">_getActive()</code>, <code class="language-plaintext highlighter-rouge">_getFrozen()</code>, and <code class="language-plaintext highlighter-rouge">_getPaused()</code> rely on bitwise operations taking place left to right. Because solidity version updates can sometimes alter this process, such as <a href="https://docs.soliditylang.org/en/v0.8.15/080-breaking-changes.html#silent-changes-of-the-semantics">solidity 0.8.0 changing exponentiation from left associative to right associative</a>, adding parentheses would help remove any ambiguity and make it clearer to readers of the code what is happening.</p>
      <h4 id="technical-details-32">
        
        
          <a href="#technical-details-32" class="anchor-heading" aria-labelledby="technical-details-32"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Technical Details
        
        
      </h4>
    

<p>These <a href="https://github.com/timeless-fi/yield-daddy/blob/2c8f62681ab90325ede093ac9c9f94dbcc5f7e49/src/aave-v3/AaveV3ERC4626.sol#L242-L252">three functions</a> have boolean logic that relies on order of operations. If this changes in a future solidity version, an incorrect value may be calculated. Applying parentheses would remove any ambiguity and make it easier to upgrade to future solidity releases with reduced concerns.</p>

<div class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    function _getActive(uint256 configData) internal pure returns (bool) {
<span class="gd">-        return configData &amp; ~ACTIVE_MASK != 0;
</span><span class="gi">+        return (configData &amp; ~ACTIVE_MASK) != 0;
</span>    }

    function _getFrozen(uint256 configData) internal pure returns (bool) {
<span class="gd">-        return configData &amp; ~FROZEN_MASK != 0;
</span><span class="gi">+        return (configData &amp; ~FROZEN_MASK) != 0;
</span>    }

    function _getPaused(uint256 configData) internal pure returns (bool) {
<span class="gd">-        return configData &amp; ~PAUSED_MASK != 0;
</span><span class="gi">+        return (configData &amp; ~PAUSED_MASK) != 0;
</span>    }
</code></pre></div></div>
      <h4 id="impact-32">
        
        
          <a href="#impact-32" class="anchor-heading" aria-labelledby="impact-32"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Impact
        
        
      </h4>
    

<p>Informational.</p>
      <h4 id="recommendation-32">
        
        
          <a href="#recommendation-32" class="anchor-heading" aria-labelledby="recommendation-32"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Recommendation
        
        
      </h4>
    

<p>Removing ambiguity from important logic is a good practice.</p>
      <h4 id="developer-response-32">
        
        
          <a href="#developer-response-32" class="anchor-heading" aria-labelledby="developer-response-32"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Developer Response
        
        
      </h4>
    

<p>This is fine.</p>
      <h3 id="6-informational---inconsistent-erc4626-callback-usage-engn33r">
        
        
          <a href="#6-informational---inconsistent-erc4626-callback-usage-engn33r" class="anchor-heading" aria-labelledby="6-informational---inconsistent-erc4626-callback-usage-engn33r"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 6. Informational - Inconsistent ERC4626 callback usage (engn33r)
        
        
      </h3>
    

<p>The <code class="language-plaintext highlighter-rouge">afterDeposit()</code> callback is implemented in AaveV2ERC4626.sol but the <code class="language-plaintext highlighter-rouge">beforeWithdraw()</code> callback is not implemented. Instead of implementing the <code class="language-plaintext highlighter-rouge">beforeWithdraw()</code> callback, the <code class="language-plaintext highlighter-rouge">withdraw()</code> and <code class="language-plaintext highlighter-rouge">redeem()</code> function have a custom implementation to remove the need for the <code class="language-plaintext highlighter-rouge">beforeWithdraw()</code> callback. Ideally AaveV2ERC4626.sol should be consistent and implement both callbacks or neither.</p>
      <h4 id="technical-details-33">
        
        
          <a href="#technical-details-33" class="anchor-heading" aria-labelledby="technical-details-33"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Technical Details
        
        
      </h4>
    

<p>The default <code class="language-plaintext highlighter-rouge">withdraw()</code> and <code class="language-plaintext highlighter-rouge">redeem()</code> function implementations are overridden in AaveV2ERC4626.sol, possibly to save gas from one ERC20 token transfer. The same approach could be used for <code class="language-plaintext highlighter-rouge">deposit()</code> and <code class="language-plaintext highlighter-rouge">mint()</code> by having the user send their reserve asset directly to Aave with <a href="https://docs.aave.com/developers/v/2.0/the-core-protocol/lendingpool#deposit">an onBehalfOf value</a> in the <code class="language-plaintext highlighter-rouge">deposit()</code> call of the Yield Daddy vault. This may require the user to approval the Aave pool, but it would improve consistency in the Yield Daddy code.</p>
      <h4 id="impact-33">
        
        
          <a href="#impact-33" class="anchor-heading" aria-labelledby="impact-33"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Impact
        
        
      </h4>
    

<p>Informational.</p>
      <h4 id="recommendation-33">
        
        
          <a href="#recommendation-33" class="anchor-heading" aria-labelledby="recommendation-33"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Recommendation
        
        
      </h4>
    

<p>Consider using one approach consistently throughout the contracts. Using the more gas efficient option can improve gas efficiency.</p>
      <h4 id="developer-response-33">
        
        
          <a href="#developer-response-33" class="anchor-heading" aria-labelledby="developer-response-33"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Developer Response
        
        
      </h4>
    

<p>This is more gas efficient.</p>
      <h3 id="7-informational---some-hard-coded-variables-might-be-better-adjustable-engn33r">
        
        
          <a href="#7-informational---some-hard-coded-variables-might-be-better-adjustable-engn33r" class="anchor-heading" aria-labelledby="7-informational---some-hard-coded-variables-might-be-better-adjustable-engn33r"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 7. Informational - Some hard coded variables might be better adjustable (engn33r)
        
        
      </h3>
    

<p>Some variables are hard coded in Yield Daddy, but making these values modifiable in functions with the <code class="language-plaintext highlighter-rouge">onlyGovernance()</code> modifier may make the protocol more adaptable.</p>
      <h4 id="technical-details-34">
        
        
          <a href="#technical-details-34" class="anchor-heading" aria-labelledby="technical-details-34"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Technical Details
        
        
      </h4>
    

<p>The <code class="language-plaintext highlighter-rouge">rewardRecipient</code> is an address that receives accrued rewards from the ERC4626 vault. This address cannot be changed in the existing AaveV2ERC4626.sol contract. Scenarios may arise where this value needs to be changed, but the contract does not currently allow this to happen.</p>
      <h4 id="impact-34">
        
        
          <a href="#impact-34" class="anchor-heading" aria-labelledby="impact-34"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Impact
        
        
      </h4>
    

<p>Informational.</p>
      <h4 id="recommendation-34">
        
        
          <a href="#recommendation-34" class="anchor-heading" aria-labelledby="recommendation-34"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Recommendation
        
        
      </h4>
    

<p>Making certain variables adjustable could make the contract easier to upgrade, maintain, or simply make the contract more versatile to unexpected scenarios. Another option is to set <code class="language-plaintext highlighter-rouge">rewardRecipient</code> to a proxy address so that the logic behind the proxy can be modified if needed.</p>
      <h4 id="developer-response-34">
        
        
          <a href="#developer-response-34" class="anchor-heading" aria-labelledby="developer-response-34"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Developer Response
        
        
      </h4>
    

<p>The contracts are not intended to be upgradeable. If a new version of the wrappers become available, existing wrapper holders can easily migrate to the new wrapper if desired.</p>
      <h3 id="8-informational---unclear-upgrade-mechanism-engn33r">
        
        
          <a href="#8-informational---unclear-upgrade-mechanism-engn33r" class="anchor-heading" aria-labelledby="8-informational---unclear-upgrade-mechanism-engn33r"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 8. Informational - Unclear upgrade mechanism (engn33r)
        
        
      </h3>
    

<p>There is no clear upgrade mechanism if the Yield Daddy contracts needs to be upgraded. This may cause problems later on if an upgrade to the vault needs to happen.</p>
      <h4 id="technical-details-35">
        
        
          <a href="#technical-details-35" class="anchor-heading" aria-labelledby="technical-details-35"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Technical Details
        
        
      </h4>
    

<p>The Yield Daddy contracts have no clear upgrade mechanism even though some hard coded values might need changing in the future. Some examples of upgrade use cases include:</p>
<ol>
  <li>If extra features are planned for a future Yield Daddy vault version, there is no clear path for migrating the aTokens from the existing vault.</li>
  <li>The Yield Daddy vaults do not have a mechanism to borrow from Aave using the aTokens the vault holds. Borrowing with some amount of this collateral could allow Yield Daddy to increase the yield generated and improve the value proposition to users. Introducing such a mechanism in the future would require the vault to approve the aTokens to another address or borrowing directly from Aave, and neither option is available with the contract logic.</li>
  <li>Aave had <a href="https://docs.aave.com/developers/v/2.0/the-core-protocol/lendingpool#deposit">a referral program in the past which is now inactive</a>, and a governance proposal could theoretically bring the program back. Even though this scenario is unlikely, if it were to happen the Aave <code class="language-plaintext highlighter-rouge">deposit()</code> call in Yield Daddy has a hard coded value of 0 for the referral code, so no referral rewards could be collected if the reward program is resumed by Aave.</li>
</ol>
      <h4 id="impact-35">
        
        
          <a href="#impact-35" class="anchor-heading" aria-labelledby="impact-35"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Impact
        
        
      </h4>
    

<p>Informational.</p>
      <h4 id="recommendation-35">
        
        
          <a href="#recommendation-35" class="anchor-heading" aria-labelledby="recommendation-35"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Recommendation
        
        
      </h4>
    

<p>Consider the current strategy for handling a scenario where the contracts need to be upgraded and the probability of such scenarios surfacing. If necessary, make it easier to upgrade the contracts. If upgrades are not necessary, the code can be left as it is.</p>
      <h4 id="developer-response-35">
        
        
          <a href="#developer-response-35" class="anchor-heading" aria-labelledby="developer-response-35"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Developer Response
        
        
      </h4>
    

<p>The contracts are not intended to be upgradeable. If a new version of the wrappers become available, existing wrapper holders can easily migrate to the new wrapper if desired.</p>
      <h3 id="9-informational---general-lack-of-documentation-and-comments-engn33r">
        
        
          <a href="#9-informational---general-lack-of-documentation-and-comments-engn33r" class="anchor-heading" aria-labelledby="9-informational---general-lack-of-documentation-and-comments-engn33r"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 9. Informational - General lack of documentation and comments (engn33r)
        
        
      </h3>
    

<p>There is no developer docs for Yield Daddy. Not all functions have NatSpec documentation. Improved documentation should be added before deployment.</p>
      <h4 id="technical-details-36">
        
        
          <a href="#technical-details-36" class="anchor-heading" aria-labelledby="technical-details-36"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Technical Details
        
        
      </h4>
    

<p>To give one example of some unclear code that should have comments, the <code class="language-plaintext highlighter-rouge">maxRedeem()</code> function <a href="https://github.com/timeless-fi/yield-daddy/blob/c2dfda5e2bc3bc9d1ca920416f962669b830c601/src/aave-v2/AaveV2ERC4626.sol#L244-L247">checks how much of the reserve asset is held by the aToken address</a>. It may not be obvious to all readers that the reason that an external protocol is queried before returning a result for Yield Daddy users is to cover the edge case where the Aave pool is undercollateralized (which is common due to Aave’s lending feature) and the Yield Daddy withdrawal would be larger than the entire Aave aToken reserve balance. A comment in the code or developer docs explaining this reasoning could expedite understanding for developers interfacing with this protocol or future code reviewers. Another place where NetSpec comments would help is clarifying that the return value of <code class="language-plaintext highlighter-rouge">maxWithdraw()</code> is in units of shares while the return value of <code class="language-plaintext highlighter-rouge">maxRedeem()</code> is in units of the underlying asset.</p>
      <h4 id="impact-36">
        
        
          <a href="#impact-36" class="anchor-heading" aria-labelledby="impact-36"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Impact
        
        
      </h4>
    

<p>Informational.</p>
      <h4 id="recommendation-36">
        
        
          <a href="#recommendation-36" class="anchor-heading" aria-labelledby="recommendation-36"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Recommendation
        
        
      </h4>
    

<p>Improve the Yield Daddy project documentation.</p>
      <h4 id="developer-response-36">
        
        
          <a href="#developer-response-36" class="anchor-heading" aria-labelledby="developer-response-36"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Developer Response
        
        
      </h4>
    

<p>Acknowledged.</p>
      <h3 id="10-informational---typos-engn33r">
        
        
          <a href="#10-informational---typos-engn33r" class="anchor-heading" aria-labelledby="10-informational---typos-engn33r"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 10. Informational - Typos (engn33r)
        
        
      </h3>
    

<p>There were some typos found in the repo.</p>
      <h4 id="technical-details-37">
        
        
          <a href="#technical-details-37" class="anchor-heading" aria-labelledby="technical-details-37"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Technical Details
        
        
      </h4>
    

<p>The Aave V2 factory contract has a comment accidentally copied <a href="https://github.com/timeless-fi/yield-daddy/blob/c2dfda5e2bc3bc9d1ca920416f962669b830c601/src/aave-v2/AaveV2ERC4626Factory.sol#L20">from Aave V3</a>. This should be modified to reference Aave V2.</p>

<p><a href="https://github.com/timeless-fi/xPYT/blob/fabe9d7cb9700334b10a48ee5d081234eb98def9/src/xPYT.sol#L232">This comment about <code class="language-plaintext highlighter-rouge">burn the xPYT</code></a> should be removed or changed. It was erroneously copied <a href="https://github.com/timeless-fi/xPYT/blob/fabe9d7cb9700334b10a48ee5d081234eb98def9/src/xPYT.sol#L165">from a similar function that does burn xPYT</a>. The same applieds to <a href="https://github.com/timeless-fi/xPYT/blob/fabe9d7cb9700334b10a48ee5d081234eb98def9/src/xPYT.sol#L244-L245">this other comment in the same function</a>.</p>
      <h4 id="impact-37">
        
        
          <a href="#impact-37" class="anchor-heading" aria-labelledby="impact-37"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Impact
        
        
      </h4>
    

<p>Informational.</p>
      <h4 id="recommendation-37">
        
        
          <a href="#recommendation-37" class="anchor-heading" aria-labelledby="recommendation-37"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Recommendation
        
        
      </h4>
    

<p>Fix typos.</p>
      <h4 id="developer-response-37">
        
        
          <a href="#developer-response-37" class="anchor-heading" aria-labelledby="developer-response-37"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Developer Response
        
        
      </h4>
    

<p>Fixed in commit <a href="https://github.com/timeless-fi/yield-daddy/commit/6c679121d2b4bacc5376c69d676928958a2b602b">6c679121d2b4bacc5376c69d676928958a2b602b</a>.</p>
      <h3 id="11-informational---aave-lendingpool-getconfiguration-can-replace-getreservedata-engn33r">
        
        
          <a href="#11-informational---aave-lendingpool-getconfiguration-can-replace-getreservedata-engn33r" class="anchor-heading" aria-labelledby="11-informational---aave-lendingpool-getconfiguration-can-replace-getreservedata-engn33r"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 11. Informational - Aave LendingPool <code class="language-plaintext highlighter-rouge">getConfiguration()</code> can replace <code class="language-plaintext highlighter-rouge">getReserveData()</code> (engn33r)
        
        
      </h3>
    

<p>In the Aave V2 and V3 wrappers, <code class="language-plaintext highlighter-rouge">lendingPool.getReserveData()</code> is used, which returns many pieces of data. These calls can be replaced with <code class="language-plaintext highlighter-rouge">lendingPool.getConfiguration()</code>, which returns less data. There are no gas savings because this is a view function.</p>
      <h4 id="technical-details-38">
        
        
          <a href="#technical-details-38" class="anchor-heading" aria-labelledby="technical-details-38"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Technical Details
        
        
      </h4>
    

<p><code class="language-plaintext highlighter-rouge">getReserveData()</code> returns many pieces of data in <a href="https://docs.aave.com/developers/v/2.0/the-core-protocol/lendingpool#getreservedata">Aave V2</a> and <a href="https://docs.aave.com/developers/core-contracts/pool#getreservedata">Aave V3</a>. The only data needed in the wrapper contracts can be received from <code class="language-plaintext highlighter-rouge">getConfiguration()</code>, which returns less data in <a href="https://docs.aave.com/developers/v/2.0/the-core-protocol/lendingpool#getconfiguration">Aave V2</a> and <a href="https://docs.aave.com/developers/core-contracts/pool#getconfiguration">Aave V3</a>. This efficiency boost won’t save gas because it is used in a view function.</p>
      <h4 id="impact-38">
        
        
          <a href="#impact-38" class="anchor-heading" aria-labelledby="impact-38"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Impact
        
        
      </h4>
    

<p>Informational.</p>
      <h4 id="recommendation-38">
        
        
          <a href="#recommendation-38" class="anchor-heading" aria-labelledby="recommendation-38"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Recommendation
        
        
      </h4>
    

<p>Use more efficient external Aave call when possible.</p>
      <h4 id="developer-response-38">
        
        
          <a href="#developer-response-38" class="anchor-heading" aria-labelledby="developer-response-38"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Developer Response
        
        
      </h4>
    

<p>Acknowledged.</p>
      <h3 id="12-informational---redundant-dependency-imports-engn33r">
        
        
          <a href="#12-informational---redundant-dependency-imports-engn33r" class="anchor-heading" aria-labelledby="12-informational---redundant-dependency-imports-engn33r"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 12. Informational - Redundant dependency imports (engn33r)
        
        
      </h3>
    

<p>The factory contracts for each protocol (Aave V2, Aave V3, Compound, Euler) import ERC4626Factory.sol and two solmate files. The ERC4626Factory.sol contract already imports the two solmate files, so they are imported twice. A similar instance is found in StETHERC4626.sol.</p>
      <h4 id="technical-details-39">
        
        
          <a href="#technical-details-39" class="anchor-heading" aria-labelledby="technical-details-39"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Technical Details
        
        
      </h4>
    

<p>The ERC4626 factory contracts have the same redundant import of two solmate files. For example, Aave V3 <a href="https://github.com/timeless-fi/yield-daddy/blob/2c8f62681ab90325ede093ac9c9f94dbcc5f7e49/src/aave-v3/AaveV3ERC4626Factory.sol#L9">imports ERC4626Factory.sol</a> and <a href="https://github.com/timeless-fi/yield-daddy/blob/2c8f62681ab90325ede093ac9c9f94dbcc5f7e49/src/aave-v3/AaveV3ERC4626Factory.sol#L4-L5">two solmate files</a>. But the imported base factory contract <a href="https://github.com/timeless-fi/yield-daddy/blob/2c8f62681ab90325ede093ac9c9f94dbcc5f7e49/src/base/ERC4626Factory.sol#L4-L5">has the solmate files imported</a>, making the import of these files redundant.</p>

<p>StETHERC4626.sol has a similar instance of this where StETHERC4626.sol imports “solmate/tokens/ERC20.sol” and “./external/IStETH.sol”, but “solmate/tokens/ERC20.sol” is already imported by IStETH.sol making the separate import unnecessary.</p>

<p>CurveV2Swapper.sol has a similar instance of this where CurveV2Swapper.sol imports “../Swapper.sol” and “../lib/ApproveMaxIfNeeded.sol”, but “../lib/ApproveMaxIfNeeded.sol” is already imported by Swapper.sol. The same applies to the solmate and timeless imports in CurveV2Swapper.sol.</p>
      <h4 id="impact-39">
        
        
          <a href="#impact-39" class="anchor-heading" aria-labelledby="impact-39"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Impact
        
        
      </h4>
    

<p>Informational.</p>
      <h4 id="recommendation-39">
        
        
          <a href="#recommendation-39" class="anchor-heading" aria-labelledby="recommendation-39"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Recommendation
        
        
      </h4>
    

<p>Remove redundant solmate file imports from Aave V2, Aave V3, Compound, and Euler factory contracts. Separately, remove StETHERC4626.sol and CurveV2Swapper.sol redundant import.</p>
      <h4 id="developer-response-39">
        
        
          <a href="#developer-response-39" class="anchor-heading" aria-labelledby="developer-response-39"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Developer Response
        
        
      </h4>
    

<p>This is by design. I want it to be obvious where each imported contract comes from in every file, so each symbol is explicitly imported from the file in which they were defined instead of importing all symbols from some other files.</p>
      <h3 id="13-informational---interface-doesnt-match-mainnet-contract-engn33r">
        
        
          <a href="#13-informational---interface-doesnt-match-mainnet-contract-engn33r" class="anchor-heading" aria-labelledby="13-informational---interface-doesnt-match-mainnet-contract-engn33r"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 13. Informational - Interface doesn’t match mainnet contract (engn33r)
        
        
      </h3>
    

<p>The interface for <code class="language-plaintext highlighter-rouge">mintGuardianPaused()</code> in IComptroller.sol doesn’t match the actual Compound contract. When yield daddy ERC4626 functions that rely on this external call are called on mainnet, they will revert because the ICERC20 type must be cast to an address first.</p>
      <h4 id="technical-details-40">
        
        
          <a href="#technical-details-40" class="anchor-heading" aria-labelledby="technical-details-40"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Technical Details
        
        
      </h4>
    

<p><a href="https://github.com/compound-finance/compound-protocol/blob/a3214f67b73310d547e00fc578e8355911c9d376/contracts/ComptrollerStorage.sol#L92">This is the Compound code</a> defining the <code class="language-plaintext highlighter-rouge">mintGuardianPaused</code> mapping as <code class="language-plaintext highlighter-rouge">mapping(address =&gt; bool) public mintGuardianPaused</code>. <a href="https://github.com/timeless-fi/yield-daddy/blob/2c8f62681ab90325ede093ac9c9f94dbcc5f7e49/src/compound/external/IComptroller.sol#L11">The interface for this mapping</a> is defined as <code class="language-plaintext highlighter-rouge">function mintGuardianPaused(ICERC20 cToken) external view returns (bool)</code>. This is problematic because the <code class="language-plaintext highlighter-rouge">address</code> type is not equal to the <code class="language-plaintext highlighter-rouge">ICERC20</code> type.</p>

<p>A foundry test was created to test if this type mismatch caused a revert, but the test passed without a revert. However, the custom <code class="language-plaintext highlighter-rouge">maxMint()</code> and <code class="language-plaintext highlighter-rouge">maxDeposit()</code> functions are not tested with existing tests for Compound or Aave V3.</p>
      <h4 id="impact-40">
        
        
          <a href="#impact-40" class="anchor-heading" aria-labelledby="impact-40"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Impact
        
        
      </h4>
    

<p>Informational.</p>
      <h4 id="recommendation-40">
        
        
          <a href="#recommendation-40" class="anchor-heading" aria-labelledby="recommendation-40"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Recommendation
        
        
      </h4>
    

<p>Modify the interface file IComptroller.sol to match Compound’s code. Add foundry tests to confirm these functions work as expected.</p>
      <h4 id="developer-response-40">
        
        
          <a href="#developer-response-40" class="anchor-heading" aria-labelledby="developer-response-40"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Developer Response
        
        
      </h4>
    

<p>This is by design. Contract types are treated the same as address types in external calls, so it’s good to use contract types to enforce extra type checking and avoid passing in the wrong parameters.</p>
      <h3 id="14-informational---consider-upgrade-to-latest-solidity-release-engn33r">
        
        
          <a href="#14-informational---consider-upgrade-to-latest-solidity-release-engn33r" class="anchor-heading" aria-labelledby="14-informational---consider-upgrade-to-latest-solidity-release-engn33r"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 14. Informational - Consider upgrade to latest solidity release (engn33r)
        
        
      </h3>
    

<p>The ERC4626 wrapper contracts use solidity 0.8.13. The latest solidity release at the time of writing, 0.8.16, has improvements that could be useful to take advantage of by upgrading the release version.</p>
      <h4 id="technical-details-41">
        
        
          <a href="#technical-details-41" class="anchor-heading" aria-labelledby="technical-details-41"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Technical Details
        
        
      </h4>
    

<p>The <a href="https://github.com/ethereum/solidity/releases">release notes of solidity releases since 0.8.13</a> describe code generation bugfixes and gas optimizations that have been introduced in the more recent releases. It would be best to use the latest release unless there is a good reason to continue using 0.8.13.</p>
      <h4 id="impact-41">
        
        
          <a href="#impact-41" class="anchor-heading" aria-labelledby="impact-41"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Impact
        
        
      </h4>
    

<p>Informational.</p>
      <h4 id="recommendation-41">
        
        
          <a href="#recommendation-41" class="anchor-heading" aria-labelledby="recommendation-41"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Recommendation
        
        
      </h4>
    

<p>Upgrade contracts to 0.8.16 to use the recent bug fixes and optimizations.</p>
      <h4 id="developer-response-41">
        
        
          <a href="#developer-response-41" class="anchor-heading" aria-labelledby="developer-response-41"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Developer Response
        
        
      </h4>
    

<p>The Solidity pragma used is pragma solidity ^0.8.13;, which means if a newer version of Solidity has been released it would automatically be used during compilation.</p>
      <h3 id="15-informational---theoretical-overflow-of-converttoshares-and-converttoassets-engn33r">
        
        
          <a href="#15-informational---theoretical-overflow-of-converttoshares-and-converttoassets-engn33r" class="anchor-heading" aria-labelledby="15-informational---theoretical-overflow-of-converttoshares-and-converttoassets-engn33r"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 15. Informational - Theoretical overflow of <code class="language-plaintext highlighter-rouge">convertToShares()</code> and <code class="language-plaintext highlighter-rouge">convertToAssets()</code> (engn33r)
        
        
      </h3>
    

<p>The ERC4626 functions <code class="language-plaintext highlighter-rouge">convertToShares()</code> and <code class="language-plaintext highlighter-rouge">convertToAssets()</code> could overflow and revert if a very large assets input parameter value is used. This is unlikely because it requires a small denominator and a very large numerator and most tokens don’t have a supply cap that large.</p>
      <h4 id="technical-details-42">
        
        
          <a href="#technical-details-42" class="anchor-heading" aria-labelledby="technical-details-42"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Technical Details
        
        
      </h4>
    

<p>Below is the custom <code class="language-plaintext highlighter-rouge">convertToShares()</code> function from StETHERC4626.sol:</p>

<div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">function</span> <span class="n">convertToShares</span><span class="p">(</span><span class="kt">uint256</span> <span class="n">assets</span><span class="p">)</span> <span class="k">public</span> <span class="k">view</span> <span class="k">virtual</span> <span class="k">override</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint256</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">uint256</span> <span class="n">supply</span> <span class="o">=</span> <span class="n">stETH</span><span class="p">().</span><span class="n">totalSupply</span><span class="p">();</span>

        <span class="k">return</span> <span class="n">supply</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">?</span> <span class="n">assets</span> <span class="o">:</span> <span class="n">assets</span><span class="p">.</span><span class="n">mulDivDown</span><span class="p">(</span><span class="n">stETH</span><span class="p">().</span><span class="n">getTotalShares</span><span class="p">(),</span> <span class="n">supply</span><span class="p">);</span>
    <span class="p">}</span>
</code></pre></div></div>

<p>If the value of the <code class="language-plaintext highlighter-rouge">assets</code> input parameter or the value of <code class="language-plaintext highlighter-rouge">stETH().getTotalShares()</code> is very close to <code class="language-plaintext highlighter-rouge">type(uint256).max</code> at the same time that <code class="language-plaintext highlighter-rouge">supply</code> is a very small value, this function could revert during the <a href="https://github.com/transmissions11/solmate/blob/3c738133a0c1697096d63d28ef7a8ef298f9af6b/src/utils/FixedPointMathLib.sol#L44-L46">mulDivDown library call</a>. The same is true of the <code class="language-plaintext highlighter-rouge">convertToShares()</code> function in <a href="https://github.com/transmissions11/solmate/blob/3c738133a0c1697096d63d28ef7a8ef298f9af6b/src/mixins/ERC4626.sol#L124">the standard solmate implementation</a>. The <code class="language-plaintext highlighter-rouge">convertToAssets()</code> function suffers from the same side effect in this extreme case.</p>
      <h4 id="impact-42">
        
        
          <a href="#impact-42" class="anchor-heading" aria-labelledby="impact-42"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Impact
        
        
      </h4>
    

<p>Informational.</p>
      <h4 id="recommendation-42">
        
        
          <a href="#recommendation-42" class="anchor-heading" aria-labelledby="recommendation-42"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Recommendation
        
        
      </h4>
    

<p>Most likely no change is needed because the revert condition is on a view function and only happens in extreme edge cases.</p>
      <h4 id="developer-response-42">
        
        
          <a href="#developer-response-42" class="anchor-heading" aria-labelledby="developer-response-42"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Developer Response
        
        
      </h4>
    

<p>Acknowledged.</p>
      <h3 id="16-informational---no-zero-address-checks-in-constructor-engn33r">
        
        
          <a href="#16-informational---no-zero-address-checks-in-constructor-engn33r" class="anchor-heading" aria-labelledby="16-informational---no-zero-address-checks-in-constructor-engn33r"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 16. Informational - No zero address checks in constructor (engn33r)
        
        
      </h3>
    

<p>There is no zero address checks in the constructor of xPYT.sol. This is acceptable if it is assumed that no mistake will occur during the contract deployment, but for security purposes it is best to err on the side of caution.</p>
      <h4 id="technical-details-43">
        
        
          <a href="#technical-details-43" class="anchor-heading" aria-labelledby="technical-details-43"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Technical Details
        
        
      </h4>
    

<p>The <a href="https://github.com/timeless-fi/xPYT/blob/fabe9d7cb9700334b10a48ee5d081234eb98def9/src/xPYT.sol#L97-L117">xPYT.sol constructor</a> sets three state variables to specific external contract addresses. No zero address check is performed, making it possible that one of these state variables could be set to the zero address.</p>
      <h4 id="impact-43">
        
        
          <a href="#impact-43" class="anchor-heading" aria-labelledby="impact-43"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Impact
        
        
      </h4>
    

<p>Informational.</p>
      <h4 id="recommendation-43">
        
        
          <a href="#recommendation-43" class="anchor-heading" aria-labelledby="recommendation-43"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Recommendation
        
        
      </h4>
    

<p>Add the following lines at the end of the xPYT.sol constructor. Note that storing <code class="language-plaintext highlighter-rouge">nyt</code> in a temporary <code class="language-plaintext highlighter-rouge">nyt_</code> variable like is done with the other state variables may save gas.</p>

<div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">require</span><span class="p">(</span><span class="kt">address</span><span class="p">(</span><span class="n">gate_</span><span class="p">)</span> <span class="o">!=</span> <span class="kt">address</span><span class="p">(</span><span class="mi">0</span><span class="p">));</span>
<span class="nb">require</span><span class="p">(</span><span class="kt">address</span><span class="p">(</span><span class="n">vault_</span><span class="p">)</span> <span class="o">!=</span> <span class="kt">address</span><span class="p">(</span><span class="mi">0</span><span class="p">));</span>
<span class="nb">require</span><span class="p">(</span><span class="kt">address</span><span class="p">(</span><span class="n">nyt</span><span class="p">)</span> <span class="o">!=</span> <span class="kt">address</span><span class="p">(</span><span class="mi">0</span><span class="p">));</span>
</code></pre></div></div>
      <h4 id="developer-response-43">
        
        
          <a href="#developer-response-43" class="anchor-heading" aria-labelledby="developer-response-43"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Developer Response
        
        
      </h4>
    

<p>This is fine.</p>
      <h3 id="17-informational---modify-gatesol-claimyieldandenter-function-argument-engn33r">
        
        
          <a href="#17-informational---modify-gatesol-claimyieldandenter-function-argument-engn33r" class="anchor-heading" aria-labelledby="17-informational---modify-gatesol-claimyieldandenter-function-argument-engn33r"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 17. Informational - Modify Gate.sol <code class="language-plaintext highlighter-rouge">claimYieldAndEnter()</code> function argument (engn33r)
        
        
      </h3>
    

<p><code class="language-plaintext highlighter-rouge">claimYieldAndEnter()</code> accepts four function arguments. The fourth argument is of type <code class="language-plaintext highlighter-rouge">IxPYT</code>, but this value is cast to an address four out of five times that it is used in the function. Consider changing this input type of <code class="language-plaintext highlighter-rouge">address</code> to cast this value only one time instead of four times.</p>
      <h4 id="technical-details-44">
        
        
          <a href="#technical-details-44" class="anchor-heading" aria-labelledby="technical-details-44"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Technical Details
        
        
      </h4>
    

<p>Most locations where xPYT is used, it is cast to an address with <code class="language-plaintext highlighter-rouge">address(xPYT)</code>. Only once is it used as <code class="language-plaintext highlighter-rouge">IxPYT</code> type. Instead, take in a function argument of type <code class="language-plaintext highlighter-rouge">address</code> and cast to <code class="language-plaintext highlighter-rouge">IxPYT</code> the one time that this type is needed.</p>
      <h4 id="impact-44">
        
        
          <a href="#impact-44" class="anchor-heading" aria-labelledby="impact-44"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Impact
        
        
      </h4>
    

<p>Informational.</p>
      <h4 id="recommendation-44">
        
        
          <a href="#recommendation-44" class="anchor-heading" aria-labelledby="recommendation-44"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Recommendation
        
        
      </h4>
    

<p>Modify <code class="language-plaintext highlighter-rouge">claimYieldAndEnter()</code> to take a fourth argument of type <code class="language-plaintext highlighter-rouge">address</code> instead of type <code class="language-plaintext highlighter-rouge">IxPYT</code>.</p>
      <h4 id="developer-response-44">
        
        
          <a href="#developer-response-44" class="anchor-heading" aria-labelledby="developer-response-44"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Developer Response
        
        
      </h4>
    

<p>This is by design. This adds more type checking for function parameters.</p>
      <h3 id="18-informational---curvev2xpyt-utilizes-a-non-twap-price-oracle-benjamin-samuels">
        
        
          <a href="#18-informational---curvev2xpyt-utilizes-a-non-twap-price-oracle-benjamin-samuels" class="anchor-heading" aria-labelledby="18-informational---curvev2xpyt-utilizes-a-non-twap-price-oracle-benjamin-samuels"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 18. Informational - CurveV2xPYT utilizes a non-TWAP price oracle (Benjamin Samuels)
        
        
      </h3>
    

<p>The CurveV2xPYT implements the <code class="language-plaintext highlighter-rouge">_getTwapQuote</code> function, which <code class="language-plaintext highlighter-rouge">curvePool.price_oracle()</code> to acquire a TWAP estimation, however, curve’s price_oracle() function implements an  exponential moving average (EMA) oracle.</p>
      <h4 id="technical-details-45">
        
        
          <a href="#technical-details-45" class="anchor-heading" aria-labelledby="technical-details-45"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Technical Details
        
        
      </h4>
    

<p>Curve’s <a href="https://github.com/curvefi/curve-crypto-contract/blob/master/contracts/two/CurveCryptoSwap2ETH.vy#L598"><code class="language-plaintext highlighter-rouge">price_oracle()</code> implementation</a> uses an exponential moving average for its oracle. EMA oracles have different properties from TWAP oracles, most notable of which is they are more sensitive to high price volatility near the time of query.</p>
      <h4 id="impact-45">
        
        
          <a href="#impact-45" class="anchor-heading" aria-labelledby="impact-45"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Impact
        
        
      </h4>
    

<p>Informational.</p>
      <h4 id="recommendation-45">
        
        
          <a href="#recommendation-45" class="anchor-heading" aria-labelledby="recommendation-45"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Recommendation
        
        
      </h4>
    

<p>Modify xPYT’s <code class="language-plaintext highlighter-rouge">_getTwapQuote</code> function name to reflect that the implementer may use a different averaging mechanism than TWAP, such as <code class="language-plaintext highlighter-rouge">_getOracleQuote</code></p>
      <h4 id="developer-response-45">
        
        
          <a href="#developer-response-45" class="anchor-heading" aria-labelledby="developer-response-45"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Developer Response
        
        
      </h4>
    

<p>This is fine.</p>
      <h3 id="19-informational---replace-magic-numbers-with-constants-engn33r">
        
        
          <a href="#19-informational---replace-magic-numbers-with-constants-engn33r" class="anchor-heading" aria-labelledby="19-informational---replace-magic-numbers-with-constants-engn33r"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 19. Informational - Replace magic numbers with constants (engn33r)
        
        
      </h3>
    

<p>Constant variables should be used in place of magic numbers to prevent typos. For one example, the magic number 10000 is found in multiple places in Swapper.sol and should be replaced with a constant. Using a constant also adds a description to the value to explain the purpose of the value. This will not change gas consumption.</p>
      <h4 id="technical-details-46">
        
        
          <a href="#technical-details-46" class="anchor-heading" aria-labelledby="technical-details-46"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Technical Details
        
        
      </h4>
    

<p>There are many instances of the value 10000. Consider replacing this magic number with a constant internal variable named <code class="language-plaintext highlighter-rouge">FEE_BASE</code>. Instances are found <a href="https://github.com/timeless-fi/swapper/blob/b898896579b60697a8113da21cefb3b00bcfaa0d/src/Swapper.sol#L338">here</a>, <a href="https://github.com/timeless-fi/swapper/blob/b898896579b60697a8113da21cefb3b00bcfaa0d/src/Swapper.sol#L417">here</a>, <a href="https://github.com/timeless-fi/swapper/blob/b898896579b60697a8113da21cefb3b00bcfaa0d/src/Swapper.sol#L496">here</a>, and <a href="https://github.com/timeless-fi/swapper/blob/b898896579b60697a8113da21cefb3b00bcfaa0d/src/Swapper.sol#L613">here</a>.</p>
      <h4 id="impact-46">
        
        
          <a href="#impact-46" class="anchor-heading" aria-labelledby="impact-46"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Impact
        
        
      </h4>
    

<p>Informational.</p>
      <h4 id="recommendation-46">
        
        
          <a href="#recommendation-46" class="anchor-heading" aria-labelledby="recommendation-46"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Recommendation
        
        
      </h4>
    

<p>Use constant variables instead of magic numbers.</p>
      <h4 id="developer-response-46">
        
        
          <a href="#developer-response-46" class="anchor-heading" aria-labelledby="developer-response-46"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Developer Response
        
        
      </h4>
    

<p>Acknowledged.</p>
      <h3 id="20-informational---no-timelock-or-other-protection-around-changing-fee-or-fee-recipient-engn33r">
        
        
          <a href="#20-informational---no-timelock-or-other-protection-around-changing-fee-or-fee-recipient-engn33r" class="anchor-heading" aria-labelledby="20-informational---no-timelock-or-other-protection-around-changing-fee-or-fee-recipient-engn33r"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 20. Informational - No timelock or other protection around changing fee or fee recipient (engn33r)
        
        
      </h3>
    

<p><code class="language-plaintext highlighter-rouge">ownerSetProtocolFee()</code> allows the owner to change the fee percentage and the recipient of fees. This is a centralization risk because the owner can make this change without any delay. If holders of a timeless token are promised a fraction of these fees, the owner can redirect the fees elsewhere, effectively rugging the token holders.</p>
      <h4 id="technical-details-47">
        
        
          <a href="#technical-details-47" class="anchor-heading" aria-labelledby="technical-details-47"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Technical Details
        
        
      </h4>
    

<p><a href="https://github.com/timeless-fi/swapper/blob/b898896579b60697a8113da21cefb3b00bcfaa0d/src/Swapper.sol#L261"><code class="language-plaintext highlighter-rouge">ownerSetProtocolFee()</code></a> allows the owner to set the fee percentage and fee recipient. While this function has access control to only allow the owner to call this function, there is no further controls to reduce centralization risk. Whether this is necessary depends on the parties who are intended to receive the fees. If users are intended to receive a fraction of the fees from Swapper.sol, they may want additional guarantees that the fees will not be redirected somewhere else without notice.</p>
      <h4 id="impact-47">
        
        
          <a href="#impact-47" class="anchor-heading" aria-labelledby="impact-47"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Impact
        
        
      </h4>
    

<p>Informational.</p>
      <h4 id="recommendation-47">
        
        
          <a href="#recommendation-47" class="anchor-heading" aria-labelledby="recommendation-47"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Recommendation
        
        
      </h4>
    

<p>Consider reducing centralization risk by adding a timelock to fee changes and clarifying how the multisig works.</p>
      <h4 id="developer-response-47">
        
        
          <a href="#developer-response-47" class="anchor-heading" aria-labelledby="developer-response-47"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Developer Response
        
        
      </h4>
    

<p>Acknowledged.</p>
      <h3 id="21-informational---safeapprove-is-deprecated-benjamin-samuels">
        
        
          <a href="#21-informational---safeapprove-is-deprecated-benjamin-samuels" class="anchor-heading" aria-labelledby="21-informational---safeapprove-is-deprecated-benjamin-samuels"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 21. Informational - safeApprove is deprecated (Benjamin Samuels)
        
        
      </h3>
    

<p>The <code class="language-plaintext highlighter-rouge">safeApprove</code> function is used in several locations across the scoped &amp; unscoped contracts. According to the <a href="https://docs.openzeppelin.com/contracts/4.x/api/token/erc20#SafeERC20-safeApprove-contract-IERC20-address-uint256-">OpenZeppelin documentation</a>, it is currently deprecated.</p>
      <h4 id="technical-details-48">
        
        
          <a href="#technical-details-48" class="anchor-heading" aria-labelledby="technical-details-48"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Technical Details
        
        
      </h4>
    

<p>This function is deprecated because it can be used to <a href="https://github.com/ethereum/EIPs/issues/20#issuecomment-263524729">manipulate a user’s allowances using specific transaction ordering</a>.</p>
      <h4 id="impact-48">
        
        
          <a href="#impact-48" class="anchor-heading" aria-labelledby="impact-48"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Impact
        
        
      </h4>
    

<p>Informational.</p>
      <h4 id="recommendation-48">
        
        
          <a href="#recommendation-48" class="anchor-heading" aria-labelledby="recommendation-48"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Recommendation
        
        
      </h4>
    

<p>Consider replacing instances of safeApprove with safeIncreaseAllowance/safeDecreaseAllowance respectively.</p>
      <h4 id="developer-response-48">
        
        
          <a href="#developer-response-48" class="anchor-heading" aria-labelledby="developer-response-48"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Developer Response
        
        
      </h4>
    

<p>This is by design. Some major tokens such as USDT will revert if safeIncreaseAllowance or safeDecreaseAllowance is used, since calling approve() with a non-zero input &amp; non-zero existing allowance is not allowed.</p>
      <h3 id="22-informational---swapper-repo-foundry-coverage-failing-engn33r">
        
        
          <a href="#22-informational---swapper-repo-foundry-coverage-failing-engn33r" class="anchor-heading" aria-labelledby="22-informational---swapper-repo-foundry-coverage-failing-engn33r"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 22. Informational - Swapper repo foundry coverage failing (engn33r)
        
        
      </h3>
    

<p>Using <code class="language-plaintext highlighter-rouge">foundry coverage</code> for the swapper repo results in a <code class="language-plaintext highlighter-rouge">CompilerError</code> message.</p>
      <h4 id="technical-details-49">
        
        
          <a href="#technical-details-49" class="anchor-heading" aria-labelledby="technical-details-49"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Technical Details
        
        
      </h4>
    

<p>While increasing code coverage does not necessarily reduce the risk of security issues, it is generally a good idea to improve code coverage for projects. Running <code class="language-plaintext highlighter-rouge">foundry coverage</code> in the swapper repo returns a <code class="language-plaintext highlighter-rouge">CompilerError: Stack too deep when compiling inline assembly: Variable value0 is 1 slot(s) too deep inside the stack.</code> error. This implies that code coverage is not being monitored or improved for the swapper issue.</p>
      <h4 id="impact-49">
        
        
          <a href="#impact-49" class="anchor-heading" aria-labelledby="impact-49"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Impact
        
        
      </h4>
    

<p>Informational.</p>
      <h4 id="recommendation-49">
        
        
          <a href="#recommendation-49" class="anchor-heading" aria-labelledby="recommendation-49"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Recommendation
        
        
      </h4>
    

<p>Fix the Swapper repo to enable foundry code coverage.</p>
      <h4 id="developer-response-49">
        
        
          <a href="#developer-response-49" class="anchor-heading" aria-labelledby="developer-response-49"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Developer Response
        
        
      </h4>
    

<p>Acknowledged.</p>
      <h3 id="23-informational---stetherc4626tsol-test-failing-benjamin-samuels">
        
        
          <a href="#23-informational---stetherc4626tsol-test-failing-benjamin-samuels" class="anchor-heading" aria-labelledby="23-informational---stetherc4626tsol-test-failing-benjamin-samuels"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 23. Informational - StETHERC4626.t.sol test failing (Benjamin Samuels)
        
        
      </h3>
    

<p>The testVaultInteractionsForSomeoneElse test for StETHERC4626.t.sol in the yield-daddy repo is failing.</p>
      <h4 id="technical-details-50">
        
        
          <a href="#technical-details-50" class="anchor-heading" aria-labelledby="technical-details-50"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Technical Details
        
        
      </h4>
    

<p>This issue is caused by the <code class="language-plaintext highlighter-rouge">mintUnderlying</code> call on <a href="https://github.com/timeless-fi/yield-daddy/blob/2c8f62681ab90325ede093ac9c9f94dbcc5f7e49/src/test/lido/StETHERC4626.t.sol#L188">line 188</a>, which mints 1e18+2 of the underlying token for alice. 1e18 of these tokens are deposited to the vault on <a href="https://github.com/timeless-fi/yield-daddy/blob/2c8f62681ab90325ede093ac9c9f94dbcc5f7e49/src/test/lido/StETHERC4626.t.sol#L201">line 201</a>, leaving behind 2 underlying tokens in alice’s account when the following assertion is made on <a href="https://github.com/timeless-fi/yield-daddy/blob/2c8f62681ab90325ede093ac9c9f94dbcc5f7e49/src/test/lido/StETHERC4626.t.sol#L205">line 205</a>.</p>
      <h4 id="impact-50">
        
        
          <a href="#impact-50" class="anchor-heading" aria-labelledby="impact-50"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Impact
        
        
      </h4>
    

<p>Informational.</p>
      <h4 id="recommendation-50">
        
        
          <a href="#recommendation-50" class="anchor-heading" aria-labelledby="recommendation-50"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Recommendation
        
        
      </h4>
    

<p>Fix the test and add automatic test-on-push using Github Actions to prevent similar test failures in the future.</p>
      <h4 id="developer-response-50">
        
        
          <a href="#developer-response-50" class="anchor-heading" aria-labelledby="developer-response-50"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Developer Response
        
        
      </h4>
    

<p>Acknowledged.</p>
      <h2 id="final-remarks">
        
        
          <a href="#final-remarks" class="anchor-heading" aria-labelledby="final-remarks"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Final remarks
        
        
      </h2>
    
      <h3 id="engn33r">
        
        
          <a href="#engn33r" class="anchor-heading" aria-labelledby="engn33r"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> engn33r
        
        
      </h3>
    

<p>The swapper and xPYT repositories have many code paths that involve calls to contracts that were outside the scope of this review, making it difficult to guarantee the security of the in-scope contracts given the involvement of extensive out of scope code. Additionally, the swapper and xPYT contracts are written in a way that involves many code paths that make it difficult to follow for every edge case. Refactoring this code, replacing duplicated line of code with functions and making it more linear where possible, would go a long way to making the code easier to understand in future reviews. In contrast, the ERC4626 wrappers in the yield-daddy repository were relatively straightforward to review.</p>

<p>Beyond the complexity of the code, one area in need of improvement is documentation. The documentation for the all the repositories, including the core timeless repository (which was not in the scope of this review) could be improved, especially for the xPYT and swapper repositories. Because swaps are happening between three different Timeless tokens, it is important to keep track of what units/token each variable refers to, and the lack of documentation around what units/token each variable uses makes it harder to verify the contract logic.</p>
      <h3 id="benjamin-samuels">
        
        
          <a href="#benjamin-samuels" class="anchor-heading" aria-labelledby="benjamin-samuels"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Benjamin Samuels
        
        
      </h3>
    

<p>Swapper, xPYT, and yield-daddy have adequate testing that would benefit greatly from an integration test suite that runs against mainnet/other network state. Integration tests currently run against locally-deployed variants, however it should be noted that many of the protocols being integrated against utilize upgradable proxies(Lido), or have different versions of their protocol deployed on different networks (Aave). Some level of mainnet integration testing can help avoid unexpected issues such as the <a href="https://www.comp.xyz/t/ceth-price-feed-incident-post-mortem/3578">cETH Price Oracle incident</a> that recent impacted Compound.</p>

<p>If future passes on the testing suite are planned, it would be advisable to standardize the invariants that are tested in the ERC4626 wrappers. The current test suite for the ERC4626 wrappers is comprehensive for some wrappers, but relatively lacking for others. Equal testing coverage would help ensure each wrapper is conforming to the properties of the official spec.</p>

<p>The in-code naming conventions for NYT, PYT, and xPYT made auditing the system much more difficult. This convention will likely make it more challenging for integrators to develop on top of Yield Daddy, and it would be advisable to choose a more concise naming convention in future protocol versions.</p>

<p>The Swapper repository exposes the most dynamic behavior, so some additional time was spent focusing on verifying its behavior. Several Echidna invariants were written to verify the CurveJuggler component of Swapper, the code for which is attached to this report.</p>

<p>While Yield Daddy’s architecture is relatively complex, it is worth noting that some care was taken to decouple its components using ERC4626. This decoupling made auditing the ERC4626 contracts much simpler, and other parts of the codebase may benefit from a similar decoupling pass.</p>
      <h2 id="about-yacademy">
        
        
          <a href="#about-yacademy" class="anchor-heading" aria-labelledby="about-yacademy"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> About yAcademy
        
        
      </h2>
    

<p><a href="https://yacademy.dev/">yAcademy</a> is an ecosystem initiative started by Yearn Finance and its ecosystem partners to bootstrap sustainable and collaborative blockchain security reviews and to nurture aspiring security talent. yAcademy includes <a href="https://yacademy.dev/fellowship-program/">a fellowship program</a>, a residents program, and <a href="https://yacademy.dev/guest-auditor-program/">a guest auditor program</a>. In the fellowship program, fellows perform a series of periodic security reviews and presentations during the program. Residents are past fellows who continue to gain experience by performing security reviews of contracts submitted to yAcademy for review (such as this contract). Guest auditors are experts with a track record in the security space who temporarily assist with the review efforts.</p>

        

        

        
        
          <hr>
          <footer>
            
              <p><a href="#top" id="back-to-top">Back to top</a></p>
            

            

            
              <div class="d-flex mt-2">
                
                
              </div>
            
          </footer>
        

      </div>
    </div>

    
      

      <div class="search-overlay"></div>
    
  </div>
  <link rel="image_src" href="https://yaudit.dev/assets/images/logo.png" />
</body>

  <script>
    var config = {}
;
    mermaid.initialize(config);
    window.mermaid.init(undefined, document.querySelectorAll('.language-mermaid'));
  </script>

</html>

