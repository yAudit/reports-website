

<!DOCTYPE html>

<html lang="en-US">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge">

  

  <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">


  <link rel="stylesheet" href="/assets/css/just-the-docs-default.css">

  

  
    <script type="text/javascript" src="/assets/js/vendor/lunr.min.js"></script>
  

  
    <script src="https://cdn.jsdelivr.net/npm/mermaid@9.1.6/dist/mermaid.min.js"></script>
  

  <script type="text/javascript" src="/assets/js/just-the-docs.js"></script>
  <script defer data-domain="reports.yAudit.dev" src="https://plausible.io/js/script.js"></script>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>12-2022-Gro-Protocol | yAudit Reports</title>
<meta name="generator" content="Jekyll v3.9.2" />
<meta property="og:title" content="12-2022-Gro-Protocol" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Gro Protocol yAcademy Report" />
<meta property="og:description" content="Gro Protocol yAcademy Report" />
<link rel="canonical" href="http://localhost:4000/reports/12-2022-Gro-Protocol/" />
<meta property="og:url" content="http://localhost:4000/reports/12-2022-Gro-Protocol/" />
<meta property="og:site_name" content="yAudit Reports" />
<meta property="og:image" content="http://localhost:4000/assets/images/logo.png" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary_large_image" />
<meta property="twitter:image" content="http://localhost:4000/assets/images/logo.png" />
<meta property="twitter:title" content="12-2022-Gro-Protocol" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","description":"Gro Protocol yAcademy Report","headline":"12-2022-Gro-Protocol","image":"http://localhost:4000/assets/images/logo.png","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"http://localhost:4000/assets/images/yaudit-logo.jpg"}},"url":"http://localhost:4000/reports/12-2022-Gro-Protocol/"}</script>
<!-- End Jekyll SEO tag -->


  

</head>

<body>
  <a class="skip-to-main" href="#main-content">Skip to main content</a>
  <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
    <symbol id="svg-link" viewBox="0 0 24 24">
      <title>Link</title>
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link">
        <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
      </svg>
    </symbol>
    <symbol id="svg-search" viewBox="0 0 24 24">
      <title>Search</title>
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search">
        <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line>
      </svg>
    </symbol>
    <symbol id="svg-menu" viewBox="0 0 24 24">
      <title>Menu</title>
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu">
        <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line>
      </svg>
    </symbol>
    <symbol id="svg-arrow-right" viewBox="0 0 24 24">
      <title>Expand</title>
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right">
        <polyline points="9 18 15 12 9 6"></polyline>
      </svg>
    </symbol>
    <symbol id="svg-doc" viewBox="0 0 24 24">
      <title>Document</title>
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file">
        <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline>
      </svg>
    </symbol>
    <!-- Feather. MIT License: https://github.com/feathericons/feather/blob/master/LICENSE -->
<symbol id="svg-external-link" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-external-link">
  <title id="svg-external-link-title">(external link)</title>
  <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line>
</symbol>

  </svg>

  <div class="side-bar">
    <div class="site-header">
      <a href="/" class="site-title lh-tight">
  <div class="site-logo"></div>

</a>
      <a href="#" id="menu-button" class="site-button">
        <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg>
      </a>
    </div>
    <nav role="navigation" aria-label="Main" id="site-nav" class="site-nav">
      
      
        <ul class="nav-list"><li class="nav-list-item"><a href="/" class="nav-list-link">yAudit Reports</a></li><li class="nav-list-item"><a href="/reports/03-2022-Ohm/" class="nav-list-link">03-2022-Ohm</a></li><li class="nav-list-item"><a href="/reports/04-2022-Ohm-Bond/" class="nav-list-link">04-2022-Ohm-Bond</a></li><li class="nav-list-item"><a href="/reports/04-2022-veYFI/" class="nav-list-link">04-2022-veYFI</a></li><li class="nav-list-item"><a href="/reports/05-2022-OpenMEVRouter/" class="nav-list-link">05-2022-OpenMEV</a></li><li class="nav-list-item"><a href="/reports/08-2022-Bunni/" class="nav-list-link">08-2022-Bunni</a></li><li class="nav-list-item"><a href="/reports/08-2022-Timeless-Yield-Daddy/" class="nav-list-link">08-2022-Timeless-Yield-Daddy</a></li><li class="nav-list-item"><a href="/reports/09-2022-yFu-NFT/" class="nav-list-link">09-2022-yFu-NFT</a></li><li class="nav-list-item"><a href="/reports/10-2022-NounsDAO-Token-Buyer/" class="nav-list-link">10-2022-NounsDAO-Token-Buyer</a></li><li class="nav-list-item active"><a href="/reports/12-2022-Gro-Protocol/" class="nav-list-link active">12-2022-Gro-Protocol</a></li><li class="nav-list-item external">
      <a href="https://yaudit.dev/" class="nav-list-link external">
        yAudit Website
        <svg viewBox="0 0 24 24" aria-labelledby="svg-external-link-title"><use xlink:href="#svg-external-link"></use></svg>
      </a>
    </li></ul>
      
      
    </nav>

    
    
      <footer class="site-footer">
        <!-- This site uses <a href="https://github.com/just-the-docs/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. -->
      </footer>
    
  </div>
  <div class="main" id="top">
    <div id="main-header" class="main-header">
      

        

        <div class="search">
          <div class="search-input-wrap">
            <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search yAudit Reports" aria-label="Search yAudit Reports" autocomplete="off">
            <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label>
          </div>
          <div id="search-results" class="search-results"></div>
        </div>
      
      
      
    </div>
    <div id="main-content-wrap" class="main-content-wrap">
      
        
      
      <div id="main-content" class="main-content" role="main">
        
          <h1 class="no_toc" id="yacademy-gro-protocol-review">
        
        
          <a href="#yacademy-gro-protocol-review" class="anchor-heading" aria-labelledby="yacademy-gro-protocol-review"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> yAcademy Gro Protocol Review
        
        
      </h1>
    

<p><strong>Review Resources:</strong></p>

<ul>
  <li><a href="https://docs.gro.xyz/gro-docs/">Current Gro Protocol docs</a></li>
</ul>

<p><strong>Residents:</strong></p>

<ul>
  <li>engn33r</li>
  <li>usmannk</li>
</ul>
      <h2 class="no_toc" id="table-of-contents">
        
        
          <a href="#table-of-contents" class="anchor-heading" aria-labelledby="table-of-contents"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Table of Contents
        
        
      </h2>
    

<ol id="markdown-toc">
  <li><a href="#review-summary" id="markdown-toc-review-summary">Review Summary</a></li>
  <li><a href="#scope" id="markdown-toc-scope">Scope</a></li>
  <li><a href="#code-evaluation-matrix" id="markdown-toc-code-evaluation-matrix">Code Evaluation Matrix</a></li>
  <li><a href="#findings-explanation" id="markdown-toc-findings-explanation">Findings Explanation</a></li>
  <li><a href="#critical-findings" id="markdown-toc-critical-findings">Critical Findings</a></li>
  <li><a href="#high-findings" id="markdown-toc-high-findings">High Findings</a>    <ol>
      <li><a href="#1-high---underflow-in-int256---uint256-conversion" id="markdown-toc-1-high---underflow-in-int256---uint256-conversion">1. High - Underflow in int256 -&gt; uint256 conversion</a>        <ol>
          <li><a href="#technical-details" id="markdown-toc-technical-details">Technical Details</a></li>
          <li><a href="#impact" id="markdown-toc-impact">Impact</a></li>
          <li><a href="#recommendation" id="markdown-toc-recommendation">Recommendation</a></li>
          <li><a href="#developer-response" id="markdown-toc-developer-response">Developer Response</a></li>
        </ol>
      </li>
    </ol>
  </li>
  <li><a href="#medium-findings" id="markdown-toc-medium-findings">Medium Findings</a>    <ol>
      <li><a href="#1-medium---sellallrewards-reverts-with-non-zero-numberofrewards" id="markdown-toc-1-medium---sellallrewards-reverts-with-non-zero-numberofrewards">1. Medium - <code class="language-plaintext highlighter-rouge">sellAllRewards()</code> reverts with non-zero <code class="language-plaintext highlighter-rouge">numberOfRewards</code></a>        <ol>
          <li><a href="#technical-details-1" id="markdown-toc-technical-details-1">Technical Details</a></li>
          <li><a href="#impact-1" id="markdown-toc-impact-1">Impact</a></li>
          <li><a href="#recommendation-1" id="markdown-toc-recommendation-1">Recommendation</a></li>
          <li><a href="#developer-response-1" id="markdown-toc-developer-response-1">Developer Response</a></li>
        </ol>
      </li>
      <li><a href="#2-medium---wethamount-in-rewards-calculations-should-be-balanceof" id="markdown-toc-2-medium---wethamount-in-rewards-calculations-should-be-balanceof">2. Medium - <code class="language-plaintext highlighter-rouge">wethAmount</code> in rewards calculations should be balanceOf</a>        <ol>
          <li><a href="#technical-details-2" id="markdown-toc-technical-details-2">Technical Details</a></li>
          <li><a href="#impact-2" id="markdown-toc-impact-2">Impact</a></li>
          <li><a href="#recommendation-2" id="markdown-toc-recommendation-2">Recommendation</a></li>
          <li><a href="#developer-response-2" id="markdown-toc-developer-response-2">Developer Response</a></li>
        </ol>
      </li>
      <li><a href="#3-medium---tranche-depositwithdrawal-denial-of-service" id="markdown-toc-3-medium---tranche-depositwithdrawal-denial-of-service">3. Medium - Tranche deposit/withdrawal denial of service</a>        <ol>
          <li><a href="#technical-details-3" id="markdown-toc-technical-details-3">Technical Details</a></li>
          <li><a href="#impact-3" id="markdown-toc-impact-3">Impact</a></li>
          <li><a href="#recommendation-3" id="markdown-toc-recommendation-3">Recommendation</a></li>
          <li><a href="#developer-response-3" id="markdown-toc-developer-response-3">Developer Response</a></li>
        </ol>
      </li>
      <li><a href="#4-medium---unreliable-senior-tranche-yield" id="markdown-toc-4-medium---unreliable-senior-tranche-yield">4. Medium - Unreliable Senior Tranche yield</a>        <ol>
          <li><a href="#technical-details-4" id="markdown-toc-technical-details-4">Technical Details</a></li>
          <li><a href="#impact-4" id="markdown-toc-impact-4">Impact</a></li>
          <li><a href="#recommendation-4" id="markdown-toc-recommendation-4">Recommendation</a></li>
          <li><a href="#developer-response-4" id="markdown-toc-developer-response-4">Developer Response</a></li>
        </ol>
      </li>
      <li><a href="#5-medium---timing-mismatch-between-time-gated-actions" id="markdown-toc-5-medium---timing-mismatch-between-time-gated-actions">5. Medium - Timing mismatch between time-gated actions</a>        <ol>
          <li><a href="#technical-details-5" id="markdown-toc-technical-details-5">Technical Details</a></li>
          <li><a href="#impact-5" id="markdown-toc-impact-5">Impact</a></li>
          <li><a href="#recommendation-5" id="markdown-toc-recommendation-5">Recommendation</a></li>
          <li><a href="#developer-response-5" id="markdown-toc-developer-response-5">Developer Response</a></li>
        </ol>
      </li>
      <li><a href="#6-medium---whale-invest-and-divest-denial-of-service-dos" id="markdown-toc-6-medium---whale-invest-and-divest-denial-of-service-dos">6. Medium - Whale <code class="language-plaintext highlighter-rouge">invest()</code> and <code class="language-plaintext highlighter-rouge">divest()</code> denial of service (DoS)</a>        <ol>
          <li><a href="#technical-details-6" id="markdown-toc-technical-details-6">Technical Details</a></li>
          <li><a href="#impact-6" id="markdown-toc-impact-6">Impact</a></li>
          <li><a href="#recommendation-6" id="markdown-toc-recommendation-6">Recommendation</a></li>
          <li><a href="#developer-response-6" id="markdown-toc-developer-response-6">Developer Response</a></li>
        </ol>
      </li>
    </ol>
  </li>
  <li><a href="#low-findings" id="markdown-toc-low-findings">Low Findings</a>    <ol>
      <li><a href="#1-low---strategy-migration-should-remove-old-approvals" id="markdown-toc-1-low---strategy-migration-should-remove-old-approvals">1. Low - Strategy migration should remove old approvals</a>        <ol>
          <li><a href="#technical-details-7" id="markdown-toc-technical-details-7">Technical Details</a></li>
          <li><a href="#impact-7" id="markdown-toc-impact-7">Impact</a></li>
          <li><a href="#recommendation-7" id="markdown-toc-recommendation-7">Recommendation</a></li>
          <li><a href="#developer-response-7" id="markdown-toc-developer-response-7">Developer Response</a></li>
        </ol>
      </li>
      <li><a href="#2-low---inconsistent-erc20-imports" id="markdown-toc-2-low---inconsistent-erc20-imports">2. Low - Inconsistent ERC20 imports</a>        <ol>
          <li><a href="#technical-details-8" id="markdown-toc-technical-details-8">Technical Details</a></li>
          <li><a href="#impact-8" id="markdown-toc-impact-8">Impact</a></li>
          <li><a href="#recommendation-8" id="markdown-toc-recommendation-8">Recommendation</a></li>
          <li><a href="#developer-response-8" id="markdown-toc-developer-response-8">Developer Response</a></li>
        </ol>
      </li>
      <li><a href="#3-low---similar-functions-have-different-logic" id="markdown-toc-3-low---similar-functions-have-different-logic">3. Low - Similar functions have different logic</a>        <ol>
          <li><a href="#technical-details-9" id="markdown-toc-technical-details-9">Technical Details</a></li>
          <li><a href="#impact-9" id="markdown-toc-impact-9">Impact</a></li>
          <li><a href="#recommendation-9" id="markdown-toc-recommendation-9">Recommendation</a></li>
          <li><a href="#developer-response-9" id="markdown-toc-developer-response-9">Developer Response</a></li>
        </ol>
      </li>
      <li><a href="#4-low---convexstrategy-owner-can-sweep-tokens" id="markdown-toc-4-low---convexstrategy-owner-can-sweep-tokens">4. Low - ConvexStrategy owner can sweep tokens</a>        <ol>
          <li><a href="#technical-details-10" id="markdown-toc-technical-details-10">Technical Details</a></li>
          <li><a href="#impact-10" id="markdown-toc-impact-10">Impact</a></li>
          <li><a href="#recommendation-10" id="markdown-toc-recommendation-10">Recommendation</a></li>
          <li><a href="#developer-response-10" id="markdown-toc-developer-response-10">Developer Response</a></li>
        </ol>
      </li>
      <li><a href="#5-low---inconsistent-minimum-reward-amount" id="markdown-toc-5-low---inconsistent-minimum-reward-amount">5. Low - Inconsistent minimum reward amount</a>        <ol>
          <li><a href="#technical-details-11" id="markdown-toc-technical-details-11">Technical Details</a></li>
          <li><a href="#impact-11" id="markdown-toc-impact-11">Impact</a></li>
          <li><a href="#recommendation-11" id="markdown-toc-recommendation-11">Recommendation</a></li>
          <li><a href="#developer-response-11" id="markdown-toc-developer-response-11">Developer Response</a></li>
        </ol>
      </li>
      <li><a href="#6-low---inconsistent-metapool-fee-inclusion" id="markdown-toc-6-low---inconsistent-metapool-fee-inclusion">6. Low - Inconsistent metapool fee inclusion</a>        <ol>
          <li><a href="#technical-details-12" id="markdown-toc-technical-details-12">Technical Details</a></li>
          <li><a href="#impact-12" id="markdown-toc-impact-12">Impact</a></li>
          <li><a href="#recommendation-12" id="markdown-toc-recommendation-12">Recommendation</a></li>
          <li><a href="#developer-response-12" id="markdown-toc-developer-response-12">Developer Response</a></li>
        </ol>
      </li>
      <li><a href="#7-low---potentially-incorrect-branching-logic" id="markdown-toc-7-low---potentially-incorrect-branching-logic">7. Low - Potentially incorrect branching logic</a>        <ol>
          <li><a href="#technical-details-13" id="markdown-toc-technical-details-13">Technical Details</a></li>
          <li><a href="#impact-13" id="markdown-toc-impact-13">Impact</a></li>
          <li><a href="#recommendation-13" id="markdown-toc-recommendation-13">Recommendation</a></li>
          <li><a href="#developer-response-13" id="markdown-toc-developer-response-13">Developer Response</a></li>
        </ol>
      </li>
      <li><a href="#8-low---setstrategies-doesnt-set-strategycheck-values" id="markdown-toc-8-low---setstrategies-doesnt-set-strategycheck-values">8. Low - <code class="language-plaintext highlighter-rouge">setStrategies()</code> doesn’t set <code class="language-plaintext highlighter-rouge">strategyCheck</code> values</a>        <ol>
          <li><a href="#technical-details-14" id="markdown-toc-technical-details-14">Technical Details</a></li>
          <li><a href="#impact-14" id="markdown-toc-impact-14">Impact</a></li>
          <li><a href="#recommendation-14" id="markdown-toc-recommendation-14">Recommendation</a></li>
          <li><a href="#developer-response-14" id="markdown-toc-developer-response-14">Developer Response</a></li>
        </ol>
      </li>
      <li><a href="#9-low---weak-oracle-result-staleness-check-in-stalecheck" id="markdown-toc-9-low---weak-oracle-result-staleness-check-in-stalecheck">9. Low - Weak oracle result staleness check in <code class="language-plaintext highlighter-rouge">staleCheck()</code></a>        <ol>
          <li><a href="#technical-details-15" id="markdown-toc-technical-details-15">Technical Details</a></li>
          <li><a href="#impact-15" id="markdown-toc-impact-15">Impact</a></li>
          <li><a href="#recommendation-15" id="markdown-toc-recommendation-15">Recommendation</a></li>
          <li><a href="#developer-response-15" id="markdown-toc-developer-response-15">Developer Response</a></li>
        </ol>
      </li>
      <li><a href="#10-low---no-mindeposit-in-gtranche" id="markdown-toc-10-low---no-mindeposit-in-gtranche">10. Low - No <code class="language-plaintext highlighter-rouge">minDeposit</code> in GTranche</a>        <ol>
          <li><a href="#technical-details-16" id="markdown-toc-technical-details-16">Technical Details</a></li>
          <li><a href="#impact-16" id="markdown-toc-impact-16">Impact</a></li>
          <li><a href="#recommendation-16" id="markdown-toc-recommendation-16">Recommendation</a></li>
          <li><a href="#developer-response-16" id="markdown-toc-developer-response-16">Developer Response</a></li>
        </ol>
      </li>
      <li><a href="#11-low---volatile-token-price-causes-higher-vault-fees" id="markdown-toc-11-low---volatile-token-price-causes-higher-vault-fees">11. Low - Volatile token price causes higher vault fees</a>        <ol>
          <li><a href="#technical-details-17" id="markdown-toc-technical-details-17">Technical Details</a></li>
          <li><a href="#impact-17" id="markdown-toc-impact-17">Impact</a></li>
          <li><a href="#recommendation-17" id="markdown-toc-recommendation-17">Recommendation</a></li>
          <li><a href="#developer-response-17" id="markdown-toc-developer-response-17">Developer Response</a></li>
        </ol>
      </li>
      <li><a href="#12-low---high-default-slippage-tolerance" id="markdown-toc-12-low---high-default-slippage-tolerance">12. Low - High default slippage tolerance</a>        <ol>
          <li><a href="#technical-details-18" id="markdown-toc-technical-details-18">Technical Details</a></li>
          <li><a href="#impact-18" id="markdown-toc-impact-18">Impact</a></li>
          <li><a href="#recommendation-18" id="markdown-toc-recommendation-18">Recommendation</a></li>
          <li><a href="#developer-response-18" id="markdown-toc-developer-response-18">Developer Response</a></li>
        </ol>
      </li>
    </ol>
  </li>
  <li><a href="#gas-savings-findings" id="markdown-toc-gas-savings-findings">Gas Savings Findings</a>    <ol>
      <li><a href="#1-gas---use-prefix-in-loops" id="markdown-toc-1-gas---use-prefix-in-loops">1. Gas - Use prefix in loops</a>        <ol>
          <li><a href="#technical-details-19" id="markdown-toc-technical-details-19">Technical Details</a></li>
          <li><a href="#impact-19" id="markdown-toc-impact-19">Impact</a></li>
          <li><a href="#recommendation-19" id="markdown-toc-recommendation-19">Recommendation</a></li>
          <li><a href="#developer-response-19" id="markdown-toc-developer-response-19">Developer Response</a></li>
        </ol>
      </li>
      <li><a href="#2-gas---unnecessary-zero-initializations" id="markdown-toc-2-gas---unnecessary-zero-initializations">2. Gas - Unnecessary zero initializations</a>        <ol>
          <li><a href="#technical-details-20" id="markdown-toc-technical-details-20">Technical Details</a></li>
          <li><a href="#impact-20" id="markdown-toc-impact-20">Impact</a></li>
          <li><a href="#recommendation-20" id="markdown-toc-recommendation-20">Recommendation</a></li>
          <li><a href="#developer-response-20" id="markdown-toc-developer-response-20">Developer Response</a></li>
        </ol>
      </li>
      <li><a href="#3-gas---use-simple-comparison" id="markdown-toc-3-gas---use-simple-comparison">3. Gas - Use simple comparison</a>        <ol>
          <li><a href="#technical-details-21" id="markdown-toc-technical-details-21">Technical Details</a></li>
          <li><a href="#impact-21" id="markdown-toc-impact-21">Impact</a></li>
          <li><a href="#recommendation-21" id="markdown-toc-recommendation-21">Recommendation</a></li>
          <li><a href="#developer-response-21" id="markdown-toc-developer-response-21">Developer Response</a></li>
        </ol>
      </li>
      <li><a href="#4-gas---remove-redundant-check" id="markdown-toc-4-gas---remove-redundant-check">4. Gas - Remove redundant check</a>        <ol>
          <li><a href="#technical-details-22" id="markdown-toc-technical-details-22">Technical Details</a></li>
          <li><a href="#impact-22" id="markdown-toc-impact-22">Impact</a></li>
          <li><a href="#recommendation-22" id="markdown-toc-recommendation-22">Recommendation</a></li>
          <li><a href="#developer-response-22" id="markdown-toc-developer-response-22">Developer Response</a></li>
        </ol>
      </li>
      <li><a href="#5-gas---use-solidity-errors-in-084" id="markdown-toc-5-gas---use-solidity-errors-in-084">5. Gas - Use Solidity errors in 0.8.4+</a>        <ol>
          <li><a href="#technical-details-23" id="markdown-toc-technical-details-23">Technical Details</a></li>
          <li><a href="#impact-23" id="markdown-toc-impact-23">Impact</a></li>
          <li><a href="#recommendation-23" id="markdown-toc-recommendation-23">Recommendation</a></li>
          <li><a href="#developer-response-23" id="markdown-toc-developer-response-23">Developer Response</a></li>
        </ol>
      </li>
      <li><a href="#6-gas---declare-variables-immutable-when-possible" id="markdown-toc-6-gas---declare-variables-immutable-when-possible">6. Gas - Declare variables immutable when possible</a>        <ol>
          <li><a href="#technical-details-24" id="markdown-toc-technical-details-24">Technical Details</a></li>
          <li><a href="#impact-24" id="markdown-toc-impact-24">Impact</a></li>
          <li><a href="#recommendation-24" id="markdown-toc-recommendation-24">Recommendation</a></li>
          <li><a href="#developer-response-24" id="markdown-toc-developer-response-24">Developer Response</a></li>
        </ol>
      </li>
      <li><a href="#7-gas---use-unchecked-if-no-underflow-risk" id="markdown-toc-7-gas---use-unchecked-if-no-underflow-risk">7. Gas - Use unchecked if no underflow risk</a>        <ol>
          <li><a href="#technical-details-25" id="markdown-toc-technical-details-25">Technical Details</a></li>
          <li><a href="#impact-25" id="markdown-toc-impact-25">Impact</a></li>
          <li><a href="#recommendation-25" id="markdown-toc-recommendation-25">Recommendation</a></li>
          <li><a href="#developer-response-25" id="markdown-toc-developer-response-25">Developer Response</a></li>
        </ol>
      </li>
    </ol>
  </li>
  <li><a href="#informational-findings" id="markdown-toc-informational-findings">Informational Findings</a>    <ol>
      <li><a href="#1-informational---unusual-mindeposit-choice" id="markdown-toc-1-informational---unusual-mindeposit-choice">1. Informational - Unusual <code class="language-plaintext highlighter-rouge">minDeposit</code> choice</a>        <ol>
          <li><a href="#technical-details-26" id="markdown-toc-technical-details-26">Technical Details</a></li>
          <li><a href="#impact-26" id="markdown-toc-impact-26">Impact</a></li>
          <li><a href="#recommendation-26" id="markdown-toc-recommendation-26">Recommendation</a></li>
          <li><a href="#developer-response-26" id="markdown-toc-developer-response-26">Developer Response</a></li>
        </ol>
      </li>
      <li><a href="#2-informational---fees-may-be-sent-to-address0" id="markdown-toc-2-informational---fees-may-be-sent-to-address0">2. Informational - Fees may be sent to address(0)</a>        <ol>
          <li><a href="#technical-details-27" id="markdown-toc-technical-details-27">Technical Details</a></li>
          <li><a href="#impact-27" id="markdown-toc-impact-27">Impact</a></li>
          <li><a href="#recommendation-27" id="markdown-toc-recommendation-27">Recommendation</a></li>
          <li><a href="#developer-response-27" id="markdown-toc-developer-response-27">Developer Response</a></li>
        </ol>
      </li>
      <li><a href="#3-informational---missing-_minamount-check-in-redeem" id="markdown-toc-3-informational---missing-_minamount-check-in-redeem">3. Informational - Missing <code class="language-plaintext highlighter-rouge">_minAmount</code> check in <code class="language-plaintext highlighter-rouge">redeem</code></a>        <ol>
          <li><a href="#technical-details-28" id="markdown-toc-technical-details-28">Technical Details</a></li>
          <li><a href="#impact-28" id="markdown-toc-impact-28">Impact</a></li>
          <li><a href="#recommendation-28" id="markdown-toc-recommendation-28">Recommendation</a></li>
          <li><a href="#developer-response-28" id="markdown-toc-developer-response-28">Developer Response</a></li>
        </ol>
      </li>
      <li><a href="#4-informational---_owner-argument-shadows-ownable-state-variable" id="markdown-toc-4-informational---_owner-argument-shadows-ownable-state-variable">4. Informational - <code class="language-plaintext highlighter-rouge">_owner</code> argument shadows Ownable state variable</a>        <ol>
          <li><a href="#technical-details-29" id="markdown-toc-technical-details-29">Technical Details</a></li>
          <li><a href="#impact-29" id="markdown-toc-impact-29">Impact</a></li>
          <li><a href="#recommendation-29" id="markdown-toc-recommendation-29">Recommendation</a></li>
          <li><a href="#developer-response-29" id="markdown-toc-developer-response-29">Developer Response</a></li>
        </ol>
      </li>
      <li><a href="#5-informational---junior-tranche-lacks-immediate-withdrawal-guarantees" id="markdown-toc-5-informational---junior-tranche-lacks-immediate-withdrawal-guarantees">5. Informational - Junior tranche lacks immediate withdrawal guarantees</a>        <ol>
          <li><a href="#technical-details-30" id="markdown-toc-technical-details-30">Technical Details</a></li>
          <li><a href="#impact-30" id="markdown-toc-impact-30">Impact</a></li>
          <li><a href="#recommendation-30" id="markdown-toc-recommendation-30">Recommendation</a></li>
          <li><a href="#developer-response-30" id="markdown-toc-developer-response-30">Developer Response</a></li>
        </ol>
      </li>
      <li><a href="#6-informational---change-call-sequence-for-reentrancy-mitigation" id="markdown-toc-6-informational---change-call-sequence-for-reentrancy-mitigation">6. Informational - Change call sequence for reentrancy mitigation</a>        <ol>
          <li><a href="#technical-details-31" id="markdown-toc-technical-details-31">Technical Details</a></li>
          <li><a href="#impact-31" id="markdown-toc-impact-31">Impact</a></li>
          <li><a href="#recommendation-31" id="markdown-toc-recommendation-31">Recommendation</a></li>
          <li><a href="#developer-response-31" id="markdown-toc-developer-response-31">Developer Response</a></li>
        </ol>
      </li>
      <li><a href="#7-informational---undocumented-assumption-of-private-gelato-mempool" id="markdown-toc-7-informational---undocumented-assumption-of-private-gelato-mempool">7. Informational - Undocumented assumption of private Gelato mempool</a>        <ol>
          <li><a href="#technical-details-32" id="markdown-toc-technical-details-32">Technical Details</a></li>
          <li><a href="#impact-32" id="markdown-toc-impact-32">Impact</a></li>
          <li><a href="#recommendation-32" id="markdown-toc-recommendation-32">Recommendation</a></li>
          <li><a href="#developer-response-32" id="markdown-toc-developer-response-32">Developer Response</a></li>
        </ol>
      </li>
      <li><a href="#8-informational---inconsistent-interface-files" id="markdown-toc-8-informational---inconsistent-interface-files">8. Informational - Inconsistent interface files</a>        <ol>
          <li><a href="#technical-details-33" id="markdown-toc-technical-details-33">Technical Details</a></li>
          <li><a href="#impact-33" id="markdown-toc-impact-33">Impact</a></li>
          <li><a href="#recommendation-33" id="markdown-toc-recommendation-33">Recommendation</a></li>
          <li><a href="#developer-response-33" id="markdown-toc-developer-response-33">Developer Response</a></li>
        </ol>
      </li>
      <li><a href="#9-informational---inconsistent-uniswap-array-indices" id="markdown-toc-9-informational---inconsistent-uniswap-array-indices">9. Informational - Inconsistent Uniswap array indices</a>        <ol>
          <li><a href="#technical-details-34" id="markdown-toc-technical-details-34">Technical Details</a></li>
          <li><a href="#impact-34" id="markdown-toc-impact-34">Impact</a></li>
          <li><a href="#recommendation-34" id="markdown-toc-recommendation-34">Recommendation</a></li>
          <li><a href="#developer-response-34" id="markdown-toc-developer-response-34">Developer Response</a></li>
        </ol>
      </li>
      <li><a href="#10-informational---_additionalrewardtokens-works-in-unexpected-way" id="markdown-toc-10-informational---_additionalrewardtokens-works-in-unexpected-way">10. Informational - <code class="language-plaintext highlighter-rouge">_additionalRewardTokens()</code> works in unexpected way</a>        <ol>
          <li><a href="#technical-details-35" id="markdown-toc-technical-details-35">Technical Details</a></li>
          <li><a href="#impact-35" id="markdown-toc-impact-35">Impact</a></li>
          <li><a href="#recommendation-35" id="markdown-toc-recommendation-35">Recommendation</a></li>
          <li><a href="#developer-response-35" id="markdown-toc-developer-response-35">Developer Response</a></li>
        </ol>
      </li>
      <li><a href="#11-informational---non-ideal-_selladditionalrewards-min-reward-limit" id="markdown-toc-11-informational---non-ideal-_selladditionalrewards-min-reward-limit">11. Informational - Non-ideal <code class="language-plaintext highlighter-rouge">_sellAdditionalRewards()</code> min reward limit</a>        <ol>
          <li><a href="#technical-details-36" id="markdown-toc-technical-details-36">Technical Details</a></li>
          <li><a href="#impact-36" id="markdown-toc-impact-36">Impact</a></li>
          <li><a href="#recommendation-36" id="markdown-toc-recommendation-36">Recommendation</a></li>
          <li><a href="#developer-response-36" id="markdown-toc-developer-response-36">Developer Response</a></li>
        </ol>
      </li>
      <li><a href="#12-informational---strategy-migration-logic-can-revert" id="markdown-toc-12-informational---strategy-migration-logic-can-revert">12. Informational - Strategy migration logic can revert</a>        <ol>
          <li><a href="#technical-details-37" id="markdown-toc-technical-details-37">Technical Details</a></li>
          <li><a href="#impact-37" id="markdown-toc-impact-37">Impact</a></li>
          <li><a href="#recommendation-37" id="markdown-toc-recommendation-37">Recommendation</a></li>
          <li><a href="#developer-response-37" id="markdown-toc-developer-response-37">Developer Response</a></li>
        </ol>
      </li>
      <li><a href="#13-informational---theoretical-casting-overflow" id="markdown-toc-13-informational---theoretical-casting-overflow">13. Informational - Theoretical casting overflow</a>        <ol>
          <li><a href="#technical-details-38" id="markdown-toc-technical-details-38">Technical Details</a></li>
          <li><a href="#impact-38" id="markdown-toc-impact-38">Impact</a></li>
          <li><a href="#recommendation-38" id="markdown-toc-recommendation-38">Recommendation</a></li>
          <li><a href="#developer-response-38" id="markdown-toc-developer-response-38">Developer Response</a></li>
        </ol>
      </li>
      <li><a href="#14-informational---differing-approach-to-keeper-role" id="markdown-toc-14-informational---differing-approach-to-keeper-role">14. Informational - Differing approach to keeper role</a>        <ol>
          <li><a href="#technical-details-39" id="markdown-toc-technical-details-39">Technical Details</a></li>
          <li><a href="#impact-39" id="markdown-toc-impact-39">Impact</a></li>
          <li><a href="#recommendation-39" id="markdown-toc-recommendation-39">Recommendation</a></li>
          <li><a href="#developer-response-39" id="markdown-toc-developer-response-39">Developer Response</a></li>
        </ol>
      </li>
      <li><a href="#15-informational---duplicate-strategies-possible-with-setstrategies" id="markdown-toc-15-informational---duplicate-strategies-possible-with-setstrategies">15. Informational - Duplicate strategies possible with <code class="language-plaintext highlighter-rouge">setStrategies()</code></a>        <ol>
          <li><a href="#technical-details-40" id="markdown-toc-technical-details-40">Technical Details</a></li>
          <li><a href="#impact-40" id="markdown-toc-impact-40">Impact</a></li>
          <li><a href="#recommendation-40" id="markdown-toc-recommendation-40">Recommendation</a></li>
          <li><a href="#developer-response-40" id="markdown-toc-developer-response-40">Developer Response</a></li>
        </ol>
      </li>
      <li><a href="#16-informational---unnecessary-erc4626-casting" id="markdown-toc-16-informational---unnecessary-erc4626-casting">16. Informational - Unnecessary ERC4626 casting</a>        <ol>
          <li><a href="#technical-details-41" id="markdown-toc-technical-details-41">Technical Details</a></li>
          <li><a href="#impact-41" id="markdown-toc-impact-41">Impact</a></li>
          <li><a href="#recommendation-41" id="markdown-toc-recommendation-41">Recommendation</a></li>
          <li><a href="#developer-response-41" id="markdown-toc-developer-response-41">Developer Response</a></li>
        </ol>
      </li>
      <li><a href="#17-informational---getswappingprice-doesnt-make-sense-with-single-strategy-and-vault" id="markdown-toc-17-informational---getswappingprice-doesnt-make-sense-with-single-strategy-and-vault">17. Informational - <code class="language-plaintext highlighter-rouge">getSwappingPrice()</code> doesn’t make sense with single strategy and vault</a>        <ol>
          <li><a href="#technical-details-42" id="markdown-toc-technical-details-42">Technical Details</a></li>
          <li><a href="#impact-42" id="markdown-toc-impact-42">Impact</a></li>
          <li><a href="#recommendation-42" id="markdown-toc-recommendation-42">Recommendation</a></li>
          <li><a href="#developer-response-42" id="markdown-toc-developer-response-42">Developer Response</a></li>
        </ol>
      </li>
      <li><a href="#18-informational---no-upper-limit-to-junior-tranche-leverage-or-fixed-yield" id="markdown-toc-18-informational---no-upper-limit-to-junior-tranche-leverage-or-fixed-yield">18. Informational - No upper limit to Junior Tranche leverage or fixed yield</a>        <ol>
          <li><a href="#technical-details-43" id="markdown-toc-technical-details-43">Technical Details</a></li>
          <li><a href="#impact-43" id="markdown-toc-impact-43">Impact</a></li>
          <li><a href="#recommendation-43" id="markdown-toc-recommendation-43">Recommendation</a></li>
          <li><a href="#developer-response-43" id="markdown-toc-developer-response-43">Developer Response</a></li>
        </ol>
      </li>
      <li><a href="#19-informational---multiple-migration-functions-increase-tranchebalances" id="markdown-toc-19-informational---multiple-migration-functions-increase-tranchebalances">19. Informational - Multiple migration functions increase <code class="language-plaintext highlighter-rouge">trancheBalances</code></a>        <ol>
          <li><a href="#technical-details-44" id="markdown-toc-technical-details-44">Technical Details</a></li>
          <li><a href="#impact-44" id="markdown-toc-impact-44">Impact</a></li>
          <li><a href="#recommendation-44" id="markdown-toc-recommendation-44">Recommendation</a></li>
          <li><a href="#developer-response-44" id="markdown-toc-developer-response-44">Developer Response</a></li>
        </ol>
      </li>
      <li><a href="#20-informational---unclear-redistribution-of-vault-fees" id="markdown-toc-20-informational---unclear-redistribution-of-vault-fees">20. Informational - Unclear redistribution of vault fees</a>        <ol>
          <li><a href="#technical-details-45" id="markdown-toc-technical-details-45">Technical Details</a></li>
          <li><a href="#impact-45" id="markdown-toc-impact-45">Impact</a></li>
          <li><a href="#recommendation-45" id="markdown-toc-recommendation-45">Recommendation</a></li>
          <li><a href="#developer-response-45" id="markdown-toc-developer-response-45">Developer Response</a></li>
        </ol>
      </li>
      <li><a href="#21-informational---tranche-tokens-not-compliant-with-erc4626" id="markdown-toc-21-informational---tranche-tokens-not-compliant-with-erc4626">21. Informational - Tranche tokens not compliant with ERC4626</a>        <ol>
          <li><a href="#technical-details-46" id="markdown-toc-technical-details-46">Technical Details</a></li>
          <li><a href="#impact-46" id="markdown-toc-impact-46">Impact</a></li>
          <li><a href="#recommendation-46" id="markdown-toc-recommendation-46">Recommendation</a></li>
          <li><a href="#developer-response-46" id="markdown-toc-developer-response-46">Developer Response</a></li>
        </ol>
      </li>
      <li><a href="#22-informational---silent-returns" id="markdown-toc-22-informational---silent-returns">22. Informational - Silent returns</a>        <ol>
          <li><a href="#technical-details-47" id="markdown-toc-technical-details-47">Technical Details</a></li>
          <li><a href="#impact-47" id="markdown-toc-impact-47">Impact</a></li>
          <li><a href="#recommendation-47" id="markdown-toc-recommendation-47">Recommendation</a></li>
          <li><a href="#developer-response-47" id="markdown-toc-developer-response-47">Developer Response</a></li>
        </ol>
      </li>
      <li><a href="#23-informational---minor-nitpicks" id="markdown-toc-23-informational---minor-nitpicks">23. Informational - Minor nitpicks</a>        <ol>
          <li><a href="#technical-details-48" id="markdown-toc-technical-details-48">Technical Details</a></li>
          <li><a href="#impact-48" id="markdown-toc-impact-48">Impact</a></li>
          <li><a href="#recommendation-48" id="markdown-toc-recommendation-48">Recommendation</a></li>
          <li><a href="#developer-response-48" id="markdown-toc-developer-response-48">Developer Response</a></li>
        </ol>
      </li>
    </ol>
  </li>
  <li><a href="#final-remarks" id="markdown-toc-final-remarks">Final remarks</a></li>
  <li><a href="#about-yacademy" id="markdown-toc-about-yacademy">About yAcademy</a></li>
</ol>
      <h2 id="review-summary">
        
        
          <a href="#review-summary" class="anchor-heading" aria-labelledby="review-summary"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Review Summary
        
        
      </h2>
    

<p><strong>Gro Protocol</strong></p>

<p>Gro Protocol is a stablecoin yield aggregator. The protocol uses a Junior Tranche and a Senior Tranche design to maximize yield in the Junior Tranche while providing asset protection in the Senior Tranche. The tranches will hold a basket of ERC4626 tokens, where the choice of tokens and weighting between them can be set by the creator of the vault. The vault invests the assets using a collection of strategies, which can allocated the assets into different protocols. Unlike some yield aggregators, the protocol does not require the strategies to remain “number go up”, so if losses are incurred by the Junior Tranche, the losses are distributed across the shareholders during the time of withdrawal. There is a keeper-triggered stop loss feature to provide a safeguard in the event of unexpected events.</p>

<p>The contracts of the Gro Protocol <a href="https://github.com/groLabs/GSquared-foundry">Repo</a> were reviewed over 14 days. The code was reviewed by 2 residents between December 19, 2022 and January 1, 2023. The repository was under active development during the review, but the review was limited to the latest commit at the start of the review. This was <a href="https://github.com/groLabs/GSquared-foundry/tree/f1831bdb353d4a0b3a8937087e1663f73b75e905">commit f1831bdb353d4a0b3a8937087e1663f73b75e905</a> for the Gro Protocol repo.</p>
      <h2 id="scope">
        
        
          <a href="#scope" class="anchor-heading" aria-labelledby="scope"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Scope
        
        
      </h2>
    

<p>The scope of the review consisted of all the contracts in the repo, excluding those that were not used by the protocol such as PnL.sol. This included several key subcomponents in the system, including:</p>
<ul>
  <li>GRouter.sol: used to simplify user interactions by handling asset conversions and deposits in a single transaction</li>
  <li>GVault.sol and ConvexStrategy.sol: Provide an ERC4626 token that generates yield</li>
  <li>GTranche.sol and PnLFixedRate.sol: Enables a Junior and Senior Tranche structure. The Senior Tranche offers asset value protection with fixed yield on the underlying USD asset value while the Junior Tranche offers leveraged yields.</li>
</ul>

<p>In the future, the goal is to allow different ERC4626 tokens to be deposited into the Gro Tranche system, but for this review only one specific ERC4626 token corresponding to a single GVault and strategy was examined. Similarly, while Gro Protocol could expand to other EVM-compatible chains in the future, only the Ethereum mainnet deployment was considered during this review. The end-to-end flow of value between the user holding stablecoins and the way that Gro provides this yield and protection involves many steps, so it is visualized below for easier understanding.</p>

<p><img src="../../assets/images/Gro/Gro-asset-flow.png" alt="Gro protocol asset flow" /></p>

<p>After the findings were presented to the Gro Protocol team, fixes were made and included in several PRs.</p>

<p>This review is a code review to identify potential vulnerabilities in the code. The reviewers did not investigate security practices or operational security and assumed that privileged accounts could be trusted. The reviewers did not evaluate the security of the code relative to a standard or specification. The review may not have identified all potential attack vectors or areas of vulnerability.</p>

<p>yAcademy and the residents make no warranties regarding the security of the code and do not warrant that the code is free from defects. yAcademy and the residents do not represent nor imply to third parties that the code has been audited nor that the code is free from defects. By deploying or using the code, Gro Protocol and users of the contracts agree to use the code at their own risk.</p>
      <h2 id="code-evaluation-matrix">
        
        
          <a href="#code-evaluation-matrix" class="anchor-heading" aria-labelledby="code-evaluation-matrix"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Code Evaluation Matrix
        
        
      </h2>
    

<div class="table-wrapper"><table>
  <thead>
    <tr>
      <th>Category</th>
      <th>Mark</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Access Control</td>
      <td>Average</td>
      <td>There are at least three privileged types of addresses (owner, keeper, whitelisted) in the protocol. Access controls appear to be applied properly, but adding privileged roles always creates the potential of an increased attack surface if one of these addresses is compromised or goes rogue.</td>
    </tr>
    <tr>
      <td>Mathematics</td>
      <td>Average</td>
      <td>The math in this protocol is primarily used for internal accounting, but there some casting operations between int256 values and uint256 values that could be problematic in some edge cases.</td>
    </tr>
    <tr>
      <td>Complexity</td>
      <td>Low</td>
      <td>The complexity of the system as a whole is quite high, with integration to at least 6 external protocols (Curve, Convex, Uniswap V2, Uniswap V3, Gelato, Chainlink) and a large amount of internal accounting math. The large number of token swaps and reliance on external protocols for pricing is an important part of the system, but not very simple to understand at the deepest levels. The built-in assumptions about how Gelato works that is not documented in Gelato’s documentation is an additional point of concern.</td>
    </tr>
    <tr>
      <td>Libraries</td>
      <td>Average</td>
      <td>OpenZeppelin and solmate libraries are used in this protocol. There is an average number of libraries and external dependencies used, which can add risk if there is a vulnerability found in the underlying library code or external interactions. Using OpenZeppelin and solmate together in a single project can sometimes cause a mismatch of features and functionality.</td>
    </tr>
    <tr>
      <td>Decentralization</td>
      <td>Average</td>
      <td>Like many protocols, the design of the Gro protocol enables migration for future upgrades and emergency functions for unexpected scenarios where market volatility is exceptionally high or an underlying DeFi lego block experiences problems. This design is double edged, as it provides additional benefits to users but at the risk of trusting the owner and other addresses that have elevated privileges to call specific functions (i.e., onlyOwner, onlyWhitelist, keeper).</td>
    </tr>
    <tr>
      <td>Code stability</td>
      <td>Average</td>
      <td>Part of the code base builds on existing code that has been audited and live in production for over a year. Other elements of the design have been implemented and tested by other protocols. The code base did not go through any changes during the audit.</td>
    </tr>
    <tr>
      <td>Documentation</td>
      <td>Good</td>
      <td>The documentation for the Gro protocol provided to the reviewers surpassed expectations. The documentation explained the system assumptions and requirements clearly. While there was an absence of good NatSpec comments in some places, the overall protocol documentation made up for this omission.</td>
    </tr>
    <tr>
      <td>Monitoring</td>
      <td>Good</td>
      <td>Events were consistently emitted for crucial functions that involved the flow of assets.</td>
    </tr>
    <tr>
      <td>Testing and verification</td>
      <td>Average</td>
      <td>Foundry and brownie tests exist for Gro. The foundry tests had good coverage for some of the most important contracts, but other contracts were near or below 70% code coverage. The coverage numbers in the Gro documentation did not exactly align to the latest coverage numbers. Coverage could be improved</td>
    </tr>
  </tbody>
</table></div>
      <h2 id="findings-explanation">
        
        
          <a href="#findings-explanation" class="anchor-heading" aria-labelledby="findings-explanation"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Findings Explanation
        
        
      </h2>
    

<p>Findings are broken down into sections by their respective impact:</p>
<ul>
  <li>Critical, High, Medium, Low impact
    <ul>
      <li>These are findings that range from attacks that may cause loss of funds, impact control/ownership of the contracts, or cause any unintended consequences/actions that are outside the scope of the requirements</li>
    </ul>
  </li>
  <li>Gas savings
    <ul>
      <li>Findings that can improve the gas efficiency of the contracts</li>
    </ul>
  </li>
  <li>Informational
    <ul>
      <li>Findings including recommendations and best practices</li>
    </ul>
  </li>
</ul><hr />
      <h2 id="critical-findings">
        
        
          <a href="#critical-findings" class="anchor-heading" aria-labelledby="critical-findings"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Critical Findings
        
        
      </h2>
    

<p>None.</p>
      <h2 id="high-findings">
        
        
          <a href="#high-findings" class="anchor-heading" aria-labelledby="high-findings"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> High Findings
        
        
      </h2>
    
      <h3 id="1-high---underflow-in-int256---uint256-conversion">
        
        
          <a href="#1-high---underflow-in-int256---uint256-conversion" class="anchor-heading" aria-labelledby="1-high---underflow-in-int256---uint256-conversion"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 1. High - Underflow in int256 -&gt; uint256 conversion
        
        
      </h3>
    

<p>SafeMath does not apply to casting. Casting happens between uint256 and int256 values which can lead to a problematic underflow.</p>
      <h4 id="technical-details">
        
        
          <a href="#technical-details" class="anchor-heading" aria-labelledby="technical-details"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Technical Details
        
        
      </h4>
    

<p>In GTranche.sol, <a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/GTranche.sol#L331"><code class="language-plaintext highlighter-rouge">pnlDistribution()</code></a> and <a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/GTranche.sol#L367"><code class="language-plaintext highlighter-rouge">_pnlDistribution()</code></a> calculate the new <code class="language-plaintext highlighter-rouge">_trancheBalances</code> in int256 values before casting them to uint256 when storing in the return variables. This final casting will cause an underflow if the int256 value <code class="language-plaintext highlighter-rouge">_trancheBalances</code> is negative. For example:</p>
<ol>
  <li>Assume a scenario where the Junior Tranche is permitted 50x leverage, so the Senior Tranche has 5000 wei and the Junior Tranche has 100 wei (root causes include: no minimum deposit in the tranche, no limit on the leverage allowed, no limit on the fixed yield paid to the Senior Tranche)</li>
  <li>If the PnL distribution is not done in a long time, it is possible that the <code class="language-plaintext highlighter-rouge">seniorProfit</code> owed to the Senior Tranche will be greater than 100 wei. This needs to be paid to the Senior Tranche even if the profit of the tranche is zero (if <code class="language-plaintext highlighter-rouge">lastTotal &lt;= totalValue</code> then <code class="language-plaintext highlighter-rouge">distributeProfit()</code> <a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/GTranche.sol#L353-L361">will be triggered</a>).</li>
  <li><code class="language-plaintext highlighter-rouge">distributeLoss()</code> prevents <code class="language-plaintext highlighter-rouge">loss[0]</code> from holding a value that is greater than <code class="language-plaintext highlighter-rouge">_trancheBalances[0]</code>, which would <a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/GTranche.sol#L351">cause a negative <code class="language-plaintext highlighter-rouge">_trancheBalances[0]</code> after this subtraction</a> and would later underflow. In contrast, <code class="language-plaintext highlighter-rouge">distributeProfit()</code> has no similar check and there is <a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/pnl/PnLFixedRate.sol#L155-L156">even a comment stating that the profit to the Junior Tranche can be negative</a>, which would make it similar to a loss scenario for this tranche. If the value of <code class="language-plaintext highlighter-rouge">-1 * (_amount - seniorProfit)</code> is greater than <code class="language-plaintext highlighter-rouge">_trancheBalances[0]</code>, then <a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/GTranche.sol#L359">the addition operation</a> will actually become a subtraction and result in <code class="language-plaintext highlighter-rouge">_trancheBalances[0]</code> holding a negative value, which <a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/GTranche.sol#L362">would underflow in a later casting</a>.</li>
</ol>

<p>The same underflow issue may theoretically occur with <code class="language-plaintext highlighter-rouge">distributeLoss()</code> if <code class="language-plaintext highlighter-rouge">_amount - _trancheBalances[0] &gt; _trancheBalances[1]</code>. This might be possible in a tranche setup where nearly all the deposits are in the Junior Tranche so the utilization ratio is nearly zero, but an accounting error causes the losses to be greater than the total tranche assets. This scenario seems unlikely but still may be worth protecting against.</p>
      <h4 id="impact">
        
        
          <a href="#impact" class="anchor-heading" aria-labelledby="impact"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Impact
        
        
      </h4>
    

<p>High. An underflow in the internal PnL accounting that causes the balance of the Junior Tranche to become extremely large would allow for almost infinite deposits into the Senior Tranche, even though there are not sufficient real assets in the Junior Tranche to protect these deposits.</p>
      <h4 id="recommendation">
        
        
          <a href="#recommendation" class="anchor-heading" aria-labelledby="recommendation"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Recommendation
        
        
      </h4>
    

<p>In this specific case, it is sufficient to confirm that <code class="language-plaintext highlighter-rouge">_trancheBalances[0] + (_amount - seniorProfit) &gt; 0</code> <a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/GTranche.sol#L359">before this line</a>. In general, it is best to use OpenZeppelin SafeCast, solmate SafeCastLib, or implement a similar form of over/underflow avoidance in GTranche.sol and other parts of Gro that convert between int256 and uint256.</p>
      <h4 id="developer-response">
        
        
          <a href="#developer-response" class="anchor-heading" aria-labelledby="developer-response"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Developer Response
        
        
      </h4>
    

<p>Acknowledged, fixed in <a href="https://github.com/groLabs/GSquared/pull/62">#62</a> and discussed in <a href="https://github.com/groLabs/GSquared/issues/2">#2</a>.</p>
      <h2 id="medium-findings">
        
        
          <a href="#medium-findings" class="anchor-heading" aria-labelledby="medium-findings"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Medium Findings
        
        
      </h2>
    
      <h3 id="1-medium---sellallrewards-reverts-with-non-zero-numberofrewards">
        
        
          <a href="#1-medium---sellallrewards-reverts-with-non-zero-numberofrewards" class="anchor-heading" aria-labelledby="1-medium---sellallrewards-reverts-with-non-zero-numberofrewards"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 1. Medium - <code class="language-plaintext highlighter-rouge">sellAllRewards()</code> reverts with non-zero <code class="language-plaintext highlighter-rouge">numberOfRewards</code>
        
        
      </h3>
    

<p>The additional reward tokens are never approved for the Uniswap V2 router, so the Uniswap V2 <code class="language-plaintext highlighter-rouge">swapExactTokensForTokens()</code> call will revert.</p>
      <h4 id="technical-details-1">
        
        
          <a href="#technical-details-1" class="anchor-heading" aria-labelledby="technical-details-1"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Technical Details
        
        
      </h4>
    

<p>The <code class="language-plaintext highlighter-rouge">swapExactTokensForTokens()</code> function in Uniswap V2 Router <a href="https://github.com/Uniswap/v2-periphery/blob/0335e8f7e1bd1e8d8329fd300aea2ef2f36dd19f/contracts/UniswapV2Router02.sol#L233">has a <code class="language-plaintext highlighter-rouge">safeTransferFrom()</code> call</a>. The address calling the Uniswap V2 router must approve the tokens for the Router before calling this function, otherwise the function will revert. The ConvexStrategy fails to approve additional reward tokens before calling Uniswap V2.</p>
      <h4 id="impact-1">
        
        
          <a href="#impact-1" class="anchor-heading" aria-labelledby="impact-1"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Impact
        
        
      </h4>
    

<p>Medium. Important functions will revert if there are any reward tokens.</p>
      <h4 id="recommendation-1">
        
        
          <a href="#recommendation-1" class="anchor-heading" aria-labelledby="recommendation-1"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Recommendation
        
        
      </h4>
    

<p><a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/strategy/ConvexStrategy.sol#L410">In <code class="language-plaintext highlighter-rouge">setAdditionalRewards()</code></a>, make two changes:</p>
<ol>
  <li>Before the existing <code class="language-plaintext highlighter-rouge">rewardTokens</code> array is deleted, set the approval for all tokens to zero</li>
  <li>In the for loop where the <code class="language-plaintext highlighter-rouge">rewardTokens</code> array is populated, set an infinite approval for this token to the Uniswap V2 Router</li>
</ol>
      <h4 id="developer-response-1">
        
        
          <a href="#developer-response-1" class="anchor-heading" aria-labelledby="developer-response-1"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Developer Response
        
        
      </h4>
    

<p>Acknowledged, fixed in <a href="https://github.com/groLabs/GSquared/pull/52">#52</a> and discussed in <a href="https://github.com/groLabs/GSquared/issues/3">#3</a>.</p>
      <h3 id="2-medium---wethamount-in-rewards-calculations-should-be-balanceof">
        
        
          <a href="#2-medium---wethamount-in-rewards-calculations-should-be-balanceof" class="anchor-heading" aria-labelledby="2-medium---wethamount-in-rewards-calculations-should-be-balanceof"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 2. Medium - <code class="language-plaintext highlighter-rouge">wethAmount</code> in rewards calculations should be balanceOf
        
        
      </h3>
    

<p><code class="language-plaintext highlighter-rouge">_sellRewards()</code> sells reward tokens to WETH, then converts the WETH to USDC to reinvest into 3CRV. The current logic could result in WETH building up in the strategy over time without getting converted into 3CRV, resulting in a lost yield opportunity for depositors.</p>
      <h4 id="technical-details-2">
        
        
          <a href="#technical-details-2" class="anchor-heading" aria-labelledby="technical-details-2"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Technical Details
        
        
      </h4>
    

<p>When <code class="language-plaintext highlighter-rouge">_sellRewards()</code> calculates the rewards that can be reinvested into 3CRV, it starts calculating with a <code class="language-plaintext highlighter-rouge">wethAmount</code> of zero. However, the minimum amount for converting CRV rewards or CVX rewards to ETH is <a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/strategy/ConvexStrategy.sol#L633">1E18 of CRV or CVX</a>, while the minimum amount <a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/strategy/ConvexStrategy.sol#L654">for converting ETH to 3CRV is 1E16 ETH</a>. Assuming the current prices of $1200 WETH, $0.5 CRV, and $3.50 CVX, it is possible for a scenario where $11 worth of CRV and CVX is converted into WETH, but because the 1E16 threshold for converting WETH to 3CRV is $12, the WETH will not be converted into 3CRV. If this case happens many times, substantial WETH could accumulate in the strategy without getting reinvested to earn more yield.</p>
      <h4 id="impact-2">
        
        
          <a href="#impact-2" class="anchor-heading" aria-labelledby="impact-2"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Impact
        
        
      </h4>
    

<p>Medium. WETH could accumulate in the contract over time without getting reinvested. The current contract would allow the owner could sweep and reinvest manually, but if this process is not automated it can result in lost yield for users.</p>
      <h4 id="recommendation-2">
        
        
          <a href="#recommendation-2" class="anchor-heading" aria-labelledby="recommendation-2"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Recommendation
        
        
      </h4>
    

<p>Consider removing <code class="language-plaintext highlighter-rouge">wethAmount</code> in <code class="language-plaintext highlighter-rouge">_sellRewards()</code> completely and instead reference the current WETH balance in the strategy <a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/strategy/ConvexStrategy.sol#L654">when determining if WETH should be swapped and reinvested</a>:</p>
<div class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gd">- if (wethAmount &gt; MIN_WETH_SELL_AMOUNT) {
</span><span class="gi">+ if (IERC20(WETH).balanceOf(address(this)) &gt; MIN_WETH_SELL_AMOUNT) {
</span></code></pre></div></div>
      <h4 id="developer-response-2">
        
        
          <a href="#developer-response-2" class="anchor-heading" aria-labelledby="developer-response-2"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Developer Response
        
        
      </h4>
    

<p>Acknowledged, fixed in <a href="https://github.com/groLabs/GSquared/pull/54">#54</a> and discussed in <a href="https://github.com/groLabs/GSquared/issues/5">#5</a>.</p>
      <h3 id="3-medium---tranche-depositwithdrawal-denial-of-service">
        
        
          <a href="#3-medium---tranche-depositwithdrawal-denial-of-service" class="anchor-heading" aria-labelledby="3-medium---tranche-depositwithdrawal-denial-of-service"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 3. Medium - Tranche deposit/withdrawal denial of service
        
        
      </h3>
    

<p>It is possible for the utilisation ratio of the two tranches to be greater than <code class="language-plaintext highlighter-rouge">utilisationThreshold</code>. If this scenario occurs and a user wishes to withdraw or deposit to a tranche with an amount that does not bring the tranches back under the <code class="language-plaintext highlighter-rouge">utilisationThreshold</code>, this can result in a denial of service for most users where a single whale-sized deposit or withdrawal must happen in order to bring the utilisation ratio below <code class="language-plaintext highlighter-rouge">utilisationThreshold</code>.</p>
      <h4 id="technical-details-3">
        
        
          <a href="#technical-details-3" class="anchor-heading" aria-labelledby="technical-details-3"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Technical Details
        
        
      </h4>
    

<p>The current code is written in a way that assumes the utilisation ratio remains below the <code class="language-plaintext highlighter-rouge">utilisationThreshold</code> unless a deposit or withdrawal will move it above the threshold. In fact, the utilisation ratio can achieve a value greater than <code class="language-plaintext highlighter-rouge">utilisationThreshold</code> in a couple of ways:</p>
<ol>
  <li>The owner can set <code class="language-plaintext highlighter-rouge">utilisationThreshold</code> to any value with <a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/GTranche.sol#L133"><code class="language-plaintext highlighter-rouge">setUtilizationThreshold()</code></a>. If the threshold is set to a value less than the current utilisation ratio, it can break assumptions about how the protocol should work and prevent tranche deposits or withdrawals.</li>
  <li>Losses for the Junior Tranche may result in a scenario where the utilisation ratio exceeds the <code class="language-plaintext highlighter-rouge">utilisationThreshold</code>. Note that the Junior tranche can experience a loss even when <code class="language-plaintext highlighter-rouge">distributeProfit()</code> is called because the yield paid to the Senior Tranche depositors may exceed the profit earned.</li>
</ol>

<p>If the utilisation ratio exceeds the <code class="language-plaintext highlighter-rouge">utilisationThreshold</code>, a GTranche <code class="language-plaintext highlighter-rouge">deposit()</code> or <code class="language-plaintext highlighter-rouge">withdraw()</code> that attempts to move the utilisation ratio in the correct direction may revert if it does not bring the ratio below <code class="language-plaintext highlighter-rouge">utilisationThreshold</code>. This behaviour breaks an assumption in the protocol documentation that such actions should always be allowed.</p>
      <h4 id="impact-3">
        
        
          <a href="#impact-3" class="anchor-heading" aria-labelledby="impact-3"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Impact
        
        
      </h4>
    

<p>Medium. The tranche design requires the Junior Tranche to always allow deposits and Senior Tranche should always allow withdrawals, but these requirements can be broken in edge cases.</p>
      <h4 id="recommendation-3">
        
        
          <a href="#recommendation-3" class="anchor-heading" aria-labelledby="recommendation-3"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Recommendation
        
        
      </h4>
    

<p>Allow GTranche <code class="language-plaintext highlighter-rouge">deposit()</code> and <code class="language-plaintext highlighter-rouge">withdrawal()</code> to happen even if <code class="language-plaintext highlighter-rouge">trancheUtilization &gt; utilisationThreshold</code>. If <code class="language-plaintext highlighter-rouge">trancheUtilization &gt; utilisationThreshold</code>, then the <code class="language-plaintext highlighter-rouge">trancheUtilization</code> should be reduced as a result of the deposit or withdrawal action when compared to the value of <code class="language-plaintext highlighter-rouge">trancheUtilization</code> before the deposit or withdrawal so that the <code class="language-plaintext highlighter-rouge">trancheUtilization</code> is changed in a directionally correct manner.</p>
      <h4 id="developer-response-3">
        
        
          <a href="#developer-response-3" class="anchor-heading" aria-labelledby="developer-response-3"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Developer Response
        
        
      </h4>
    

<p>Acknowledged, won’t fix.</p>
<ol>
  <li>Owner is a trusted party and therefore is not expected to set the <code class="language-plaintext highlighter-rouge">utilisationThreshold</code> in this way.</li>
  <li>This is acknowledged as part of the design and is not considered an issue.</li>
</ol>

<p>Addressed in <a href="https://github.com/groLabs/GSquared/issues/6">#6</a>.</p>
      <h3 id="4-medium---unreliable-senior-tranche-yield">
        
        
          <a href="#4-medium---unreliable-senior-tranche-yield" class="anchor-heading" aria-labelledby="4-medium---unreliable-senior-tranche-yield"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 4. Medium - Unreliable Senior Tranche yield
        
        
      </h3>
    

<p>The Senior Tranche is designed to earn a fixed amount of yield. This yield is not always accounted for in the PnL calculations.</p>
      <h4 id="technical-details-4">
        
        
          <a href="#technical-details-4" class="anchor-heading" aria-labelledby="technical-details-4"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Technical Details
        
        
      </h4>
    

<p>PnLFixedRate.sol does not account for <code class="language-plaintext highlighter-rouge">seniorProfit</code> in two cases:</p>
<ol>
  <li>In <code class="language-plaintext highlighter-rouge">distributeLoss()</code> when the loss is greater than or equal to the value of the Junior Tranche and could cause losses for the Senior Tranche</li>
  <li>In <code class="language-plaintext highlighter-rouge">distributeProfit()</code> when the utilisation ratio is greater than <code class="language-plaintext highlighter-rouge">utilisationThreshold</code></li>
</ol>
      <h4 id="impact-4">
        
        
          <a href="#impact-4" class="anchor-heading" aria-labelledby="impact-4"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Impact
        
        
      </h4>
    

<p>Medium. The PnLFixedRate.sol calculations do not account for <code class="language-plaintext highlighter-rouge">seniorProfit</code> in less common edge cases.</p>
      <h4 id="recommendation-4">
        
        
          <a href="#recommendation-4" class="anchor-heading" aria-labelledby="recommendation-4"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Recommendation
        
        
      </h4>
    

<p>The amount <code class="language-plaintext highlighter-rouge">seniorProfit</code> should likely be summed into <code class="language-plaintext highlighter-rouge">loss[1]</code> or <code class="language-plaintext highlighter-rouge">profit[1]</code> respectively. Otherwise, when <code class="language-plaintext highlighter-rouge">distributeAssets()</code> is called and <code class="language-plaintext highlighter-rouge">fixedRate.lastDistribution</code> is updated without the <code class="language-plaintext highlighter-rouge">seniorProfit</code> getting added to either tranche, users who deposited into the Senior Tranche will lose out on the yield they should have received since the previous distribution.</p>
      <h4 id="developer-response-4">
        
        
          <a href="#developer-response-4" class="anchor-heading" aria-labelledby="developer-response-4"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Developer Response
        
        
      </h4>
    

<p>Acknowledged, won’t fix. By design, senior tranche assets are only protected by the value of junior tranche assets. A highly leveraged tranche structure can lead to greater risk to senior tranche assets. Addressed in <a href="https://github.com/groLabs/GSquared/issues/7">#7</a>.</p>
      <h3 id="5-medium---timing-mismatch-between-time-gated-actions">
        
        
          <a href="#5-medium---timing-mismatch-between-time-gated-actions" class="anchor-heading" aria-labelledby="5-medium---timing-mismatch-between-time-gated-actions"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 5. Medium - Timing mismatch between time-gated actions
        
        
      </h3>
    

<p><code class="language-plaintext highlighter-rouge">_calculateLockedProfit()</code> uses a 24 hour interval <code class="language-plaintext highlighter-rouge">releaseTime</code> to release profits to the vault. In contrast, the <code class="language-plaintext highlighter-rouge">lockedProfit</code> amount is only updated when <code class="language-plaintext highlighter-rouge">report()</code> is called by the strategy which has a <code class="language-plaintext highlighter-rouge">MIN_REPORT_DELAY</code> value of 48 hours.</p>
      <h4 id="technical-details-5">
        
        
          <a href="#technical-details-5" class="anchor-heading" aria-labelledby="technical-details-5"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Technical Details
        
        
      </h4>
    

<p><a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/GVault.sol#L756"><code class="language-plaintext highlighter-rouge">_calculateLockedProfit()</code> is designed to slowly release profits</a> to the GVault depositors. If the <code class="language-plaintext highlighter-rouge">releaseTime</code> is surpassed, <a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/GVault.sol#L121">which is 24 hours</a>, it returns zero, which means no profit is locked. The <code class="language-plaintext highlighter-rouge">lockedProfit</code> value is updated when <code class="language-plaintext highlighter-rouge">report()</code> in GVault is called by a strategy’s <code class="language-plaintext highlighter-rouge">runHarvest()</code>. ConvexStrategy’s <code class="language-plaintext highlighter-rouge">canHarvest()</code>, which indicates when a keeper can call <code class="language-plaintext highlighter-rouge">runHarvest()</code>, has a constant <a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/strategy/ConvexStrategy.sol#L193"><code class="language-plaintext highlighter-rouge">MIN_REPORT_DELAY</code> value of 48 hours</a>. This means that if <code class="language-plaintext highlighter-rouge">MIN_REPORT_DELAY</code> is the determining factor for when a harvest happens, <code class="language-plaintext highlighter-rouge">_calculateLockedProfit()</code> will return zero for roughly half of that minimum time period. During the time that <code class="language-plaintext highlighter-rouge">_calculateLockedProfit()</code> returns zero, the profit calculation in PnLFixedRate of <code class="language-plaintext highlighter-rouge">totalValue - lastTotal</code> will return zero. This will causes the Senior Tranche to take value from the Junior Tranche to pay the fixed yield of the Senior Tranche.</p>

<p>An example of how this could be leveraged to cause a loss for Junior Tranche holders:</p>
<ol>
  <li>Depositor deposits 3CRV into the GVault</li>
  <li>The GVault does not move 3CRV to the strategy until <code class="language-plaintext highlighter-rouge">report()</code> is called by a strategy, so the assets may not maximize their yield for some time</li>
  <li>Depositor deposits their GVault ERC4626 tokens into the Senior Tranche and soon withdraws. The deposit and withdrawal may both be done in a short period (say, 24 hours) while <code class="language-plaintext highlighter-rouge">_calculateLockedProfit()</code> is returning zero. This means before <code class="language-plaintext highlighter-rouge">report()</code> will not have been called to deposit the loose 3CRV in the GVault to maximize yield, yet the depositor claims their fixed yield from the Senior Tranche at the cost of Junior Tranche depositors, who don’t reap the full benefits of the 3CRV deposit into the GVault.</li>
</ol>

<p>If the above actions are performed frequently with large amounts of capital, say twice a week, the Junior Tranche may be less appealing for depositors. This is because the Junior Tranche is willing to pay the Senior Tranche the borrowing cost for leverage, but this cost makes more sense if the Junior Tranche is able to use the 3CRV in the strategy and not when it is sitting idle in the GVault. This scenario would get worse if the tranche had a large utilization ratio, say 10x, because the fee paid to the Senior Tranche would be larger. The flip side of this is that Junior Tranche depositors would be incentivized to withdraw their deposits during the time when <code class="language-plaintext highlighter-rouge">_calculateLockedProfit()</code> returns zero for the same reason.</p>
      <h4 id="impact-5">
        
        
          <a href="#impact-5" class="anchor-heading" aria-labelledby="impact-5"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Impact
        
        
      </h4>
    

<p>Medium. Many withdrawals from the Senior Tranche may extract substantial value from the Junior Tranche when <code class="language-plaintext highlighter-rouge">_calculateLockedProfit()</code> returns zero.</p>
      <h4 id="recommendation-5">
        
        
          <a href="#recommendation-5" class="anchor-heading" aria-labelledby="recommendation-5"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Recommendation
        
        
      </h4>
    

<p>Consider requiring strategies to use the same <code class="language-plaintext highlighter-rouge">MIN_REPORT_DELAY</code> value as the GVault’s <code class="language-plaintext highlighter-rouge">releaseTime</code>. Other redesigns should be considered as well to minimize the time when <code class="language-plaintext highlighter-rouge">_calculateLockedProfit()</code> returns zero.</p>
      <h4 id="developer-response-5">
        
        
          <a href="#developer-response-5" class="anchor-heading" aria-labelledby="developer-response-5"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Developer Response
        
        
      </h4>
    

<p>Acknowledged, will fix in later release. Addressed in <a href="https://github.com/groLabs/GSquared/issues/8">#8</a>.</p>
      <h3 id="6-medium---whale-invest-and-divest-denial-of-service-dos">
        
        
          <a href="#6-medium---whale-invest-and-divest-denial-of-service-dos" class="anchor-heading" aria-labelledby="6-medium---whale-invest-and-divest-denial-of-service-dos"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 6. Medium - Whale <code class="language-plaintext highlighter-rouge">invest()</code> and <code class="language-plaintext highlighter-rouge">divest()</code> denial of service (DoS)
        
        
      </h3>
    

<p>If a whale deposits a large enough amount of 3CRV into the GVault, ConvexStrategy may not be able to deposit the large amount into the Curve metapool without substantial slippage. This can cause <code class="language-plaintext highlighter-rouge">invest()</code> in ConvexStrategy to revert and block the strategy’s harvesting from operating properly. The same could happen with <code class="language-plaintext highlighter-rouge">divest()</code>, but would require the whale creating an imbalance in the Curve pool outside of Gro, which is likely an unprofitable approach.</p>
      <h4 id="technical-details-6">
        
        
          <a href="#technical-details-6" class="anchor-heading" aria-labelledby="technical-details-6"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Technical Details
        
        
      </h4>
    

<p>A whale may deposit an extremely large amount of 3CRV into GVault. When the GVault provides this 3CRV to ConvexStrategy to invest, the <code class="language-plaintext highlighter-rouge">invest()</code> function makes sure that the liquidity added to the metapool is within proper slippage tolerance. If the Curve pool is imbalanced sufficiently by the added liquidity, it may not return sufficient value and <a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/strategy/ConvexStrategy.sol#L898">cause <code class="language-plaintext highlighter-rouge">invest()</code> to revert</a> due to the slippage exceeding the slippage tolerance. This denial of service would not cost the whale much to sustain the DoS because they could deposit the GVault tokens into the Senior Tranche (at least until the utilization ratio is met) and receive their fixed yield, even though the Junior Tranche is not receiving its yield because the strategy’s harvesting mechanism is locked up. In theory this could lead to bankrupting the Junior Tranche if carried out for long enough because the whale’s deposit can’t be deposited into the metapool to maximize rewards, like the “leach attack” described in a separate finding.</p>

<p><code class="language-plaintext highlighter-rouge">divest()</code> has a similar slippage check that may also revert under some conditions. Since users cannot control when divest happens, the whale would need to imbalance the pool outside of Gro. This DoS is likely far more costly than the <code class="language-plaintext highlighter-rouge">invest()</code> DoS vector because imbalancing the Curve pool would most likely create and arbitrage opportunity.</p>
      <h4 id="impact-6">
        
        
          <a href="#impact-6" class="anchor-heading" aria-labelledby="impact-6"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Impact
        
        
      </h4>
    

<p>Medium. Denial of Service of a key function in the protocol could happen and there does not appear to be a simple way to resolve the situation.</p>
      <h4 id="recommendation-6">
        
        
          <a href="#recommendation-6" class="anchor-heading" aria-labelledby="recommendation-6"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Recommendation
        
        
      </h4>
    

<p>Modify <code class="language-plaintext highlighter-rouge">invest()</code> to avoid a revert in this case of a whale deposit. For instance, <code class="language-plaintext highlighter-rouge">invest()</code> could calculate the maximum assets that could be deposited into the metapool within slippage limits and then deposit that amount. Alternatively, set an owner controlled max cap on the total assets value than the GVault can receive in <code class="language-plaintext highlighter-rouge">deposit()</code> to add one layer of prevention for this edge case.</p>
      <h4 id="developer-response-6">
        
        
          <a href="#developer-response-6" class="anchor-heading" aria-labelledby="developer-response-6"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Developer Response
        
        
      </h4>
    

<p>Acknowledged, will fix in <a href="https://github.com/groLabs/GSquared/issues/9">#9</a>.</p>
      <h2 id="low-findings">
        
        
          <a href="#low-findings" class="anchor-heading" aria-labelledby="low-findings"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Low Findings
        
        
      </h2>
    
      <h3 id="1-low---strategy-migration-should-remove-old-approvals">
        
        
          <a href="#1-low---strategy-migration-should-remove-old-approvals" class="anchor-heading" aria-labelledby="1-low---strategy-migration-should-remove-old-approvals"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 1. Low - Strategy migration should remove old approvals
        
        
      </h3>
    

<p>ConvexStrategy has logic to migrate to a new metapool and LP token with <code class="language-plaintext highlighter-rouge">setPool()</code>. Before the migration sets an infinite approval for the metapool and LP token, the old metapool and LP token that are no longer used should have the existing approval removed for the safety of deposited assets.</p>
      <h4 id="technical-details-7">
        
        
          <a href="#technical-details-7" class="anchor-heading" aria-labelledby="technical-details-7"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Technical Details
        
        
      </h4>
    

<p><code class="language-plaintext highlighter-rouge">setPool()</code> in ConvexStrategy.sol <a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/strategy/ConvexStrategy.sol#L1040-L1043">gives a new metaPool infinite approval</a>. But when this happens, the old metapool (if one was previously set) does not have its infinite approval revoked. If the old metapool had a security issue, the inability to revoke the prior approval could be problematic and would require emergency mode activation which would not be required if the approval could be revoked. The same process should take place to remove the <code class="language-plaintext highlighter-rouge">BOOSTER</code> approval of the old LP token.</p>
      <h4 id="impact-7">
        
        
          <a href="#impact-7" class="anchor-heading" aria-labelledby="impact-7"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Impact
        
        
      </h4>
    

<p>Low. Infinite approval of old metapool is not revoked when metapool is changed.</p>
      <h4 id="recommendation-7">
        
        
          <a href="#recommendation-7" class="anchor-heading" aria-labelledby="recommendation-7"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Recommendation
        
        
      </h4>
    

<p>Revoke the approval to the <code class="language-plaintext highlighter-rouge">newMetaPool</code> address <a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/strategy/ConvexStrategy.sol#L1040">before the state variable is modified</a> to hold the new metapool address. Consider removing the <code class="language-plaintext highlighter-rouge">BOOSTER</code>’s approval of the prior <code class="language-plaintext highlighter-rouge">newLpToken</code> token before <a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/strategy/ConvexStrategy.sol#L1037">that state variable is updated</a>.</p>
      <h4 id="developer-response-7">
        
        
          <a href="#developer-response-7" class="anchor-heading" aria-labelledby="developer-response-7"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Developer Response
        
        
      </h4>
    

<p>Acknowledged, fixed in <a href="https://github.com/groLabs/GSquared/pull/55">#55</a> and discussed in <a href="https://github.com/groLabs/GSquared/issues/10">#10</a>.</p>
      <h3 id="2-low---inconsistent-erc20-imports">
        
        
          <a href="#2-low---inconsistent-erc20-imports" class="anchor-heading" aria-labelledby="2-low---inconsistent-erc20-imports"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 2. Low - Inconsistent ERC20 imports
        
        
      </h3>
    

<p>GVault, GRouter, and GMigration import the ERC20 library from solmate, while other contracts like ConvexStrategy and GToken import the ERC20 library from OpenZeppelin. This can cause incompatibilities or unexpected edge cases because the OpenZeppelin ERC20 library does not include EIP-2612 <code class="language-plaintext highlighter-rouge">permit()</code>.</p>
      <h4 id="technical-details-8">
        
        
          <a href="#technical-details-8" class="anchor-heading" aria-labelledby="technical-details-8"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Technical Details
        
        
      </h4>
    

<p>One example showing the mixup between the OpenZeppelin and solmate ERC20 libraries is in IGVault and GVault. IGVault imports IERC20 from OpenZeppelin while GVault imports ERC20 from solmate. The solmate ERC20 library <a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/solmate/src/tokens/ERC20.sol#L130-L132">has EIP-2612 support</a> while OpenZeppelin does not include such logic in the default ERC20 file and instead packages it in the file draft-ERC20Permit.sol.</p>

<p>The way the code is currently written may be confusing for protocols integrating with Gro Protocol because The GVault ERC4626 token will support EIP-2612 but the GToken (and therefore the JuniorTranche and SeniorTranche) will not. Because the tranche is intended to be a wrapper for the GVault ERC4626, which does support <code class="language-plaintext highlighter-rouge">permit()</code>, this is not ideal because the tranche wrapper does not support <code class="language-plaintext highlighter-rouge">permit()</code> like the GVault ERC4626. The below slither commands can be used to demonstrate the difference in EIP2612 support.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>slither-check-erc --erc ERC2612 --solc-remaps "@openzeppelin/=lib/openzeppelin-contracts/ @chainlink/=lib/chainlink-brownie-contracts/ ds-test/=lib/forge-std/lib/ds-test/src/" ./src/tokens/GToken.sol GToken

slither-check-erc --erc ERC2612 --solc-remaps "@openzeppelin/=lib/openzeppelin-contracts/ @chainlink/=lib/chainlink-brownie-contracts/ ds-test/=lib/forge-std/lib/ds-test/src/" ./src/GVault.sol GVault
</code></pre></div></div>
      <h4 id="impact-8">
        
        
          <a href="#impact-8" class="anchor-heading" aria-labelledby="impact-8"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Impact
        
        
      </h4>
    

<p>Low. Gro protocol ERC20 tokens do not consistently support EIP2612.</p>
      <h4 id="recommendation-8">
        
        
          <a href="#recommendation-8" class="anchor-heading" aria-labelledby="recommendation-8"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Recommendation
        
        
      </h4>
    

<p>Use consistent imports for Gro ERC20 tokens and throughout the protocol.</p>
      <h4 id="developer-response-8">
        
        
          <a href="#developer-response-8" class="anchor-heading" aria-labelledby="developer-response-8"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Developer Response
        
        
      </h4>
    

<p>Acknowledged, fixed in <a href="https://github.com/groLabs/GSquared/pull/56">#56</a> and discussed in <a href="https://github.com/groLabs/GSquared/issues/11">#11</a>.</p>
      <h3 id="3-low---similar-functions-have-different-logic">
        
        
          <a href="#3-low---similar-functions-have-different-logic" class="anchor-heading" aria-labelledby="3-low---similar-functions-have-different-logic"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 3. Low - Similar functions have different logic
        
        
      </h3>
    

<p>Two similar stop loss functions in GStrategyGuard have slightly different logic, potentially allowing a stop loss to be triggered in an unexpected situation.</p>
      <h4 id="technical-details-9">
        
        
          <a href="#technical-details-9" class="anchor-heading" aria-labelledby="technical-details-9"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Technical Details
        
        
      </h4>
    

<p><code class="language-plaintext highlighter-rouge">executeStopLoss()</code> <a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/strategy/keeper/GStrategyGuard.sol#L261">includes the line <code class="language-plaintext highlighter-rouge">if (strategy == address(0)) continue;</code></a> which is not in <code class="language-plaintext highlighter-rouge">canExecuteStopLossPrimer()</code>. Likewise, <code class="language-plaintext highlighter-rouge">canExecuteStopLossPrimer()</code> <a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/strategy/keeper/GStrategyGuard.sol#L200">includes the line <code class="language-plaintext highlighter-rouge">if (strategyCheck[strategy].primerTimestamp == 0) continue;</code></a> which is not in <code class="language-plaintext highlighter-rouge">executeStopLoss()</code>. The two functions should share logic. Currently, the lack of a zero check for <code class="language-plaintext highlighter-rouge">strategyCheck[strategy].primerTimestamp</code> in <code class="language-plaintext highlighter-rouge">executeStopLoss()</code> means a rogue keeper could execute a stop loss before primerTimestamp has been set to a non-zero value.</p>
      <h4 id="impact-9">
        
        
          <a href="#impact-9" class="anchor-heading" aria-labelledby="impact-9"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Impact
        
        
      </h4>
    

<p>Low. Logic checks are not applied consistently and a keeper could execute a stop loss at an unintended time when <code class="language-plaintext highlighter-rouge">primerTimestamp</code> is zero.</p>
      <h4 id="recommendation-9">
        
        
          <a href="#recommendation-9" class="anchor-heading" aria-labelledby="recommendation-9"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Recommendation
        
        
      </h4>
    

<p>Use consistent logic in similar functions for more predictable behaviour.</p>
      <h4 id="developer-response-9">
        
        
          <a href="#developer-response-9" class="anchor-heading" aria-labelledby="developer-response-9"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Developer Response
        
        
      </h4>
    

<p>Acknowledged, fixed in <a href="https://github.com/groLabs/GSquared/pull/76">#76</a> and discussed in <a href="https://github.com/groLabs/GSquared/issues/12">#12</a>.</p>
      <h3 id="4-low---convexstrategy-owner-can-sweep-tokens">
        
        
          <a href="#4-low---convexstrategy-owner-can-sweep-tokens" class="anchor-heading" aria-labelledby="4-low---convexstrategy-owner-can-sweep-tokens"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 4. Low - ConvexStrategy owner can sweep tokens
        
        
      </h3>
    

<p>The owner of ConvexStrategy has permission to sweep any non-asset tokens. This can result in a rogue or malicious owner sweeping reward tokens, lpTokens from the metapool, or any other tokens. Even if the owner was prevented from sweeping the tokens in the <code class="language-plaintext highlighter-rouge">rewardTokens</code> array, the owner has permission to change the reward tokens and therefore change the blacklist of what tokens could be swept. Furthermore, the test deployment of ConvexStrategy has an owner address that is an EOA, which should not happen in the production release.</p>
      <h4 id="technical-details-10">
        
        
          <a href="#technical-details-10" class="anchor-heading" aria-labelledby="technical-details-10"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Technical Details
        
        
      </h4>
    

<p>Many DeFi protocols attempt to remain immutable to enable the user to maintain control over their assets at all times. While the underlying asset token is prevented from owner sweeping, the rewards returned by the Curve metapool are impacted as are the metapool LP tokens. This could lead to loss of user funds if the owner count is compromised or acts maliciously. In order to increase trust in the protocol, the owner should be a sufficiently distributed multisig to allow users to trust it.</p>
      <h4 id="impact-10">
        
        
          <a href="#impact-10" class="anchor-heading" aria-labelledby="impact-10"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Impact
        
        
      </h4>
    

<p>Low. While the owner is normally assumed to be a trusted party, there is potential loss of user funds if this assumption is broken.</p>
      <h4 id="recommendation-10">
        
        
          <a href="#recommendation-10" class="anchor-heading" aria-labelledby="recommendation-10"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Recommendation
        
        
      </h4>
    

<p>Several improvements should take place:</p>
<ol>
  <li>Prevent the owner from sweeping lptokens from the strategy by adding the line <code class="language-plaintext highlighter-rouge">if (address(lpToken) == _token) revert StrategyErrors.BaseAsset();</code></li>
  <li>Use a multisig that users can trust for the owner of ConvexStrategy</li>
  <li>Consider clarifying in documentation what the sweep function is intended to be used for and how reward token distribution to depositors may be impacted</li>
</ol>
      <h4 id="developer-response-10">
        
        
          <a href="#developer-response-10" class="anchor-heading" aria-labelledby="developer-response-10"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Developer Response
        
        
      </h4>
    

<p>Acknowledged, fixed in <a href="https://github.com/groLabs/GSquared/pull/57">#57</a> and discussed in <a href="https://github.com/groLabs/GSquared/issues/13">#13</a>.</p>
      <h3 id="5-low---inconsistent-minimum-reward-amount">
        
        
          <a href="#5-low---inconsistent-minimum-reward-amount" class="anchor-heading" aria-labelledby="5-low---inconsistent-minimum-reward-amount"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 5. Low - Inconsistent minimum reward amount
        
        
      </h3>
    

<p><code class="language-plaintext highlighter-rouge">_claimableRewards()</code> compares the reward value in WETH to <code class="language-plaintext highlighter-rouge">MIN_REWARD_SELL_AMOUNT</code>, but the actual <code class="language-plaintext highlighter-rouge">_sellRewards()</code> function compares the WETH value to <code class="language-plaintext highlighter-rouge">MIN_WETH_SELL_AMOUNT</code>. The latter value of <code class="language-plaintext highlighter-rouge">MIN_WETH_SELL_AMOUNT</code> should be used in both functions.</p>
      <h4 id="technical-details-11">
        
        
          <a href="#technical-details-11" class="anchor-heading" aria-labelledby="technical-details-11"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Technical Details
        
        
      </h4>
    

<p><code class="language-plaintext highlighter-rouge">_claimableRewards()</code> should compare the WETH value of rewards to <code class="language-plaintext highlighter-rouge">MIN_WETH_SELL_AMOUNT</code> and not to , otherwise <code class="language-plaintext highlighter-rouge">_claimableRewards()</code> <a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/strategy/ConvexStrategy.sol#L612">will not return a value if the amount of rewards has a value of less than 1 ETH</a>, which is quite a large requirement for rewards values to be <a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/strategy/ConvexStrategy.sol#L514">included in the calculations in <code class="language-plaintext highlighter-rouge">rewards()</code></a>. The existing strategy code will underestimate the rewards returned by <code class="language-plaintext highlighter-rouge">_estimatedTotalAssets()</code> when the value of <code class="language-plaintext highlighter-rouge">_claimableRewards()</code> is between 1E16 WETH and 1E18 WETH <a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/strategy/ConvexStrategy.sol#L770">which impacts the PnL calculations</a>.</p>
      <h4 id="impact-11">
        
        
          <a href="#impact-11" class="anchor-heading" aria-labelledby="impact-11"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Impact
        
        
      </h4>
    

<p>Low. Incorrect minimum amount leads to exclusion of rewards in <code class="language-plaintext highlighter-rouge">_estimatedTotalAssets()</code> even when rewards value is non-negligible.</p>
      <h4 id="recommendation-11">
        
        
          <a href="#recommendation-11" class="anchor-heading" aria-labelledby="recommendation-11"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Recommendation
        
        
      </h4>
    

<p>Replace <code class="language-plaintext highlighter-rouge">MIN_REWARD_SELL_AMOUNT</code> with <code class="language-plaintext highlighter-rouge">MIN_WETH_SELL_AMOUNT</code> <a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/strategy/ConvexStrategy.sol#L612">on this line</a>.</p>
      <h4 id="developer-response-11">
        
        
          <a href="#developer-response-11" class="anchor-heading" aria-labelledby="developer-response-11"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Developer Response
        
        
      </h4>
    

<p>Acknowledged, fixed in <a href="https://github.com/groLabs/GSquared/pull/58">#58</a> and discussed in <a href="https://github.com/groLabs/GSquared/issues/14">#14</a>.</p>
      <h3 id="6-low---inconsistent-metapool-fee-inclusion">
        
        
          <a href="#6-low---inconsistent-metapool-fee-inclusion" class="anchor-heading" aria-labelledby="6-low---inconsistent-metapool-fee-inclusion"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 6. Low - Inconsistent metapool fee inclusion
        
        
      </h3>
    

<p>When <a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/strategy/ConvexStrategy.sol#L889"><code class="language-plaintext highlighter-rouge">invest()</code></a> calculates slippage, it compares the amount of received assets <em>with</em> fees included to the slippage tolerance, while when <a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/strategy/ConvexStrategy.sol#L816"><code class="language-plaintext highlighter-rouge">divest()</code></a> does the same it compares the amount of received assets <em>without</em> fees included to the slippage tolerance. These two functions are inconsistent and this could lead to higher slippage than expected in <code class="language-plaintext highlighter-rouge">divest()</code> when fees are factored in.</p>
      <h4 id="technical-details-12">
        
        
          <a href="#technical-details-12" class="anchor-heading" aria-labelledby="technical-details-12"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Technical Details
        
        
      </h4>
    

<p>The Curve docs describe <code class="language-plaintext highlighter-rouge">calc_token_amount()</code>, which is used in <code class="language-plaintext highlighter-rouge">divest()</code>, <a href="https://curve.readthedocs.io/factory-pools.html#StableSwap.calc_token_amount">with the following</a>:</p>

<blockquote>
  <p>This calculation accounts for slippage, but not fees. It should be used as a basis for determining expected amounts when calling <code class="language-plaintext highlighter-rouge">add_liquidity</code> or <code class="language-plaintext highlighter-rouge">remove_liquidity_imbalance</code>, but should not be considered to be precise!</p>
</blockquote>

<p>This means that in <a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/strategy/ConvexStrategy.sol#L889"><code class="language-plaintext highlighter-rouge">invest()</code></a>, the slippage calculation compares <code class="language-plaintext highlighter-rouge">_credit</code>, the initial 3CRV token amount, with <code class="language-plaintext highlighter-rouge">amount * ratio</code>, which is the 3CRV value after slippage and fees. In contrast, <a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/strategy/ConvexStrategy.sol#L816"><code class="language-plaintext highlighter-rouge">divest()</code></a> compares <code class="language-plaintext highlighter-rouge">_debt</code>, the initial 3CRV token amount, with <code class="language-plaintext highlighter-rouge">meta_amount * ratio</code>, which is the 3CRV value after slippage but without fees.</p>
      <h4 id="impact-12">
        
        
          <a href="#impact-12" class="anchor-heading" aria-labelledby="impact-12"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Impact
        
        
      </h4>
    

<p>Low. The strategy may experience more slippage than expected when divesting from the metapool due to the calculation omitting fees.</p>
      <h4 id="recommendation-12">
        
        
          <a href="#recommendation-12" class="anchor-heading" aria-labelledby="recommendation-12"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Recommendation
        
        
      </h4>
    

<p>Standardize the approach to calculating acceptable slippage when depositing or withdrawing from the metapool. Consider using <code class="language-plaintext highlighter-rouge">calc_token_amount()</code> in both <code class="language-plaintext highlighter-rouge">invest()</code> and <code class="language-plaintext highlighter-rouge">divest()</code>.</p>
      <h4 id="developer-response-12">
        
        
          <a href="#developer-response-12" class="anchor-heading" aria-labelledby="developer-response-12"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Developer Response
        
        
      </h4>
    

<p>Acknowledged, won’t fix for reasons mentioned in <a href="https://github.com/groLabs/GSquared/issues/15">#15</a>.</p>
      <h3 id="7-low---potentially-incorrect-branching-logic">
        
        
          <a href="#7-low---potentially-incorrect-branching-logic" class="anchor-heading" aria-labelledby="7-low---potentially-incorrect-branching-logic"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 7. Low - Potentially incorrect branching logic
        
        
      </h3>
    

<p>Comments in <a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/strategy/ConvexStrategy.sol#L800-L805">the 3rd and 4th nested if statements in <code class="language-plaintext highlighter-rouge">realisePnl()</code></a> demonstrate there is unclear understanding of when this branching logic is activated. Specifically, there is duplicated logic that is never reached and should either be fixed or removed.</p>
      <h4 id="technical-details-13">
        
        
          <a href="#technical-details-13" class="anchor-heading" aria-labelledby="technical-details-13"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Technical Details
        
        
      </h4>
    

<p><a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/strategy/ConvexStrategy.sol#L803">This line of <code class="language-plaintext highlighter-rouge">realisePnl()</code> is unreachable</a> because if <code class="language-plaintext highlighter-rouge">loss &gt; _excessDebt</code> evaluates to true, to flow would have entered <a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/strategy/ConvexStrategy.sol#L796">this if statement</a> instead. The duplicate line of logic should be removed or changed. The comment of <a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/strategy/ConvexStrategy.sol#L801"><code class="language-plaintext highlighter-rouge">here for safety, but should really never be the case</code></a> before the line of code that is duplicated and never reached indicates some of the nuance of the branching may not be fully understood.</p>
      <h4 id="impact-13">
        
        
          <a href="#impact-13" class="anchor-heading" aria-labelledby="impact-13"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Impact
        
        
      </h4>
    

<p>Low. The logic has one inaccuracy and may have others based on the comments.</p>
      <h4 id="recommendation-13">
        
        
          <a href="#recommendation-13" class="anchor-heading" aria-labelledby="recommendation-13"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Recommendation
        
        
      </h4>
    

<p>Fix or remove the unreachable logic. Create a visual to help with mapping the branching logic to each permutation of variable values. Document the nested if statements more clearly and make sure that the tests have (close to) full coverage of the branches.</p>
      <h4 id="developer-response-13">
        
        
          <a href="#developer-response-13" class="anchor-heading" aria-labelledby="developer-response-13"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Developer Response
        
        
      </h4>
    

<p>Acknowledged, fixed in <a href="https://github.com/groLabs/GSquared/pull/59">#59</a> and discussed in <a href="https://github.com/groLabs/GSquared/issues/16">#16</a>.</p>
      <h3 id="8-low---setstrategies-doesnt-set-strategycheck-values">
        
        
          <a href="#8-low---setstrategies-doesnt-set-strategycheck-values" class="anchor-heading" aria-labelledby="8-low---setstrategies-doesnt-set-strategycheck-values"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 8. Low - <code class="language-plaintext highlighter-rouge">setStrategies()</code> doesn’t set <code class="language-plaintext highlighter-rouge">strategyCheck</code> values
        
        
      </h3>
    

<p><code class="language-plaintext highlighter-rouge">addStrategy()</code> and <code class="language-plaintext highlighter-rouge">removeStrategy()</code> set <code class="language-plaintext highlighter-rouge">timeLimit</code> and <code class="language-plaintext highlighter-rouge">active</code> values in the <code class="language-plaintext highlighter-rouge">strategyCheck</code> mapping. <code class="language-plaintext highlighter-rouge">setStrategies()</code> adds strategies like <code class="language-plaintext highlighter-rouge">addStrategy()</code> but does not allow <code class="language-plaintext highlighter-rouge">strategyCheck</code> to be updated.</p>
      <h4 id="technical-details-14">
        
        
          <a href="#technical-details-14" class="anchor-heading" aria-labelledby="technical-details-14"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Technical Details
        
        
      </h4>
    

<p><a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/strategy/keeper/GStrategyGuard.sol#L95"><code class="language-plaintext highlighter-rouge">setStrategies()</code></a> does not allow setting values in <code class="language-plaintext highlighter-rouge">strategyCheck</code>, which is <a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/strategy/keeper/GStrategyGuard.sol#L108">in contrast to <code class="language-plaintext highlighter-rouge">addStrategy()</code></a>. This could impact the use case where <code class="language-plaintext highlighter-rouge">setStrategies()</code> is useful. For example, if <code class="language-plaintext highlighter-rouge">strategyCheck</code> values are not set, the strategy will never return <code class="language-plaintext highlighter-rouge">true</code> <a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/strategy/keeper/GStrategyGuard.sol#L186-L187">in functions like <code class="language-plaintext highlighter-rouge">canEndStopLoss()</code></a>.</p>
      <h4 id="impact-14">
        
        
          <a href="#impact-14" class="anchor-heading" aria-labelledby="impact-14"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Impact
        
        
      </h4>
    

<p>Low. <code class="language-plaintext highlighter-rouge">setStrategies()</code> doesn’t provide the same abilities as the <code class="language-plaintext highlighter-rouge">addStrategy()</code>.</p>
      <h4 id="recommendation-14">
        
        
          <a href="#recommendation-14" class="anchor-heading" aria-labelledby="recommendation-14"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Recommendation
        
        
      </h4>
    

<p>Consider modifying <code class="language-plaintext highlighter-rouge">setStrategies()</code> to set corresponding <code class="language-plaintext highlighter-rouge">strategyCheck</code> values.</p>
      <h4 id="developer-response-14">
        
        
          <a href="#developer-response-14" class="anchor-heading" aria-labelledby="developer-response-14"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Developer Response
        
        
      </h4>
    

<p>Acknowledged, fixed in <a href="https://github.com/groLabs/GSquared/pull/60">#60</a> and discussed in <a href="https://github.com/groLabs/GSquared/issues/17">#17</a>.</p>
      <h3 id="9-low---weak-oracle-result-staleness-check-in-stalecheck">
        
        
          <a href="#9-low---weak-oracle-result-staleness-check-in-stalecheck" class="anchor-heading" aria-labelledby="9-low---weak-oracle-result-staleness-check-in-stalecheck"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 9. Low - Weak oracle result staleness check in <code class="language-plaintext highlighter-rouge">staleCheck()</code>
        
        
      </h3>
    

<p><code class="language-plaintext highlighter-rouge">staleCheck()</code> checks if the Chainlink oracle price data is stale. The staleness check only checks if the timestamp is from the last 24 hours, but a stricter check would also check if the roundId is stale.</p>
      <h4 id="technical-details-15">
        
        
          <a href="#technical-details-15" class="anchor-heading" aria-labelledby="technical-details-15"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Technical Details
        
        
      </h4>
    

<p><code class="language-plaintext highlighter-rouge">staleCheck()</code> only checks that the Chainlink price data is under 24 hours old. The staleness check does not consider whether the roundId data may be outdated. It is recommended to do both, as shown in other security report findings <a href="https://consensys.net/diligence/audits/2021/09/fei-protocol-v2-phase-1/#chainlinkoraclewrapper---latestrounddata-might-return-stale-results">here</a> and <a href="https://github.com/code-423n4/2021-05-fairside-findings/issues/70">here</a>. Specifically, the DAI/USD oracle <a href="https://data.chain.link/ethereum/mainnet/stablecoins/dai-usd">updates more regularly than every 24 hours</a>. Considering that the Gro protocol has protections in place for stablecoins losing their peg, improving the Chainlink price staleness check is a crucial consideration.</p>
      <h4 id="impact-15">
        
        
          <a href="#impact-15" class="anchor-heading" aria-labelledby="impact-15"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Impact
        
        
      </h4>
    

<p>Low. The staleness check could provide a false positive, say in the case that the price data is 23 hours old but is not from the most recent roundId.</p>
      <h4 id="recommendation-15">
        
        
          <a href="#recommendation-15" class="anchor-heading" aria-labelledby="recommendation-15"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Recommendation
        
        
      </h4>
    

<p>Consider modifying <code class="language-plaintext highlighter-rouge">setStrategies()</code> to the following:</p>
<div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code>	<span class="k">function</span> <span class="n">staleCheck</span><span class="p">(</span><span class="kt">uint256</span> <span class="n">_updatedAt</span><span class="p">,</span> <span class="kt">uint80</span> <span class="n">_roundId</span><span class="p">,</span> <span class="kt">uint80</span> <span class="n">_answeredInRound</span><span class="p">)</span> <span class="k">internal</span> <span class="k">view</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="p">((</span><span class="n">block</span><span class="p">.</span><span class="n">timestamp</span> <span class="o">-</span> <span class="n">_updatedAt</span> <span class="o">&gt;=</span> <span class="n">STALE_CHECK</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">_answeredInRound</span> <span class="o">==</span> <span class="n">_roundId</span><span class="p">));</span>
    <span class="p">}</span>
</code></pre></div></div>
      <h4 id="developer-response-15">
        
        
          <a href="#developer-response-15" class="anchor-heading" aria-labelledby="developer-response-15"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Developer Response
        
        
      </h4>
    

<p>Acknowledged, won’t fix for reasons mentioned in <a href="https://github.com/groLabs/GSquared/issues/18">#18</a>.</p>
      <h3 id="10-low---no-mindeposit-in-gtranche">
        
        
          <a href="#10-low---no-mindeposit-in-gtranche" class="anchor-heading" aria-labelledby="10-low---no-mindeposit-in-gtranche"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 10. Low - No <code class="language-plaintext highlighter-rouge">minDeposit</code> in GTranche
        
        
      </h3>
    

<p>GVault has a <code class="language-plaintext highlighter-rouge">minDeposit</code> value which prevents extremely small deposits, such as depositing 1 wei. GTranche has no such minimum but may benefit from implementing one.</p>
      <h4 id="technical-details-16">
        
        
          <a href="#technical-details-16" class="anchor-heading" aria-labelledby="technical-details-16"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Technical Details
        
        
      </h4>
    

<p>GVault <a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/GVault.sol#L119">sets a <code class="language-plaintext highlighter-rouge">minDeposit</code> value</a> to prevent very small 1 wei deposits. GTranche has no comparable minimum value. When combined with the implementation of <code class="language-plaintext highlighter-rouge">utilization()</code> adding 1 wei to the denominator, the lack of a <code class="language-plaintext highlighter-rouge">minDeposit</code> is problematic in the following scenario:</p>
<ol>
  <li>The <code class="language-plaintext highlighter-rouge">utilisationThreshold</code> is set to 3E4, implying there can be 3 tokens deposit into the Senior Tranche for every token deposited into the Junior Tranche</li>
  <li>1 wei is deposited into the Junior Tranche</li>
  <li>3 wei is deposited into the Senior Tranche, which should be the maximum amount permitted to maintain the 3-to-1 ratio</li>
  <li>With the current tranche holdings, <code class="language-plaintext highlighter-rouge">utilization()</code> returns a value of <code class="language-plaintext highlighter-rouge">(3 * 1E4) / (1+1) = 15000</code>, which is half of the <code class="language-plaintext highlighter-rouge">utilisationThreshold</code> limit of 3E4</li>
  <li>An additional 3 wei can be deposited into the Senior Tranche. Now <code class="language-plaintext highlighter-rouge">utilization()</code> returns <code class="language-plaintext highlighter-rouge">(6 * 1E4) / (1+1) = 30000</code>, but the ratio of Senior Tranche deposits to Junior Tranche deposits is 6-to-1, not the originally intended 3-to-1</li>
</ol>

<p>Beyond the risk of underinsured Senior Tranche deposits, another side effect of the lack of <code class="language-plaintext highlighter-rouge">minDeposit</code> is the possibility of <a href="https://github.com/OpenZeppelin/openzeppelin-contracts/issues/3706">an inflation attack</a>.</p>
      <h4 id="impact-16">
        
        
          <a href="#impact-16" class="anchor-heading" aria-labelledby="impact-16"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Impact
        
        
      </h4>
    

<p>Low. Utilization value calculation isn’t accurate with small amounts that are possible to deposit without a <code class="language-plaintext highlighter-rouge">minDeposit</code> amount.</p>
      <h4 id="recommendation-16">
        
        
          <a href="#recommendation-16" class="anchor-heading" aria-labelledby="recommendation-16"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Recommendation
        
        
      </h4>
    

<ol>
  <li>Implement a <code class="language-plaintext highlighter-rouge">minDeposit</code> amount in GTranche similar to GVault</li>
  <li>Change the implementation of <code class="language-plaintext highlighter-rouge">utilization()</code> and <a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/GTranche.sol#L322-L324">similar utilisation ratio calculations</a> to:
    <div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">function</span> <span class="n">utilization</span><span class="p">()</span> <span class="k">external</span> <span class="k">view</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint256</span><span class="p">)</span> <span class="p">{</span>
 <span class="p">(</span><span class="kt">uint256</span><span class="p">[</span><span class="n">NO_OF_TRANCHES</span><span class="p">]</span> <span class="k">memory</span> <span class="n">_totalValue</span><span class="p">,</span> <span class="p">,</span> <span class="p">)</span> <span class="o">=</span> <span class="n">pnlDistribution</span><span class="p">();</span>
 <span class="k">return</span> <span class="n">_totalValue</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">?</span> <span class="p">(</span><span class="n">_totalValue</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">DEFAULT_DECIMALS</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">_totalValue</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">:</span> <span class="k">type</span><span class="p">(</span><span class="kt">uint256</span><span class="p">).</span><span class="n">max</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>    </div>
  </li>
</ol>
      <h4 id="developer-response-16">
        
        
          <a href="#developer-response-16" class="anchor-heading" aria-labelledby="developer-response-16"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Developer Response
        
        
      </h4>
    

<p>Acknowledged, fixed in <a href="https://github.com/groLabs/GSquared/pull/61">#61</a> and discussed in <a href="https://github.com/groLabs/GSquared/issues/19">#19</a>.</p>
      <h3 id="11-low---volatile-token-price-causes-higher-vault-fees">
        
        
          <a href="#11-low---volatile-token-price-causes-higher-vault-fees" class="anchor-heading" aria-labelledby="11-low---volatile-token-price-causes-higher-vault-fees"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 11. Low - Volatile token price causes higher vault fees
        
        
      </h3>
    

<p>The docs for the currently deployed version of the Gro protocol (not the one that was reviewed) <a href="https://docs.gro.xyz/gro-docs/pwrd_vault/vault/hodl-contribution">states</a>:</p>

<blockquote>
  <p>When users withdraw funds from Vault, they pay a 0.5% fee as a contribution to the remaining HODLers.</p>
</blockquote>

<p>This is not how <code class="language-plaintext highlighter-rouge">_calcFees()</code> in the GVault works. In fact, in a volatile market where the price moves up and down a lot but ends up at the same place after some time, fees will be charged to the amount that was gained every time the strategy calls the GVault’s <code class="language-plaintext highlighter-rouge">report()</code>, which can mean a lot more fees than a simple one-time fee on withdrawal.</p>
      <h4 id="technical-details-17">
        
        
          <a href="#technical-details-17" class="anchor-heading" aria-labelledby="technical-details-17"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Technical Details
        
        
      </h4>
    

<p><code class="language-plaintext highlighter-rouge">_calcFees()</code> is called only once in GVault, <a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/GVault.sol#L669">from <code class="language-plaintext highlighter-rouge">report()</code></a>. <code class="language-plaintext highlighter-rouge">_calcFees()</code> is a bit of a misnomer because the function also takes those fees and sends them to the <code class="language-plaintext highlighter-rouge">feeCollector</code> address specified by the owner using <code class="language-plaintext highlighter-rouge">setFeeCollector()</code> while returning the gains amount minus fees. The gains are defined as the difference between all the strategy’s assets (loose assets, LP tokens, and rewards) and the strategy’s debt, which is a value stored in <code class="language-plaintext highlighter-rouge">strategies[strategyAddress].totalDebt</code> in the GVault. A key part of this is that when a strategy reports a loss, the totalDebt of the strategy is reduced to account for the loss, so it is as though the strategy received fewer assets to begin with. The combination of how fees are taken from gains and the goal post for how gains are calculated getting moved on every loss creates a problematic combination. Consider the following series of events:</p>
<ol>
  <li>Value of Strategy is $1000</li>
  <li>Strategy loses $20 and <code class="language-plaintext highlighter-rouge">report()</code> is triggered</li>
  <li>Strategy gains $20 and <code class="language-plaintext highlighter-rouge">report()</code> is triggered (pays vault fee on $20 gains)</li>
  <li>Strategy loses $20 and <code class="language-plaintext highlighter-rouge">report()</code> is triggered</li>
  <li>Strategy gains $20 and <code class="language-plaintext highlighter-rouge">report()</code> is triggered (pays vault fee on $20 gains)</li>
</ol>

<p>The strategy has paid the vault fee twice even though the value in the strategy hasn’t changed. It is only the volatility in the strategy’s assets that caused the fees to be applied. This penalizes depositors for market volatility instead of penalizing them for withdrawing, which is how the Gro protocol is documented to work today. Note that this specific strategy is built on 3CRV and the Frax Curve metapool, so the value of the LP tokens should only increase and not be subject to such volatility.</p>

<p>By deducting fees at the time of profit, there is less value in the vault to compound and grow, which slightly reduces the appeal of the strategy.</p>
      <h4 id="impact-17">
        
        
          <a href="#impact-17" class="anchor-heading" aria-labelledby="impact-17"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Impact
        
        
      </h4>
    

<p>Low. Fees create a penalty for depositors in volatile markets, but should instead only penalize depositors who withdraw. In actuality, because 3CRV should only increase in value, the two are similar.</p>
      <h4 id="recommendation-17">
        
        
          <a href="#recommendation-17" class="anchor-heading" aria-labelledby="recommendation-17"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Recommendation
        
        
      </h4>
    

<p>Only apply a fee on withdrawal to enable to net vault value to continue compounding until a user withdraws their deposit. A fee on withdrawal would create a disincentive for attack vectors such as <a href="https://github.com/yearn/yearn-security/blob/master/disclosures/2021-02-04.md">this yearn vault attack</a>.</p>
      <h4 id="developer-response-17">
        
        
          <a href="#developer-response-17" class="anchor-heading" aria-labelledby="developer-response-17"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Developer Response
        
        
      </h4>
    

<p>Acknowledged, known but won’t fix for reasons mentioned in <a href="https://github.com/groLabs/GSquared/issues/20">#20</a>.</p>
      <h3 id="12-low---high-default-slippage-tolerance">
        
        
          <a href="#12-low---high-default-slippage-tolerance" class="anchor-heading" aria-labelledby="12-low---high-default-slippage-tolerance"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 12. Low - High default slippage tolerance
        
        
      </h3>
    

<p>The value <code class="language-plaintext highlighter-rouge">(PERCENTAGE_DECIMAL_FACTOR - baseSlippage) / PERCENTAGE_DECIMAL_FACTOR</code> is the slippage tolerance for metapool deposits and withdrawals in <code class="language-plaintext highlighter-rouge">invest()</code> and <code class="language-plaintext highlighter-rouge">divest()</code>. The default value for this tolerance is unnecessarily large and likely due to a mistake in the decimal arithmetic. Fortunately <code class="language-plaintext highlighter-rouge">baseSlippage</code> can be fixed by the owner to correct similar errors in the future, but a better default value should be considered.</p>
      <h4 id="technical-details-18">
        
        
          <a href="#technical-details-18" class="anchor-heading" aria-labelledby="technical-details-18"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Technical Details
        
        
      </h4>
    

<p>The default value of <code class="language-plaintext highlighter-rouge">PERCENTAGE_DECIMAL_FACTOR</code> if 1E4 while <code class="language-plaintext highlighter-rouge">baseSlippage</code> is 50. This means the default tolerance is (10000 - 50) / 10000 = 9950 / 10000 = 99.5%, allowing for 0.5% slippage, in <a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/strategy/ConvexStrategy.sol#L895"><code class="language-plaintext highlighter-rouge">invest()</code></a> and <a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/strategy/ConvexStrategy.sol#L825"><code class="language-plaintext highlighter-rouge">divest()</code></a>. When the Frax metapool was examined at the time of this review, the Curve Finance frontend estimated a 0.03% slippage if withdrawing 1E8 LP tokens, which was over 20% of the total supply of the metapool. Similarly, when estimating the slippage for a deposit of 1E8 CRV tokens, which would increase the existing balance of CRV in the metapool by over 50%, the frontend estimated a 0.06% slippage.</p>

<p><img src="../../assets/images/Gro/Gro-slippage-withdrawal.png" alt="Curve metapool frontend withdrawal slippage estimate" /></p>

<p><img src="../../assets/images/Gro/Gro-slippage-deposit.png" alt="Curve metapool frontend deposit slippage estimate" /></p>

<p>Given the size of the slippage with such large deposits or withdrawals, and considering that the default slippage tolerance on the Curve frontend for this Frax metapool is 0.1%, the existing combination of <code class="language-plaintext highlighter-rouge">PERCENTAGE_DECIMAL_FACTOR</code> and <code class="language-plaintext highlighter-rouge">baseSlippage</code> provides too large of a slippage tolerance.</p>
      <h4 id="impact-18">
        
        
          <a href="#impact-18" class="anchor-heading" aria-labelledby="impact-18"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Impact
        
        
      </h4>
    

<p>Low. A large default slippage tolerance could lead to loss of value, but harvests are run by Gelato jobs which should offer MEV protection, even though this is not fully documented in Gelato network documentation yet.</p>
      <h4 id="recommendation-18">
        
        
          <a href="#recommendation-18" class="anchor-heading" aria-labelledby="recommendation-18"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Recommendation
        
        
      </h4>
    

<p>Change the default value of <code class="language-plaintext highlighter-rouge">baseSlippage</code> to 10 or less. Most likely a <code class="language-plaintext highlighter-rouge">baseSlippage</code> value of 5 would suffice for normal operating conditions and deposit/withdrawal sizes. The root cause could be a typo in <code class="language-plaintext highlighter-rouge">PERCENTAGE_DECIMAL_FACTOR</code> that should be 1E5 (not 1E4) or a typo in <code class="language-plaintext highlighter-rouge">baseSlippage</code> that should be 5 (not 50).</p>
      <h4 id="developer-response-18">
        
        
          <a href="#developer-response-18" class="anchor-heading" aria-labelledby="developer-response-18"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Developer Response
        
        
      </h4>
    

<p>Acknowledged, fixed in <a href="https://github.com/groLabs/GSquared/pull/53">#53</a> and discussed in <a href="https://github.com/groLabs/GSquared/issues/4">#4</a>.</p>
      <h2 id="gas-savings-findings">
        
        
          <a href="#gas-savings-findings" class="anchor-heading" aria-labelledby="gas-savings-findings"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Gas Savings Findings
        
        
      </h2>
    
      <h3 id="1-gas---use-prefix-in-loops">
        
        
          <a href="#1-gas---use-prefix-in-loops" class="anchor-heading" aria-labelledby="1-gas---use-prefix-in-loops"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 1. Gas - Use prefix in loops
        
        
      </h3>
    

<p>Using a prefix increment (++i) instead of a postfix increment (i++) saves gas for each loop cycle and so can have a big gas impact when the loop executes on a large number of elements.</p>
      <h4 id="technical-details-19">
        
        
          <a href="#technical-details-19" class="anchor-heading" aria-labelledby="technical-details-19"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Technical Details
        
        
      </h4>
    

<p>There are instances of this throughout the contracts, with examples of this optimization opportunity found in <a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/strategy/keeper/GStrategyGuard.sol#L98">GStrategyGuard.sol</a>, <a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/GTranche.sol#L512">GTranche.sol</a>, and <a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/GRouter.sol#L381">GRouter.sol</a>.</p>
      <h4 id="impact-19">
        
        
          <a href="#impact-19" class="anchor-heading" aria-labelledby="impact-19"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Impact
        
        
      </h4>
    

<p>Gas savings.</p>
      <h4 id="recommendation-19">
        
        
          <a href="#recommendation-19" class="anchor-heading" aria-labelledby="recommendation-19"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Recommendation
        
        
      </h4>
    

<p>Increment with prefix addition and not postfix in for loops.</p>
      <h4 id="developer-response-19">
        
        
          <a href="#developer-response-19" class="anchor-heading" aria-labelledby="developer-response-19"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Developer Response
        
        
      </h4>
    

<p>Acknowledged, fixed in <a href="https://github.com/groLabs/GSquared/pull/64">#64</a> and discussed in <a href="https://github.com/groLabs/GSquared/issues/21">#21</a>.</p>
      <h3 id="2-gas---unnecessary-zero-initializations">
        
        
          <a href="#2-gas---unnecessary-zero-initializations" class="anchor-heading" aria-labelledby="2-gas---unnecessary-zero-initializations"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 2. Gas - Unnecessary zero initializations
        
        
      </h3>
    

<p>Setting a variable to its default value can waste gas.</p>
      <h4 id="technical-details-20">
        
        
          <a href="#technical-details-20" class="anchor-heading" aria-labelledby="technical-details-20"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Technical Details
        
        
      </h4>
    

<p>There are instances of this throughout the contracts, with examples of this optimization opportunity found in <a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/GTranche.sol#L512">GTranche.sol</a>, <a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/GRouter.sol#L381">GRouter.sol</a>, <a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/utils/StrategyQueue.sol#L49">StrategyQueue.sol</a>, and <a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/strategy/ConvexStrategy.sol#L231">ConvexStrategy</a>.</p>
      <h4 id="impact-20">
        
        
          <a href="#impact-20" class="anchor-heading" aria-labelledby="impact-20"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Impact
        
        
      </h4>
    

<p>Gas savings.</p>
      <h4 id="recommendation-20">
        
        
          <a href="#recommendation-20" class="anchor-heading" aria-labelledby="recommendation-20"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Recommendation
        
        
      </h4>
    

<p>Remove zero initialization of variables.</p>
      <h4 id="developer-response-20">
        
        
          <a href="#developer-response-20" class="anchor-heading" aria-labelledby="developer-response-20"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Developer Response
        
        
      </h4>
    

<p>Acknowledged, fixed in <a href="https://github.com/groLabs/GSquared/pull/65">#65</a> and discussed in <a href="https://github.com/groLabs/GSquared/issues/22">#22</a>.</p>
      <h3 id="3-gas---use-simple-comparison">
        
        
          <a href="#3-gas---use-simple-comparison" class="anchor-heading" aria-labelledby="3-gas---use-simple-comparison"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 3. Gas - Use simple comparison
        
        
      </h3>
    

<p>Using a compound comparison such as ≥ or ≤ uses more gas than a simple comparison check like &gt;, &lt;, or ==. Compound comparison operators can be replaced with simple ones for gas savings.</p>
      <h4 id="technical-details-21">
        
        
          <a href="#technical-details-21" class="anchor-heading" aria-labelledby="technical-details-21"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Technical Details
        
        
      </h4>
    

<p>The <a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/strategy/ConvexStrategy.sol#L732-L740"><code class="language-plaintext highlighter-rouge">withdraw()</code> function in ConvexStrategy</a> provides one example of this, but there are other instances in the contracts:</p>
<div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="p">(</span><span class="n">withdrawnAssets</span> <span class="o">&lt;=</span> <span class="n">_amount</span><span class="p">)</span> <span class="p">{</span>
	<span class="n">loss</span> <span class="o">+=</span> <span class="n">_amount</span> <span class="o">-</span> <span class="n">withdrawnAssets</span><span class="p">;</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">loss</span> <span class="o">&gt;</span> <span class="n">withdrawnAssets</span> <span class="o">-</span> <span class="n">_amount</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">loss</span> <span class="o">-=</span> <span class="n">withdrawnAssets</span> <span class="o">-</span> <span class="n">_amount</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">loss</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>By switching around the if/else clauses, we can replace the compound operator with a simple one</p>
<div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="p">(</span><span class="n">withdrawnAssets</span> <span class="o">&gt;</span> <span class="n">_amount</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">loss</span> <span class="o">&gt;</span> <span class="n">withdrawnAssets</span> <span class="o">-</span> <span class="n">_amount</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">loss</span> <span class="o">-=</span> <span class="n">withdrawnAssets</span> <span class="o">-</span> <span class="n">_amount</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">loss</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
	<span class="n">loss</span> <span class="o">+=</span> <span class="n">_amount</span> <span class="o">-</span> <span class="n">withdrawnAssets</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>
      <h4 id="impact-21">
        
        
          <a href="#impact-21" class="anchor-heading" aria-labelledby="impact-21"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Impact
        
        
      </h4>
    

<p>Gas savings.</p>
      <h4 id="recommendation-21">
        
        
          <a href="#recommendation-21" class="anchor-heading" aria-labelledby="recommendation-21"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Recommendation
        
        
      </h4>
    

<p>Replace compound comparison operators with simple ones for gas savings.</p>
      <h4 id="developer-response-21">
        
        
          <a href="#developer-response-21" class="anchor-heading" aria-labelledby="developer-response-21"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Developer Response
        
        
      </h4>
    

<p>Acknowledged, will fix in a future update. Discussed in <a href="https://github.com/groLabs/GSquared/issues/23">#23</a>.</p>
      <h3 id="4-gas---remove-redundant-check">
        
        
          <a href="#4-gas---remove-redundant-check" class="anchor-heading" aria-labelledby="4-gas---remove-redundant-check"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 4. Gas - Remove redundant check
        
        
      </h3>
    

<p><code class="language-plaintext highlighter-rouge">mint()</code> in GVault include an unnecessary check that can be removed.</p>
      <h4 id="technical-details-22">
        
        
          <a href="#technical-details-22" class="anchor-heading" aria-labelledby="technical-details-22"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Technical Details
        
        
      </h4>
    

<p><code class="language-plaintext highlighter-rouge">mint()</code> in GVault checks if assets is zero and then checks if assets is less than minDeposit. The first check is redundant because if assets is zero, then <code class="language-plaintext highlighter-rouge">assets &lt; minDeposit</code> is true and it will revert in the next check. This suggestion assumes that <code class="language-plaintext highlighter-rouge">minDeposit</code> should be <code class="language-plaintext highlighter-rouge">10 ** _asset.decimals()</code> instead of <code class="language-plaintext highlighter-rouge">_asset.decimals()</code>, since <code class="language-plaintext highlighter-rouge">10 ** X</code> where X is a uint cannot result in a value of zero.</p>

<p>Separately, the returns in <a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/GVault.sol#L241"><code class="language-plaintext highlighter-rouge">mint()</code></a>, <a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/GVault.sol#L215"><code class="language-plaintext highlighter-rouge">deposit()</code></a>, and <a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/GVault.sol#L305"><code class="language-plaintext highlighter-rouge">withdraw()</code></a> are unnecessary and can be removed because the return value is the same as the named return variable.</p>
      <h4 id="impact-22">
        
        
          <a href="#impact-22" class="anchor-heading" aria-labelledby="impact-22"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Impact
        
        
      </h4>
    

<p>Gas savings.</p>
      <h4 id="recommendation-22">
        
        
          <a href="#recommendation-22" class="anchor-heading" aria-labelledby="recommendation-22"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Recommendation
        
        
      </h4>
    

<p>Remove the revert on <a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/GVault.sol#L230">this line of code</a> because the zero check is included in the <code class="language-plaintext highlighter-rouge">assets &lt; minDeposit</code> check:</p>
<div class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gd">- if ((assets = previewMint(_shares)) == 0) revert Errors.ZeroAssets();
</span><span class="gi">+ assets = previewMint(_shares);
</span></code></pre></div></div>
      <h4 id="developer-response-22">
        
        
          <a href="#developer-response-22" class="anchor-heading" aria-labelledby="developer-response-22"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Developer Response
        
        
      </h4>
    

<p>Acknowledged, fixed in <a href="https://github.com/groLabs/GSquared/pull/67">#67</a> and discussed in <a href="https://github.com/groLabs/GSquared/issues/24">#24</a>.</p>
      <h3 id="5-gas---use-solidity-errors-in-084">
        
        
          <a href="#5-gas---use-solidity-errors-in-084" class="anchor-heading" aria-labelledby="5-gas---use-solidity-errors-in-084"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 5. Gas - Use Solidity errors in 0.8.4+
        
        
      </h3>
    

<p>Using <a href="https://blog.soliditylang.org/2021/04/21/custom-errors/">solidity errors</a> is a new and more gas efficient way to revert on failure states.</p>
      <h4 id="technical-details-23">
        
        
          <a href="#technical-details-23" class="anchor-heading" aria-labelledby="technical-details-23"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Technical Details
        
        
      </h4>
    

<p>Require statements are found in the JuniorTranche, SeniorTranche, GToken, and GVault contracts (examples include <a href="https://github.com/groLabs/GSquared-foundry/tree/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/tokens/SeniorTranche.sol#L90">1</a>, <a href="https://github.com/groLabs/GSquared-foundry/tree/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/tokens/JuniorTranche.sol#L95">2</a>, <a href="https://github.com/groLabs/GSquared-foundry/tree/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/tokens/GToken.sol#L229">3</a>, <a href="https://github.com/groLabs/GSquared-foundry/tree/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/GVault.sol#L540">4</a>). Using this new solidity feature can provide gas savings on revert conditions.</p>
      <h4 id="impact-23">
        
        
          <a href="#impact-23" class="anchor-heading" aria-labelledby="impact-23"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Impact
        
        
      </h4>
    

<p>Gas savings.</p>
      <h4 id="recommendation-23">
        
        
          <a href="#recommendation-23" class="anchor-heading" aria-labelledby="recommendation-23"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Recommendation
        
        
      </h4>
    

<p>Add errors to replace each <code class="language-plaintext highlighter-rouge">require()</code> with <code class="language-plaintext highlighter-rouge">revert errorName()</code> for greater gas efficiency.</p>
      <h4 id="developer-response-23">
        
        
          <a href="#developer-response-23" class="anchor-heading" aria-labelledby="developer-response-23"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Developer Response
        
        
      </h4>
    

<p>Acknowledged, partially fixed in <a href="https://github.com/groLabs/GSquared/pull/66">#66</a> and discussed in <a href="https://github.com/groLabs/GSquared/issues/25">#25</a>.</p>
      <h3 id="6-gas---declare-variables-immutable-when-possible">
        
        
          <a href="#6-gas---declare-variables-immutable-when-possible" class="anchor-heading" aria-labelledby="6-gas---declare-variables-immutable-when-possible"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 6. Gas - Declare variables immutable when possible
        
        
      </h3>
    

<p>An immutable variable can provide gas saving compared to a non-immutable variable.</p>
      <h4 id="technical-details-24">
        
        
          <a href="#technical-details-24" class="anchor-heading" aria-labelledby="technical-details-24"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Technical Details
        
        
      </h4>
    

<p>The <code class="language-plaintext highlighter-rouge">IsGTrancheSet</code> boolean <a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/GMigration.sol#L55">is set only once in GMigration.sol</a> and can be immutable.</p>
      <h4 id="impact-24">
        
        
          <a href="#impact-24" class="anchor-heading" aria-labelledby="impact-24"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Impact
        
        
      </h4>
    

<p>Gas savings.</p>
      <h4 id="recommendation-24">
        
        
          <a href="#recommendation-24" class="anchor-heading" aria-labelledby="recommendation-24"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Recommendation
        
        
      </h4>
    

<p>Make <code class="language-plaintext highlighter-rouge">IsGTrancheSet</code> immutable for gas savings.</p>
      <h4 id="developer-response-24">
        
        
          <a href="#developer-response-24" class="anchor-heading" aria-labelledby="developer-response-24"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Developer Response
        
        
      </h4>
    

<p>Acknowledged, won’t fix for reasons mentioned in <a href="https://github.com/groLabs/GSquared/issues/26">#26</a>.</p>
      <h3 id="7-gas---use-unchecked-if-no-underflow-risk">
        
        
          <a href="#7-gas---use-unchecked-if-no-underflow-risk" class="anchor-heading" aria-labelledby="7-gas---use-unchecked-if-no-underflow-risk"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 7. Gas - Use unchecked if no underflow risk
        
        
      </h3>
    

<p>There is a subtraction operation that can use unchecked for gas savings.</p>
      <h4 id="technical-details-25">
        
        
          <a href="#technical-details-25" class="anchor-heading" aria-labelledby="technical-details-25"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Technical Details
        
        
      </h4>
    

<p><a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/GTranche.sol#L381">One example</a> where unchecked can be applied:</p>
<div class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gd">- loss = lastTotal - totalValue;
</span><span class="gi">+ unchecked { loss = lastTotal - totalValue; }
</span></code></pre></div></div>

<p>Similar savings can be found throughout the contracts including <a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/GTranche.sol#L390">here</a>, <a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/strategy/ConvexStrategy.sol#L716">here</a>, and <a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/strategy/ConvexStrategy.sol#L779">here</a>.</p>
      <h4 id="impact-25">
        
        
          <a href="#impact-25" class="anchor-heading" aria-labelledby="impact-25"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Impact
        
        
      </h4>
    

<p>Gas savings.</p>
      <h4 id="recommendation-25">
        
        
          <a href="#recommendation-25" class="anchor-heading" aria-labelledby="recommendation-25"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Recommendation
        
        
      </h4>
    

<p>Use <a href="https://docs.soliditylang.org/en/latest/control-structures.html#checked-or-unchecked-arithmetic">unchecked block</a> if there is no overflow or underflow risk for gas savings.</p>
      <h4 id="developer-response-25">
        
        
          <a href="#developer-response-25" class="anchor-heading" aria-labelledby="developer-response-25"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Developer Response
        
        
      </h4>
    

<p>Acknowledged, partially fixed in <a href="https://github.com/groLabs/GSquared/pull/69">#69</a> and discussed in <a href="https://github.com/groLabs/GSquared/issues/27">#27</a>.</p>
      <h2 id="informational-findings">
        
        
          <a href="#informational-findings" class="anchor-heading" aria-labelledby="informational-findings"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Informational Findings
        
        
      </h2>
    
      <h3 id="1-informational---unusual-mindeposit-choice">
        
        
          <a href="#1-informational---unusual-mindeposit-choice" class="anchor-heading" aria-labelledby="1-informational---unusual-mindeposit-choice"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 1. Informational - Unusual <code class="language-plaintext highlighter-rouge">minDeposit</code> choice
        
        
      </h3>
    

<p><code class="language-plaintext highlighter-rouge">minDeposit</code> is set to <code class="language-plaintext highlighter-rouge">_asset.decimals()</code> but <code class="language-plaintext highlighter-rouge">10 ** _asset.decimals()</code> may be a better choice to relate to the underlying asset, like <a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/utils/FixedTokensCurve.sol#L97">what is done for <code class="language-plaintext highlighter-rouge">FIRST_TOKEN_DECIMALS</code></a>.</p>
      <h4 id="technical-details-26">
        
        
          <a href="#technical-details-26" class="anchor-heading" aria-labelledby="technical-details-26"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Technical Details
        
        
      </h4>
    

<p>This <a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/GVault.sol#L119">line of GVault.sol</a> may have a typo if the intent is to have a minimum deposit of at least one dollar (because the vault is designed for stablecoins).</p>
      <h4 id="impact-26">
        
        
          <a href="#impact-26" class="anchor-heading" aria-labelledby="impact-26"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Impact
        
        
      </h4>
    

<p>Informational.</p>
      <h4 id="recommendation-26">
        
        
          <a href="#recommendation-26" class="anchor-heading" aria-labelledby="recommendation-26"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Recommendation
        
        
      </h4>
    

<p>Modify the line with:</p>
<div class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gd">- minDeposit = _asset.decimals();
</span><span class="gi">+ minDeposit = 10 ** _asset.decimals();
</span></code></pre></div></div>
      <h4 id="developer-response-26">
        
        
          <a href="#developer-response-26" class="anchor-heading" aria-labelledby="developer-response-26"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Developer Response
        
        
      </h4>
    

<p>Acknowledged, partially fixed in <a href="https://github.com/groLabs/GSquared/pull/68">#68</a> and discussed in <a href="https://github.com/groLabs/GSquared/issues/28">#28</a>.</p>
      <h3 id="2-informational---fees-may-be-sent-to-address0">
        
        
          <a href="#2-informational---fees-may-be-sent-to-address0" class="anchor-heading" aria-labelledby="2-informational---fees-may-be-sent-to-address0"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 2. Informational - Fees may be sent to address(0)
        
        
      </h3>
    

<p>It is possible for <code class="language-plaintext highlighter-rouge">vaultFee</code> to be non-zero but the receiver of the fees, <code class="language-plaintext highlighter-rouge">feeCollector</code>, to remain the default <code class="language-plaintext highlighter-rouge">address(0)</code> value.</p>
      <h4 id="technical-details-27">
        
        
          <a href="#technical-details-27" class="anchor-heading" aria-labelledby="technical-details-27"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Technical Details
        
        
      </h4>
    

<p>The GVault default is to have <code class="language-plaintext highlighter-rouge">vaultFee</code> and <code class="language-plaintext highlighter-rouge">feeCollector</code> remain unset, which keeps them at the default values of <code class="language-plaintext highlighter-rouge">0</code> and <code class="language-plaintext highlighter-rouge">address(0)</code> respectively. It is possible for <code class="language-plaintext highlighter-rouge">vaultFee</code> to be set to a non-zero value while <code class="language-plaintext highlighter-rouge">feeCollector</code> remains at zero, resulting in fees getting sent to <code class="language-plaintext highlighter-rouge">address(0)</code>.</p>
      <h4 id="impact-27">
        
        
          <a href="#impact-27" class="anchor-heading" aria-labelledby="impact-27"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Impact
        
        
      </h4>
    

<p>Informational.</p>
      <h4 id="recommendation-27">
        
        
          <a href="#recommendation-27" class="anchor-heading" aria-labelledby="recommendation-27"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Recommendation
        
        
      </h4>
    

<p>Protections for owner errors are not strictly needed, but if guardrails against contract owner errors are worth some gas, consider this change:</p>
<div class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gi">+ error ZeroCollectorAddress();
</span>
function setVaultFee(uint256 _fee) external onlyOwner {
	if (_fee &gt;= 3000) revert Errors.VaultFeeTooHigh();
<span class="gi">+   if (_fee &gt; 0 &amp;&amp; feeCollector == address(0)) revert ZeroCollectorAddress();
</span>	vaultFee = _fee;
	emit LogNewVaultFee(_fee);
<span class="err">}</span>
</code></pre></div></div>
      <h4 id="developer-response-27">
        
        
          <a href="#developer-response-27" class="anchor-heading" aria-labelledby="developer-response-27"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Developer Response
        
        
      </h4>
    

<p>Acknowledged, won’t fix as mentioned in <a href="https://github.com/groLabs/GSquared/issues/29">#29</a>.</p>
      <h3 id="3-informational---missing-_minamount-check-in-redeem">
        
        
          <a href="#3-informational---missing-_minamount-check-in-redeem" class="anchor-heading" aria-labelledby="3-informational---missing-_minamount-check-in-redeem"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 3. Informational - Missing <code class="language-plaintext highlighter-rouge">_minAmount</code> check in <code class="language-plaintext highlighter-rouge">redeem</code>
        
        
      </h3>
    

<p><code class="language-plaintext highlighter-rouge">redeem</code> does not check if the <code class="language-plaintext highlighter-rouge">_minAmount</code> asset requirement is met. The other three similar functions check if the assets amount is at least <code class="language-plaintext highlighter-rouge">_minAmount</code>.</p>
      <h4 id="technical-details-28">
        
        
          <a href="#technical-details-28" class="anchor-heading" aria-labelledby="technical-details-28"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Technical Details
        
        
      </h4>
    

<p><a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/GVault.sol#L205"><code class="language-plaintext highlighter-rouge">deposit()</code></a> and <a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/GVault.sol#L232"><code class="language-plaintext highlighter-rouge">mint()</code></a> verify the deposit amount is greater than <code class="language-plaintext highlighter-rouge">minDeposit</code> while <a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/GVault.sol#L296"><code class="language-plaintext highlighter-rouge">withdraw()</code></a> checks that the asset amount is greater than the user-specified <code class="language-plaintext highlighter-rouge">_minAmount</code> before transferring tokens. <code class="language-plaintext highlighter-rouge">redeem()</code> does have a comparable minimum value check <a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/GVault.sol#L335">before assets are transferred</a>.</p>
      <h4 id="impact-28">
        
        
          <a href="#impact-28" class="anchor-heading" aria-labelledby="impact-28"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Impact
        
        
      </h4>
    

<p>Informational.</p>
      <h4 id="recommendation-28">
        
        
          <a href="#recommendation-28" class="anchor-heading" aria-labelledby="recommendation-28"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Recommendation
        
        
      </h4>
    

<p>Consider adding the line <code class="language-plaintext highlighter-rouge">if (_assets &lt; _minAmount) revert Errors.InsufficientAssets();</code> into <code class="language-plaintext highlighter-rouge">redeem()</code> to keep the GVault consistent with how it uses <code class="language-plaintext highlighter-rouge">_minAmount</code>.</p>
      <h4 id="developer-response-28">
        
        
          <a href="#developer-response-28" class="anchor-heading" aria-labelledby="developer-response-28"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Developer Response
        
        
      </h4>
    

<p>Acknowledged, won’t fix as mentioned in <a href="https://github.com/groLabs/GSquared/issues/30">#30</a>.</p>
      <h3 id="4-informational---_owner-argument-shadows-ownable-state-variable">
        
        
          <a href="#4-informational---_owner-argument-shadows-ownable-state-variable" class="anchor-heading" aria-labelledby="4-informational---_owner-argument-shadows-ownable-state-variable"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 4. Informational - <code class="language-plaintext highlighter-rouge">_owner</code> argument shadows Ownable state variable
        
        
      </h3>
    

<p>There is a function argument and a state variable with the name <code class="language-plaintext highlighter-rouge">_owner</code> in GVault.sol.</p>
      <h4 id="technical-details-29">
        
        
          <a href="#technical-details-29" class="anchor-heading" aria-labelledby="technical-details-29"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Technical Details
        
        
      </h4>
    

<p><code class="language-plaintext highlighter-rouge">withdraw()</code> in GVault.sol has <a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/GVault.sol#L277">a <code class="language-plaintext highlighter-rouge">_owner</code> argument</a> that shadows <a href="https://github.com/OpenZeppelin/openzeppelin-contracts/blob/a5445b0afb8b350417b6e6ab3160554967bc151f/contracts/access/Ownable.sol#L21">a state variable with the same name</a> in OpenZeppelin’s Ownable library.</p>
      <h4 id="impact-29">
        
        
          <a href="#impact-29" class="anchor-heading" aria-labelledby="impact-29"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Impact
        
        
      </h4>
    

<p>Informational.</p>
      <h4 id="recommendation-29">
        
        
          <a href="#recommendation-29" class="anchor-heading" aria-labelledby="recommendation-29"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Recommendation
        
        
      </h4>
    

<p>Consider renaming the function argument to a name other than <code class="language-plaintext highlighter-rouge">_owner</code> to avoid confusion over which variable is used.</p>
      <h4 id="developer-response-29">
        
        
          <a href="#developer-response-29" class="anchor-heading" aria-labelledby="developer-response-29"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Developer Response
        
        
      </h4>
    

<p>Acknowledged, won’t fix as mentioned in <a href="https://github.com/groLabs/GSquared/issues/31">#31</a>.</p>
      <h3 id="5-informational---junior-tranche-lacks-immediate-withdrawal-guarantees">
        
        
          <a href="#5-informational---junior-tranche-lacks-immediate-withdrawal-guarantees" class="anchor-heading" aria-labelledby="5-informational---junior-tranche-lacks-immediate-withdrawal-guarantees"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 5. Informational - Junior tranche lacks immediate withdrawal guarantees
        
        
      </h3>
    

<p>Depositors to the Junior Tranche not only are exposed to higher risk than the Senior Tranche, but are also exposed to the risk that their assets may not be possible to withdraw at all times. At worst, this could cause a “leach attack”.</p>
      <h4 id="technical-details-30">
        
        
          <a href="#technical-details-30" class="anchor-heading" aria-labelledby="technical-details-30"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Technical Details
        
        
      </h4>
    

<p>In order to deposit in the Senior Tranche, there must be sufficient value in the Junior Tranche to protect Senior Tranche deposits. This means that if the Junior Tranche protects the Senior Tranche 1-to-1 and there is 100% utilization, no Junior Tranche funds can be withdraw. In the event that all depositors to the Junior Tranche wish to withdraw, there could be a “bank run” where the first users to withdrawer receive their funds, but when the utilization ratio hits 100%, no Junior Tranche funds can be withdrawn because they are needed to protect the funds in the Senior Tranche. This behaviour is the norm for tranche structures, but users who have not interacted with such a pool design may not clearly understand the limitations of the system. This could be problematic for users if they have a loan in a protocol like Aave that is about to be liquidated and they cannot withdraw their funds from the Junior Tranche to increase their loan collateralization ratio.</p>

<p>A real scenario where this would be incentivized to take place is a “leach attack”, when the fixed yield on the Senior Tranche exceeds what the underlying vault is capable of producing and the Senior Tranche depositors leach off the Junior Tranche value. If the Senior Tranche promised an absurdly high fixed yield, or if the underlying vault yield drops to a near-zero value, the Senior Tranche depositors would be more incentivized to keep their token in the Senior Tranche to receive the “impossibly good” yield, even though the yield the Senior Tranche is receiving is being taken from the token value of the Junior Tranche depositors (because the yield from the vault cannot cover the fixed yield amount). It is true that the tranche owner can set the fixed rate with <code class="language-plaintext highlighter-rouge">setRate()</code>, but there may be a delay before this happens (possibly a DAO vote), during which time value could be leached from Junior Tranche depositors and the Junior Tranche depositors would be unable to withdraw because 1. the utilization ratio does not permit it 2. the leaching causes a loss of value in the Junior Tranche which makes the utilization ratio even worse.</p>
      <h4 id="impact-30">
        
        
          <a href="#impact-30" class="anchor-heading" aria-labelledby="impact-30"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Impact
        
        
      </h4>
    

<p>Informational.</p>
      <h4 id="recommendation-30">
        
        
          <a href="#recommendation-30" class="anchor-heading" aria-labelledby="recommendation-30"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Recommendation
        
        
      </h4>
    

<p>Document clearly the lack of guarantees around immediate withdrawal for the Junior Tranche to try to prevent users from making poor decisions.</p>
      <h4 id="developer-response-30">
        
        
          <a href="#developer-response-30" class="anchor-heading" aria-labelledby="developer-response-30"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Developer Response
        
        
      </h4>
    

<p>Acknowledged, no need to make changes to fix this as mentioned in <a href="https://github.com/groLabs/GSquared/issues/32">#32</a>.</p>
      <h3 id="6-informational---change-call-sequence-for-reentrancy-mitigation">
        
        
          <a href="#6-informational---change-call-sequence-for-reentrancy-mitigation" class="anchor-heading" aria-labelledby="6-informational---change-call-sequence-for-reentrancy-mitigation"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 6. Informational - Change call sequence for reentrancy mitigation
        
        
      </h3>
    

<p><code class="language-plaintext highlighter-rouge">_withdraw()</code>, <code class="language-plaintext highlighter-rouge">redeem()</code>, and <code class="language-plaintext highlighter-rouge">report()</code> should change the order of transferring assets and updating <code class="language-plaintext highlighter-rouge">vaultAssets</code> to follow checks-effects-interactions and get one step closer to not needing the <code class="language-plaintext highlighter-rouge">nonReentrant</code> modifiers.</p>
      <h4 id="technical-details-31">
        
        
          <a href="#technical-details-31" class="anchor-heading" aria-labelledby="technical-details-31"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Technical Details
        
        
      </h4>
    

<p>In <code class="language-plaintext highlighter-rouge">_withdraw()</code>, funds are <a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/GVault.sol#L300">transferred out of the GVault before the <code class="language-plaintext highlighter-rouge">vaultAssets</code> state variable is updated</a>. According to checks-effects-interactions, the external interactions should happen last, meaning the <code class="language-plaintext highlighter-rouge">vaultAssets</code> variable should be updated before funds are transferred. This is what the <a href="https://github.com/transmissions11/solmate/blob/3a752b8c83427ed1ea1df23f092ea7a810205b6c/src/mixins/ERC4626.sol#L88-L92">solmate ERC4626 implementation does</a> by calling the internal <code class="language-plaintext highlighter-rouge">_burn()</code> first to update the <code class="language-plaintext highlighter-rouge">totalSupply</code> value before transferring funds, which is <a href="https://github.com/transmissions11/solmate/blob/3a752b8c83427ed1ea1df23f092ea7a810205b6c/src/mixins/ERC4626.sol#L64-L66">the opposite of when the transfer happens</a> relative to <code class="language-plaintext highlighter-rouge">_mint()</code> in <code class="language-plaintext highlighter-rouge">mint()</code>. The same change can be applied to <a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/GVault.sol#L336"><code class="language-plaintext highlighter-rouge">redeem()</code></a> and <code class="language-plaintext highlighter-rouge">report()</code> (<a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/GVault.sol#L656">1</a>, <a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/GVault.sol#L663">2</a>).</p>
      <h4 id="impact-31">
        
        
          <a href="#impact-31" class="anchor-heading" aria-labelledby="impact-31"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Impact
        
        
      </h4>
    

<p>Informational.</p>
      <h4 id="recommendation-31">
        
        
          <a href="#recommendation-31" class="anchor-heading" aria-labelledby="recommendation-31"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Recommendation
        
        
      </h4>
    

<p>Consider changing the order of operations so the subtraction from <code class="language-plaintext highlighter-rouge">vaultAssets</code> happens before assets are transferred outside of the GVault. This may allow the <code class="language-plaintext highlighter-rouge">nonReentrant</code> modifier to be removed in the future.</p>
      <h4 id="developer-response-31">
        
        
          <a href="#developer-response-31" class="anchor-heading" aria-labelledby="developer-response-31"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Developer Response
        
        
      </h4>
    

<p>Acknowledged, won’t fix as mentioned in <a href="https://github.com/groLabs/GSquared/issues/33">#33</a>.</p>
      <h3 id="7-informational---undocumented-assumption-of-private-gelato-mempool">
        
        
          <a href="#7-informational---undocumented-assumption-of-private-gelato-mempool" class="anchor-heading" aria-labelledby="7-informational---undocumented-assumption-of-private-gelato-mempool"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 7. Informational - Undocumented assumption of private Gelato mempool
        
        
      </h3>
    

<p>The design of the protocol assumes Gelato jobs execute transactions in a way that is MEV resistant. Gelato’s public documentation does not clearly state this is guaranteed. If this assumption is broken, the protocol could lose value.</p>
      <h4 id="technical-details-32">
        
        
          <a href="#technical-details-32" class="anchor-heading" aria-labelledby="technical-details-32"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Technical Details
        
        
      </h4>
    

<p>MEV protection mitigates the risk of a frontrun, backrun, or sandwich that can extract value from a transaction. This most often happens during swap operations. The design of Gro Protocol assumes that when a Gelato keeper executes a transaction, there will be MEV protection. The <a href="https://docs.gelato.network/introduction/what-is-gelato">Gelato documentation</a> does not clarify that this is a guarantee that keepers offer and whether there is still risk of an uncle bandit attack. The MEV mitigation is expected to exist based on discussions with the Gro devs, but the lack of official documentation around the mempool guarantees provided by Gelato jobs, the possibility of changes over time, and the risk of a rogue Gelato keeper are all possible concerns with this approach.</p>
      <h4 id="impact-32">
        
        
          <a href="#impact-32" class="anchor-heading" aria-labelledby="impact-32"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Impact
        
        
      </h4>
    

<p>Informational.</p>
      <h4 id="recommendation-32">
        
        
          <a href="#recommendation-32" class="anchor-heading" aria-labelledby="recommendation-32"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Recommendation
        
        
      </h4>
    

<p>Gelato should clarify their approach to MEV protection for Gelato jobs. Before Gelato update their documentation, Gro should monitor the keeper-controlled actions in Gro for any potential foul play.</p>
      <h4 id="developer-response-32">
        
        
          <a href="#developer-response-32" class="anchor-heading" aria-labelledby="developer-response-32"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Developer Response
        
        
      </h4>
    

<p>Acknowledged, will make a note about this in docs and inform Gelato as mentioned in <a href="https://github.com/groLabs/GSquared/issues/34">#34</a>.</p>
      <h3 id="8-informational---inconsistent-interface-files">
        
        
          <a href="#8-informational---inconsistent-interface-files" class="anchor-heading" aria-labelledby="8-informational---inconsistent-interface-files"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 8. Informational - Inconsistent interface files
        
        
      </h3>
    

<p>The <code class="language-plaintext highlighter-rouge">metapool</code> in ConvexStrategy is cast with ICurveMeta or ICurve3Pool depending on the context. It would be best to keep the casting consistent.</p>
      <h4 id="technical-details-33">
        
        
          <a href="#technical-details-33" class="anchor-heading" aria-labelledby="technical-details-33"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Technical Details
        
        
      </h4>
    

<p><code class="language-plaintext highlighter-rouge">metapool</code> is <a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/strategy/ConvexStrategy.sol#L1105">cast as ICurve3Pool here</a> because <code class="language-plaintext highlighter-rouge">get_virtual_price()</code> is found in the external Curve3Pool contract and is inherited by the metapool contract. However, the same could be said about <code class="language-plaintext highlighter-rouge">remove_liquidity_one_coin()</code>, but <code class="language-plaintext highlighter-rouge">metapool</code> is cast as ICurveMeta when removing liquidity (<a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/strategy/ConvexStrategy.sol#L833">1</a>, <a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/strategy/ConvexStrategy.sol#L863">2</a>, <a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/strategy/ConvexStrategy.sol#L878">3</a>) because the Curve3Pool usage in ConvexStrategy didn’t use that function.</p>
      <h4 id="impact-33">
        
        
          <a href="#impact-33" class="anchor-heading" aria-labelledby="impact-33"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Impact
        
        
      </h4>
    

<p>Informational.</p>
      <h4 id="recommendation-33">
        
        
          <a href="#recommendation-33" class="anchor-heading" aria-labelledby="recommendation-33"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Recommendation
        
        
      </h4>
    

<p>Copy <code class="language-plaintext highlighter-rouge">get_virtual_price()</code> from ICurve3Pool to ICurveMeta to allow consistent casting of <code class="language-plaintext highlighter-rouge">metapool</code> to ICurveMeta.</p>
      <h4 id="developer-response-33">
        
        
          <a href="#developer-response-33" class="anchor-heading" aria-labelledby="developer-response-33"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Developer Response
        
        
      </h4>
    

<p>Acknowledged, fixed in <a href="https://github.com/groLabs/GSquared/pull/72">#72</a> and discussed in <a href="https://github.com/groLabs/GSquared/issues/35">#35</a>.</p>
      <h3 id="9-informational---inconsistent-uniswap-array-indices">
        
        
          <a href="#9-informational---inconsistent-uniswap-array-indices" class="anchor-heading" aria-labelledby="9-informational---inconsistent-uniswap-array-indices"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 9. Informational - Inconsistent Uniswap array indices
        
        
      </h3>
    

<p>The quantity of output tokens from <code class="language-plaintext highlighter-rouge">getAmountsOut()</code> in Uniswap V2 is referenced in two different ways in ConvexStrategy. It would be best to maintain a consistent approach.</p>
      <h4 id="technical-details-34">
        
        
          <a href="#technical-details-34" class="anchor-heading" aria-labelledby="technical-details-34"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Technical Details
        
        
      </h4>
    

<p>Uniswap references the amountOut value with <code class="language-plaintext highlighter-rouge">amounts[amounts.length - 1]</code> with comparing that value to <code class="language-plaintext highlighter-rouge">amountOutMin</code>, and this approach <a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/strategy/ConvexStrategy.sol#L543">is found once in ConvexStrategy</a>. Another approach of hard coding <a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/strategy/ConvexStrategy.sol#L690">an index of 1 is found elsewhere</a>.</p>
      <h4 id="impact-34">
        
        
          <a href="#impact-34" class="anchor-heading" aria-labelledby="impact-34"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Impact
        
        
      </h4>
    

<p>Informational.</p>
      <h4 id="recommendation-34">
        
        
          <a href="#recommendation-34" class="anchor-heading" aria-labelledby="recommendation-34"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Recommendation
        
        
      </h4>
    

<p>Reference <a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/strategy/ConvexStrategy.sol#L690">the amount out value here</a> with <code class="language-plaintext highlighter-rouge">swap[swap.length - 1]</code> to stay consistent with Uniswap V2.</p>
      <h4 id="developer-response-34">
        
        
          <a href="#developer-response-34" class="anchor-heading" aria-labelledby="developer-response-34"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Developer Response
        
        
      </h4>
    

<p>Acknowledged, fixed in <a href="https://github.com/groLabs/GSquared/pull/73">#73</a> and discussed in <a href="https://github.com/groLabs/GSquared/issues/36">#36</a>.</p>
      <h3 id="10-informational---_additionalrewardtokens-works-in-unexpected-way">
        
        
          <a href="#10-informational---_additionalrewardtokens-works-in-unexpected-way" class="anchor-heading" aria-labelledby="10-informational---_additionalrewardtokens-works-in-unexpected-way"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 10. Informational - <code class="language-plaintext highlighter-rouge">_additionalRewardTokens()</code> works in unexpected way
        
        
      </h3>
    

<p><code class="language-plaintext highlighter-rouge">rewards()</code> in ConvexStrategy looks like it should return the estimated rewards that would be received if <code class="language-plaintext highlighter-rouge">sellAllRewards()</code> is called. But <code class="language-plaintext highlighter-rouge">_additionalRewardTokens()</code> in <code class="language-plaintext highlighter-rouge">rewards()</code> does not estimate the pending additional reward tokens, it just sums up the additional reward tokens that are already held by ConvexStrategy, which most often will be zero because the reward tokens will already have been swapped and reinvested.</p>
      <h4 id="technical-details-35">
        
        
          <a href="#technical-details-35" class="anchor-heading" aria-labelledby="technical-details-35"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Technical Details
        
        
      </h4>
    

<p>In <code class="language-plaintext highlighter-rouge">rewards()</code>, <a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/strategy/ConvexStrategy.sol#L514"><code class="language-plaintext highlighter-rouge">_additionalRewardTokens()</code> is summed with <code class="language-plaintext highlighter-rouge">_claimableRewards()</code></a>. The latter returns the value of claimable rewards that can be received if <code class="language-plaintext highlighter-rouge">getReward()</code> is called as it is in <code class="language-plaintext highlighter-rouge">sellAllRewards()</code>. In contrast, <code class="language-plaintext highlighter-rouge">_additionalRewardTokens()</code> does not do this. Instead, <code class="language-plaintext highlighter-rouge">_additionalRewardTokens()</code> sums <a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/strategy/ConvexStrategy.sol#L572">the current balance of award tokens</a> in the strategy. This can result in a different value than the return value of <code class="language-plaintext highlighter-rouge">sellAllRewards()</code>, which is likely unexpected behaviour.</p>
      <h4 id="impact-35">
        
        
          <a href="#impact-35" class="anchor-heading" aria-labelledby="impact-35"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Impact
        
        
      </h4>
    

<p>Informational.</p>
      <h4 id="recommendation-35">
        
        
          <a href="#recommendation-35" class="anchor-heading" aria-labelledby="recommendation-35"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Recommendation
        
        
      </h4>
    

<p>Modify <code class="language-plaintext highlighter-rouge">_additionalRewardTokens()</code> to calculate the estimated additional reward tokens that will be received from Convex instead of the additional tokens already held in the strategy contract.</p>
      <h4 id="developer-response-35">
        
        
          <a href="#developer-response-35" class="anchor-heading" aria-labelledby="developer-response-35"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Developer Response
        
        
      </h4>
    

<p>Acknowledged, will fix in a future update. Discussed in <a href="https://github.com/groLabs/GSquared/issues/37">#37</a>.</p>
      <h3 id="11-informational---non-ideal-_selladditionalrewards-min-reward-limit">
        
        
          <a href="#11-informational---non-ideal-_selladditionalrewards-min-reward-limit" class="anchor-heading" aria-labelledby="11-informational---non-ideal-_selladditionalrewards-min-reward-limit"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 11. Informational - Non-ideal <code class="language-plaintext highlighter-rouge">_sellAdditionalRewards()</code> min reward limit
        
        
      </h3>
    

<p><code class="language-plaintext highlighter-rouge">_sellAdditionalRewards()</code> uses a fixed minimum reward limit of 1E18 to determine whether to swap rewards to WETH or not. However, 1E18 can mean wildly different values for different tokens, and because the <code class="language-plaintext highlighter-rouge">rewardTokens</code> array can be changed depending on the current rewards, using a constant here is not an ideal choice.</p>
      <h4 id="technical-details-36">
        
        
          <a href="#technical-details-36" class="anchor-heading" aria-labelledby="technical-details-36"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Technical Details
        
        
      </h4>
    

<p>Consider a value different from <a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/strategy/ConvexStrategy.sol#L682">the current <code class="language-plaintext highlighter-rouge">MIN_REWARD_SELL_AMOUNT</code> used in <code class="language-plaintext highlighter-rouge">_sellAdditionalRewards()</code></a> because different tokens have different decimals values and different values. A more flexible choice of value would be preferable to enable flexibility with future reward tokens.</p>
      <h4 id="impact-36">
        
        
          <a href="#impact-36" class="anchor-heading" aria-labelledby="impact-36"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Impact
        
        
      </h4>
    

<p>Informational.</p>
      <h4 id="recommendation-36">
        
        
          <a href="#recommendation-36" class="anchor-heading" aria-labelledby="recommendation-36"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Recommendation
        
        
      </h4>
    

<p>Consider using <code class="language-plaintext highlighter-rouge">10**(IERC20(reward_token).decimals())</code> instead of the fixed 1E18 value, or consider a modifiable value in case high value tokens similar to WBTC or WETH are reward tokens.</p>
      <h4 id="developer-response-36">
        
        
          <a href="#developer-response-36" class="anchor-heading" aria-labelledby="developer-response-36"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Developer Response
        
        
      </h4>
    

<p>Acknowledged, will fix in a future update. Discussed in <a href="https://github.com/groLabs/GSquared/issues/38">#38</a>.</p>
      <h3 id="12-informational---strategy-migration-logic-can-revert">
        
        
          <a href="#12-informational---strategy-migration-logic-can-revert" class="anchor-heading" aria-labelledby="12-informational---strategy-migration-logic-can-revert"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 12. Informational - Strategy migration logic can revert
        
        
      </h3>
    

<p>When <code class="language-plaintext highlighter-rouge">divest()</code> is called with slippage set to true, the call can revert. This can happen when a migration is attempted because <code class="language-plaintext highlighter-rouge">realisePnl()</code> calls <code class="language-plaintext highlighter-rouge">divest()</code> with slippage set to true.</p>
      <h4 id="technical-details-37">
        
        
          <a href="#technical-details-37" class="anchor-heading" aria-labelledby="technical-details-37"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Technical Details
        
        
      </h4>
    

<p><code class="language-plaintext highlighter-rouge">divestAll()</code> is written to avoid a revert condition at all costs because it is intended to be used for the emergency scenario where reverting is not an option. <code class="language-plaintext highlighter-rouge">divestAll()</code> is <a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/strategy/ConvexStrategy.sol#L932">called immediately before</a> <code class="language-plaintext highlighter-rouge">migratePool()</code>. After the migration, <code class="language-plaintext highlighter-rouge">realisePnl()</code> is called which has has <code class="language-plaintext highlighter-rouge">divest()</code> calls (<a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/strategy/ConvexStrategy.sol#L787">1</a>, <a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/strategy/ConvexStrategy.sol#L798">2</a>) which offer an opportunity for a revert to happen. This could prevent the migration from happening in some circumstances.</p>
      <h4 id="impact-37">
        
        
          <a href="#impact-37" class="anchor-heading" aria-labelledby="impact-37"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Impact
        
        
      </h4>
    

<p>Informational.</p>
      <h4 id="recommendation-37">
        
        
          <a href="#recommendation-37" class="anchor-heading" aria-labelledby="recommendation-37"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Recommendation
        
        
      </h4>
    

<p>Consider how the strategy owner would proceed with the migration in this revert scenario.</p>
      <h4 id="developer-response-37">
        
        
          <a href="#developer-response-37" class="anchor-heading" aria-labelledby="developer-response-37"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Developer Response
        
        
      </h4>
    

<p>Acknowledged, won’t fix in the code but will add docs so this is handled properly. Discussed in <a href="https://github.com/groLabs/GSquared/issues/39">#39</a>.</p>
      <h3 id="13-informational---theoretical-casting-overflow">
        
        
          <a href="#13-informational---theoretical-casting-overflow" class="anchor-heading" aria-labelledby="13-informational---theoretical-casting-overflow"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 13. Informational - Theoretical casting overflow
        
        
      </h3>
    

<p>Casting is not protected by SafeMath and could overflow. There is one case where this may happen.</p>
      <h4 id="technical-details-38">
        
        
          <a href="#technical-details-38" class="anchor-heading" aria-labelledby="technical-details-38"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Technical Details
        
        
      </h4>
    

<p><a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/strategy/stop-loss/StopLossLogic.sol#L116">This line of StopLossLogic</a> casts a uint256 <code class="language-plaintext highlighter-rouge">dy_diff</code> to an int256 value. It is possible a very large unsigned value would be converted to a negative number.</p>
      <h4 id="impact-38">
        
        
          <a href="#impact-38" class="anchor-heading" aria-labelledby="impact-38"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Impact
        
        
      </h4>
    

<p>Informational.</p>
      <h4 id="recommendation-38">
        
        
          <a href="#recommendation-38" class="anchor-heading" aria-labelledby="recommendation-38"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Recommendation
        
        
      </h4>
    

<p>Consider protecting against this casting overflow.</p>
      <h4 id="developer-response-38">
        
        
          <a href="#developer-response-38" class="anchor-heading" aria-labelledby="developer-response-38"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Developer Response
        
        
      </h4>
    

<p>Acknowledged, won’t fix due to low probability. Discussed in <a href="https://github.com/groLabs/GSquared/issues/40">#40</a>.</p>
      <h3 id="14-informational---differing-approach-to-keeper-role">
        
        
          <a href="#14-informational---differing-approach-to-keeper-role" class="anchor-heading" aria-labelledby="14-informational---differing-approach-to-keeper-role"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 14. Informational - Differing approach to keeper role
        
        
      </h3>
    

<p>GStrategyGuard only allows a single keeper address while ConvexStrategy maintains a mapping of addresses to store multiple keepers. If GStrategyGuard is intended to have the same keeper addresses as ConvexStrategy, it should use a mapping.</p>
      <h4 id="technical-details-39">
        
        
          <a href="#technical-details-39" class="anchor-heading" aria-labelledby="technical-details-39"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Technical Details
        
        
      </h4>
    

<p>The <code class="language-plaintext highlighter-rouge">keeper</code> variable in GStrategyGuard <a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/strategy/keeper/GStrategyGuard.sol#L57">stores a single address</a> while <a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/strategy/ConvexStrategy.sol#L235">a similar <code class="language-plaintext highlighter-rouge">keepers</code> variable in ConvexStrategy</a> allows for multiple addresses to serve as keepers. Allowing more keepers provides more flexibility if Gelato changes their operations to have multiple addresses executing transactions, or to allow the owner address to serve as a keeper.</p>
      <h4 id="impact-39">
        
        
          <a href="#impact-39" class="anchor-heading" aria-labelledby="impact-39"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Impact
        
        
      </h4>
    

<p>Informational.</p>
      <h4 id="recommendation-39">
        
        
          <a href="#recommendation-39" class="anchor-heading" aria-labelledby="recommendation-39"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Recommendation
        
        
      </h4>
    

<p>Consider using a keepers mapping in GStrategyGuard to allow for multiple keeper addresses.</p>
      <h4 id="developer-response-39">
        
        
          <a href="#developer-response-39" class="anchor-heading" aria-labelledby="developer-response-39"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Developer Response
        
        
      </h4>
    

<p>Acknowledged, fixed in <a href="https://github.com/groLabs/GSquared/pull/75">#75</a> and discussed in <a href="https://github.com/groLabs/GSquared/issues/41">#41</a>.</p>
      <h3 id="15-informational---duplicate-strategies-possible-with-setstrategies">
        
        
          <a href="#15-informational---duplicate-strategies-possible-with-setstrategies" class="anchor-heading" aria-labelledby="15-informational---duplicate-strategies-possible-with-setstrategies"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 15. Informational - Duplicate strategies possible with <code class="language-plaintext highlighter-rouge">setStrategies()</code>
        
        
      </h3>
    

<p><code class="language-plaintext highlighter-rouge">setStrategies()</code> can store the same strategy more than once in the <code class="language-plaintext highlighter-rouge">strategies</code> array. This is specifically prevented in <code class="language-plaintext highlighter-rouge">_addStrategy()</code>, unlike many owner-controlled functions which have no safety guards.</p>
      <h4 id="technical-details-40">
        
        
          <a href="#technical-details-40" class="anchor-heading" aria-labelledby="technical-details-40"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Technical Details
        
        
      </h4>
    

<p><code class="language-plaintext highlighter-rouge">_addStrategy()</code> <a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/strategy/keeper/GStrategyGuard.sol#L122-L124">does not permit a strategy to be added to the <code class="language-plaintext highlighter-rouge">strategies</code> array</a> if it is already in the array. But the owner could use <code class="language-plaintext highlighter-rouge">setStrategies()</code> to do the same.</p>
      <h4 id="impact-40">
        
        
          <a href="#impact-40" class="anchor-heading" aria-labelledby="impact-40"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Impact
        
        
      </h4>
    

<p>Informational.</p>
      <h4 id="recommendation-40">
        
        
          <a href="#recommendation-40" class="anchor-heading" aria-labelledby="recommendation-40"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Recommendation
        
        
      </h4>
    

<p>Remove the safety check for duplicate strategies in <code class="language-plaintext highlighter-rouge">_addStrategy()</code> which provides a false sense of security.</p>
      <h4 id="developer-response-40">
        
        
          <a href="#developer-response-40" class="anchor-heading" aria-labelledby="developer-response-40"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Developer Response
        
        
      </h4>
    

<p>Acknowledged, will fix in a future update. Discussed in <a href="https://github.com/groLabs/GSquared/issues/42">#42</a>.</p>
      <h3 id="16-informational---unnecessary-erc4626-casting">
        
        
          <a href="#16-informational---unnecessary-erc4626-casting" class="anchor-heading" aria-labelledby="16-informational---unnecessary-erc4626-casting"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 16. Informational - Unnecessary ERC4626 casting
        
        
      </h3>
    

<p>The return value from FixedTokensCurve’s <code class="language-plaintext highlighter-rouge">getYieldToken()</code> is of type ERC4626, so the places where this return value is cast to an ERC4626 does unnecessary casting.</p>
      <h4 id="technical-details-41">
        
        
          <a href="#technical-details-41" class="anchor-heading" aria-labelledby="technical-details-41"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Technical Details
        
        
      </h4>
    

<p><code class="language-plaintext highlighter-rouge">getYieldToken()</code> in FixedTokensCurve <a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/utils/FixedTokensCurve.sol#L113">returns an ERC4626 value</a>. But GTranche needlessly casts this return value to an ERC4626 in several places (<a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/GTranche.sol#L170">1</a>, <a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/GTranche.sol#L231">2</a>, <a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/GTranche.sol#L466">3</a>, <a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/GTranche.sol#L542">4</a>).</p>
      <h4 id="impact-41">
        
        
          <a href="#impact-41" class="anchor-heading" aria-labelledby="impact-41"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Impact
        
        
      </h4>
    

<p>Informational.</p>
      <h4 id="recommendation-41">
        
        
          <a href="#recommendation-41" class="anchor-heading" aria-labelledby="recommendation-41"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Recommendation
        
        
      </h4>
    

<p>Remove needless ERC4626 casting.</p>
      <h4 id="developer-response-41">
        
        
          <a href="#developer-response-41" class="anchor-heading" aria-labelledby="developer-response-41"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Developer Response
        
        
      </h4>
    

<p>Acknowledged, fixed in <a href="https://github.com/groLabs/GSquared/pull/71">#71</a> and discussed in <a href="https://github.com/groLabs/GSquared/issues/43">#43</a>.</p>
      <h3 id="17-informational---getswappingprice-doesnt-make-sense-with-single-strategy-and-vault">
        
        
          <a href="#17-informational---getswappingprice-doesnt-make-sense-with-single-strategy-and-vault" class="anchor-heading" aria-labelledby="17-informational---getswappingprice-doesnt-make-sense-with-single-strategy-and-vault"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 17. Informational - <code class="language-plaintext highlighter-rouge">getSwappingPrice()</code> doesn’t make sense with single strategy and vault
        
        
      </h3>
    

<p><code class="language-plaintext highlighter-rouge">getSwappingPrice()</code> is intended to <code class="language-plaintext highlighter-rouge">get swapping price between to underlying assets in the tranche</code> but this function and its implementation doesn’t make sense when only one ERC4626 is deposited into the tranche.</p>
      <h4 id="technical-details-42">
        
        
          <a href="#technical-details-42" class="anchor-heading" aria-labelledby="technical-details-42"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Technical Details
        
        
      </h4>
    

<p>The Gro protocol as examined only has one token that is deposited into it, as <a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/utils/FixedTokensCurve.sol#L118">the return value of <code class="language-plaintext highlighter-rouge">getYieldToken()</code> shows</a>. The <a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/oracles/CurveOracle.sol#L46">current implementation of <code class="language-plaintext highlighter-rouge">getSwappingPrice()</code></a> allows any uint256 input values for function arguments <code class="language-plaintext highlighter-rouge">i</code> and <code class="language-plaintext highlighter-rouge">j</code> and always returns the input <code class="language-plaintext highlighter-rouge">_amount</code> which implies a 1-to-1 exchange rate between token <code class="language-plaintext highlighter-rouge">i</code> and token <code class="language-plaintext highlighter-rouge">j</code>. This return value doesn’t make sense. It would make more sense to follow an implementation like <a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/utils/FixedTokensCurve.sol#L118"><code class="language-plaintext highlighter-rouge">getYieldToken()</code> shows</a> and only allow an <code class="language-plaintext highlighter-rouge">i</code> and <code class="language-plaintext highlighter-rouge">j</code> value of zero, reverting in other cases.</p>
      <h4 id="impact-42">
        
        
          <a href="#impact-42" class="anchor-heading" aria-labelledby="impact-42"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Impact
        
        
      </h4>
    

<p>Informational.</p>
      <h4 id="recommendation-42">
        
        
          <a href="#recommendation-42" class="anchor-heading" aria-labelledby="recommendation-42"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Recommendation
        
        
      </h4>
    

<p>Consider a different implementation for <code class="language-plaintext highlighter-rouge">getSwappingPrice()</code> rather than returning a value that assumes a 1-to-1 exchange rate between arbitrary input tokens. The function is not called by the existing Gro implementation so it is not very important.</p>
      <h4 id="developer-response-42">
        
        
          <a href="#developer-response-42" class="anchor-heading" aria-labelledby="developer-response-42"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Developer Response
        
        
      </h4>
    

<p>Acknowledged, won’t fix for reasons mentioned in <a href="https://github.com/groLabs/GSquared/issues/44">#44</a>.</p>
      <h3 id="18-informational---no-upper-limit-to-junior-tranche-leverage-or-fixed-yield">
        
        
          <a href="#18-informational---no-upper-limit-to-junior-tranche-leverage-or-fixed-yield" class="anchor-heading" aria-labelledby="18-informational---no-upper-limit-to-junior-tranche-leverage-or-fixed-yield"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 18. Informational - No upper limit to Junior Tranche leverage or fixed yield
        
        
      </h3>
    

<p>The Gro protocol has no upper limit to the leverage that a Junior Tranche can take on or the fixed yield owed to the Senior Tranche. In theory, a Junior Tranche could have 10,000x leverage when borrowing from a Senior Tranche. It is also possible to create a Senior Tranche with exceptionally good yield but that is unsustainable. The stability of the protocol at such extreme leverage values or fixed yield amounts could result in unexpected behaviour.</p>
      <h4 id="technical-details-43">
        
        
          <a href="#technical-details-43" class="anchor-heading" aria-labelledby="technical-details-43"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Technical Details
        
        
      </h4>
    

<p>Setting an upper bound on the leverage available to a Junior Tranche, and therefore a lower bound on the protection available to Senior Tranche depositors, may be prudent to avoid blatant misuse of the Gro tranche design. Additionally consider a limit on the fixed yield amount, which could be adjusted by the protocol owner depending on market conditions. Be aware that the yield in the tranche design is dollar denominated, so if the underlying asset drops in value, there could be issues in paying the fixed yield to the Senior Tranche.</p>

<p>We can take one example of the Junior Tranche taking 20x leverage by borrowing from the Senior Tranche, with a fixed Senior Tranche yield of 2%:</p>

<p><code class="language-plaintext highlighter-rouge">100% utilizationRatio * (20x leverage - 1x from Junior Tranche) * 2% Senior Tranche Fixed Yield = 38% borrowing cost owed to Senior Tranche</code></p>

<p>Due to the amount of leverage in the Junior Tranche and the yield promised to the Senior Tranche depositors, the Junior Tranche could easily see losses if it cannot continue to deliver the 38% yield.</p>
      <h4 id="impact-43">
        
        
          <a href="#impact-43" class="anchor-heading" aria-labelledby="impact-43"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Impact
        
        
      </h4>
    

<p>Informational.</p>
      <h4 id="recommendation-43">
        
        
          <a href="#recommendation-43" class="anchor-heading" aria-labelledby="recommendation-43"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Recommendation
        
        
      </h4>
    

<p>Set an owner-controlled <code class="language-plaintext highlighter-rouge">utilisationThreshold</code> maximum to prevent the Junior Tranche from taking an extremely leveraged position and providing too little protection to the Senior Tranche. A similar approach for <code class="language-plaintext highlighter-rouge">fixedRate.rate</code> yield maximum would help with overpromising Senior Tranche depositors with an unsustainable model. One approach might be to verify that the product of the Senior Tranche fixed yield and the leverage is less than a certain owner-controlled value (say, 50%). If the goal is to cater to yield farming degens, this limit may not be necessary.</p>
      <h4 id="developer-response-43">
        
        
          <a href="#developer-response-43" class="anchor-heading" aria-labelledby="developer-response-43"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Developer Response
        
        
      </h4>
    

<p>Acknowledged, won’t fix for reasons mentioned in <a href="https://github.com/groLabs/GSquared/issues/45">#45</a>.</p>
      <h3 id="19-informational---multiple-migration-functions-increase-tranchebalances">
        
        
          <a href="#19-informational---multiple-migration-functions-increase-tranchebalances" class="anchor-heading" aria-labelledby="19-informational---multiple-migration-functions-increase-tranchebalances"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 19. Informational - Multiple migration functions increase <code class="language-plaintext highlighter-rouge">trancheBalances</code>
        
        
      </h3>
    

<p>The <code class="language-plaintext highlighter-rouge">trancheBalances</code> mapping stores the internal accounting balances for the tokens held by the Senior Tranche and Junior Tranche. There are two migration functions in GTranche, <code class="language-plaintext highlighter-rouge">migrateFromOldTranche()</code> and <code class="language-plaintext highlighter-rouge">migrate()</code>. It appears as though only one should be used, but in the event that both are used, the <code class="language-plaintext highlighter-rouge">trancheBalances</code> mapping may double count or overcount the tokens in each of the tranches.</p>
      <h4 id="technical-details-44">
        
        
          <a href="#technical-details-44" class="anchor-heading" aria-labelledby="technical-details-44"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Technical Details
        
        
      </h4>
    

<p><code class="language-plaintext highlighter-rouge">migrateFromOldTranche()</code> <a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/GTranche.sol#L483">increases the tranche balances here</a>. <code class="language-plaintext highlighter-rouge">migrate()</code> <a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/GTranche.sol#L530">does so here</a>. The two migration functions appear to serve different purposes, but a boolean protecting the two functions from both getting called does not exist. Instead, <code class="language-plaintext highlighter-rouge">hasMigratedFromOldTranche</code> is <a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/GTranche.sol#L460">only found in <code class="language-plaintext highlighter-rouge">migrateFromOldTranche()</code></a>.</p>
      <h4 id="impact-44">
        
        
          <a href="#impact-44" class="anchor-heading" aria-labelledby="impact-44"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Impact
        
        
      </h4>
    

<p>Informational.</p>
      <h4 id="recommendation-44">
        
        
          <a href="#recommendation-44" class="anchor-heading" aria-labelledby="recommendation-44"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Recommendation
        
        
      </h4>
    

<p>Add a similar check for the value of <code class="language-plaintext highlighter-rouge">hasMigratedFromOldTranche</code> in <code class="language-plaintext highlighter-rouge">migrate()</code>, as well as toggling this boolean to true, like <a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/GTranche.sol#L460">what is found in <code class="language-plaintext highlighter-rouge">migrateFromOldTranche()</code></a>. This would prevent <code class="language-plaintext highlighter-rouge">migrate()</code> from getting called more than once and would prevent both migration functions from being called in the same GTranche.</p>
      <h4 id="developer-response-44">
        
        
          <a href="#developer-response-44" class="anchor-heading" aria-labelledby="developer-response-44"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Developer Response
        
        
      </h4>
    

<p>Acknowledged, fixed in <a href="https://github.com/groLabs/GSquared/pull/70">#70</a> and discussed in <a href="https://github.com/groLabs/GSquared/issues/46">#46</a>.</p>
      <h3 id="20-informational---unclear-redistribution-of-vault-fees">
        
        
          <a href="#20-informational---unclear-redistribution-of-vault-fees" class="anchor-heading" aria-labelledby="20-informational---unclear-redistribution-of-vault-fees"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 20. Informational - Unclear redistribution of vault fees
        
        
      </h3>
    

<p><code class="language-plaintext highlighter-rouge">_calcFees()</code> calculates and sends GVault fees to a <code class="language-plaintext highlighter-rouge">feeCollector</code> address. It is unclear whether the <code class="language-plaintext highlighter-rouge">feeCollector</code> redistributes collected fees back to the protocol, and if so, whether this is done in a fair manner.</p>
      <h4 id="technical-details-45">
        
        
          <a href="#technical-details-45" class="anchor-heading" aria-labelledby="technical-details-45"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Technical Details
        
        
      </h4>
    

<p><a href="https://docs.gro.xyz/gro-docs/pwrd_vault/vault/hodl-contribution">Existing Gro protocol documentation</a> mentions the withdrawal fees are redistributed back to the protocol. While this may not be true with the upgraded Gro protocol, if the fees are to be redistributed to the protocol, it should be done in a way that is not gameable.</p>
      <h4 id="impact-45">
        
        
          <a href="#impact-45" class="anchor-heading" aria-labelledby="impact-45"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Impact
        
        
      </h4>
    

<p>Informational.</p>
      <h4 id="recommendation-45">
        
        
          <a href="#recommendation-45" class="anchor-heading" aria-labelledby="recommendation-45"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Recommendation
        
        
      </h4>
    

<p>Consider clarifying how and when the yield from withdrawal fees is redistributed to the pool so that it is done fairly and not frontrun.</p>
      <h4 id="developer-response-45">
        
        
          <a href="#developer-response-45" class="anchor-heading" aria-labelledby="developer-response-45"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Developer Response
        
        
      </h4>
    

<p>Acknowledged, will update documentation to address this. Discussed in <a href="https://github.com/groLabs/GSquared/issues/47">#47</a>.</p>
      <h3 id="21-informational---tranche-tokens-not-compliant-with-erc4626">
        
        
          <a href="#21-informational---tranche-tokens-not-compliant-with-erc4626" class="anchor-heading" aria-labelledby="21-informational---tranche-tokens-not-compliant-with-erc4626"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 21. Informational - Tranche tokens not compliant with ERC4626
        
        
      </h3>
    

<p>The tranche is described as providing a wrapper to the underlying ERC4626 tokens, but does not currently support ERC4626 itself. SeniorTranche and JuniorTranche do not implement certain ERC4626 functions.</p>
      <h4 id="technical-details-46">
        
        
          <a href="#technical-details-46" class="anchor-heading" aria-labelledby="technical-details-46"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Technical Details
        
        
      </h4>
    

<p>To clarify, the tranche tokens do not currently implement ERC4626 but the documentation uses the word “ERC4626 wrapper” when describing the tranche, which could be misleading. GVault and tranche tokens import the same ERC4626 to implement basic ERC4626 support. GVault overrides many virtual functions from this import to implement them correctly according to ERC4626 specifications, but GTranche does not. The functions that should be implemented in GTranche to comply with ERC4626 include:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">mint()</code></li>
  <li><code class="language-plaintext highlighter-rouge">deposit()</code></li>
  <li><code class="language-plaintext highlighter-rouge">withdraw()</code></li>
  <li><code class="language-plaintext highlighter-rouge">redeem()</code></li>
  <li><code class="language-plaintext highlighter-rouge">convertToShares()</code></li>
  <li><code class="language-plaintext highlighter-rouge">convertToAssets()</code></li>
  <li><code class="language-plaintext highlighter-rouge">maxRedeem()</code></li>
  <li><code class="language-plaintext highlighter-rouge">previewRedeem()</code></li>
  <li><code class="language-plaintext highlighter-rouge">maxWithdraw()</code></li>
  <li><code class="language-plaintext highlighter-rouge">previewWithdraw()</code></li>
  <li><code class="language-plaintext highlighter-rouge">maxMint()</code></li>
  <li><code class="language-plaintext highlighter-rouge">previewMint()</code></li>
  <li><code class="language-plaintext highlighter-rouge">maxDeposit()</code></li>
  <li><code class="language-plaintext highlighter-rouge">previewDeposit()</code></li>
</ul>
      <h4 id="impact-46">
        
        
          <a href="#impact-46" class="anchor-heading" aria-labelledby="impact-46"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Impact
        
        
      </h4>
    

<p>Informational.</p>
      <h4 id="recommendation-46">
        
        
          <a href="#recommendation-46" class="anchor-heading" aria-labelledby="recommendation-46"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Recommendation
        
        
      </h4>
    

<p>Consider updating the documentation to remove the word “wrapper” and to clarify that the tranche tokens are not exactly ERC4626 tokens themselves but rather ERC20 tokens.</p>
      <h4 id="developer-response-46">
        
        
          <a href="#developer-response-46" class="anchor-heading" aria-labelledby="developer-response-46"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Developer Response
        
        
      </h4>
    

<p>Acknowledged, will update documentation to address this. Discussed in <a href="https://github.com/groLabs/GSquared/issues/48">#48</a>.</p>
      <h3 id="22-informational---silent-returns">
        
        
          <a href="#22-informational---silent-returns" class="anchor-heading" aria-labelledby="22-informational---silent-returns"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 22. Informational - Silent returns
        
        
      </h3>
    

<p>If invalid values are given to <code class="language-plaintext highlighter-rouge">move()</code>, it does not revert but instead returns. This can lead to a misunderstanding where the user assumes the action was completed, when in fact it was not.</p>
      <h4 id="technical-details-47">
        
        
          <a href="#technical-details-47" class="anchor-heading" aria-labelledby="technical-details-47"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Technical Details
        
        
      </h4>
    

<p><code class="language-plaintext highlighter-rouge">move()</code> in StrategyQueue <a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/utils/StrategyQueue.sol#L184-L196">silently returns in three cases</a>. This may give the <a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/GVault.sol#L567">owner calling <code class="language-plaintext highlighter-rouge">moveStrategy()</code></a> a false sense of confidence that the strategy was moved, when it in fact was not.</p>
      <h4 id="impact-47">
        
        
          <a href="#impact-47" class="anchor-heading" aria-labelledby="impact-47"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Impact
        
        
      </h4>
    

<p>Informational.</p>
      <h4 id="recommendation-47">
        
        
          <a href="#recommendation-47" class="anchor-heading" aria-labelledby="recommendation-47"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Recommendation
        
        
      </h4>
    

<p>Revert in the conditions that currently return. Provide the caller with a useful error.</p>
      <h4 id="developer-response-47">
        
        
          <a href="#developer-response-47" class="anchor-heading" aria-labelledby="developer-response-47"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Developer Response
        
        
      </h4>
    

<p>Acknowledged, fixed in <a href="https://github.com/groLabs/GSquared/pull/74">#74</a> and discussed in <a href="https://github.com/groLabs/GSquared/issues/49">#49</a>.</p>
      <h3 id="23-informational---minor-nitpicks">
        
        
          <a href="#23-informational---minor-nitpicks" class="anchor-heading" aria-labelledby="23-informational---minor-nitpicks"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 23. Informational - Minor nitpicks
        
        
      </h3>
    

<p>General nitpicks with comments, naming, and typos in the contracts.</p>
      <h4 id="technical-details-48">
        
        
          <a href="#technical-details-48" class="anchor-heading" aria-labelledby="technical-details-48"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Technical Details
        
        
      </h4>
    

<ol>
  <li>Consider naming <a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/utils/StrategyQueue.sol#L86"><code class="language-plaintext highlighter-rouge">withdrawalQueue(uint256 i)</code></a> to <code class="language-plaintext highlighter-rouge">withdrawalQueueAt(uint256 i)</code> and <a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/utils/StrategyQueue.sol#L106"><code class="language-plaintext highlighter-rouge">withdrawalQueue()</code></a> to <code class="language-plaintext highlighter-rouge">fullWithdrawalQueue()</code>.</li>
  <li>Consider clarifying <a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/utils/StrategyQueue.sol#L85">the strategy return value</a> is an address, not a Strategy struct.</li>
  <li><a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/GVault.sol#L135"><code class="language-plaintext highlighter-rouge">getStrategyDebt()</code></a> and <a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/GVault.sol#L156"><code class="language-plaintext highlighter-rouge">getStrategyAssets()</code></a> return the <code class="language-plaintext highlighter-rouge">totalDebt</code> of a strategy and might be improved with more similar names to avoid confusion over debt vs. assets.</li>
  <li>NatSpec is incomplete for some functions, such as missing return value descriptions for <code class="language-plaintext highlighter-rouge">beforeWithdraw()</code>/<code class="language-plaintext highlighter-rouge">excessDebt</code>/<code class="language-plaintext highlighter-rouge">_excessDebt</code> and no NatSpec for <code class="language-plaintext highlighter-rouge">_removeStrategy()</code> in GVault</li>
  <li><code class="language-plaintext highlighter-rouge">depositIntoTrancheForCaller()</code> is <a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/GRouter.sol#L329">missing a comment that _token_index of 3 or greater is 3CRV</a></li>
  <li>Typo: <a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/GVault.sol#L606">adapetr -&gt; adapter</a></li>
  <li>Typo: <a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/GRouter.sol#L92">Apporve -&gt; Approve</a></li>
  <li>Typo: <a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/oracles/RouterOracle.sol#L60">CHIANLINK_FACTOR -&gt; CHAINLINK_FACTOR</a></li>
  <li>Typo: <a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/GRouter.sol#L124">add_liquididty -&gt; add_liquidity</a></li>
  <li>Typo: <a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/GVault.sol#L850">strategies -&gt; strategy’s</a> and <a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/GVault.sol#L601">same here</a></li>
  <li>Typo: <a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/GVault.sol#L865">enstimated -&gt; estimated</a></li>
  <li>Typo: <a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/GVault.sol#L769">excluding and profits -&gt; excluding profits</a></li>
  <li>Typo: <a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/GVault.sol#L815">srategy -&gt; strategy</a></li>
  <li>Typo: <a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/GTranche.sol#L38">do generate -&gt; to generate</a></li>
  <li>Typo: <a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/GTranche.sol#L58">unledrying -&gt; underlying</a></li>
  <li>Typo: <a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/utils/FixedTokensCurve.sol#L27">beneth -&gt; beneath</a> and <a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/utils/FixedTokens.sol#L27">here</a></li>
  <li>Typo: <a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/tokens/JuniorTranche.sol#L7">baring -&gt; bearing</a></li>
  <li>Typo: <a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/oracles/RelationModule.sol#L29">extensoin -&gt; extension</a></li>
  <li>Typo: <a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/GRouter.sol#L404">their -&gt; there</a></li>
  <li>Typo: <a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/strategy/ConvexStrategy.sol#L617">underlyng -&gt; underlying</a></li>
  <li>Typo: <a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/strategy/ConvexStrategy.sol#L553">prive -&gt; price</a></li>
  <li>Typo: <a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/strategy/keeper/GStrategyGuard.sol#L67">it -&gt; its</a></li>
  <li>Typo: <a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/GTranche.sol#L132">utiliszation -&gt; utilisation</a></li>
  <li>Typo: <a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/GTranche.sol#L118">_tranchTokens -&gt; _trancheTokens</a></li>
  <li>Typo: <a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/oracles/CurveOracle.sol#L33">between to underlying -&gt; between the underlying</a></li>
  <li>Typo: <a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/oracles/CurveOracle.sol#L52">amount of price -&gt; amount of yield token</a></li>
  <li>Typo: <a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/GTranche.sol#L455">and ontermiadry -&gt; an intermediary</a></li>
  <li>Typo: <a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/GTranche.sol#L575">amount of transform</a> (unclear what this means)</li>
  <li>Typo: <a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/GTranche.sol#L133"><code class="language-plaintext highlighter-rouge">setUtilizationThreshold()</code></a> (note utilization with a ‘z’) sets the <a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/GTranche.sol#L134">variable <code class="language-plaintext highlighter-rouge">utilisationThreshold</code></a> (note utilisation with ‘s’) and there is a <a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/GTranche.sol#L271">function <code class="language-plaintext highlighter-rouge">utilization()</code></a> (note utilization with a ‘z’)</li>
  <li>Typo: <a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/pnl/PnLFixedRate.sol#L156">experiene -&gt; experience</a></li>
  <li><a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/GVault.sol#L763">Improve precision by changing</a> <code class="language-plaintext highlighter-rouge">((_lockedProfit / _releaseTime) * _timeSinceLastReport)</code> to <code class="language-plaintext highlighter-rouge">((_lockedProfit * _timeSinceLastReport) / _releaseTime)</code> to <a href="https://github.com/yearn/yearn-vaults/blob/74364b2c33bd0ee009ece975c157f065b592eeaf/contracts/Vault.vy#L837-L839">match Vault.vy approach</a></li>
  <li><a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/GVault.sol#L553">Fix this comment</a> that references a non-existent <code class="language-plaintext highlighter-rouge">emergencyExit()</code> function</li>
  <li>The <a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/GVault.sol#L616"><code class="language-plaintext highlighter-rouge">emergency</code> boolean function argument</a> is missing a NatSpec comment as is <a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/GTranche.sol#L590"><code class="language-plaintext highlighter-rouge">_calcFactor()</code> in GTranche</a> and <a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/pnl/PnL.sol#L58"><code class="language-plaintext highlighter-rouge">_loss</code> in PnL</a></li>
  <li>The <a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/GVault.sol#L636"><code class="language-plaintext highlighter-rouge">debt</code> variable</a> is not used for any purpose. It may be better to simply compare <code class="language-plaintext highlighter-rouge">debtPayment</code> to the value of <code class="language-plaintext highlighter-rouge">_excessDebt(msg.sender)</code> to replace the safeMath <a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/GVault.sol#L642">in this line</a>.</li>
  <li>Inaccurate <a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/strategy/ConvexStrategy.sol#L703">NatSpec for <code class="language-plaintext highlighter-rouge">withdraw()</code>’s <code class="language-plaintext highlighter-rouge">_amount</code></a> (better would be “asset quantity needed by Vault if not holding enough asset balance”) and missing NatSpec for return values</li>
  <li>Replace PnL <a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/pnl/PnL.sol#L115-L120">magic numbers with constants</a>. For example, replace 10000 with <code class="language-plaintext highlighter-rouge">utilisationThreshold</code>.</li>
  <li>Junior Tranche is branded as GVT token, so <a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/GRouter.sol#L287">this comment should replace PWRD with GVT</a></li>
  <li>Consider a better name than <a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/tokens/GToken.sol#L492-L499">“controller” or “ctrl” in GToken</a> for the GTranche address, because the word “controller” does not appear anywhere in GTranche</li>
  <li>Assets in Convex are not locked and <a href="https://docs.convexfinance.com/convexfinanceintegration/cvx-locking-vlcvx">therefore are not used to vote in reward distribution</a>. There are potential downsides to this approach and this choice should be documented somewhere in Gro’s documentation. The strategy that ConvexStrategy was inspired by does lock some tokens for voting.</li>
  <li><code class="language-plaintext highlighter-rouge">_claimableRewards()</code> in ConvexStrategy does not return a value if <code class="language-plaintext highlighter-rouge">MIN_REWARD_SELL_AMOUNT</code> is not met and <a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/strategy/ConvexStrategy.sol#L612-L614">this if statement is not entered</a></li>
  <li>Consider replacing <a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/strategy/ConvexStrategy.sol#L855"><code class="language-plaintext highlighter-rouge">slippage</code> in <code class="language-plaintext highlighter-rouge">divestAll()</code></a> with the <code class="language-plaintext highlighter-rouge">baseSlippage</code> value used elsewhere because <code class="language-plaintext highlighter-rouge">baseSlippage</code> can be modified by the owner unlike <code class="language-plaintext highlighter-rouge">slippage</code></li>
  <li><code class="language-plaintext highlighter-rouge">estimatedTotalAssets()</code> should <a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/strategy/ConvexStrategy.sol#L469">replace <code class="language-plaintext highlighter-rouge">_estimatedTotalAssets(true)</code></a> with <code class="language-plaintext highlighter-rouge">_estimatedTotalAssets(false)</code> because the rewards return value is not needed</li>
  <li>Incomplete NatSpec <a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/GTranche.sol#L576">for <code class="language-plaintext highlighter-rouge">factor</code> in <code class="language-plaintext highlighter-rouge">_calcTrancheValue()</code></a> and <a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/GTranche.sol#L296"><code class="language-plaintext highlighter-rouge">factor</code> elsewhere in GTranche</a></li>
  <li><a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/GTranche.sol#L202">This return is redundant</a>, the named return values would be returned properly without this line</li>
  <li>The <a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/tokens/GToken.sol#L9">SafeMath OpenZeppelin import in GToken</a> is redundant because solidity 0.8.10 is used. The contract should be updated accordingly.</li>
  <li>The <a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/tokens/GToken.sol#L7">Ownable import in GToken</a> is redundant because <a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/tokens/GToken.sol#L11">the import of Whitelist.sol</a> includes Ownable already</li>
  <li><code class="language-plaintext highlighter-rouge">_calcTokenAmount()</code> can <a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/tokens/GTranche.sol#L431">remove the <code class="language-plaintext highlighter-rouge">_deposit</code> boolean function argument</a> because it is never used for anything useful in the function</li>
  <li>The NatSpec in <a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/oracles/CurveOracle.sol#L67">CurveOracle</a> uses the term “yield token” to mostly refer to 3CRV while <a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/utils/FixedTokensCurve.sol#L118">FixedTokensCurve</a> NatSpec uses “yield token” to mostly refer to GVault shares. Consider terms that more clearly differentiate the tokens.</li>
  <li>Remove <a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/tokens/GTranche.sol#L579">unused <code class="language-plaintext highlighter-rouge">_tranche</code> bool function argument</a> from <code class="language-plaintext highlighter-rouge">_calcTrancheValue()</code></li>
  <li>Remove <a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/tokens/GTranche.sol#L584"><code class="language-plaintext highlighter-rouge">if (_factor == 0)</code> logic from <code class="language-plaintext highlighter-rouge">_calcTrancheValue()</code></a> because this can never happen based on current contract logic</li>
  <li><a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/pnl/PnLFixedRate.sol#L41"><code class="language-plaintext highlighter-rouge">lastDistribution</code> could be uint32</a> instead of uint64</li>
  <li>Consider <a href="https://github.com/groLabs/GSquared-foundry/blob/f1831bdb353d4a0b3a8937087e1663f73b75e905/src/GVault.sol#L841">renaming <code class="language-plaintext highlighter-rouge">_calcFees()</code></a> to <code class="language-plaintext highlighter-rouge">_gainSubFees()</code></li>
</ol>
      <h4 id="impact-48">
        
        
          <a href="#impact-48" class="anchor-heading" aria-labelledby="impact-48"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Impact
        
        
      </h4>
    

<p>Informational.</p>
      <h4 id="recommendation-48">
        
        
          <a href="#recommendation-48" class="anchor-heading" aria-labelledby="recommendation-48"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Recommendation
        
        
      </h4>
    

<p>Consider fixing nitpicks.</p>
      <h4 id="developer-response-48">
        
        
          <a href="#developer-response-48" class="anchor-heading" aria-labelledby="developer-response-48"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Developer Response
        
        
      </h4>
    

<p>Acknowledged, fixed in <a href="https://github.com/groLabs/GSquared/pull/77">#77</a> and discussed in <a href="https://github.com/groLabs/GSquared/issues/50">#50</a>.</p>
      <h2 id="final-remarks">
        
        
          <a href="#final-remarks" class="anchor-heading" aria-labelledby="final-remarks"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Final remarks
        
        
      </h2>
    

<p>Overall, the protocol is well designed and properly transfers value between the different contracts in order to deliver the desired objectives. There are some unusual edge cases that need improved handling, but in general the main logic flows work as intended. The scope of this review covering the entire protocol was quite large, but good review coverage was still possible in the allotted time.</p>
      <h2 id="about-yacademy">
        
        
          <a href="#about-yacademy" class="anchor-heading" aria-labelledby="about-yacademy"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> About yAcademy
        
        
      </h2>
    

<p><a href="https://yacademy.dev/">yAcademy</a> is an ecosystem initiative started by Yearn Finance and its ecosystem partners to bootstrap sustainable and collaborative blockchain security reviews and to nurture aspiring security talent. yAcademy includes <a href="https://yacademy.dev/fellowship-program/">a fellowship program</a>, a residents program, and <a href="https://yacademy.dev/guest-auditor-program/">a guest auditor program</a>. In the fellowship program, fellows perform a series of periodic security reviews and presentations during the program. Residents are past fellows who continue to gain experience by performing security reviews of contracts submitted to yAcademy for review (such as this contract). Guest auditors are experts with a track record in the security space who temporarily assist with the review efforts.</p>

        

        

        
        
          <hr>
          <footer>
            
              <p><a href="#top" id="back-to-top">Back to top</a></p>
            

            

            
              <div class="d-flex mt-2">
                
                
              </div>
            
          </footer>
        

      </div>
    </div>

    
      

      <div class="search-overlay"></div>
    
  </div>
  <link rel="image_src" href="https://yaudit.dev/assets/images/logo.png" />
</body>

  <script>
    var config = {}
;
    mermaid.initialize(config);
    window.mermaid.init(undefined, document.querySelectorAll('.language-mermaid'));
  </script>

</html>

