

<!DOCTYPE html>

<html lang="en-US">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge">

  

  <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">


  <link rel="stylesheet" href="/assets/css/just-the-docs-default.css">

  

  
    <script type="text/javascript" src="/assets/js/vendor/lunr.min.js"></script>
  

  
    <script src="https://cdn.jsdelivr.net/npm/mermaid@9.1.6/dist/mermaid.min.js"></script>
  

  <script type="text/javascript" src="/assets/js/just-the-docs.js"></script>
  <script defer data-domain="reports.yAudit.dev" src="https://plausible.io/js/script.js"></script>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>08-2022-Bunni | yAudit Reports</title>
<meta name="generator" content="Jekyll v3.9.2" />
<meta property="og:title" content="08-2022-Bunni" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Bunni yAcademy Report" />
<meta property="og:description" content="Bunni yAcademy Report" />
<link rel="canonical" href="http://localhost:4000/reports/08-2022-Bunni/" />
<meta property="og:url" content="http://localhost:4000/reports/08-2022-Bunni/" />
<meta property="og:site_name" content="yAudit Reports" />
<meta property="og:image" content="http://localhost:4000/assets/images/logo.png" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary_large_image" />
<meta property="twitter:image" content="http://localhost:4000/assets/images/logo.png" />
<meta property="twitter:title" content="08-2022-Bunni" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","description":"Bunni yAcademy Report","headline":"08-2022-Bunni","image":"http://localhost:4000/assets/images/logo.png","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"http://localhost:4000/assets/images/yaudit-logo.jpg"}},"url":"http://localhost:4000/reports/08-2022-Bunni/"}</script>
<!-- End Jekyll SEO tag -->


  

</head>

<body>
  <a class="skip-to-main" href="#main-content">Skip to main content</a>
  <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
    <symbol id="svg-link" viewBox="0 0 24 24">
      <title>Link</title>
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link">
        <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
      </svg>
    </symbol>
    <symbol id="svg-search" viewBox="0 0 24 24">
      <title>Search</title>
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search">
        <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line>
      </svg>
    </symbol>
    <symbol id="svg-menu" viewBox="0 0 24 24">
      <title>Menu</title>
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu">
        <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line>
      </svg>
    </symbol>
    <symbol id="svg-arrow-right" viewBox="0 0 24 24">
      <title>Expand</title>
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right">
        <polyline points="9 18 15 12 9 6"></polyline>
      </svg>
    </symbol>
    <symbol id="svg-doc" viewBox="0 0 24 24">
      <title>Document</title>
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file">
        <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline>
      </svg>
    </symbol>
    <!-- Feather. MIT License: https://github.com/feathericons/feather/blob/master/LICENSE -->
<symbol id="svg-external-link" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-external-link">
  <title id="svg-external-link-title">(external link)</title>
  <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line>
</symbol>

  </svg>

  <div class="side-bar">
    <div class="site-header">
      <a href="/" class="site-title lh-tight">
  <div class="site-logo"></div>

</a>
      <a href="#" id="menu-button" class="site-button">
        <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg>
      </a>
    </div>
    <nav role="navigation" aria-label="Main" id="site-nav" class="site-nav">
      
      
        <ul class="nav-list"><li class="nav-list-item"><a href="/" class="nav-list-link">yAudit Reports</a></li><li class="nav-list-item"><a href="/reports/03-2022-Ohm/" class="nav-list-link">03-2022-Ohm</a></li><li class="nav-list-item"><a href="/reports/04-2022-Ohm-Bond/" class="nav-list-link">04-2022-Ohm-Bond</a></li><li class="nav-list-item"><a href="/reports/04-2022-veYFI/" class="nav-list-link">04-2022-veYFI</a></li><li class="nav-list-item"><a href="/reports/05-2022-OpenMEVRouter/" class="nav-list-link">05-2022-OpenMEV</a></li><li class="nav-list-item active"><a href="/reports/08-2022-Bunni/" class="nav-list-link active">08-2022-Bunni</a></li><li class="nav-list-item"><a href="/reports/08-2022-Timeless-Yield-Daddy/" class="nav-list-link">08-2022-Timeless-Yield-Daddy</a></li><li class="nav-list-item"><a href="/reports/09-2022-yFu-NFT/" class="nav-list-link">09-2022-yFu-NFT</a></li><li class="nav-list-item"><a href="/reports/10-2022-NounsDAO-Token-Buyer/" class="nav-list-link">10-2022-NounsDAO-Token-Buyer</a></li><li class="nav-list-item"><a href="/reports/12-2022-Gro-Protocol/" class="nav-list-link">12-2022-Gro-Protocol</a></li><li class="nav-list-item external">
      <a href="https://yaudit.dev/" class="nav-list-link external">
        yAudit Website
        <svg viewBox="0 0 24 24" aria-labelledby="svg-external-link-title"><use xlink:href="#svg-external-link"></use></svg>
      </a>
    </li></ul>
      
      
    </nav>

    
    
      <footer class="site-footer">
        <!-- This site uses <a href="https://github.com/just-the-docs/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. -->
      </footer>
    
  </div>
  <div class="main" id="top">
    <div id="main-header" class="main-header">
      

        

        <div class="search">
          <div class="search-input-wrap">
            <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search yAudit Reports" aria-label="Search yAudit Reports" autocomplete="off">
            <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label>
          </div>
          <div id="search-results" class="search-results"></div>
        </div>
      
      
      
    </div>
    <div id="main-content-wrap" class="main-content-wrap">
      
        
      
      <div id="main-content" class="main-content" role="main">
        
          <h1 class="no_toc" id="yacademy-bunni-review">
        
        
          <a href="#yacademy-bunni-review" class="anchor-heading" aria-labelledby="yacademy-bunni-review"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> yAcademy Bunni review
        
        
      </h1>
    

<p><strong>Review Resources:</strong>
<a href="https://github.com/ZeframLou/bunni#readme">README</a></p>

<p><strong>Residents:</strong></p>
<ul>
  <li>Jackson</li>
  <li>devtooligan</li>
</ul>
      <h2 class="no_toc" id="table-of-contents">
        
        
          <a href="#table-of-contents" class="anchor-heading" aria-labelledby="table-of-contents"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Table of Contents
        
        
      </h2>
    

<ol id="markdown-toc">
  <li><a href="#review-summary" id="markdown-toc-review-summary">Review Summary</a></li>
  <li><a href="#scope" id="markdown-toc-scope">Scope</a></li>
  <li><a href="#code-evaluation-matrix" id="markdown-toc-code-evaluation-matrix">Code Evaluation Matrix</a></li>
  <li><a href="#findings-explanation" id="markdown-toc-findings-explanation">Findings Explanation</a></li>
  <li><a href="#critical-findings" id="markdown-toc-critical-findings">Critical Findings</a>    <ol>
      <li><a href="#1-critical---anyone-can-call-uniswapv3mintcallback-stealing-the-protocol-fees-devtooligan-jackson" id="markdown-toc-1-critical---anyone-can-call-uniswapv3mintcallback-stealing-the-protocol-fees-devtooligan-jackson">1. Critical - Anyone can call <code class="language-plaintext highlighter-rouge">uniswapV3MintCallback()</code> stealing the protocol fees (devtooligan, Jackson)</a>        <ol>
          <li><a href="#technical-details" id="markdown-toc-technical-details">Technical Details</a></li>
          <li><a href="#impact" id="markdown-toc-impact">Impact</a></li>
          <li><a href="#recommendation" id="markdown-toc-recommendation">Recommendation</a></li>
          <li><a href="#developer-response-zeframl" id="markdown-toc-developer-response-zeframl">Developer response (zeframL)</a></li>
        </ol>
      </li>
      <li><a href="#2-critical---anyone-can-call-the-peripherypayments-sweeptoken-stealing-the-protocol-fees-jackson" id="markdown-toc-2-critical---anyone-can-call-the-peripherypayments-sweeptoken-stealing-the-protocol-fees-jackson">2. Critical - Anyone can call the PeripheryPayments <code class="language-plaintext highlighter-rouge">sweepToken()</code> stealing the protocol fees (Jackson)</a>        <ol>
          <li><a href="#technical-details-1" id="markdown-toc-technical-details-1">Technical Details</a></li>
          <li><a href="#impact-1" id="markdown-toc-impact-1">Impact</a></li>
          <li><a href="#recommendation-1" id="markdown-toc-recommendation-1">Recommendation</a></li>
          <li><a href="#developer-response-zeframl-1" id="markdown-toc-developer-response-zeframl-1">Developer response (zeframL)</a></li>
        </ol>
      </li>
      <li><a href="#3-critical---anyone-can-call-the-peripherypayments-unwrapweth9-stealing-the-weth-stored-in-bunnihub-jackson" id="markdown-toc-3-critical---anyone-can-call-the-peripherypayments-unwrapweth9-stealing-the-weth-stored-in-bunnihub-jackson">3. Critical - Anyone can call the PeripheryPayments <code class="language-plaintext highlighter-rouge">unwrapWETH9()</code> stealing the weth stored in BunniHub (Jackson)</a>        <ol>
          <li><a href="#technical-details-2" id="markdown-toc-technical-details-2">Technical Details</a></li>
          <li><a href="#impact-2" id="markdown-toc-impact-2">Impact</a></li>
          <li><a href="#recommendation-2" id="markdown-toc-recommendation-2">Recommendation</a></li>
          <li><a href="#developer-response-zeframl-2" id="markdown-toc-developer-response-zeframl-2">Developer response (zeframL)</a></li>
        </ol>
      </li>
    </ol>
  </li>
  <li><a href="#high-findings" id="markdown-toc-high-findings">High Findings</a></li>
  <li><a href="#medium-findings" id="markdown-toc-medium-findings">Medium Findings</a></li>
  <li><a href="#low-findings" id="markdown-toc-low-findings">Low Findings</a>    <ol>
      <li><a href="#1-low---general-complexity-around-eth-management-including-certain-circumstances-where-eth-could-be-lost-devtooligan" id="markdown-toc-1-low---general-complexity-around-eth-management-including-certain-circumstances-where-eth-could-be-lost-devtooligan">1. Low - General complexity around ETH management including certain circumstances where ETH could be lost (devtooligan)</a>        <ol>
          <li><a href="#technical-details-3" id="markdown-toc-technical-details-3">Technical Details</a></li>
          <li><a href="#impact-3" id="markdown-toc-impact-3">Impact</a></li>
          <li><a href="#recommendation-3" id="markdown-toc-recommendation-3">Recommendation</a></li>
          <li><a href="#developer-response-zeframl-3" id="markdown-toc-developer-response-zeframl-3">Developer response (zeframL)</a></li>
        </ol>
      </li>
      <li><a href="#2-low---calling-withdraw-forfeits-uncollected-lp-fees-devtooligan" id="markdown-toc-2-low---calling-withdraw-forfeits-uncollected-lp-fees-devtooligan">2. Low - Calling <code class="language-plaintext highlighter-rouge">withdraw()</code> forfeits uncollected LP fees (devtooligan)</a>        <ol>
          <li><a href="#technical-details-4" id="markdown-toc-technical-details-4">Technical Details</a></li>
          <li><a href="#impact-4" id="markdown-toc-impact-4">Impact</a></li>
          <li><a href="#recommendation-4" id="markdown-toc-recommendation-4">Recommendation</a></li>
          <li><a href="#developer-response-zeframl-4" id="markdown-toc-developer-response-zeframl-4">Developer response (zeframL)</a></li>
        </ol>
      </li>
    </ol>
  </li>
  <li><a href="#gas-savings-findings" id="markdown-toc-gas-savings-findings">Gas Savings Findings</a>    <ol>
      <li><a href="#1-gas---optimize-the-sweeptokens-loop-devtooligan" id="markdown-toc-1-gas---optimize-the-sweeptokens-loop-devtooligan">1. Gas - Optimize the <code class="language-plaintext highlighter-rouge">sweepTokens()</code> loop (devtooligan)</a>        <ol>
          <li><a href="#technical-details-5" id="markdown-toc-technical-details-5">Technical Details</a></li>
          <li><a href="#impact-5" id="markdown-toc-impact-5">Impact</a></li>
          <li><a href="#developer-response-zeframl-5" id="markdown-toc-developer-response-zeframl-5">Developer response (zeframL)</a></li>
        </ol>
      </li>
    </ol>
  </li>
  <li><a href="#informational-findings" id="markdown-toc-informational-findings">Informational Findings</a>    <ol>
      <li><a href="#1-informational---upgrade-to-at-least-solidity-084-devtooligan" id="markdown-toc-1-informational---upgrade-to-at-least-solidity-084-devtooligan">1. Informational - Upgrade to at least solidity 0.8.4 (devtooligan)</a>        <ol>
          <li><a href="#technical-details-6" id="markdown-toc-technical-details-6">Technical Details</a></li>
          <li><a href="#impact-6" id="markdown-toc-impact-6">Impact</a></li>
          <li><a href="#recommendation-5" id="markdown-toc-recommendation-5">Recommendation</a></li>
          <li><a href="#developer-response-zeframl-6" id="markdown-toc-developer-response-zeframl-6">Developer response (zeframL)</a></li>
        </ol>
      </li>
      <li><a href="#2-informational---use-latest-versions-of-unmodified-libraries-devtooligan" id="markdown-toc-2-informational---use-latest-versions-of-unmodified-libraries-devtooligan">2. Informational - Use latest versions of unmodified libraries (devtooligan)</a>        <ol>
          <li><a href="#technical-details-7" id="markdown-toc-technical-details-7">Technical Details</a></li>
          <li><a href="#impact-7" id="markdown-toc-impact-7">Impact</a></li>
          <li><a href="#recommendation-6" id="markdown-toc-recommendation-6">Recommendation</a></li>
          <li><a href="#developer-response-zeframl-7" id="markdown-toc-developer-response-zeframl-7">Developer response (zeframL)</a></li>
        </ol>
      </li>
      <li><a href="#3-informational---consider-foundry-scripting-for-the-deployment-scripts-jackson" id="markdown-toc-3-informational---consider-foundry-scripting-for-the-deployment-scripts-jackson">3. Informational - Consider Foundry scripting for the deployment scripts (Jackson)</a>        <ol>
          <li><a href="#technical-details-8" id="markdown-toc-technical-details-8">Technical Details</a></li>
          <li><a href="#impact-8" id="markdown-toc-impact-8">Impact</a></li>
          <li><a href="#recommendation-7" id="markdown-toc-recommendation-7">Recommendation</a></li>
          <li><a href="#developer-response-zeframl-8" id="markdown-toc-developer-response-zeframl-8">Developer response (zeframL)</a></li>
        </ol>
      </li>
      <li><a href="#4-informational---typo-in-readme-jackson" id="markdown-toc-4-informational---typo-in-readme-jackson">4. Informational - Typo in README (Jackson)</a>        <ol>
          <li><a href="#technical-details-9" id="markdown-toc-technical-details-9">Technical Details</a></li>
          <li><a href="#impact-9" id="markdown-toc-impact-9">Impact</a></li>
          <li><a href="#recommendation-8" id="markdown-toc-recommendation-8">Recommendation</a></li>
          <li><a href="#developer-response-zeframl-9" id="markdown-toc-developer-response-zeframl-9">Developer response (zeframL)</a></li>
        </ol>
      </li>
      <li><a href="#5-informational---consider-adding-npm-related-steps-to-the-readme-jackson" id="markdown-toc-5-informational---consider-adding-npm-related-steps-to-the-readme-jackson">5. Informational - Consider adding npm related steps to the README (Jackson)</a>        <ol>
          <li><a href="#technical-details-10" id="markdown-toc-technical-details-10">Technical Details</a></li>
          <li><a href="#impact-10" id="markdown-toc-impact-10">Impact</a></li>
          <li><a href="#recommendation-9" id="markdown-toc-recommendation-9">Recommendation</a></li>
          <li><a href="#developer-response-zeframl-10" id="markdown-toc-developer-response-zeframl-10">Developer response (zeframL)</a></li>
        </ol>
      </li>
      <li><a href="#6-informational---consider-removing-the-weth-unwrapping-logic-jackson" id="markdown-toc-6-informational---consider-removing-the-weth-unwrapping-logic-jackson">6. Informational - Consider removing the WETH unwrapping logic (Jackson)</a>        <ol>
          <li><a href="#technical-details-11" id="markdown-toc-technical-details-11">Technical Details</a></li>
          <li><a href="#impact-11" id="markdown-toc-impact-11">Impact</a></li>
          <li><a href="#recommendation-10" id="markdown-toc-recommendation-10">Recommendation</a></li>
          <li><a href="#developer-response-zeframl-11" id="markdown-toc-developer-response-zeframl-11">Developer response (zeframL)</a></li>
        </ol>
      </li>
    </ol>
  </li>
  <li><a href="#final-remarks" id="markdown-toc-final-remarks">Final remarks</a>    <ol>
      <li><a href="#devtooligan" id="markdown-toc-devtooligan">devtooligan</a></li>
      <li><a href="#jackson" id="markdown-toc-jackson">Jackson</a></li>
    </ol>
  </li>
  <li><a href="#about-yacademy" id="markdown-toc-about-yacademy">About yAcademy</a></li>
</ol>
      <h2 id="review-summary">
        
        
          <a href="#review-summary" class="anchor-heading" aria-labelledby="review-summary"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Review Summary
        
        
      </h2>
    

<p><strong>Bunni</strong></p>

<p>From Bunni’s README:</p>

<blockquote>
  <p>Bunni enables projects to create ERC-20 LP tokens on Uniswap V3 and plug them into existing liquidity incentivization contracts designed for Uniswap V2/Sushiswap.</p>
</blockquote>

<p>The main branch of the Bunni <a href="https://github.com/ZeframLou/bunni">repo</a> was reviewed over 14 days, 5 of which were used to create an initial overview of the contract. The code review was performed between August 29 and September 11, 2022. The code was reviewed by 2 residents for a total of 52 man hours (devtooligan: 27 hours, and Jackson 25 hours). The review was limited to <a href="https://github.com/ZeframLou/bunni/commit/fc3535c35ca182dee5684e0a9dd9c152cc33047e">one specific commit</a>.</p>
      <h2 id="scope">
        
        
          <a href="#scope" class="anchor-heading" aria-labelledby="scope"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Scope
        
        
      </h2>
    
<p><a href="https://github.com/ZeframLou/bunni">Code Repo</a>
<a href="https://github.com/ZeframLou/bunni/commit/fc3535c35ca182dee5684e0a9dd9c152cc33047e">Commit</a></p>

<p>The commit reviewed was fc3535c35ca182dee5684e0a9dd9c152cc33047e. The review covered the entire repository at this specific commit but focused on the contracts directory.</p>

<p>This review is a code review to identify potential vulnerabilities in the code. The reviewers did not investigate security practices or operational security and assumed that privileged accounts could be trusted. The reviewers did not evaluate the security of the code relative to a standard or specification. The review may not have identified all potential attack vectors or areas of vulnerability.</p>

<p>yAcademy and the residents make no warranties regarding the security of the code and do not warrant that the code is free from defects. yAcademy and the residents do not represent nor imply to third parties that the code has been audited nor that the code is free from defects. Bunni and third parties should use the code at their own risk.</p>
      <h2 id="code-evaluation-matrix">
        
        
          <a href="#code-evaluation-matrix" class="anchor-heading" aria-labelledby="code-evaluation-matrix"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Code Evaluation Matrix
        
        
      </h2>
    

<div class="table-wrapper"><table>
  <thead>
    <tr>
      <th>Category</th>
      <th>Mark</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Access Control</td>
      <td>Good</td>
      <td>The onlyOwner modifier was only applied to the <code class="language-plaintext highlighter-rouge">sweepTokens()</code> and <code class="language-plaintext highlighter-rouge">setProtocolFee()</code> functions.  Access controls existed on the relevant callback functions in LiquidityManagement.sol for deposits into the underlying Uniswap liquidity pool and BunniToken. msg.sender is properly used so that the user cannot perform actions they should not be able to. Access controls are applied where needed.</td>
    </tr>
    <tr>
      <td>Mathematics</td>
      <td>Average</td>
      <td>Solidity 0.7.6 is used, which does not provide overflow and underflow protect.  However,  Uniswap’s FullMath and LowGasSafeMath libraries are used where overflow and underflow protection is necessary.</td>
    </tr>
    <tr>
      <td>Complexity</td>
      <td>Average</td>
      <td>Many function names and implementations are borrowed from UniswapV3 contracts and Solmate. This reduces the amount of custom development work necessary. The primary source of complexity is in the handling of callbacks from UniswapV3 pools and proper accounting in the BunniHub.</td>
    </tr>
    <tr>
      <td>Libraries</td>
      <td>Average</td>
      <td>Since the contracts are using Solidity 0.7.6 some library contracts were copied into the directory rather than being imported.  These dependencies include Solmate’s CREATE3, ERC20, and SafeTransferLib.  However, due to these being copied into the project, they do not match the latest versions of these projects.</td>
    </tr>
    <tr>
      <td>Decentralization</td>
      <td>Good</td>
      <td>Only two functions contain <code class="language-plaintext highlighter-rouge">onlyOwner</code> modifiers, <code class="language-plaintext highlighter-rouge">sweepTokens()</code> and <code class="language-plaintext highlighter-rouge">setProtocolFee()</code> in the BunniHub.</td>
    </tr>
    <tr>
      <td>Code stability</td>
      <td>Good</td>
      <td>Changes were reviewed at a specific commit hash and the scope was not expanded after the review was started. The code reviewed had nearly all features implemented.</td>
    </tr>
    <tr>
      <td>Documentation</td>
      <td>Good</td>
      <td>Descriptive NatSpec comments are found in the interface contracts. The comments accurately describe the function purpose and function input/output arguments.  The BunniHub <code class="language-plaintext highlighter-rouge">compound()</code> function is particularly well commented.  The README contains useful information about the intended use and purpose of Bunni.</td>
    </tr>
    <tr>
      <td>Monitoring</td>
      <td>Average</td>
      <td>The core functions in BunniHub contain events, however, the other auxilliary functions do not.</td>
    </tr>
    <tr>
      <td>Testing and verification</td>
      <td>Average</td>
      <td>Bunni uses Foundry for testing.  Foundry coverage was used to produce a coverage report that indicates roughly 50% coverage.  However, the majority of core logic is found in the src/ directory, which has roughly 75% coverage.  The coverage could be improved to test for the edge cases introduced by modifications to the forked Uniswap contracts as demonstrated by the findings.  Fuzz and fork tests could also be easily included due to the use of Foundry.</td>
    </tr>
  </tbody>
</table></div>
      <h2 id="findings-explanation">
        
        
          <a href="#findings-explanation" class="anchor-heading" aria-labelledby="findings-explanation"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Findings Explanation
        
        
      </h2>
    

<p>Findings are broken down into sections by their respective impact:</p>
<ul>
  <li>Critical, High, Medium, Low impact
    <ul>
      <li>These are findings that range from attacks that may cause loss of funds, impact control/ownership of the contracts, or cause any unintended consequences/actions that are outside the scope of the requirements</li>
    </ul>
  </li>
  <li>Gas savings
    <ul>
      <li>Findings that can improve the gas efficiency of the contracts</li>
    </ul>
  </li>
  <li>Informational
    <ul>
      <li>Findings including recommendations and best practices</li>
    </ul>
  </li>
</ul><hr />
      <h2 id="critical-findings">
        
        
          <a href="#critical-findings" class="anchor-heading" aria-labelledby="critical-findings"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Critical Findings
        
        
      </h2>
    
      <h3 id="1-critical---anyone-can-call-uniswapv3mintcallback-stealing-the-protocol-fees-devtooligan-jackson">
        
        
          <a href="#1-critical---anyone-can-call-uniswapv3mintcallback-stealing-the-protocol-fees-devtooligan-jackson" class="anchor-heading" aria-labelledby="1-critical---anyone-can-call-uniswapv3mintcallback-stealing-the-protocol-fees-devtooligan-jackson"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 1. Critical - Anyone can call <code class="language-plaintext highlighter-rouge">uniswapV3MintCallback()</code> stealing the protocol fees (devtooligan, Jackson)
        
        
      </h3>
    
      <h4 id="technical-details">
        
        
          <a href="#technical-details" class="anchor-heading" aria-labelledby="technical-details"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Technical Details
        
        
      </h4>
    

<p><code class="language-plaintext highlighter-rouge">LiquidityManagement::uniswapV3MintCallback()</code> only checks that <code class="language-plaintext highlighter-rouge">msg.sender == address(decodedData.pool)</code>, which any attacker can trivially fulfill by setting <code class="language-plaintext highlighter-rouge">decodedData.pool</code> to an address they own. The function then transfers <code class="language-plaintext highlighter-rouge">decodedData.pool.token0()</code> and <code class="language-plaintext highlighter-rouge">decodedData.pool.token1()</code> to <code class="language-plaintext highlighter-rouge">msg.sender</code>, the amount of which is specified by the caller.</p>
      <h4 id="impact">
        
        
          <a href="#impact" class="anchor-heading" aria-labelledby="impact"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Impact
        
        
      </h4>
    

<p>Critical, anyone can take the protocol fees stored in BunniHub.</p>
      <h4 id="recommendation">
        
        
          <a href="#recommendation" class="anchor-heading" aria-labelledby="recommendation"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Recommendation
        
        
      </h4>
    

<p>Use the Uniswap V3 factory to verify that the caller is indeed the Uniswap pool associated with the desired tokens and fee tier.</p>
      <h4 id="developer-response-zeframl">
        
        
          <a href="#developer-response-zeframl" class="anchor-heading" aria-labelledby="developer-response-zeframl"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Developer response (zeframL)
        
        
      </h4>
    

<p>This was fixed in commit <a href="https://github.com/ZeframLou/bunni/commit/f6fa8cd1ef06e71ddc25ac15e82c9fe9859a9aec">f6fa8cd1ef06e71ddc25ac15e82c9fe9859a9aec</a> by using the Uniswap V3 factory to verify that the caller is indeed the Uniswap pool associated with the desired tokens and fee tier.</p>
      <h3 id="2-critical---anyone-can-call-the-peripherypayments-sweeptoken-stealing-the-protocol-fees-jackson">
        
        
          <a href="#2-critical---anyone-can-call-the-peripherypayments-sweeptoken-stealing-the-protocol-fees-jackson" class="anchor-heading" aria-labelledby="2-critical---anyone-can-call-the-peripherypayments-sweeptoken-stealing-the-protocol-fees-jackson"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 2. Critical - Anyone can call the PeripheryPayments <code class="language-plaintext highlighter-rouge">sweepToken()</code> stealing the protocol fees (Jackson)
        
        
      </h3>
    
      <h4 id="technical-details-1">
        
        
          <a href="#technical-details-1" class="anchor-heading" aria-labelledby="technical-details-1"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Technical Details
        
        
      </h4>
    

<p>PeripheryPayments is a dependency of the LiquidityManagement contract, which is a dependency of the BunniHub contract.  PeripheryPayments has a <code class="language-plaintext highlighter-rouge">sweepToken()</code> with no access control which allows a caller to transfer any token from the BunniHub contract to any recipient.</p>
      <h4 id="impact-1">
        
        
          <a href="#impact-1" class="anchor-heading" aria-labelledby="impact-1"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Impact
        
        
      </h4>
    

<p>Critical. Anyone can take the protocol fees stored in BunniHub.</p>
      <h4 id="recommendation-1">
        
        
          <a href="#recommendation-1" class="anchor-heading" aria-labelledby="recommendation-1"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Recommendation
        
        
      </h4>
    

<p>Remove or access control the PeripheryPayments <code class="language-plaintext highlighter-rouge">sweepToken()</code> function.</p>
      <h4 id="developer-response-zeframl-1">
        
        
          <a href="#developer-response-zeframl-1" class="anchor-heading" aria-labelledby="developer-response-zeframl-1"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Developer response (zeframL)
        
        
      </h4>
    

<p>Fixed in commit <a href="https://github.com/ZeframLou/bunni/commit/cfead992384cf959350439eb1ca79d73b0c528ac">cfead992384cf959350439eb1ca79d73b0c528ac</a> by removing PeripheryPayments.</p>
      <h3 id="3-critical---anyone-can-call-the-peripherypayments-unwrapweth9-stealing-the-weth-stored-in-bunnihub-jackson">
        
        
          <a href="#3-critical---anyone-can-call-the-peripherypayments-unwrapweth9-stealing-the-weth-stored-in-bunnihub-jackson" class="anchor-heading" aria-labelledby="3-critical---anyone-can-call-the-peripherypayments-unwrapweth9-stealing-the-weth-stored-in-bunnihub-jackson"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 3. Critical - Anyone can call the PeripheryPayments <code class="language-plaintext highlighter-rouge">unwrapWETH9()</code> stealing the weth stored in BunniHub (Jackson)
        
        
      </h3>
    
      <h4 id="technical-details-2">
        
        
          <a href="#technical-details-2" class="anchor-heading" aria-labelledby="technical-details-2"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Technical Details
        
        
      </h4>
    

<p>PeripheryPayments is a dependency of the LiquidityManagement contract, which is a dependency of the BunniHub contract.  PeripheryPayments has a <code class="language-plaintext highlighter-rouge">unwrapWETH9()</code> with no access control which allows a caller to the contract’s weth balance from the BunniHub contract to any recipient.</p>
      <h4 id="impact-2">
        
        
          <a href="#impact-2" class="anchor-heading" aria-labelledby="impact-2"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Impact
        
        
      </h4>
    

<p>Critical. Anyone can take the weth stored in BunniHub.</p>
      <h4 id="recommendation-2">
        
        
          <a href="#recommendation-2" class="anchor-heading" aria-labelledby="recommendation-2"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Recommendation
        
        
      </h4>
    

<p>Remove or access control the PeripheryPayments <code class="language-plaintext highlighter-rouge">unwrapWETH9()</code> function.</p>
      <h4 id="developer-response-zeframl-2">
        
        
          <a href="#developer-response-zeframl-2" class="anchor-heading" aria-labelledby="developer-response-zeframl-2"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Developer response (zeframL)
        
        
      </h4>
    

<p>Fixed in commit <a href="https://github.com/ZeframLou/bunni/commit/cfead992384cf959350439eb1ca79d73b0c528ac">cfead992384cf959350439eb1ca79d73b0c528ac</a> by removing PeripheryPayments.</p>
      <h2 id="high-findings">
        
        
          <a href="#high-findings" class="anchor-heading" aria-labelledby="high-findings"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> High Findings
        
        
      </h2>
    

<p>None.</p>
      <h2 id="medium-findings">
        
        
          <a href="#medium-findings" class="anchor-heading" aria-labelledby="medium-findings"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Medium Findings
        
        
      </h2>
    

<p>None.</p>
      <h2 id="low-findings">
        
        
          <a href="#low-findings" class="anchor-heading" aria-labelledby="low-findings"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Low Findings
        
        
      </h2>
    
      <h3 id="1-low---general-complexity-around-eth-management-including-certain-circumstances-where-eth-could-be-lost-devtooligan">
        
        
          <a href="#1-low---general-complexity-around-eth-management-including-certain-circumstances-where-eth-could-be-lost-devtooligan" class="anchor-heading" aria-labelledby="1-low---general-complexity-around-eth-management-including-certain-circumstances-where-eth-could-be-lost-devtooligan"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 1. Low - General complexity around ETH management including certain circumstances where ETH could be lost (devtooligan)
        
        
      </h3>
    
      <h4 id="technical-details-3">
        
        
          <a href="#technical-details-3" class="anchor-heading" aria-labelledby="technical-details-3"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Technical Details
        
        
      </h4>
    

<p>The <code class="language-plaintext highlighter-rouge">BunniHub</code> contract currently only has one <code class="language-plaintext highlighter-rouge">payable</code> function that can receive ETH which is the <code class="language-plaintext highlighter-rouge">receive()</code> found in <code class="language-plaintext highlighter-rouge">PeripheryPayments</code>. That function requires that the sender is WETH9.  In general <code class="language-plaintext highlighter-rouge">BunniHub</code> will not be interacting with ETH but there is functionality embedded with the <code class="language-plaintext highlighter-rouge">Uniswap</code> imports related to the management of ETH which adds complexity and some risk.</p>

<div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">abstract</span> <span class="k">contract</span> <span class="n">PeripheryPayments</span> <span class="k">is</span> <span class="n">IPeripheryPayments</span><span class="p">,</span> <span class="n">PeripheryImmutableState</span> <span class="p">{</span>
    <span class="k">receive</span><span class="p">()</span> <span class="k">external</span> <span class="k">payable</span> <span class="p">{</span>
        <span class="nb">require</span><span class="p">(</span><span class="n">msg</span><span class="p">.</span><span class="n">sender</span> <span class="o">==</span> <span class="n">WETH9</span><span class="p">,</span> <span class="s">'Not WETH9'</span><span class="p">);</span>
    <span class="p">}</span>
</code></pre></div></div>

<p>If for some reason someone unwrapped WETH and set the recipient to the BunniHub, then the contract would no hold the ETH.  This ETH could be taken by anyone via <code class="language-plaintext highlighter-rouge">refundEth()</code> or it could also be included used the next time anyone deposited into a WETH pool since <code class="language-plaintext highlighter-rouge">pay()</code> includes some logic that is designed to work with with unwrapping WETH:</p>
<div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">function</span> <span class="n">pay</span><span class="p">(</span>
        <span class="kt">address</span> <span class="n">token</span><span class="p">,</span>
        <span class="kt">address</span> <span class="n">payer</span><span class="p">,</span>
        <span class="kt">address</span> <span class="n">recipient</span><span class="p">,</span>
        <span class="kt">uint256</span> <span class="n">value</span>
    <span class="p">)</span> <span class="k">internal</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">token</span> <span class="o">==</span> <span class="n">WETH9</span> <span class="o">&amp;&amp;</span> <span class="kt">address</span><span class="p">(</span><span class="nb">this</span><span class="p">).</span><span class="nb">balance</span> <span class="o">&gt;=</span> <span class="n">value</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// pay with WETH9
</span>            <span class="n">IWETH9</span><span class="p">(</span><span class="n">WETH9</span><span class="p">).</span><span class="n">deposit</span><span class="p">{</span><span class="n">value</span><span class="o">:</span> <span class="n">value</span><span class="p">}();</span> <span class="c1">// wrap only what is needed to pay
</span>            <span class="n">IWETH9</span><span class="p">(</span><span class="n">WETH9</span><span class="p">).</span><span class="nb">transfer</span><span class="p">(</span><span class="n">recipient</span><span class="p">,</span> <span class="n">value</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">payer</span> <span class="o">==</span> <span class="kt">address</span><span class="p">(</span><span class="nb">this</span><span class="p">))</span> <span class="p">{</span>
            <span class="p">...</span>
</code></pre></div></div>
      <h4 id="impact-3">
        
        
          <a href="#impact-3" class="anchor-heading" aria-labelledby="impact-3"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Impact
        
        
      </h4>
    

<p>Low. It is a real edge case where a user could lose ETH via <code class="language-plaintext highlighter-rouge">pay()</code> but the general complexity of including the ETH management is more of a concern.</p>
      <h4 id="recommendation-3">
        
        
          <a href="#recommendation-3" class="anchor-heading" aria-labelledby="recommendation-3"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Recommendation
        
        
      </h4>
    

<p>Consider removing ETH management logic, including the <code class="language-plaintext highlighter-rouge">receive()</code> and <code class="language-plaintext highlighter-rouge">refundEth()</code> functions in PeripheryPayments, as well as the conditional logic found in <code class="language-plaintext highlighter-rouge">pay()</code>.</p>
      <h4 id="developer-response-zeframl-3">
        
        
          <a href="#developer-response-zeframl-3" class="anchor-heading" aria-labelledby="developer-response-zeframl-3"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Developer response (zeframL)
        
        
      </h4>
    

<p>Fixed in commit <a href="https://github.com/ZeframLou/bunni/commit/cfead992384cf959350439eb1ca79d73b0c528ac">cfead992384cf959350439eb1ca79d73b0c528ac</a> by removing PeripheryPayments.</p>
      <h3 id="2-low---calling-withdraw-forfeits-uncollected-lp-fees-devtooligan">
        
        
          <a href="#2-low---calling-withdraw-forfeits-uncollected-lp-fees-devtooligan" class="anchor-heading" aria-labelledby="2-low---calling-withdraw-forfeits-uncollected-lp-fees-devtooligan"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 2. Low - Calling <code class="language-plaintext highlighter-rouge">withdraw()</code> forfeits uncollected LP fees (devtooligan)
        
        
      </h3>
    
      <h4 id="technical-details-4">
        
        
          <a href="#technical-details-4" class="anchor-heading" aria-labelledby="technical-details-4"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Technical Details
        
        
      </h4>
    

<p>Fees are collected and reinvested via <code class="language-plaintext highlighter-rouge">compound()</code>, but when <code class="language-plaintext highlighter-rouge">withdraw()</code> is called, fees are not collected.</p>
      <h4 id="impact-4">
        
        
          <a href="#impact-4" class="anchor-heading" aria-labelledby="impact-4"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Impact
        
        
      </h4>
    

<p>Low. Depending on the size of the deposit and the amount of time since <code class="language-plaintext highlighter-rouge">compound()</code> was called, a depositor lose out on significant portion of fees.</p>
      <h4 id="recommendation-4">
        
        
          <a href="#recommendation-4" class="anchor-heading" aria-labelledby="recommendation-4"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Recommendation
        
        
      </h4>
    

<p>Consider adding a second function <code class="language-plaintext highlighter-rouge">compoundAndWithdraw()</code> or else adding a bool to the current <code class="language-plaintext highlighter-rouge">withdraw()</code> which explicitly indicates whether or not <code class="language-plaintext highlighter-rouge">compound()</code> should be called prior to <code class="language-plaintext highlighter-rouge">withdraw()</code>.</p>
      <h4 id="developer-response-zeframl-4">
        
        
          <a href="#developer-response-zeframl-4" class="anchor-heading" aria-labelledby="developer-response-zeframl-4"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Developer response (zeframL)
        
        
      </h4>
    

<p>This is fine, since <code class="language-plaintext highlighter-rouge">BunniHub</code> inherits <code class="language-plaintext highlighter-rouge">Multicall</code> where the caller can batch multiple calls in the same transaction. If the user is okay with paying the extra gas cost, the user can choose to call <code class="language-plaintext highlighter-rouge">compound()</code> before <code class="language-plaintext highlighter-rouge">withdraw()</code>.</p>
      <h2 id="gas-savings-findings">
        
        
          <a href="#gas-savings-findings" class="anchor-heading" aria-labelledby="gas-savings-findings"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Gas Savings Findings
        
        
      </h2>
    
      <h3 id="1-gas---optimize-the-sweeptokens-loop-devtooligan">
        
        
          <a href="#1-gas---optimize-the-sweeptokens-loop-devtooligan" class="anchor-heading" aria-labelledby="1-gas---optimize-the-sweeptokens-loop-devtooligan"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 1. Gas - Optimize the <code class="language-plaintext highlighter-rouge">sweepTokens()</code> loop (devtooligan)
        
        
      </h3>
    
      <h4 id="technical-details-5">
        
        
          <a href="#technical-details-5" class="anchor-heading" aria-labelledby="technical-details-5"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Technical Details
        
        
      </h4>
    

<div class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">@@ -436,12 +453,16 @@</span> contract BunniHub is
<span class="gd">-        for (uint256 i = 0; i &lt; tokenList.length; i++) {
</span><span class="gi">+        uint256 tokenListLength = tokenList.length;
+        for (uint256 i = 0; i &lt; tokenListLength;) {
</span>             SafeTransferLib.safeTransfer(
                 tokenList[i],
                 recipient,
                 tokenList[i].balanceOf(address(this))
             );
<span class="gi">+            unchecked {
+                ++i;
+            }
</span>         }
</code></pre></div></div>

<p>Incrementing <code class="language-plaintext highlighter-rouge">i</code> can be done in an unchecked block because the number of tokens will not overflow saving 108 gas per per iteration.
The length of an array can be stored outside of the for loop for additional gas savings 3 gas per iteration.of as is suggested <a href="https://gist.github.com/hrkrshnn/ee8fabd532058307229d65dcd5836ddc#caching-the-length-in-for-loops">here.</a>
Incrementing with <code class="language-plaintext highlighter-rouge">++i</code> instead of <code class="language-plaintext highlighter-rouge">i++</code> saves ~5 gas per iteration from reduced stack operations.</p>
      <h4 id="impact-5">
        
        
          <a href="#impact-5" class="anchor-heading" aria-labelledby="impact-5"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Impact
        
        
      </h4>
    

<p>Gas savings ~115 per token submitted.</p>
      <h4 id="developer-response-zeframl-5">
        
        
          <a href="#developer-response-zeframl-5" class="anchor-heading" aria-labelledby="developer-response-zeframl-5"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Developer response (zeframL)
        
        
      </h4>
    

<p>Fixed in commit <a href="https://github.com/ZeframLou/bunni/commit/8587a86bb5f45a5bcf82d10ce22cca04989b2abd">8587a86bb5f45a5bcf82d10ce22cca04989b2abd</a>.</p>
      <h2 id="informational-findings">
        
        
          <a href="#informational-findings" class="anchor-heading" aria-labelledby="informational-findings"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Informational Findings
        
        
      </h2>
    
      <h3 id="1-informational---upgrade-to-at-least-solidity-084-devtooligan">
        
        
          <a href="#1-informational---upgrade-to-at-least-solidity-084-devtooligan" class="anchor-heading" aria-labelledby="1-informational---upgrade-to-at-least-solidity-084-devtooligan"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 1. Informational - Upgrade to at least solidity 0.8.4 (devtooligan)
        
        
      </h3>
    
      <h4 id="technical-details-6">
        
        
          <a href="#technical-details-6" class="anchor-heading" aria-labelledby="technical-details-6"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Technical Details
        
        
      </h4>
    

<p>Currently there is no underflow or overflow protection at the compiler level in Bunni, which means SafeMath style libraries are necessary, which are gas inefficient compared to the compiler and potentially less safe.  Also see <a href="https://gist.github.com/hrkrshnn/ee8fabd532058307229d65dcd5836ddc#upgrade-to-at-least-084">
hrkrshnn’s related comment.</a></p>
      <h4 id="impact-6">
        
        
          <a href="#impact-6" class="anchor-heading" aria-labelledby="impact-6"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Impact
        
        
      </h4>
    

<p>Informational.</p>
      <h4 id="recommendation-5">
        
        
          <a href="#recommendation-5" class="anchor-heading" aria-labelledby="recommendation-5"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Recommendation
        
        
      </h4>
    

<p>Uniswap V3 now has a 0.8 branch of their contracts.  Consider using this branch and upgrading to a more modern version of Solidity.</p>
      <h4 id="developer-response-zeframl-6">
        
        
          <a href="#developer-response-zeframl-6" class="anchor-heading" aria-labelledby="developer-response-zeframl-6"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Developer response (zeframL)
        
        
      </h4>
    

<p>Fixed in commit <a href="https://github.com/ZeframLou/bunni/commit/d2a7f886ce619096c4c79c7a89c4bcc06e941a81">d2a7f886ce619096c4c79c7a89c4bcc06e941a81</a>.</p>
      <h3 id="2-informational---use-latest-versions-of-unmodified-libraries-devtooligan">
        
        
          <a href="#2-informational---use-latest-versions-of-unmodified-libraries-devtooligan" class="anchor-heading" aria-labelledby="2-informational---use-latest-versions-of-unmodified-libraries-devtooligan"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 2. Informational - Use latest versions of unmodified libraries (devtooligan)
        
        
      </h3>
    
      <h4 id="technical-details-7">
        
        
          <a href="#technical-details-7" class="anchor-heading" aria-labelledby="technical-details-7"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Technical Details
        
        
      </h4>
    

<p>The contracts are using Solidity 0.7.6 some library contracts (CREATE3, ERC20, and SafeTransferLib) were copied into the directory rather than being imported.  However, due to these being copied into the project and also because of some modifications, they do not match the latest versions of these projects.</p>
      <h4 id="impact-7">
        
        
          <a href="#impact-7" class="anchor-heading" aria-labelledby="impact-7"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Impact
        
        
      </h4>
    

<p>Informational.</p>
      <h4 id="recommendation-6">
        
        
          <a href="#recommendation-6" class="anchor-heading" aria-labelledby="recommendation-6"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Recommendation
        
        
      </h4>
    

<p>We recommend using the latest versions of the libraries, and using the libraries without modification.</p>
      <h4 id="developer-response-zeframl-7">
        
        
          <a href="#developer-response-zeframl-7" class="anchor-heading" aria-labelledby="developer-response-zeframl-7"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Developer response (zeframL)
        
        
      </h4>
    

<p>Fixed in commit <a href="https://github.com/ZeframLou/bunni/commit/d2a7f886ce619096c4c79c7a89c4bcc06e941a81">d2a7f886ce619096c4c79c7a89c4bcc06e941a81</a>. Note that <code class="language-plaintext highlighter-rouge">ERC20</code> and <code class="language-plaintext highlighter-rouge">SafeTransferLib</code> still need to be copied and modified, because we need <code class="language-plaintext highlighter-rouge">ERC20</code> to inherit from <code class="language-plaintext highlighter-rouge">IERC20</code> in order to allow <code class="language-plaintext highlighter-rouge">BunniToken</code> to inherit from both <code class="language-plaintext highlighter-rouge">ERC20</code> and <code class="language-plaintext highlighter-rouge">IERC20</code>.</p>
      <h3 id="3-informational---consider-foundry-scripting-for-the-deployment-scripts-jackson">
        
        
          <a href="#3-informational---consider-foundry-scripting-for-the-deployment-scripts-jackson" class="anchor-heading" aria-labelledby="3-informational---consider-foundry-scripting-for-the-deployment-scripts-jackson"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 3. Informational - Consider Foundry scripting for the deployment scripts (Jackson)
        
        
      </h3>
    
      <h4 id="technical-details-8">
        
        
          <a href="#technical-details-8" class="anchor-heading" aria-labelledby="technical-details-8"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Technical Details
        
        
      </h4>
    

<p>Currently bash scripts are used for the deployment scripts.  While they are currently relatively simple, as the project progresses this may no longer be the case.</p>
      <h4 id="impact-8">
        
        
          <a href="#impact-8" class="anchor-heading" aria-labelledby="impact-8"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Impact
        
        
      </h4>
    

<p>Informational.</p>
      <h4 id="recommendation-7">
        
        
          <a href="#recommendation-7" class="anchor-heading" aria-labelledby="recommendation-7"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Recommendation
        
        
      </h4>
    

<p>Since Foundry is used in the project for testing, consider migrating to Foundry for the deployment scripts as well, as it provides a few benefits over a bash script, to include compile time checking and transaction simulation.</p>
      <h4 id="developer-response-zeframl-8">
        
        
          <a href="#developer-response-zeframl-8" class="anchor-heading" aria-labelledby="developer-response-zeframl-8"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Developer response (zeframL)
        
        
      </h4>
    

<p>Fixed in <a href="https://github.com/ZeframLou/bunni/commit/86739fcec723fc7be7d2386152d369597c532ef3">86739fcec723fc7be7d2386152d369597c532ef3</a>.</p>
      <h3 id="4-informational---typo-in-readme-jackson">
        
        
          <a href="#4-informational---typo-in-readme-jackson" class="anchor-heading" aria-labelledby="4-informational---typo-in-readme-jackson"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 4. Informational - Typo in README (Jackson)
        
        
      </h3>
    
      <h4 id="technical-details-9">
        
        
          <a href="#technical-details-9" class="anchor-heading" aria-labelledby="technical-details-9"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Technical Details
        
        
      </h4>
    

<p>There is a typo in the README “perfer”.</p>
      <h4 id="impact-9">
        
        
          <a href="#impact-9" class="anchor-heading" aria-labelledby="impact-9"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Impact
        
        
      </h4>
    

<p>Informational.</p>
      <h4 id="recommendation-8">
        
        
          <a href="#recommendation-8" class="anchor-heading" aria-labelledby="recommendation-8"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Recommendation
        
        
      </h4>
    

<p>Change “perfer” to “prefer”.</p>
      <h4 id="developer-response-zeframl-9">
        
        
          <a href="#developer-response-zeframl-9" class="anchor-heading" aria-labelledby="developer-response-zeframl-9"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Developer response (zeframL)
        
        
      </h4>
    

<p>Fixed in commit <a href="5ebca63def23b21004efbbff84a7f105438a6308">5ebca63def23b21004efbbff84a7f105438a6308</a>.</p>
      <h3 id="5-informational---consider-adding-npm-related-steps-to-the-readme-jackson">
        
        
          <a href="#5-informational---consider-adding-npm-related-steps-to-the-readme-jackson" class="anchor-heading" aria-labelledby="5-informational---consider-adding-npm-related-steps-to-the-readme-jackson"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 5. Informational - Consider adding npm related steps to the README (Jackson)
        
        
      </h3>
    
      <h4 id="technical-details-10">
        
        
          <a href="#technical-details-10" class="anchor-heading" aria-labelledby="technical-details-10"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Technical Details
        
        
      </h4>
    

<p>npm is used to manage dependencies but this information is not present in the README.</p>
      <h4 id="impact-10">
        
        
          <a href="#impact-10" class="anchor-heading" aria-labelledby="impact-10"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Impact
        
        
      </h4>
    

<p>Informational.</p>
      <h4 id="recommendation-9">
        
        
          <a href="#recommendation-9" class="anchor-heading" aria-labelledby="recommendation-9"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Recommendation
        
        
      </h4>
    

<p>Consider adding the dependency management steps to the README for future contributors.</p>
      <h4 id="developer-response-zeframl-10">
        
        
          <a href="#developer-response-zeframl-10" class="anchor-heading" aria-labelledby="developer-response-zeframl-10"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Developer response (zeframL)
        
        
      </h4>
    

<p>Fixed in commit <a href="5ebca63def23b21004efbbff84a7f105438a6308">5ebca63def23b21004efbbff84a7f105438a6308</a>.</p>
      <h3 id="6-informational---consider-removing-the-weth-unwrapping-logic-jackson">
        
        
          <a href="#6-informational---consider-removing-the-weth-unwrapping-logic-jackson" class="anchor-heading" aria-labelledby="6-informational---consider-removing-the-weth-unwrapping-logic-jackson"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 6. Informational - Consider removing the WETH unwrapping logic (Jackson)
        
        
      </h3>
    
      <h4 id="technical-details-11">
        
        
          <a href="#technical-details-11" class="anchor-heading" aria-labelledby="technical-details-11"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Technical Details
        
        
      </h4>
    

<p>One of the critical findings is related to WETH management.  If it’s not necessary it is a source of unecessary additional complexity that may lead to other future vulnerabilities.</p>
      <h4 id="impact-11">
        
        
          <a href="#impact-11" class="anchor-heading" aria-labelledby="impact-11"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Impact
        
        
      </h4>
    

<p>Informational.</p>
      <h4 id="recommendation-10">
        
        
          <a href="#recommendation-10" class="anchor-heading" aria-labelledby="recommendation-10"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Recommendation
        
        
      </h4>
    

<p>Consider removing this functionality from all contracts and treat WETH as any other token in order to simplify the logic.</p>
      <h4 id="developer-response-zeframl-11">
        
        
          <a href="#developer-response-zeframl-11" class="anchor-heading" aria-labelledby="developer-response-zeframl-11"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Developer response (zeframL)
        
        
      </h4>
    

<p>Fixed in commit <a href="https://github.com/ZeframLou/bunni/commit/cfead992384cf959350439eb1ca79d73b0c528ac">cfead992384cf959350439eb1ca79d73b0c528ac</a> by removing PeripheryPayments.</p>
      <h2 id="final-remarks">
        
        
          <a href="#final-remarks" class="anchor-heading" aria-labelledby="final-remarks"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Final remarks
        
        
      </h2>
    
      <h3 id="devtooligan">
        
        
          <a href="#devtooligan" class="anchor-heading" aria-labelledby="devtooligan"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> devtooligan
        
        
      </h3>
    

<p>We conducted extensive testing based on a mainnet fork to ensure realistic interaction with Uniswap deployed contracts.  We stress tested the <code class="language-plaintext highlighter-rouge">deposit()</code> and <code class="language-plaintext highlighter-rouge">withdraw()</code> by conducting unit and fuzz tests on multiple scenarios including changing the existing liquidity (through deposit/withdraws) before/after transactions as well as affecting the market price of the pair itself through Uniswap trades.  In all of these tests, the target amount being tested was unaffected, remaining constant to the wei.  We noted some seemingly unnecessary complexity and risk associated with WETH/ETH logic which can probably be removed completely.  Additionally, all functions in the SafeTransferLib implementation were stress tested with fuzzing and no counterexamples were found.  Overall, I found the contracts to be clean, well documented, and using best practices.</p>
      <h3 id="jackson">
        
        
          <a href="#jackson" class="anchor-heading" aria-labelledby="jackson"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Jackson
        
        
      </h3>
    

<p>I spent quite a bit of time trying to manipulate the underlying pool in an attempt to get more BunniToken shares, or more underlying tokens from the pool when withdrawing.  But, none of these approaches proved fruitful.  This is primarily because the ticks used with the Uniswap V3 liquidity pools mean that deposits and withdrawals are contained to those liquidity ranges and those liquidity ranges only even if the pool itself is not trading in those liquidity ranges.  As is said in the Bunni README, the project is an ERC20 wrapper over the Uniswap V3 LP NFTs, which makes the system somewhat simple and therefore hard to game and relatively safe from a security perspective.</p>
      <h2 id="about-yacademy">
        
        
          <a href="#about-yacademy" class="anchor-heading" aria-labelledby="about-yacademy"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> About yAcademy
        
        
      </h2>
    

<p><a href="https://yacademy.dev/">yAcademy</a> is an ecosystem initiative started by Yearn Finance and its ecosystem partners to bootstrap sustainable and collaborative blockchain security reviews and to nurture aspiring security talent. yAcademy includes <a href="https://yacademy.dev/fellowship-program/">a fellowship program</a>, a residents program, and <a href="https://yacademy.dev/guest-auditor-program/">a guest auditor program</a>. In the fellowship program, fellows perform a series of periodic security reviews and presentations during the program. Residents are past fellows who continue to gain experience by performing security reviews of contracts submitted to yAcademy for review (such as this contract). Guest auditors are experts with a track record in the security space who temporarily assist with the review efforts.</p>

        

        

        
        
          <hr>
          <footer>
            
              <p><a href="#top" id="back-to-top">Back to top</a></p>
            

            

            
              <div class="d-flex mt-2">
                
                
              </div>
            
          </footer>
        

      </div>
    </div>

    
      

      <div class="search-overlay"></div>
    
  </div>
  <link rel="image_src" href="https://yaudit.dev/assets/images/logo.png" />
</body>

  <script>
    var config = {}
;
    mermaid.initialize(config);
    window.mermaid.init(undefined, document.querySelectorAll('.language-mermaid'));
  </script>

</html>

